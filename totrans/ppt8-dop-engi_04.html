<html><head></head><body>
		<div id="_idContainer020">
			<h1 id="_idParaDest-71" class="chapter-number"><a id="_idTextAnchor078"/>4</h1>
			<h1 id="_idParaDest-72"><a id="_idTextAnchor079"/>Variables and Data Types</h1>
			<p>This chapter will cover how Puppet handles variables and, in particular, how Puppet differs from most declarative languages in terms of how they are used and declared. We will look at the core data types that are used to define what the value of a variable can contain and how it can be interacted with. Then, we will look at how data types and variables allow the classes we discussed in <a href="B18492_03.xhtml#_idTextAnchor048"><span class="No-Break"><em class="italic">Chapter 3</em></span></a> to receive external data and handle <span class="No-Break">default values.</span></p>
			<p>Arrays and hashes will be discussed in detail, including how to declare them, access values, and manipulate them with operations. The <strong class="source-inline">Sensitive</strong> data type will be shown, which you can use to secure values in logs and reports while making the limitations of this data type and what it does not secure clear. We will also cover abstract data types and show you how to allow more complex and flexible definitions of variables and values. The chapter will finish by covering how variable scopes and namespaces work with variables. We will also discuss the scope of variables and how variables from different scopes can be accessed and which scopes can access which levels <span class="No-Break">of data.</span></p>
			<p>In this chapter, we are going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li><span class="No-Break">Variables</span></li>
				<li><span class="No-Break">Data types</span></li>
				<li>Arrays <span class="No-Break">and hashes</span></li>
				<li>Abstract data types, <span class="No-Break">including </span><span class="No-Break"><strong class="source-inline">Sensitive</strong></span></li>
				<li><span class="No-Break">Scope</span></li>
			</ul>
			<h1 id="_idParaDest-73"><a id="_idTextAnchor080"/>Technical requirements</h1>
			<p>For this chapter, you will need to provision a Puppet server standard architecture with a Windows client and a Linux client by downloading the <strong class="source-inline">params.json</strong> file from <a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/params.json">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/params.json</a> and then using the following command from your <span class="No-Break"><strong class="source-inline">pecdm</strong></span><span class="No-Break"> directory:</span></p>
			<pre class="source-code">
<strong class="bold">bolt --verbose plan run pecdm::provision –params @<a id="_idTextAnchor081"/>params.json</strong></pre>
			<p>In various sections of this chapter, examples will be given of using the <strong class="source-inline">notify</strong> function, which outputs to the agent command line. These examples can just be run in the local development environment by putting all the code into a manifest file – for example, <strong class="source-inline">example.pp</strong> – and then running <strong class="source-inline">puppet </strong><span class="No-Break"><strong class="source-inline">apply example.pp</strong></span><span class="No-Break">.</span></p>
			<p>Alternatively, any variables that are required can be set using the environment variable format of <strong class="source-inline">FACTER_variable_name</strong> and running <strong class="source-inline">puppet apply –e '&lt;example_code&gt;'</strong>. To run one of the <a id="_idTextAnchor082"/>substring examples, you can run the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
<strong class="bold">export FACTER_example_string='substring'</strong>
<strong class="bold"><a id="_idTextAnchor083"/>puppet apply -e '<a id="_idTextAnchor084"/>notify{ "${example_string[3]}"<a id="_idTextAnchor085"/>: }'</strong></pre>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor086"/>Variables</h1>
			<p>In this section, we will<a id="_idIndexMarker192"/> cover how to use variables in Puppet and how this differs from other procedural languages. The key thing to understand about Puppet variables is that they are only assigned once during compilation in a given scope. In a traditional procedural language, it’s common to use variables throughout your code, where you might gather the current state as your code runs, use variables to keep track of it, and update it to act and make procedural decisions at various stages of your code. The following is an example of a simple PowerShell script that runs a command several times and adds the output to a single variable. It does so by using <strong class="source-inline">select-string</strong> to search for files containing <strong class="source-inline">?</strong> in the <strong class="source-inline">.sh</strong> and <strong class="source-inline">.pp</strong> files in the user’s <span class="No-Break">code directory:</span></p>
			<pre class="source-code">
$Matches = Select-String -Path "$PSHOME\code\*.sh" -Pattern '\?
…
…
$Matches = $Matches + Select-String -Path "$PSHOME\code\*.pp" -Pattern '\?</pre>
			<p>This state check is not done in Puppet since all evaluation takes place at the start of the catalog, based on the state the server sent to be compiled. This, in turn, provides the steps required to get it into a desired state. In Puppet, we assign variables for repetitive uses such as file paths or conditional logic such as <strong class="source-inline">if</strong> or <strong class="source-inline">case</strong>. In these cases, a value must be chosen to be assigned, depending on the <span class="No-Break">initial state.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">We are simplifying the process slightly here as there are now deferred functions that can run after complications. However, this still does not allow us to reassign variables. We will cover this in more detail in <a href="B18492_05.xhtml#_idTextAnchor123"><span class="No-Break"><em class="italic">Chapter 5</em></span></a><span class="No-Break">.</span></p>
			<p>Puppet variables are declared with a dollar sign (<strong class="source-inline">$</strong>) followed by the variable’s name, an equals symbol (<strong class="source-inline">=</strong>), and the value to assign. For example, a variable called <strong class="source-inline">example_variable</strong> that’s assigned a value of <strong class="source-inline">'this is a value'</strong> would look <span class="No-Break">like this:</span></p>
			<pre class="source-code">
$example_variable = 'this is a value'</pre>
			<p>Note that, unlike resources, variables<a id="_idIndexMarker193"/> depend on the order of evaluation and must be declared in code before they <span class="No-Break">are called.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">There are several variables known as built-in variables that return server information. However, since these are more about infrastructure and the environment, they will be covered in <a href="B18492_10.xhtml#_idTextAnchor252"><span class="No-Break"><em class="italic">Chapter 10</em></span></a> and <a href="B18492_11.xhtml#_idTextAnchor272"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, where they will <span class="No-Break">be relevant.</span></p>
			<h2 id="_idParaDest-75"><a id="_idTextAnchor087"/>Naming</h2>
			<p>Variable names are <a id="_idIndexMarker194"/>case-sensitive, and they can include upper and lowercase letters, numbers, and underscores but must start with an underscore (<strong class="source-inline">_</strong>) or lowercase letter. The exception is regex capture variables, which are variables only named with numbers such <a id="_idIndexMarker195"/>as <strong class="source-inline">$0</strong>, <strong class="source-inline">$1</strong>, and so on. We will cover these in <a href="B18492_07.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic">Chapter 7</em></span></a> and <a href="B18492_11.xhtml#_idTextAnchor272"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, where we will use them as part of conditionals and <span class="No-Break">node definitions.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Starting a variable name with an underscore will limit it to local scope use, as discussed in detail at the end of <span class="No-Break">this chapter.</span></p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor088"/>Reserved variable names</h2>
			<p>There are several <a id="_idIndexMarker196"/>built-in variables that you cannot use in your code. These are <a id="_idIndexMarker197"/><span class="No-Break">as follows:</span></p>
			<ul>
				<li><strong class="source-inline">$</strong><span class="No-Break"><strong class="source-inline">facts</strong></span></li>
				<li><strong class="source-inline">$</strong><span class="No-Break"><strong class="source-inline">trusted</strong></span></li>
				<li><strong class="source-inline">$</strong><span class="No-Break"><strong class="source-inline">server_facts</strong></span></li>
			</ul>
			<p>These are all built-in variables generated from Facter, which cannot be used or reassigned. We will discuss these variables in detail in <a href="B18492_05.xhtml#_idTextAnchor123"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, as well as what values <span class="No-Break">they provide.</span></p>
			<p>As we covered in <a href="B18492_03.xhtml#_idTextAnchor048"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, the <strong class="source-inline">$title</strong> and <strong class="source-inline">$name</strong> variables are used by classes and defined types and should not <span class="No-Break">be used.</span></p>
			<p>The full list of reserved words<a id="_idIndexMarker198"/> can be viewed in the Puppet documentation <span class="No-Break">at </span><a href="https://www.puppet.com/docs/puppet/8/lang_reserved.html"><span class="No-Break">https://www.puppet.com/docs/puppet/8/lang_reserved.html</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor089"/>Interpolation</h2>
			<p>Puppet variables can be <a id="_idIndexMarker199"/>evaluated and resolved into their assigned values when called without quotes or as part of a variable mixed with our data in double quotes. The style guide enforced by the lint checks will ensure single quotes are used when an assignment does not contain a variable and no quotes are used when an assignment only contains a variable. A mix of values and variables can be written with double quotes. When you should use a mix is stated in the style guide. This is checked by the linter to ensure it uses curly braces <strong class="source-inline">{}</strong>. This can be seen in the following example of assigning <strong class="source-inline">mixed_variable</strong> to the variable’s declaration when using double quotes <span class="No-Break">for interpolation:</span></p>
			<pre class="source-code">
$database_id = $dbname
$base_directory = '/opt'
$database_directory = "${base_directory}/database/${database_id}"</pre>
			<p>As we described in the<a id="_idIndexMarker200"/> previous chapter, the <strong class="source-inline">notify</strong> function can be used to check the values <span class="No-Break">of variables:</span></p>
			<pre class="source-code">
notify{'debug variable':
  message =&gt; "The database directory is ${database_directory}"
}</pre>
			<p>This section discussed how Puppet variables differ compared to other programming languages due to statefulness and how it can declare, access, and <span class="No-Break">name variables.</span></p>
			<h1 id="_idParaDest-78"><a id="_idTextAnchor090"/>Data types</h1>
			<p>Every value in Puppet has a<a id="_idIndexMarker201"/> data type; in the previous section, for example, the variables had <strong class="source-inline">String</strong> values assigned. A data type, when used as a capitalized unquoted string, such as <strong class="source-inline">Integer</strong>, can be used to specify what parameters in a class, defined type, or lambda should contain, allowing the data to <span class="No-Break">be validated:</span></p>
			<pre class="source-code">
class example (
  String example_string = 'hello world',
  Integer example_integer = 1
) {
}</pre>
			<p>Data types can also be used to compare a variable’s value, conditionally check values, and take different actions, depending on the result. For example, to confirm that a variable contains an integer, the following match expression can be used. Here, we are confirming that the <strong class="source-inline">example_integer</strong> variable contains <span class="No-Break">an integer:</span></p>
			<pre class="source-code">
$example_integer =~ Integer</pre>
			<p>Conditional statements and comparisons will be covered in full in <a href="B18492_07.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic">Chapter 7</em></span></a><span class="No-Break">.</span></p>
			<p>The next section will run through the most commonly used core Puppet data types. Unfortunately, Puppet has no equivalent to the <strong class="source-inline">puppet describe</strong> command for data types .so all references must <a id="_idIndexMarker202"/>be taken from the web and GitHub documentation at <a href="https://www.puppet.com/docs/puppet/8/lang_data_type.html">https://www.puppet.com/docs/puppet/8/lang_data_type.html</a>. If you’re using types provided by modules from the forge, which will be covered in detail in <a href="B18492_08.xhtml#_idTextAnchor212"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, the documentation should be on the reference page of the module. Various functions work with data types, but we will not cover this here. We will look at functions in detail in <a href="B18492_05.xhtml#_idTextAnchor123"><span class="No-Break"><em class="italic">Chapter 5</em></span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor091"/>Strings</h2>
			<p>Strings are<a id="_idIndexMarker203"/> the most <a id="_idIndexMarker204"/>common data type used in Puppet and, as discussed in <a href="B18492_01.xhtml#_idTextAnchor018"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, were originally the only type of data used in early Puppet. Strings are pieces of unstructured text of any length, encoded in UTF-8. There are four ways to declare strings <span class="No-Break">in Puppet:</span></p>
			<ul>
				<li><span class="No-Break">Unquoted</span></li>
				<li><span class="No-Break">Single quoted</span></li>
				<li><span class="No-Break">Double quoted</span></li>
				<li><span class="No-Break">Heredocs</span></li>
			</ul>
			<h3>Unquoted strings</h3>
			<p>Unquoted strings are <a id="_idIndexMarker205"/>single words <a id="_idIndexMarker206"/>starting with a lowercase letter and containing only letters, digits, hyphens (<strong class="source-inline">-</strong>), and underscores (<strong class="source-inline">_</strong>) and must not be reserved words. Reserved words are typically keywords such as class or other language<a id="_idIndexMarker207"/> functions; the full list can be viewed <span class="No-Break">at </span><a href="https://www.puppet.com/docs/puppet/8/lang_reserved.html#lang_reserved_words"><span class="No-Break">https://www.puppet.com/docs/puppet/8/lang_reserved.html#lang_reserved_words</span></a><span class="No-Break">.</span></p>
			<p>Unquoted strings are used for resource attributes that accept a limited set of words, such as the Puppet service resource type, which accepts <strong class="source-inline">running<a id="_idTextAnchor092"/></strong> or <strong class="source-inline">stopped</strong> for its <span class="No-Break"><strong class="source-inline">ensure</strong></span><span class="No-Break"> attribute:</span></p>
			<pre class="source-code">
service { 'defragsvc':
  ensure =&gt; stopped
}</pre>
			<h3>Single-quoted strings</h3>
			<p>Single-quoted strings can <a id="_idIndexMarker208"/>contain multiple words but, as previously discussed, cannot <a id="_idIndexMarker209"/>interpolate variables. However, they can contain line breaks and escape sequences using a backslash (<strong class="source-inline">\</strong>), an escape backslash, or a single quote (<strong class="source-inline">'</strong>). This allows the use of single quotes within the string itself and for a backslash to be used at the end of a string. Additionally, a line break can be achieved via the <span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break"> key.</span></p>
			<p>The following example shows the <strong class="source-inline">sed_command</strong> variable with the single quotes needed as part of the <strong class="source-inline">sed</strong> command to escape in the single-quoted string and then the <strong class="source-inline">install_dir</strong> variable for a Windows file path with an <span class="No-Break">ending backslash:</span></p>
			<pre class="source-code">
$sed_command = '/usr/bin/sed -i \'s/old/new/g\''
$intall_dir = 'c:\Program Files(x86)\exampleapp\\'</pre>
			<h3>Double-quoted</h3>
			<p>Double-quoted strings<a id="_idIndexMarker210"/> can fully interpolate variables and more available<a id="_idIndexMarker211"/> escape characters. In addition to the single quote, backslash, and escape characters, double quotes can interpret <span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="source-inline">\</strong><span class="No-Break"><strong class="source-inline">n</strong></span><span class="No-Break">: Newline</span></li>
				<li><strong class="source-inline">\r</strong>: <span class="No-Break">Carriage return</span></li>
				<li><strong class="source-inline">\</strong><span class="No-Break"><strong class="source-inline">s</strong></span><span class="No-Break">: Space</span></li>
				<li><strong class="source-inline">\</strong><span class="No-Break"><strong class="source-inline">t</strong></span><span class="No-Break">: Tab</span></li>
				<li><strong class="source-inline">\$</strong>: Dollar sign, to prevent <span class="No-Break">variable interpolation</span></li>
				<li><strong class="source-inline">\uXXXX</strong>: Here, <strong class="source-inline">xxxx</strong> is a four-digit hex number for a <span class="No-Break">Unicode character</span></li>
				<li><strong class="source-inline">\u{X}</strong>: Here, <strong class="source-inline">X</strong> is a hex number between two and six digits between curly <span class="No-Break">braces, </span><span class="No-Break"><strong class="source-inline">{}</strong></span></li>
				<li><strong class="source-inline">\"</strong>: <span class="No-Break">Double quote</span></li>
				<li><strong class="source-inline">\r\n</strong>: Window <span class="No-Break">line break</span></li>
			</ul>
			<p>As per single quotes, a <a id="_idIndexMarker212"/>line break <a id="_idIndexMarker213"/>can also be used within text (that is, just by <span class="No-Break">hitting </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">).</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">If a backslash is used in double quotes without you escaping it and without a valid escape character after, it will continue and treat it as normal characters but result in the following message in the logs: <em class="italic">Warning: Unrecognized escape sequence</em>. Here is <span class="No-Break">an example:</span></p>
			<p class="callout"><strong class="source-inline">Warning: Unrecognized escape sequence '\T' </strong><span class="No-Break"><strong class="source-inline">at C:/Users/david/code/test.pp:1:50</strong></span></p>
			<p class="callout">This commonly affects Windows user paths that are used in <span class="No-Break">double quotes.</span></p>
			<p>A simple <a id="_idIndexMarker214"/>example of a double-quoted string making use of new lines and tabs (which are important to the syntax of Makefile content) is as follows. This creates a string to then be<a id="_idIndexMarker215"/> used in the content of <span class="No-Break">a file:</span></p>
			<pre class="source-code">
$make_file_content = "hello:\n\techo \"hello world\""
file '/home/david/makefile' : {
  content =&gt; $make_file_content
}</pre>
			<h3>Heredocs</h3>
			<p>Puppet’s implementation <a id="_idIndexMarker216"/>of heredocs<a id="_idIndexMarker217"/> involves using a tag to indicate the start and end of the heredoc file’s content. The starting tag is typically composed of the <span class="No-Break">following elements:</span></p>
			<ul>
				<li><strong class="source-inline">'@('</strong></li>
				<li>A string, known as the end text, that may be surrounded by double quotes to <span class="No-Break">enable interpolation</span></li>
				<li>An optional escape switch (or switches) that begin with a forward slash to enable escape switches in <span class="No-Break">the text</span></li>
				<li>An optional colon (<strong class="source-inline">:</strong>) followed by a syntax <span class="No-Break">name check</span></li>
				<li><strong class="source-inline">')'</strong></li>
			</ul>
			<p>To use a heredoc in Puppet, the content should be entered on the lines immediately following the starting tag, with the exact formatting that is desired. The end of the heredoc is indicated by an end tag, which should include the <span class="No-Break">following elements:</span></p>
			<ul>
				<li>An optional vertical bar (<strong class="source-inline">|</strong>), which indicates how much indentation should be stripped from the lines of <span class="No-Break">the text</span></li>
				<li>An optional hyphen (<strong class="source-inline">-</strong>), which removes the final line break from <span class="No-Break">the heredoc</span></li>
				<li>The same end text tag that was used in the <span class="No-Break">starting tag</span></li>
			</ul>
			<p>The end text in a Puppet heredoc is a string that can consist of mixed-case letters, numbers, and spaces, but cannot include line breaks, slashes, colons, or parentheses. By default, the content of the heredoc will not interpret escape characters, so optional escape switches must be declared if they are needed. The following escape switches are available and mirror the same escape sequences for double-quoted strings, but do not require double quotes (since they have no special meaning <span class="No-Break">in heredocs):</span></p>
			<ul>
				<li><strong class="source-inline">n</strong>: <span class="No-Break">New line</span></li>
				<li><strong class="source-inline">r</strong>: <span class="No-Break">Carriage return</span></li>
				<li><span class="No-Break"><strong class="source-inline">t</strong></span><span class="No-Break">: Tab</span></li>
				<li><span class="No-Break"><strong class="source-inline">s</strong></span><span class="No-Break">: Space</span></li>
				<li><strong class="source-inline">$</strong>: Dollar sign, to prevent interpolation if the end text <span class="No-Break">is double-quoted</span></li>
				<li><strong class="source-inline">u</strong>: <span class="No-Break">Unicode characters</span></li>
				<li><strong class="source-inline">L</strong>: A new line or <span class="No-Break">carriage return</span></li>
				<li><strong class="source-inline">\:</strong>: All of the previously mentioned escape sequences <span class="No-Break">are available</span></li>
			</ul>
			<p>When any escape sequence is selected, you can use <strong class="source-inline">\\</strong> to escape <span class="No-Break">a backslash.</span></p>
			<p>Variable interpolation is disabled by default so, as discussed, the end text should be surrounded in double quotes <span class="No-Break">if needed.</span></p>
			<p>Syntax checking is available for various content, such as Puppet manifests via <strong class="source-inline">pp</strong> or Ruby files <span class="No-Break">via </span><span class="No-Break"><strong class="source-inline">ruby</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
@(END:pp)
@(END:ruby)</pre>
			<p>Syntax checking will only run if variable interpolation is not turned on; if a type unavailable to Puppet is entered, it will be ignored. The full details of available syntax checkers can be found in the Puppet specification, which also contains details on creating custom <span class="No-Break">syntax checkers.</span></p>
			<p>Heredoc declarations can be placed anywhere a string declaration can be, so, for example, a long<a id="_idIndexMarker218"/> command in <a id="_idIndexMarker219"/>an <strong class="source-inline">exec</strong> command could be declared <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
exec { 'create databases':
  command =&gt; @("Database Commands"/L)
    sudo -u postgres psql \
    -c "CREATE DATABASE ${database1} ENCODING 'utf8' LC_COLLATE 'en_US.UTF-8' LC_CTYPE 'en_US.UTF-8'" \
    -c "CREATE DATABASE ${database2} ENCODING 'utf8' LC_COLLATE 'en_US.UTF-8' LC_CTYPE 'en_US.UTF-8'" \
    -c "CREATE DATABASE ${database3} ENCODING 'utf8' LC_COLLATE 'en_US.UTF-8' LC_CTYPE 'en_US.UTF-8'"
    |-"Database Commands"</pre>
			<p>This book recommends using heredocs sparingly. For long commands in exec, as shown in the preceding example, this may be suitable, but particularly for file content, it typically clutters and confuses the code with text and is better placed in templates, as covered in <a href="B18492_07.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, or as files in modules, as covered in <a href="B18492_08.xhtml#_idTextAnchor212"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>. The topic of how best to store data will be discussed in <a href="B18492_09.xhtml#_idTextAnchor233"><span class="No-Break"><em class="italic">Chapter 9</em></span></a><span class="No-Break">.</span></p>
			<h3>Accessing substrings in variables</h3>
			<p>To call <a id="_idIndexMarker220"/>a string in Puppet, the simplest method is to use the <strong class="source-inline">$</strong> symbol, followed<a id="_idIndexMarker221"/> by the variable name. However, if the variable name contains invalid characters, such as a space, Puppet will assume that the variable name has ended. Therefore, to ensure proper interpolation of variables within strings, it is safest to enclose the variable name in curly <span class="No-Break">braces, </span><span class="No-Break"><strong class="source-inline">{}</strong></span><span class="No-Break">.</span></p>
			<p>To access a particular character or substring within a string, Puppet allows you to specify a range of indices using <strong class="source-inline">[&lt;start index&gt;, &lt;stop position&gt;]</strong>, which can include support for negative numbers to count back from the end of a string or change the order of characters to be returned. For example, the following code sets a variable named <strong class="source-inline">'example_string'</strong> to the <strong class="source-inline">'</strong><span class="No-Break"><strong class="source-inline">substring'</strong></span><span class="No-Break"> string:</span></p>
			<pre class="source-code">
$example_string = 'substring'</pre>
			<p>Various combinations can be used; for example, a single character can be called by taking an index from the start, such as 3, to return <strong class="source-inline">s</strong> (we start <span class="No-Break">at 0).</span></p>
			<p>To extract a single character from a string variable in Puppet, you can specify the index of the desired character starting from <strong class="source-inline">0</strong>. For example, to extract the third character of a string variable, you would use an index of <strong class="source-inline">3</strong> (since indexing starts at <strong class="source-inline">0</strong>). In Puppet, this can be expressed <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
notify { "${example_string[3]}" :}</pre>
			<p>This would return the character at index <strong class="source-inline">3</strong>, which in this case would <span class="No-Break">be </span><span class="No-Break"><strong class="source-inline">'s'</strong></span><span class="No-Break">.</span></p>
			<p>A negative index can go from the end and return the same <strong class="source-inline">s</strong> character <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">-6</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
notify { "${example_string[-6]}" :}</pre>
			<p>To extract a specific portion of a string variable in Puppet, you can use the square bracket notation to indicate the start index and the stop position of the substring. For example, if you have a string variable named <strong class="source-inline">'example_string'</strong> with a value of <strong class="source-inline">'substring'</strong>, and you want to extract a substring that starts at the third character and includes the next five characters, you can use the following syntax <span class="No-Break">in Puppet:</span></p>
			<pre class="source-code">
notify { "${example_string[3,6]}" :}</pre>
			<p>This would return the substring that starts at index <strong class="source-inline">3</strong> (which corresponds to the letter <strong class="source-inline">'s'</strong> in <strong class="source-inline">'substring'</strong>) and includes the next five characters, which in this case would <span class="No-Break">be </span><span class="No-Break"><strong class="source-inline">'string'</strong></span><span class="No-Break">.</span></p>
			<p>To extract a substring starting from a negative index position, you can specify a negative value for the stop position. For example, to extract the substring that starts from the fourth index from the end and includes the next three characters, you can use the <span class="No-Break">following syntax:</span></p>
			<pre class="source-code">
notify { "${example_string[-4,-1]}" :}</pre>
			<p>This would return the substring that starts at the fourth character from the end (which corresponds to the letter <strong class="source-inline">'t'</strong> in <strong class="source-inline">'substring'</strong>) and includes the next three characters, which in this case would <span class="No-Break">be </span><span class="No-Break"><strong class="source-inline">'tri'</strong></span><span class="No-Break">.</span></p>
			<p>Finally, to extract a substring that starts from a negative index position and includes a positive number of characters, you can use the <span class="No-Break">following syntax:</span></p>
			<pre class="source-code">
notify { "${example_string[-4,4]}" :}</pre>
			<p>This would return the substring that starts at the fourth character from the end (which corresponds to the letter <strong class="source-inline">'t'</strong> in <strong class="source-inline">'substring'</strong>) and includes the next four characters, which in this case would <span class="No-Break">be </span><span class="No-Break"><strong class="source-inline">'ring'</strong></span><span class="No-Break">.</span></p>
			<p>This sort of <a id="_idIndexMarker222"/>substring work can be particularly useful when package names, application versions, or other consistent name strings need to be broken up into different variables. As a more practical example, an organization has hostnames that start with<a id="_idIndexMarker223"/> a location code and contain a role, their environment, and a <span class="No-Break">server ID:</span></p>
			<pre class="source-code">
$hostname = flkoracprd00034
$location = $hostname[0,3]
$role =$hostname[3,3]
$environment = $hostname[6,3]
$id = $hostname[-5,5]</pre>
			<h3>String data type parameter</h3>
			<p>When setting the type of <a id="_idIndexMarker224"/>a parameter as a string, the capitalized keyword of <strong class="source-inline">String</strong> is used, along with optional minimum and maximum lengths of <span class="No-Break">the string:</span></p>
			<pre class="source-code">
String[&lt;Minimum length&gt;, &lt;Maximum Length&gt;] $variable_name</pre>
			<p>The default for the minimum is 0 and the maximum is infinity. To use the default implicitly, you can use the default unquoted <span class="No-Break">string keyword.</span></p>
			<p>Let’s look at a class called <strong class="source-inline">database</strong>, which accepts a database ID string of four characters, a username between six and eight characters that defaults to <strong class="source-inline">dbuser</strong> if it’s not provided, and a description of <span class="No-Break">any length:</span></p>
			<pre class="source-code">
class 'database': {
  String[4,4] database_id,
  String[6,8] username = 'dbuser' ,
  String description,
}:</pre>
			<h2 id="_idParaDest-80">Numbers<a id="_idTextAnchor093"/></h2>
			<p>This <a id="_idIndexMarker225"/>section will cover the <a id="_idIndexMarker226"/>two types Puppet uses for numbers: integers and floating points. We will also look at what arithmetic operations can be performed on them, how numbers can convert to and from strings, and the variations on <span class="No-Break">these types.</span></p>
			<p>Both types of numbers are declared without quotation marks. Here, casing does not matter where letters are used. The following patterns <span class="No-Break">are available:</span></p>
			<ul>
				<li><strong class="bold">Integers and </strong><span class="No-Break"><strong class="bold">octal integers</strong></span><span class="No-Break">:</span><ul><li>An optional negative, <strong class="source-inline">–</strong> (positive is presumed <span class="No-Break">in absence)</span></li><li>Numeric digits (starting with a <strong class="source-inline">0</strong> <span class="No-Break">for octal)</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Hexadecimal Integers</strong></span><span class="No-Break">:</span><ul><li>An optional negative, <strong class="source-inline">–</strong> (positive is presumed <span class="No-Break">in absence)</span></li><li><strong class="source-inline">0x</strong> or <strong class="source-inline">0X</strong> (case is <span class="No-Break">not important)</span></li><li>A mix of numeric digits and upper or <span class="No-Break">lowercase letters</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Floating point</strong></span><span class="No-Break">:</span><ul><li>An optional negative, <strong class="source-inline">–</strong> (positive is presumed <span class="No-Break">in absence)</span></li><li>Numeric digits (a <strong class="source-inline">0</strong> is required if using a number between -1 <span class="No-Break">and 1)</span></li><li>A <span class="No-Break">decimal point</span></li><li><span class="No-Break">Numeric digits</span></li><li>An optional <strong class="source-inline">e</strong> or <strong class="source-inline">E</strong> preceded by digits (for <span class="No-Break">scientific float)</span></li></ul></li>
			</ul>
			<p>The<a id="_idIndexMarker227"/> following are <a id="_idIndexMarker228"/>some simple and appropriately named examples of each of the <span class="No-Break">preceding types:</span></p>
			<pre class="source-code">
$integer = 42
$negative_integer = -84
$float = 32.3333
$scientific float = 3e5
$octal = 0678
$hex = 0x</pre>
			<p>It is important to note that an octal or hexadecimal number cannot be expressed as a floating-point number and will result in an error as it is not a valid octal or hexadecimal number, <span class="No-Break">as applicable.</span></p>
			<h3>Arithmetic operators</h3>
			<p>We cannot perform operations to<a id="_idIndexMarker229"/> reassign a variable but can assign new variables<a id="_idIndexMarker230"/> based on operations between assigned variables. The following expressions can be used <span class="No-Break">between variables:</span></p>
			<ul>
				<li><strong class="source-inline">+</strong>: <span class="No-Break">Addition</span></li>
				<li><strong class="source-inline">-</strong>: <span class="No-Break">Subtraction</span></li>
				<li><strong class="source-inline">/</strong>: <span class="No-Break">Division</span></li>
				<li><strong class="source-inline">*</strong>: <span class="No-Break">Multiplication</span></li>
				<li><strong class="source-inline">%</strong>: Modulo, the remainder of dividing left <span class="No-Break">by right</span></li>
				<li><strong class="source-inline">&lt;&lt;</strong>: <span class="No-Break">Left shift</span></li>
				<li><strong class="source-inline">&gt;&gt;</strong>: <span class="No-Break">Right shift</span></li>
			</ul>
			<p>Left shift and right shift are less familiar and need further explanation. A left shift is the first variable multiplied by two to the power of the second variable. Taking an example of <strong class="source-inline">5 &lt;&lt; 3</strong>, this would translate into 5 * 2<span class="superscript">3</span>, which would result <span class="No-Break">in 40.</span></p>
			<p>A right shift is the first variable divided by two to the power of the second variable. Taking an example of <strong class="source-inline">32 &gt;&gt; 2,</strong> this would translate into 32 / 2<span class="superscript">2</span>, which would result <span class="No-Break">in 8.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For both left shift and right shift, floats will round down to <span class="No-Break">an integer.</span></p>
			<p>Additionally, the <a id="_idIndexMarker231"/>negative symbol (<strong class="source-inline">-</strong>) can be used as a prefix to negate a variable and <a id="_idIndexMarker232"/>brackets can be used to manage the priority of operations, where <strong class="bold">Brackets, Orders (powers/indices or roots), Division, Multiplication, Addition, and Subtraction</strong> (<strong class="bold">BODMAS</strong>) rules <a id="_idIndexMarker233"/>apply. Shifts are essentially treated as multiplication and modulo division in <span class="No-Break">this priority.</span></p>
			<p>Any operations between an integer and a float will result in a float and an operation on an integer, which would result in a float being rounded down to <span class="No-Break">an integer.</span></p>
			<p>The following are some examples of using <span class="No-Break">these operators:</span></p>
			<pre class="source-code">
$a = 5
$b = 3
$addition = $a + $b
$subtraction = $a - $b
$division = $a / $b
$multiplication = $a * $b
$modulo = $a % $b
$shift_left = $a &lt;&lt; $b
$shift_right = $a &gt;&gt; $b
$negate = -$a</pre>
			<p>To further <a id="_idIndexMarker234"/>show brackets enforcing<a id="_idIndexMarker235"/> BODMAS rules, the following example will be <a id="_idIndexMarker236"/>equal to <span class="No-Break">negative 40:</span></p>
			<pre class="source-code">
$bodmas_example = ($a + $b) * -$a</pre>
			<h3>String to numeric conversion</h3>
			<p>If a string is<a id="_idIndexMarker237"/> used in a numeric operation, it will automatically <a id="_idIndexMarker238"/>convert, but this will not happen in any other context. To convert a string into a number, an object can be declared as an integer, float, or numeric (we will cover numeric objects in the <em class="italic">Abstract data types, including Sensitive</em> section). An example of conversion is taking a string, <strong class="source-inline">1</strong>, to an integer and a string, <strong class="source-inline">1.1</strong>, to <span class="No-Break">a float:</span></p>
			<pre class="source-code">
$string_integer='1'
$string_float='1.1'
$converted_integer=Integer($string_integer)
$converted_float=Float($string_float)</pre>
			<h3>Numeric to string conversion</h3>
			<p>Numeric types<a id="_idIndexMarker239"/> automatically convert into strings when interpolated in a string; the automatic conversion uses base 10 notation. The <strong class="source-inline">String</strong> object declaration can also be used to convert, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
$stri<a id="_idTextAnchor094"/>ng_from_integer = String(342)</pre>
			<h3>Integer data type</h3>
			<p>When setting the<a id="_idIndexMarker240"/> type of a parameter as an integer, the capitalized <strong class="source-inline">Integer</strong> keyword<a id="_idIndexMarker241"/> is used, along with optional minimum and maximum values of <span class="No-Break">the integer:</span></p>
			<pre class="source-code">
Integer[&lt;Minimum Value&gt;, &lt;Maximum Value&gt;]</pre>
			<p>The defaults are technically negative infinity and positive infinity but as Puppet uses 64-bit signed integers, this is in the region of −9,223,372,036,854,775,808 <span class="No-Break">to 9,223,372,036,854,775,807.</span></p>
			<h3>Float data type</h3>
			<p>When setting the type of <a id="_idIndexMarker242"/>a parameter as a float, the capitalized <strong class="source-inline">Float</strong> keyword is used, along <a id="_idIndexMarker243"/>with optional minimum and maximum values of <span class="No-Break">the integer:</span></p>
			<pre class="source-code">
Float[&lt;Minimum Value&gt;, &lt;Maximum Value&gt;]</pre>
			<p>The defaults are technically plus and negative infinity but in practical terms, this is the range of a double precision float of -1.7E+308 to +1.7E+308 in <span class="No-Break">Ruby implementation.</span></p>
			<p>As an example, consider the following code block, which defines <strong class="source-inline">Class application::filesystem</strong> for assigning a percentage of a volume group within known limits of <strong class="source-inline">100</strong> <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">10000</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
Class application::filesystem (
Float[0.1, 99.9] percentage_application,
Integer[100, 10000] volume_group_size
) {
}</pre>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor095"/>undef</h2>
			<p><strong class="source-inline">undef</strong> is <a id="_idIndexMarker244"/>considered<a id="_idIndexMarker245"/> equivalent to nil in Ruby and represents the absence of a value assigned to a variable. By default, the <strong class="source-inline">strict_variables</strong> setting is set to <strong class="source-inline">false</strong>, which means variables that have not been declared have a default value of <strong class="source-inline">undef</strong>. In <a href="B18492_10.xhtml#_idTextAnchor252"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, we will see that this can be set in the <strong class="source-inline">puppet.conf</strong> <span class="No-Break">configuration file.</span></p>
			<p>As a simple example, the following line will notify <strong class="source-inline">Print</strong> that <strong class="source-inline">test1</strong> has not <span class="No-Break">been declared:</span></p>
			<pre class="source-code">
  notify {"Print $test1":}</pre>
			<p>The only value an <strong class="source-inline">undef</strong> data type has is the unquoted <strong class="source-inline">undef</strong> and it is not used for parameter data typing by itself. This is because enforcing the absence of a value would have <span class="No-Break">no purpose.</span></p>
			<p>In the <em class="italic">Abstract data types, including Sensitive</em> section of this chapter, we’ll see how <strong class="source-inline">undef</strong> values can be accepted for parameters as a part of a selection of <span class="No-Break">feasible options.</span></p>
			<p>When<a id="_idIndexMarker246"/> interpolated into<a id="_idIndexMarker247"/> a string, <strong class="source-inline">undef</strong> is converted into an empty <span class="No-Break">string (</span><span class="No-Break"><strong class="source-inline">''</strong></span><span class="No-Break">).</span></p>
			<p class="callout-heading">Callout</p>
			<p class="callout">In <a href="B18492_05.xhtml#_idTextAnchor123"><span class="No-Break"><em class="italic">Chapter 5</em></span></a> and <a href="B18492_08.xhtml#_idTextAnchor212"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, we will learn about functions such as <strong class="source-inline">delete_undef_values</strong> and <strong class="source-inline">filter</strong>, which can be used to trim the arrays and hashes of <span class="No-Break"><strong class="source-inline">undef</strong></span><span class="No-Break"> values.</span></p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor096"/>Booleans</h2>
			<p>Booleans in <a id="_idIndexMarker248"/>Puppet represent <strong class="source-inline">true</strong> or <strong class="source-inline">false</strong> and in <a href="B18492_07.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, when looking at <strong class="source-inline">if</strong>/<strong class="source-inline">case</strong> statements, you’ll <a id="_idIndexMarker249"/>see that all Puppet comparisons return a Boolean type. A Boolean variable should simply contain an unquoted <strong class="source-inline">true</strong> or <strong class="source-inline">false</strong> value. As a result, this makes the data type quite simple with no parameters – just the capitalized <span class="No-Break"><strong class="source-inline">Boolean</strong></span><span class="No-Break"> keyword.</span></p>
			<p>As an example, the following code is for an <strong class="source-inline">exampleapp</strong> class that has a parameter to manage users that are set to <strong class="source-inline">true</strong> by default and a couple of <span class="No-Break">variables hard-coded:</span></p>
			<pre class="source-code">
Class exampleapp (
  Boolean manage_users = true
) {
  $install_ssh = true
  $install_telnet = false
}</pre>
			<h3>Conversion</h3>
			<p>Automatic conversion<a id="_idIndexMarker250"/> into Boolean values will occur in most cases unless an explicit data type has been specified. For example, in an <strong class="source-inline">if</strong> statement, a variable can be used as if it were a Boolean by simply writing <strong class="source-inline">$variable_name</strong>. However, automatic conversion can be confusing because only <strong class="source-inline">undef</strong> will result in a conversion to <strong class="source-inline">false</strong>. This means that the <strong class="source-inline">'false'</strong> string, an empty string (<strong class="source-inline">''</strong>), an integer of <strong class="source-inline">0</strong>, and a float of <strong class="source-inline">0.0</strong> will all convert <span class="No-Break">into </span><span class="No-Break"><strong class="source-inline">true</strong></span><span class="No-Break">.</span></p>
			<p>When using a Boolean declaration, an empty string will fail to convert, as will <strong class="source-inline">undef</strong>, while a string of <strong class="source-inline">'false'</strong>, an integer of <strong class="source-inline">0</strong>, or a float of <strong class="source-inline">0.0</strong> will convert <span class="No-Break">into </span><span class="No-Break"><strong class="source-inline">false</strong></span><span class="No-Break">.</span></p>
			<p>Since this is confusing, it is safer to use the <strong class="source-inline">num2bool</strong> and <strong class="source-inline">str2bool</strong> functions from the <strong class="source-inline">puppetlabs-stdlib</strong> module, which will be covered in <a href="B18492_08.xhtml#_idTextAnchor212"><span class="No-Break"><em class="italic">Chapter 8</em></span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor097"/>Regexp</h2>
			<p>The <strong class="source-inline">regexp</strong> type<a id="_idIndexMarker251"/> is different from the types we’ve seen so far. It represents a valid regular <a id="_idIndexMarker252"/>expression in Puppet, which are expressions contained between forward slashes based on Ruby’s regex <span class="No-Break">implementation: </span><a href="http://ruby-doc.org/core/Regexp.html"><span class="No-Break">http://ruby-doc.org/core/Regexp.html</span></a><span class="No-Break">.</span></p>
			<p>Regex use will be covered in more detail in <a href="B18492_07.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, where it will be more practically applied. However, it is worth noting that, later in this chapter, several abstract types that combine multiple types, including <strong class="source-inline">regexp</strong>, will <span class="No-Break">be covered.</span></p>
			<h2 id="_idParaDest-84"><a id="_idTextAnchor098"/>Lab</h2>
			<p>In the previous chapter, a combined <strong class="source-inline">all_grafana</strong> manifest was created and a solution was provided at <a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/all_grafana.pp">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/all_grafana.pp</a>. Adjust this file so that it is within a class called <strong class="source-inline">all_grafana</strong> and instead of using Facter, parameters <span class="No-Break">are used.</span></p>
			<p>These parameters should include <span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="bold">Source download</strong>: A string variable defaulting <span class="No-Break">to </span><a href="https://dl.grafana.com/enterprise/release/grafana-enterprise-8.4.3-1.x86_64.rpm"><span class="No-Break">https://dl.grafana.com/enterprise/release/grafana-enterprise-8.4.3-1.x86_64.rpm</span></a></li>
				<li><strong class="bold">Port</strong>: The port for the service to listen on as <span class="No-Break">an integer</span></li>
				<li><strong class="bold">Service enabled</strong>: By <span class="No-Break">a Boolean</span></li>
			</ul>
			<p>To achieve class assignment, write a class declaration that assigns the variables to ensure the class is included in a catalog run. When you run <strong class="source-inline">bolt</strong> against your manifest, it will ensure you have included your variables. Solutions are available <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/all_grafana.pp"><span class="No-Break">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/all_grafana.pp</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor099"/>Arrays and hashes</h1>
			<p>This section will cover the two core <a id="_idIndexMarker253"/>collections of data in Puppet: arrays and hashes. You will learn how <a id="_idIndexMarker254"/>to create, access, and perform operations to manipulate the values into a <span class="No-Break">new variable.</span></p>
			<h2 id="_idParaDest-86"><a id="_idTextAnchor100"/>Assigning arrays</h2>
			<p>Puppet arrays are created by <a id="_idIndexMarker255"/>surrounding comma-separated lists of values with square brackets. An optional comma can be added after the last element, but this book recommends against that for styling. For example, an array called <strong class="source-inline">example_array</strong> containing the <strong class="source-inline">first</strong>, <strong class="source-inline">second</strong>, and <strong class="source-inline">third</strong> strings, and would be declared <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
$example_array = ['first','second','third']</pre>
			<p>Arrays can contain any data type, as well as a mix of data types. A Puppet variable cannot be reassigned in terms of individual values or in terms of any other manipulation such as the addition or removal of values. The following code shows how to assign the <strong class="source-inline">mixed_example_array</strong> array with the integer of <strong class="source-inline">1</strong>, a Boolean value of <strong class="source-inline">false</strong> from the <strong class="source-inline">example_boolean</strong> variable, and the <span class="No-Break"><strong class="source-inline">example</strong></span><span class="No-Break"> string:</span></p>
			<pre class="source-code">
$example_boolean = false
$mixed_example_array = [ 1, $example_boolean , 'example']</pre>
			<p>Arrays can also be empty with nothing between the brackets, <strong class="source-inline">[]</strong>. They will not be identified as <strong class="source-inline">undef</strong> but as an empty array. It would be unlikely to declare an array empty directly; this normally occurs as a result of interpolated variables and operators causing it to <span class="No-Break">become empty.</span></p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor101"/>Accessing an array index</h2>
			<p>To access an array variables <a id="_idIndexMarker256"/>element, a specific element can be specified by index, which will return that element. For example, to take the second string in the second index of <strong class="source-inline">example_array</strong> and assign it to a variable, you can use the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
$example_array = ['first','second','third']
$second_index = $example_arrary [1]</pre>
			<p>The following code shows a <strong class="source-inline">notify</strong> resource outputting the string interpolating the third element from <strong class="source-inline">example_array</strong> as negative numbers counting back from the end of <span class="No-Break">the array:</span></p>
			<pre class="source-code">
notify{ "The first element is ${example_array[-1]}"</pre>
			<p>Accessing an element that does not exist will result in <strong class="source-inline">undef</strong> being returned. You mustn’t put any spacing between the square bracket and the variable name; otherwise, it will be interpreted as a variable and the square brackets will <span class="No-Break">be separate.</span></p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor102"/>Accessing a subset of an array</h2>
			<p>When accessing a subset<a id="_idIndexMarker257"/> of an array, a second number is used to indicate the stopping point. This is different from how substrings are handled. In the case of arrays, a positive number represents the number of elements to return. For example, using a count position of <strong class="source-inline">1</strong> will return an array with a single element. To extract a sub-array containing only the <strong class="source-inline">'second'</strong> element from <strong class="source-inline">example_array</strong>, you could use the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
$sub_array =  example_array[1,1]</pre>
			<p>This will assign the <strong class="source-inline">['second']</strong> sub-array to the <strong class="source-inline">$</strong><span class="No-Break"><strong class="source-inline">sub_array</strong></span><span class="No-Break"> variable.</span></p>
			<p>Choosing a length beyond the length of the array will simply return the <span class="No-Break">available elements.</span></p>
			<p>A negative length will count back from the end of the array. Importantly, unlike accessing substrings, you cannot reverse the order by going past the starting index; this will simply return an empty array. In the following example, the <strong class="source-inline">negative_sub</strong> array will return the whole array since its starting position is <strong class="source-inline">0</strong> and its finishing position is the first element from the end of the array. The <strong class="source-inline">empty_sub_array</strong> variable will be assigned an empty array since the ending position would be before the starting position. The <strong class="source-inline">second_element_array</strong> variable <a id="_idIndexMarker258"/>would be assigned an array with the <span class="No-Break">second element:</span></p>
			<pre class="source-code">
$negative_sub_array = example_array[0, -1]
$empty_sub_array = example_array[1, -3]
$second_element_array = example_array[1, -2]</pre>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor103"/>Nested array</h2>
			<p>A nested array can be <a id="_idIndexMarker259"/>declared by inserting an array value within an array as many times as<a id="_idIndexMarker260"/> needed. The value can then be accessed by using multiple sets of square brackets to access the desired level. As an example, if a nested array is created with the first element as a string, a second value as an array of three strings, and a third value of a string, attempting to access the first element as a nested element results in returning a string, <strong class="source-inline">i</strong>, since the element at index <strong class="source-inline">0</strong> returns a string. A second set of brackets are then used on the <span class="No-Break"><strong class="source-inline">first</strong></span><span class="No-Break"> string.</span></p>
			<p>The <strong class="source-inline">nest_second</strong> variable returns the <strong class="source-inline">nest_second</strong> string since it returns the nested array at element <strong class="source-inline">1</strong>; then, with the second set of brackets accesses the <span class="No-Break">second element:</span></p>
			<pre class="source-code">
$nested_array= ['first',['nest_first','nest_second','nest_third'],'third']
$sub_string = $nested_array[0][1]
$nest_second = $nested_array[1][2]</pre>
			<p>To interpolate nesting in an array, curly brackets must surround the variable name and square brackets. For example, the following <strong class="source-inline">notify</strong> resource will print the first element <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">nested_array</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
notify {"Print ${nested_array[1][0]}":}</pre>
			<p>It is possible to use the subset approach within nested brackets, but this can create confusing and hard-to-follow accesses and is not a recommended style in <span class="No-Break">this book.</span></p>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor104"/>Array operators</h2>
			<p>Arrays cannot be <a id="_idIndexMarker261"/>manipulated once assigned but operators can manipulate the content of arrays to assign new array variables. The following operators <span class="No-Break">are available:</span></p>
			<ul>
				<li><strong class="source-inline">&lt;&lt;</strong>: <span class="No-Break">Append</span></li>
				<li><strong class="source-inline">+</strong>: <span class="No-Break">Concatenate</span></li>
				<li><strong class="source-inline">-</strong>: <span class="No-Break">Remove</span></li>
				<li><strong class="source-inline">*</strong>: <span class="No-Break">Splat</span></li>
			</ul>
			<h3>Append</h3>
			<p>Append takes any type <a id="_idIndexMarker262"/>of value and adds it as a new element at the end of the array. This includes adding an array as a nested array. To combine two arrays, concatenate (<strong class="source-inline">+</strong>) must be used. To demonstrate this, let’s look at an example of an array with integers <strong class="source-inline">1</strong> and <strong class="source-inline">2</strong> as elements that appends <strong class="source-inline">3</strong> into a new array. This will produce a new array, <strong class="source-inline">[1,2,'three']</strong>; appending an array of <strong class="source-inline">[3,4]</strong> to <strong class="source-inline">example_array</strong> will produce a new nested <span class="No-Break">array, </span><span class="No-Break"><strong class="source-inline">[1,2,[3,4]]</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
$example_array=[1,2]
$new_array=$example_array &lt;&lt; 'three'
$append_nest=$example_array &lt;&lt; [3,4]</pre>
			<h3>Concatenate</h3>
			<p>Concatenate takes an <a id="_idIndexMarker263"/>array and essentially combines its content with another array. If the first value is not an array, the compiler will assume this is a numerical operator. For numbers, strings, Booleans, and regular expressions, it will essentially work the same as an append and add the value to the end. To achieve a nested array entry, you must supply a nested array. So, to show some examples, <strong class="source-inline">combined_1</strong> will become an array of <strong class="source-inline">[1,2,1]</strong>, <strong class="source-inline">combined_2</strong> will be assigned <strong class="source-inline">[1,2,1,2]</strong>, and <strong class="source-inline">combined_3</strong> will result in a nested array being <span class="No-Break">assigned </span><span class="No-Break"><strong class="source-inline">[1,2,[1]]</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
$combined_1 = $example_array + 1
$combined_2 = $example_array + [1,2]
$combined_3 = $example_array + [[1,2]]</pre>
			<p>If a hash must be concatenated, it will be converted into an array unless it is turned into an array with a single hash element. So, in the following code, the converted variable would be assigned a nested array with<a id="_idIndexMarker264"/> elements of <strong class="source-inline">test</strong> and <strong class="source-inline">value</strong>, giving it an array of <strong class="source-inline">[1,2,[test,'value']</strong>, while the <strong class="source-inline">nested_hash</strong> variable would add a nested hash that assigns <strong class="source-inline">[1,2,{test =&gt; '</strong><span class="No-Break"><strong class="source-inline">value'}]</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
$converts = $example_array + {test =&gt; 'value'}
$nested_hash =$example_array + [{test =&gt; 'value'}]</pre>
			<h3>Remove</h3>
			<p>Remove assigns an array after<a id="_idIndexMarker265"/> removing all matching elements from a source. The first variable must be an array; otherwise, it will be assumed to be a numeric operator. For the second variable, if it’s a number, string, Boolean, or regular expression, it will search each element of the first variable array and remove it if there is a match. For example, removing the <strong class="source-inline">one</strong> string from <strong class="source-inline">another_example_array</strong> will match the first element and the third element and remove them, but not the first element of the nested array, assigning <strong class="source-inline">['two','three','four','three',['one','three','four']</strong> to the <span class="No-Break"><strong class="source-inline">remove_string</strong></span><span class="No-Break"> variable:</span></p>
			<pre class="source-code">
$another_example_array = ['one','two','one','three','four','three',['one','three','four']]
$remove_string = $another_example_array – 'one'</pre>
			<p>When you have an array as a second variable, it will iterate through each element in that array, removing them as if they had been presented directly, as in our previous example. In this example, it will remove <strong class="source-inline">one</strong> as per the previous example and then perform the searches for matching strings of <strong class="source-inline">three</strong> and <strong class="source-inline">four</strong>, removing the fourth, fifth, and sixth elements while assigning <strong class="source-inline">['two',['one','three','four']]</strong> to the <span class="No-Break"><strong class="source-inline">remove_array</strong></span><span class="No-Break"> variable:</span></p>
			<pre class="source-code">
$another_example_array = ['one','two','one','three','four','three',['one','three','four']]
$remove_array = $another_example_array – ['one','three','four']</pre>
			<p>When a nested array is used as the second variable, it will match any elements with the same array and remove them. So, in this example, the <strong class="source-inline">remove_nested_array</strong> variable will be <span class="No-Break">assigned </span><span class="No-Break"><strong class="source-inline">['one','two','one','three','four','three']</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
$remove_nested_array = $another_example_array – [['one','three','four']]</pre>
			<p>As with concatenation, hashes <a id="_idIndexMarker266"/>must be placed in an array; otherwise, they will remove any matching element of a translated <span class="No-Break">nested array.</span></p>
			<h3>Splat</h3>
			<p>Splats are different from the <a id="_idIndexMarker267"/>other operators as they are used to make an array provide comma-separated lists as an argument in a function call. This is true for both case and selector statements. Using array splats will be covered in detail in <a href="B18492_05.xhtml#_idTextAnchor123"><span class="No-Break"><em class="italic">Chapter 5</em></span></a> and <a href="B18492_07.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic">Chapter 7</em></span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-91"><a id="_idTextAnchor105"/>Array data type</h2>
			<p>When setting the<a id="_idIndexMarker268"/> data type of a parameter to an array, the capitalized <strong class="source-inline">Array</strong> keyword must be used with a data type for elements of the array, the minimum size of the array, and the maximum size of <span class="No-Break">the array:</span></p>
			<pre class="source-code">
Array[&lt;Data Type&gt;, &lt;Minimum Size&gt;, &lt;Maximum Size&gt;]</pre>
			<p>The defaults for data types are data, which will be covered in the <em class="italic">Abstract data types, including Sensitive</em> section of this chapter, but this means that numbers (both integers and floats), strings, Booleans, and regular expressions, as well as arrays and hashes of these types apply. If you select a more specific data type, such as <strong class="source-inline">String</strong>, it will expect every element in the array to contain a string. In the <em class="italic">Abstract data types, including Sensitive</em> section, other mixed types will be covered that provide <span class="No-Break">more flexibility.</span></p>
			<p>The minimum size is 0, while the maximum size <span class="No-Break">is infinite.</span></p>
			<p>As an example, the <strong class="source-inline">database</strong> class could accept a variable of <strong class="source-inline">db_uids</strong>, where at least one element is expected in the array but could contain up to six elements. The <strong class="source-inline">user_names</strong> variable can be an empty array or up to five elements but most only contain strings. Finally, the <strong class="source-inline">extra_flags</strong> variable is an array with default values, so it can be an empty <a id="_idIndexMarker269"/>array up to an infinite size with the contents matched against <span class="No-Break">data types:</span></p>
			<pre class="source-code">
class 'database': {
  Array[default,1,6] db_uids,
  Array[string,0,5] user_names,
  Array extra_flags,
}</pre>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor106"/>Assigning hashes</h2>
			<p>Hashes are written as <a id="_idIndexMarker270"/>comma-spa<a id="_idTextAnchor107"/>ced key-value pairs separated by <strong class="source-inline">=&gt;</strong> and the list is surrounded by curl braces, <strong class="source-inline">{ }</strong>. A trailing comma can be added after the last pair, but this is not a recommended style by this book. For example, the following hash pairs could be declined to assign the <strong class="source-inline">make</strong> key with the <strong class="source-inline">skoda</strong> string, the <strong class="source-inline">model</strong> key with the <strong class="source-inline">rapid</strong> string, and the <strong class="source-inline">year</strong> key with the <span class="No-Break"><strong class="source-inline">2014</strong></span><span class="No-Break"> integer:</span></p>
			<pre class="source-code">
$my_car = { make =&gt; 'skoda', model =&gt; 'rapid', year =&gt; 2014 }</pre>
			<p>For style purposes, a new line is often taken with each key to ensure the start of the keys line up and the arrows line up. Taking a final new line for the closing curly brace and lining it up with the opening curly brace is what this book recommends when <span class="No-Break">writing arrays:</span></p>
			<pre class="source-code">
$my_car = { make  =&gt; 'skoda',
            model =&gt; 'rapid',
            year  =&gt; 2014
          }</pre>
			<p>Hash keys and values can be any type, but it rarely makes sense for the keys to be anything but strings. Just like arrays, hashes are variables in Puppet and can only be assigned once and not <a id="_idIndexMarker271"/>manipulated unless a new hash <span class="No-Break">is assigned.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Puppet can only serialize string hash keys into a catalog. Therefore, you cannot assign a hash with no<a id="_idTextAnchor108"/>n-string keys to a resource attribute or <span class="No-Break">class parameter.</span></p>
			<h2 id="_idParaDest-93"><a id="_idTextAnchor109"/>Accessing hash values</h2>
			<p>Similarly to arrays, hash <a id="_idIndexMarker272"/>values can be accessed using square brackets with the key value to access. As an example, the following would print the <span class="No-Break"><strong class="source-inline">rapid</strong></span><span class="No-Break"> value:</span></p>
			<pre class="source-code">
notify {"Print ${my_car[model]}":}</pre>
			<h2 id="_idParaDest-94"><a id="_idTextAnchor110"/>Nested hashes</h2>
			<p>As with arrays, by declaring a <a id="_idIndexMarker273"/>hash within a hash, a nested hash can be created, which can be accessed with chained keys. The following example shows a variable package list containing the <strong class="source-inline">packages</strong> and <strong class="source-inline">services</strong> keys. The <strong class="source-inline">packages</strong> key contains the <strong class="source-inline">httpd</strong> key, with a string value of <strong class="source-inline">latest</strong>, and the <strong class="source-inline">cowsay</strong> key, with a float value of <strong class="source-inline">4.0</strong>. The <strong class="source-inline">services</strong> key contains the <strong class="source-inline">httpd</strong> key with a string value of <strong class="source-inline">running</strong> and the <strong class="source-inline">nginx</strong> key with a string value <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">stopped</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
$package_list = { packages  =&gt; { httpd  =&gt; 'latest',
                          cowsay =&gt; 4.0
                        }
                  services =&gt; { httpd =&gt; 'running',
                                nginx =&gt; 'stopped'
                              }
                 }</pre>
			<p>To print both of the nested <strong class="source-inline">httpd</strong> keys, a <strong class="source-inline">notify</strong> resource can be declared, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
notify {"Print ${package_list[packages][httpd]} ${package_list[services][httpd]}":}</pre>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor111"/>Hash operators</h2>
			<p>There are two operators <a id="_idIndexMarker274"/>for hashes – merging (<strong class="source-inline">+</strong>), which can assign a new hash by adding key pairs to an existing hash, and removal (<strong class="source-inline">-</strong>), which can assign a new hash by removing key pairs from an <span class="No-Break">existing hash.</span></p>
			<h3>Merging</h3>
			<p>Merging is <a id="_idIndexMarker275"/>performed by taking a hash variable, a <strong class="source-inline">+</strong> symbol, and a hash or an array with an even number of values. Note that this is done while looking to add a new key; if a key already exists, it will not be added. In the following example, merging a hash with the <strong class="source-inline">database</strong> key with an <strong class="source-inline">oracle</strong> string and a <strong class="source-inline">version</strong> key with an integer of <strong class="source-inline">11</strong> with the <strong class="source-inline">app_web</strong> hash with a <strong class="source-inline">web_server</strong> key with a string of <strong class="source-inline">httpd</strong> and a <strong class="source-inline">version</strong> key with a value of <strong class="source-inline">12</strong> will result in the <strong class="source-inline">combined_app</strong> variable containing the <strong class="source-inline">database</strong> key and value and the <strong class="source-inline">web_server</strong> key and value. However, it will ignore the <strong class="source-inline">app_web</strong> key version as a key already existed <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">app_db</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
$app_db    = { database =&gt; 'oracle', version = &gt; 11}
$app_web = { web_server =&gt; 'httpd', version =&gt; 12 }
$combined_app = $app_db + $app_web</pre>
			<h3>Removal</h3>
			<p>The removal <a id="_idIndexMarker276"/>operator takes a hash variable, a <strong class="source-inline">–</strong> symbol, and a hash, an array of keys, or a single string key. If giving a hash, the values in the hash will not matter as the removal is simply removing any matching keys. In the following example, a hash of <strong class="source-inline">software_versions</strong> with the <strong class="source-inline">oracle</strong> key and an integer of <strong class="source-inline">11</strong>, the <strong class="source-inline">httpd</strong> key and a value of <strong class="source-inline">12</strong>, and the <strong class="source-inline">cowsay</strong> key with a value of <strong class="source-inline">9</strong> can be seen. When a single key is removed to create the <strong class="source-inline">no_cowsay</strong> variable, the key-value pair of <strong class="source-inline">cowsay</strong> and <strong class="source-inline">9</strong> is removed. When <strong class="source-inline">only_cowsay</strong> is assigned, the values of <strong class="source-inline">oracle</strong> and <strong class="source-inline">httpd</strong> in the hash to be removed do not matter and it will simply remove the key and value. For the <strong class="source-inline">only_oracle</strong> variable, removing an array will make the removal operator run through each matching key and <span class="No-Break">remove matches:</span></p>
			<pre class="source-code">
$software_versions = { oracle =&gt; 11, httpd =&gt; 12, cowsay =&gt; 9}
$no_cowsay = $software_versions – cowsay
$only_cowsay = $software_versions – { oracle =&gt; 'anything' , httpd =&gt; 'anything' }
$only_oracle = $software_versions – [httpd,cowsay]</pre>
			<h2 id="_idParaDest-96"><a id="_idTextAnchor112"/>Hash data type</h2>
			<p>The <a id="_idIndexMarker277"/>hash data type accepts an optional key type and value type; if a key type is specified, a value type must be specified. A minimum size and maximum size can be specified for how many key pairs there <span class="No-Break">should be:</span></p>
			<pre class="source-code">
Hash[&lt;Key type&gt;, &lt;Value type&gt;, &lt;Minimum size&gt;, &lt;Maximum size&gt;]</pre>
			<p>For example, the following class has a <strong class="source-inline">tunables</strong> parameter, which must contain a hash with <strong class="source-inline">1</strong> to <strong class="source-inline">10</strong> key-value pairs of strings <span class="No-Break">and integers:</span></p>
			<pre class="source-code">
Class kernel_overrides (
  Hash[String,integer,1,10] tunables
)</pre>
			<h2 id="_idParaDest-97"><a id="_idTextAnchor113"/>Mixing hashes and arrays</h2>
			<p>Since the value of a <a id="_idIndexMarker278"/>hash key value or an array value can be any data type, nesting can be performed. Care should be taken not to overcomplicate <span class="No-Break">the structure.</span></p>
			<p>The following example shows the <strong class="source-inline">server_cmdb</strong> hash containing a hash of <strong class="source-inline">nfs_share_servers</strong>, with the <strong class="source-inline">prod</strong> and <strong class="source-inline">dev</strong> keys containing arrays <span class="No-Break">of strings:</span></p>
			<pre class="source-code">
$server_cmdb = {
  'nfs_share_servers =&gt; {
     prod =&gt;  ['prdnfs01','prdnfs02','prdnfs02']
     dev =&gt; [ 'devnfs01','devnfs02,'devnfs03']
  }
}</pre>
			<p>To access the first <strong class="source-inline">prod</strong> array’s third value, <strong class="source-inline">prdnfs02</strong>, the following call could <span class="No-Break">be made:</span></p>
			<pre class="source-code">
$server_cmdb[nfs_share_servers][prod][2]</pre>
			<h2 id="_idParaDest-98"><a id="_idTextAnchor114"/>Lab</h2>
			<p>To practice what we’ve covered, write a class that takes an array of packages and installs the packages with a hash-defining standard parameter for installing the provider and version. Remember to declare the class with variables, as per the previous lab. As an example, you could install the latest version of the RubyGems webrick, puma, and sinatra. The suggested solution can be found <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/packages_array_hash_paramters.pp"><span class="No-Break">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/packages_array_hash_paramters.pp</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-99"><a id="_idTextAnchor115"/>Abstract data types, including Sensitive</h1>
			<p>Abstract data types<a id="_idIndexMarker279"/> give you the flexibility to mix the core data types for parameter enforcement and particular patterns, as well as provide some more advanced features in terms of parameter checking. There are a large number of abstract types, so this section will cover the most commonly used ones. Other types can be found at <a href="https://github.com/puppetlabs/puppet-specifications/blob/master/language/types_values_variables.md">https://github.com/puppetlabs/puppet-specifications/blob/master/language/types_values_variables.md</a> <span class="No-Break">and </span><a href="https://www.puppet.com/docs/puppet/8/lang_data_abstract.html#variant-data-type"><span class="No-Break">https://www.puppet.com/docs/puppet/8/lang_data_abstract.html#variant-data-type</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor116"/>Prefixes</h2>
			<p>Although not <a id="_idIndexMarker280"/>Puppet terminology, the types we’ll review will be described as prefixes, where<a id="_idIndexMarker281"/> a type is prefixed in front of another type with <span class="No-Break">no options.</span></p>
			<h3>Sensitive</h3>
			<p>The <strong class="source-inline">Sensitive</strong> data type<a id="_idIndexMarker282"/> is used to mark strings as sensitive, which means the <a id="_idIndexMarker283"/>value will be displayed in plain text in the code and the catalog, but not in any Puppet reports or logs. By prefixing the <strong class="source-inline">Sensitive</strong> keyword to parameters and assignments with brackets, the strings’ contents are made sensitive. This affects both string types and resources that can contain strings or can be converted into strings. In the following example, we are showing a string, a string in an array, and an array that can be assigned. The output will print <strong class="source-inline">[value redacted]</strong> over the section that has been marked <span class="No-Break">as sensitive:</span></p>
			<pre class="source-code">
$secret_string = Sensitive('password')
notify {"Print ${secret_string}":}
$single_sensitive_array = [Sensitive('password'),'password']
notify {"Print ${single_sensitive_array}":}
$secret_array = Sensitive(['password','password'])
notify {"Print ${secret_array}":}</pre>
			<p>When the value must be used in code, the <strong class="source-inline">unwrap</strong> function allows us to view the sensitive value. This example shows how it could be unwrapped to print with a <span class="No-Break"><strong class="source-inline">notify</strong></span><span class="No-Break"> resource:</span></p>
			<pre class="source-code">
notify {"Print ${secret_string.unwrap}":}</pre>
			<p>This is purely an example and would defeat the purpose of hiding a value from logging and reporting; more likely, it would be passed to another resource. Resources such as user-recognized sensitive values for attributes such as <strong class="source-inline">password</strong> do not need to be unwrapped, but resources such as <strong class="source-inline">exec</strong> do not interpolate, so the values must be unwrapped. To avoid leaking data resources such as <strong class="source-inline">exec</strong>, which cannot interpolate, you can wrap it as <strong class="source-inline">Sensitive</strong> to ensure no part is exposed in logging. The following example shows<a id="_idIndexMarker284"/> passing the sensitive string to <strong class="source-inline">user</strong> and passing the sensitive <a id="_idIndexMarker285"/>string as a password to a <span class="No-Break"><strong class="source-inline">curl</strong></span><span class="No-Break"> command:</span></p>
			<pre class="source-code">
user { 'max'
  id =&gt; 7
  password =&gt; $secret_string
}
exec {'secure curl':
  command =&gt; Sensitive("C:\\Windows\\System32\\curl.exe -u david:${secret_string.unwrap} http://example.com")
}</pre>
			<p>If only the unwrap is performed when running Puppet with <strong class="source-inline">debug</strong>, the command and password would be <span class="No-Break">fully visible.</span></p>
			<p>In <a href="B18492_07.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, we will cover templates, including how to use sensitive values. However, as of Puppet 7.0 and 6.20, you no longer need to unwrap sensitive values before using them <span class="No-Break">in templates.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Securing data fully from end to end will be discussed in <a href="B18492_09.xhtml#_idTextAnchor233"><span class="No-Break"><em class="italic">Chapter 9</em></span></a><span class="No-Break">.</span></p>
			<p><strong class="source-inline">Enum</strong> and more <a id="_idIndexMarker286"/>advanced pattern data type patterns, which will be <a id="_idIndexMarker287"/>covered in the next section, will not work with <strong class="source-inline">Sensitive</strong> and should be avoided. Here, you should only use basic types such <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">string</strong></span><span class="No-Break">.</span></p>
			<h3>Optional</h3>
			<p>The <strong class="source-inline">Optional</strong> data type<a id="_idIndexMarker288"/> allows <strong class="source-inline">undef</strong> to be used as an acceptable input for a data<a id="_idIndexMarker289"/> type, in addition to the types allowed by the data type <span class="No-Break">it prefixes:</span></p>
			<pre class="source-code">
Optional &lt;type&gt; &lt;variable name&gt;</pre>
			<p>For example, to allow an <strong class="source-inline">Integer</strong> parameter or <strong class="source-inline">undef</strong> to be assigned to the <strong class="source-inline">oracle_uid</strong> variable, simply add the <strong class="source-inline">Optional</strong> keyword in front of the <span class="No-Break"><strong class="source-inline">Integer</strong></span><span class="No-Break"> type:</span></p>
			<pre class="source-code">
class oracle (
  Optional Integer orace_uid
)</pre>
			<p>The <strong class="source-inline">notundef</strong> type has the<a id="_idIndexMarker290"/> opposite effect but is of much more limited and<a id="_idIndexMarker291"/> <span class="No-Break">exceptional use.</span></p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor117"/>Patterns</h2>
			<p>Pattern types allow <a id="_idIndexMarker292"/>for combinations of types, such as regular expressions <a id="_idIndexMarker293"/>or specific choices of strings, to be enforced <span class="No-Break">on attributes.</span></p>
			<h3>Enum</h3>
			<p>The <strong class="source-inline">Enum</strong> data type<a id="_idIndexMarker294"/> allows you to enumerate strings, allowing multiple options<a id="_idIndexMarker295"/> to be used on a <strong class="source-inline">class</strong> parameter. The following code declares <strong class="source-inline">Enum</strong>, followed by an array of strings as options with a minimum of one string <span class="No-Break">or more:</span></p>
			<pre class="source-code">
Enum[&lt;string&gt;,*&lt;string&gt;]</pre>
			<p>The following example shows how to use this in a class called <strong class="source-inline">regional</strong> with a parameter of <strong class="source-inline">uk_region</strong> accepting one of the available <span class="No-Break">UK regions:</span></p>
			<pre class="source-code">
class regional (
  Enum['Scotland,'England','Wales','Northern Ireland'] uk_region
)</pre>
			<h3>Variant</h3>
			<p>The <strong class="source-inline">Variant</strong> data type<a id="_idIndexMarker296"/> allows you to combine any other data types as an array. The<a id="_idIndexMarker297"/> following code uses the <strong class="source-inline">Variant</strong> keyword and declares the list of allowed types on <span class="No-Break">a parameter:</span></p>
			<pre class="source-code">
Variant[&lt;type&gt;,*&lt;type&gt;]</pre>
			<p>For example, the following class accepts Booleans of <strong class="source-inline">true</strong> and <strong class="source-inline">false</strong> or the <strong class="source-inline">true</strong> or <strong class="source-inline">false</strong> strings for the <strong class="source-inline">create_user_home</strong> variable. It will also take a string or an array of strings for the <span class="No-Break"><strong class="source-inline">user_names</strong></span><span class="No-Break"> variable:</span></p>
			<pre class="source-code">
class user_accounts(
  Variant[Boolean, Enum['true', 'false']] create_user_home
  Variant[String,Array[String]] user_names
)</pre>
			<h3>Pattern</h3>
			<p>The <strong class="source-inline">Pattern</strong> data type<a id="_idIndexMarker298"/> is similar to <strong class="source-inline">Variant</strong> but is a way of providing a list of regular <a id="_idIndexMarker299"/>expressions where the parameter can match any of them. The syntax is <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
Pattern[&lt;regexcp&gt;*&lt;regexcp&gt;]</pre>
			<p>Here, we are declaring with the <strong class="source-inline">Pattern</strong> keyword, followed by an array of <strong class="source-inline">regexp</strong> types. For example, the following defined type, <strong class="source-inline">server_access</strong>, takes a hostname that must have a string starting with <strong class="source-inline">edi</strong>, <strong class="source-inline">gla</strong>, <span class="No-Break">or </span><span class="No-Break"><strong class="source-inline">abe</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
Define server_access (
  Pattern[/^edi/,/^gla/,/^abe/] hostname
)</pre>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor118"/>Arrays and hashes</h2>
			<p>In this section, we will cover the various arrays and <span class="No-Break">hashes types.</span></p>
			<h3>Tuple</h3>
			<p>In the previous section, we discussed that the array type could have one type declared for all of its content. Tuple<a id="_idIndexMarker300"/> allows any number of types to be used at specific indexes within an array and optional minimum and maximum sizes. The minimum size, if smaller than the number of types assigned, makes those types optional, while a maximum size allows for the last type to be repeated if the maximum size is greater than the number of types declared. A maximum size requires a minimum size to <span class="No-Break">be declared:</span></p>
			<pre class="source-code">
Tuple[ &lt;type&gt;, *&lt;type&gt;,  &lt;minimum size&gt;, &lt;maximum size&gt;]</pre>
			<p>To provide an example of this, let’s consider three variables: <strong class="source-inline">user_declaration</strong>, <strong class="source-inline">calculation</strong>, and <strong class="source-inline">file_download</strong>. The <strong class="source-inline">user_declaration</strong> variable requires a string for the username, an integer for the UID, and at least one string up to eight characters in length, which represents the groups that a user can be assigned to. The <strong class="source-inline">calculation</strong> variable requires an integer, a float, and an integer. The <strong class="source-inline">file_download</strong> variable requires a URI and a string, and, optionally, an integer. Please note that the <a id="_idIndexMarker301"/>integer is optional and is <span class="No-Break">not required:</span></p>
			<pre class="source-code">
class exampleapp (
Tuple [ string, integer, string, 3 , 10 ] user_declaration
Tuple [ integer, float, integer] calculation
Tuple [ uri, string , integer, 2] file_dowload
)</pre>
			<h3>Struct</h3>
			<p><strong class="source-inline">Struct</strong> provides a similar type to <strong class="source-inline">Tuple</strong> for hashes. In the <strong class="source-inline">Hash</strong> data type, a single key type and value type was declared, while a struct<a id="_idIndexMarker302"/> allows for a particular order string keys with the option to have <strong class="source-inline">optional</strong> or <strong class="source-inline">undef</strong> and value types to be declared. Unlike <strong class="source-inline">Tuple</strong>, there is no minimum or <span class="No-Break">maximum size:</span></p>
			<pre class="source-code">
Hash[&lt;*optional *undef String name&gt;, &lt;Value type&gt;, *(&lt;*optional *undef String name &gt;,&lt;value type&gt;)</pre>
			<p>To illustrate how the use of optional keys and values can affect variable assignments, let’s consider three examples: <strong class="source-inline">config_file</strong>, <strong class="source-inline">application_binary</strong>, and <strong class="source-inline">application_startup</strong>. The <strong class="source-inline">config_file</strong> variable requires key pairs, including the <strong class="source-inline">mode</strong> key with a string value of either <strong class="source-inline">file</strong> or <strong class="source-inline">link</strong>, and a <strong class="source-inline">path</strong> key with a string value. The <strong class="source-inline">application_binary</strong> variable is similar to <strong class="source-inline">config_file</strong>, but it allows for an optional <strong class="source-inline">owner</strong> key with a string value. If present, the <strong class="source-inline">owner</strong> key must have a string value. The <strong class="source-inline">application_startup</strong> variable requires an <strong class="source-inline">owner</strong> key that can either be undefined or a string. Additionally, the value for each key must match the expected <span class="No-Break">data type:</span></p>
			<pre class="source-code">
class skeleton (
Struct[{mode =&gt; Enum[file, link],
        path =&gt; String config_file
Struct[{mode            =&gt; Enum[file, link],
        path            =&gt; String,
        Optional[owner] =&gt; String}] application_binary
Struct[{mode            =&gt; Enum[file, link],
        path            =&gt; String,
        owner           =&gt; Optional[String]}] application_startup
)</pre>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor119"/>Parent data types</h2>
			<p>The following data types<a id="_idIndexMarker303"/> allow you to group multiple data types into a single parameter. Using them directly can make code shorter <span class="No-Break">and clearer:</span></p>
			<ul>
				<li><strong class="source-inline">Any</strong>: The <strong class="source-inline">Any</strong> type<a id="_idIndexMarker304"/> matches any Puppet data type, making it useful when<a id="_idIndexMarker305"/> the exact data type is unknown or does <span class="No-Break">not matter.</span></li>
				<li><strong class="source-inline">Collection</strong>: The <strong class="source-inline">Collection</strong> type<a id="_idIndexMarker306"/> matches any array or hash<a id="_idIndexMarker307"/> data type, making it useful when an array or hash can have multiple <span class="No-Break">data types.</span></li>
				<li><strong class="source-inline">Scalar</strong>: The <strong class="source-inline">Scalar</strong> data type<a id="_idIndexMarker308"/> matches strings, Booleans, regular expressions, and numerics. It is useful when a single value with any <a id="_idIndexMarker309"/>of these data types <span class="No-Break">is required.</span></li>
				<li><strong class="source-inline">Data</strong>: The <strong class="source-inline">Data</strong> type<a id="_idIndexMarker310"/> matches scalar, undefs, and arrays containing values that match data, and hashes with keys matching scalars and values <a id="_idIndexMarker311"/>that match data. It is useful when complex data structures <span class="No-Break">are required.</span></li>
				<li><strong class="source-inline">Numeric</strong>: The <strong class="source-inline">Numeric</strong> type<a id="_idIndexMarker312"/> matches float and integer <a id="_idIndexMarker313"/>data types, which is useful when a numerical value <span class="No-Break">is required.</span></li>
			</ul>
			<h2 id="_idParaDest-104"><a id="_idTextAnchor120"/>Lab</h2>
			<p>Continuing our work on the <strong class="source-inline">all_grafana</strong> class, create an <strong class="source-inline">all_grafana_data_types</strong> class and add to it so that it accepts a <strong class="source-inline">file_options</strong> parameter. This must have a name but can optionally have a mode, a user, and a group as a hash. Ensure each of those resources has restricted data types. Add a Grafana user and a sensitive parameter password that is passed to <span class="No-Break">the user.</span></p>
			<p>To achieve class assignment, write a class declaration before you assign the class some variables. When you run <strong class="source-inline">bolt</strong> against your manifest, it will include your variables. The solutions are available <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/all_grafana_data_types.pp"><span class="No-Break">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch04/all_grafana_data_types.pp</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-105"><a id="_idTextAnchor121"/>Scope</h1>
			<p>In Puppet, a scope<a id="_idIndexMarker314"/> is a level of code that has limited access to variables and default settings for resources. The three levels of scope are top scope, node scope, and local scope. Top scope variables reflect variables that are declared globally, most commonly in the <strong class="source-inline">site.pp</strong> manifest file. Node scope variables are assigned in node definitions, which are typically also made in <strong class="source-inline">site.pp</strong> or via an <strong class="bold">External Node Classifier</strong> (<strong class="bold">ENC</strong>). For example, variables <a id="_idIndexMarker315"/>can be declared in the <strong class="source-inline">site.pp</strong> manifest file within a Puppet environment to make them globally available to all nodes. Alternatively, variables can be declared in a node definition in <strong class="source-inline">site.pp</strong> or the ENC to be made available at the node level for a particular server or group of servers. <strong class="source-inline">site.pp</strong> is a special manifest file in Puppet that contains the main configuration for a Puppet environment. A resource default is a default setting for a resource, which can be overridden in a more specific scope, such as node scope or local scope. The full use of <strong class="source-inline">site.pp</strong>, ENC, and node definitions will be explained in detail in <a href="B18492_10.xhtml#_idTextAnchor252"><span class="No-Break"><em class="italic">Chapter 10</em></span></a><span class="No-Break">.</span></p>
			<p>When accessing a variable, by default, the server will access the lowest level first and essentially override variables of the same name at higher levels. Other local scopes can be accessed by using the namespace but cannot be <span class="No-Break">assigned values.</span></p>
			<p>Here’s an example of how these concepts work together in a single Puppet manifest file. We can define a global variable called <strong class="source-inline">'global'</strong> with a string value of <strong class="source-inline">'world'</strong>, and a node definition that, by default, assigns all nodes a variable called <strong class="source-inline">'node'</strong> with a string value of <strong class="source-inline">'mynode'</strong>. The node definition includes two classes, <strong class="source-inline">'local'</strong> and <strong class="source-inline">'also_local'</strong>. In the <strong class="source-inline">'local'</strong> class, we assign a variable called <strong class="source-inline">'global'</strong> with a string value of <strong class="source-inline">'override'</strong>, which has a local scope and overrides the global value. We will use two notify resources to demonstrate how variable scope works. The first notify resource prints <strong class="source-inline">'Print override'</strong>, showing that the <strong class="source-inline">'global'</strong> local variable has overridden the global value. The second notify resource uses the <strong class="source-inline">::</strong> syntax to reference the global variable, so it prints <strong class="source-inline">'Print world'</strong>. The third notify resource prints <strong class="source-inline">'Print node'</strong> because there are no local variables with that name. In the <strong class="source-inline">'also_local'</strong> class, we define a new variable called <strong class="source-inline">'another_global'</strong> with a string value of <strong class="source-inline">'another world'</strong>. The first <strong class="source-inline">notify</strong> resource in this class uses the directly-accessed variable to print <strong class="source-inline">'Print another override'</strong>. The second <strong class="source-inline">notify</strong> resource uses the <strong class="source-inline">::</strong> syntax to reference the global variable and prints <strong class="source-inline">'Print another world'</strong> because no local variable called <strong class="source-inline">'global'</strong> is declared. A <strong class="source-inline">notify</strong> resource is a Puppet resource type that simply logs a message to the console or system log. It’s commonly used for<a id="_idIndexMarker316"/> debugging or <span class="No-Break">informational purposes:</span></p>
			<pre class="source-code">
$global = 'world'
node default {
  $node = 'mynode'
  include local
  include also_local
}
class local
{
$global = 'override'
  notify {"Print ${global}":}
  notify {"Print ${::global}":}
  notify {"Print ${node}":}
}
class also_local {
  notify {"Print another ${local::global}":}
  notify {"Print another ${global}":}
}</pre>
			<p>Resource titles or references to resources are not limited by <a id="_idIndexMarker317"/>scope as they must be unique to the whole catalog. As shown in the preceding example, the <strong class="source-inline">notify</strong> resources that were used in the <strong class="source-inline">also_local</strong> class had their titles adjusted so that they contained <strong class="source-inline">another</strong>. This helps us avoid resource title clashes when the variables are interpolated. Otherwise, both the <strong class="source-inline">local</strong> and <strong class="source-inline">also_local</strong> classes would have contained <strong class="source-inline">notify</strong> resources called <strong class="source-inline">Print override</strong> and <strong class="source-inline">Print world</strong> and would fail to compile with <span class="No-Break">duplicate resources.</span></p>
			<p>As discussed, the <strong class="source-inline">also_local</strong> class can call the <strong class="source-inline">global</strong> variable from the <strong class="source-inline">local</strong> class but cannot assign it to that <span class="No-Break">local scope.</span></p>
			<h1 id="_idParaDest-106"><a id="_idTextAnchor122"/>Summary</h1>
			<p>In this chapter, we learned that Puppet variables are different from those in normal procedural languages as they can only be assigned once. We saw that certain words are reserved and cannot be used in naming variables. We also saw that Puppet variables can be interpolated, depending on how and where strings <span class="No-Break">are placed.</span></p>
			<p>We covered various core data types and how they can be used to both restrict parameters and assign variables. We also looked at <strong class="source-inline">undef</strong> and Booleans, which need to be carefully managed when translating values to get the <span class="No-Break">expected results.</span></p>
			<p>Next, we looked at arrays and hashes and how to assign them. Although they can’t be changed, we learned how operators can manipulate them into new assignments. We also covered how arrays and hashes can be nested and mixed as hashes of arrays and arrays <span class="No-Break">of hashes.</span></p>
			<p>Then, we looked at abstract data types and how they apply restrictions to parameters more flexibly with the <strong class="source-inline">Sensitive</strong> type, which provides scoped protection for logs <span class="No-Break">and reporting.</span></p>
			<p>After, we reviewed how Puppet variables can be declared at different scopes and how variables can be shared/seen in <span class="No-Break">different scopes.</span></p>
			<p>In the next chapter, we will cover facts and functions. We will look at the system profiling tool, Facter, the information it gathers, and how it can be customized to gather user-specific data on system profiles. Functions provide Ruby code plugins, allowing code to be run at compile time, which can perform actions such as data manipulation or affect the catalog run. We will cover built-in functions and functions from the standard <strong class="source-inline">lib</strong> module, from Puppet Forge, which can be used to manipulate data types into the variables we discussed in <span class="No-Break">this chapter.</span></p>
		</div>
	</body></html>