<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer257">
			<h1 id="_idParaDest-291"><em class="italic"><a id="_idTextAnchor296"/></em><a href="B17124_12_Final_SK_ePub.xhtml#_idTextAnchor296"><em class="italic">Chapter 12</em></a>: Automation and Deployment on AWS</h1>
			<p>So far, you have learned how to configure and deploy various services on AWS. However, most of your configuration has been manual, with very little automation. For example, in <a href="B17124_09_Final_SK_ePub.xhtml#_idTextAnchor223"><em class="italic">Chapter 9</em></a>, <em class="italic">High Availability and Elasticity on AWS</em>, you deployed an application in a multi-tier design. This consisted of application servers configured in an auto-scaling group, an application load balancer, a database to store application data, and an S3 bucket to host your source code. All of this was deployed in a private network in the form of <strong class="bold">Amazon VPC</strong>. </p>
			<p>While building your application stack, you had to manually configure the various services on AWS with all the necessary resources to deploy your application. For example, with the VPC, you had to configure subnets, IP address ranges, security groups, NAT gateways, and much more. Now, imagine having to perform this sort of manual labor every time you need to create a new environment to host your applications. It would, without a doubt, be very time consuming. </p>
			<p>AWS offers various deployment and automation tools to help you architect, provision, and build infrastructure components to host your applications. Some of these tools fall within the PaaS model, where you simply need to focus on the application build and deployment strategy, and AWS will provision the necessary infrastructure to support that application. Other services enable you to define a template for your infrastructure that you may need to provision repeatedly. Using <strong class="bold">Infrastructure as Code</strong> (<strong class="bold">IaC</strong>), you can draft a template that describes how your services and resources need to be configured. AWS will then build the infrastructure, along with all its components, which can then be used to host your application. Automating your infrastructure deployments offers several benefits, including being able to scale your infrastructure globally by sharing your <em class="italic">templates</em> across your organization to enforce corporate standards and security best practices. Furthermore, by avoiding manual configuration efforts, you reduce the human error element.</p>
			<p>In this chapter, we will look at some of the core automation and deployment tools to help you get your solutions to market faster.</p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>Understanding application deployment with Amazon Elastic Beanstalk</li>
				<li>Understanding the benefits of IaC using Amazon CloudFormation</li>
				<li>Introduction to the orchestration of Chef and Puppet solutions using AWS OpsWorks</li>
				<li>IT automation with Lambda</li>
			</ul>
			<h1 id="_idParaDest-292"><a id="_idTextAnchor297"/>Technical requirements</h1>
			<p>To complete the exercises in this chapter, you will need to log into your AWS account as the IAM user <strong class="bold">Alice</strong>, which you had set up in <a href="B17124_04_Final_SK_ePub.xhtml#_idTextAnchor068"><em class="italic">Chapter 4</em></a>, <em class="italic">Identity and Access Management</em>.</p>
			<h1 id="_idParaDest-293"><a id="_idTextAnchor298"/>Understanding application deployment with Amazon Elastic Beanstalk</h1>
			<p><strong class="bold">Amazon Elastic Beanstalk</strong> is a service that enables you to deploy your application without having to manually configure<a id="_idIndexMarker1265"/> the underlying infrastructure that will support the application. Amazon Elastic Beanstalk does all the heavy lifting, which involves<a id="_idIndexMarker1266"/> provisioning the necessary infrastructure to host and manage your application. This includes capacity provisioning, scaling, load balancing, and health monitoring. </p>
			<p>If your application is developed in one of the supported languages, which includes Go, Java, .NET, Node.js, PHP, Python, and a few others, Amazon Elastic Beanstalk will build out the platform using one or more AWS resources, such as EC2 instances, to run your application. All you need to do is follow a prescribed process to deploy your application.</p>
			<p>Another option to consider is to use Elastic Beanstalk to deploy Docker containers. This gives you a lot more flexibility because, with Docker containers, you can configure your runtime environments and choose a programming language, supported platform, and any dependencies as required. Thus, you are not restricted to any limitations that are usually associated with the other platforms.</p>
			<p>Amazon Elastic Beanstalk does not restrict you to one specific underlying infrastructure design either. You can modify how the underlying infrastructure components will be deployed – for example, you can specify the EC2 instance type and size that is deployed or enforce that a set minimum number of EC2 instances are deployed as part of an auto-scaling group. Ultimately, you retain<a id="_idIndexMarker1267"/> control of how the infrastructure is configured but without the complex manual configuration, which Amazon Elastic Beanstalk takes care of. Once your application has been deployed, you can manage your environment and deploy application updates or versions later.</p>
			<p>Now, let's take a look at the core components of the Amazon Elastic Beanstalk service.</p>
			<h2 id="_idParaDest-294"><a id="_idTextAnchor299"/>Core components of Amazon Elastic Beanstalk</h2>
			<p>The infrastructure components<a id="_idIndexMarker1268"/> that AWS Elastic Beanstalk creates to host your application are called an <em class="italic">environment</em>. Each environment can only run a single application version, but you can create<a id="_idIndexMarker1269"/> many environments for different application versions simultaneously. You can modify your environment if you need to and deploy upgrades to your application when you release new updates.</p>
			<p>As part of launching an Elastic Beanstalk environment, you need to select the <em class="italic">environment tier</em>. The environment tier you choose is determined by the type of application you are deploying and ultimately determines the resources Elastic Beanstalk will configure to support your application. We have two environment tiers that can be configured with Elastic Beanstalk: <strong class="bold">web server environment tier</strong> and <strong class="bold">worker environment tier</strong>.</p>
			<h3>Web server environment tier</h3>
			<p>This environment is designed for the frontend<a id="_idIndexMarker1270"/> tier of your application stack, such as the frontend <strong class="bold">user interface</strong> (<strong class="bold">UI</strong>) of your e-commerce application. AWS Elastic Beanstalk will provision an environment that is designed<a id="_idIndexMarker1271"/> to accept inbound traffic to your web application via an elastic load balancer, offer scalability in the form of auto-scaling group configurations, and one or more EC2 instances.</p>
			<p>The following diagram illustrates the typical architecture that's deployed:</p>
			<div>
				<div id="_idContainer248" class="IMG---Figure">
					<img src="Images/B17124_12_01.jpg" alt="Figure 12.1 – AWS Elastic Beanstalk – web server environment tier&#13;&#10;" width="978" height="680"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.1 – AWS Elastic Beanstalk – web server environment tier</p>
			<p>As part of the <em class="italic">web server environment tier</em>, AWS Elastic Beanstalk will deploy EC2 instances across<a id="_idIndexMarker1272"/> multiple AZs. Your application is then deployed onto those instances. Furthermore, Amazon Auto Scaling<a id="_idIndexMarker1273"/> will be configured as part of the environment to scale out as demand for your application increases or scale back in when demand drops. You will have full control over the scaling policies that are used and their parameters. AWS Elastic Beanstalk will also deploy a software stack, depending on the <em class="italic">container type</em>, which is the infrastructure topology and software stack to be used for that environment. For example, if you were deploying a .NET application on Windows, the environment that would be configured by Elastic Beanstalk would be comprised of the Microsoft Windows operating<a id="_idIndexMarker1274"/> system, Windows EC2 instances, and a version of <strong class="bold">Internet Information Services+</strong> (<strong class="bold">IIS</strong>).</p>
			<p>AWS Elastic Beanstalk<a id="_idIndexMarker1275"/> also configures an environment URL that points to the load balancer in the format of <strong class="source-inline">app-name.region.elasticbeanstalk.com</strong>. This URL is aliased with the elastic load balancer's URL. You can also alias this URL<a id="_idIndexMarker1276"/> with a CNAME record of your choice, such as your company domain name, using Amazon Route 53. This will allow you to use more friendly names such as <strong class="source-inline">myapp.mycompany.com</strong>.</p>
			<p>In addition, each EC2 instance<a id="_idIndexMarker1277"/> will be configured with a software component called the <strong class="bold">host manager</strong> (<strong class="bold">HM</strong>). The HM is responsible for the following:</p>
			<ul>
				<li>Deploying the application</li>
				<li>Aggregating events and metrics for the servers</li>
				<li>Generating instance-level events</li>
				<li>Monitoring the application log files for critical errors</li>
				<li>Monitoring the application server</li>
				<li>Patching your EC2 instances</li>
				<li>Rotating your application's log files and publishing them to Amazon S3</li>
			</ul>
			<p>Next, we'll look at the worker environment tier.</p>
			<h3>Worker environment tier</h3>
			<p>This environment is intended for backend operations. In a multiple-tier application architecture, this would represent the middleware, application, and backend database layers of your application stack. AWS Elastic Beanstalk<a id="_idIndexMarker1278"/> provisions an environment that's appropriate for such backend operations<a id="_idIndexMarker1279"/> and consists of an Auto Scaling group, one or more Amazon EC2 instances, and an IAM role. In addition, AWS Elastic Beanstalk will also provision an Amazon SQS queue if you have not configured your own yet. </p>
			<p>AWS Elastic Beanstalk will also install a <em class="italic">daemon</em> on each EC2 instance in the fleet. This daemon will read messages from the Amazon SQS queue<a id="_idIndexMarker1280"/> and send this data to the application servers running in the worker<a id="_idIndexMarker1281"/> environment tier for processing. This process is illustrated in the following diagram:</p>
			<div>
				<div id="_idContainer249" class="IMG---Figure">
					<img src="Images/B17124_12_02.jpg" alt="Figure 12.2 – AWS Elastic Beanstalk – worker environment tier&#13;&#10;" width="1245" height="636"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.2 – AWS Elastic Beanstalk – worker environment tier</p>
			<p>AWS Elastic Beanstalk<a id="_idIndexMarker1282"/> will also monitor the health of your EC2 instances using a service called <strong class="bold">Amazon CloudWatch</strong>. We will look at Amazon CloudWatch in <a href="B17124_13_Final_SK_ePub.xhtml#_idTextAnchor317"><em class="italic">Chapter 13</em></a>, <em class="italic">Management and Governance on AWS</em>.</p>
			<p>Apart from this, AWS Elastic Beanstalk can help you deploy and manage your application stack using various deployment types, including <em class="italic">all at once</em>, <em class="italic">rolling</em>, <em class="italic">rolling with additional batch</em>, <em class="italic">immutable</em>, and <em class="italic">traffic splitting</em>. These deployment types enable you to design your application deployments and any ongoing updates that suit your specific business requirements.</p>
			<p>In this section, we learned about the AWS Elastic Beanstalk service, which is an application deployment and management service on AWS. AWS Elastic Beanstalk allows developers to focus on their application code rather than having to minutely configure infrastructure components to support the application. AWS Elastic Beanstalk will provision a highly available<a id="_idIndexMarker1283"/> and scalable infrastructure architecture and gives you control over how those infrastructure components are configured to support<a id="_idIndexMarker1284"/> your specific requirements. </p>
			<p>In the next section, we will look at the Amazon CloudFormation service, which enables you to architect your underlying infrastructure resources using templates written in JSON or YAML code. </p>
			<h1 id="_idParaDest-295"><a id="_idTextAnchor300"/>Understanding the benefits of IaC using Amazon CloudFormation</h1>
			<p>The approach of using code to describe and deploy your infrastructure components automatically is known as IaC. IaC is a fundamental<a id="_idIndexMarker1285"/> component that enables you to automate infrastructure builds in the cloud.</p>
			<p>Building your infrastructure using code<a id="_idIndexMarker1286"/> greatly improves deployment processes because the code is executed by machines. This also means that any infrastructure that's deployed using code is less prone to human errors, which is inherent in manual deployments. Furthermore, you can create templates for repeat deployments and enable versioning for those templates. Often, you want to mimic the testing and production environments with each other so that you are assured that once your application has passed the testing phase, it can be easily deployed to production. Using templates that describe your infrastructure is the best way to avoid any discrepancies between those environments. </p>
			<p><strong class="bold">Amazon CloudFormation</strong> is a solution that can help you design, build, and deploy<a id="_idIndexMarker1287"/> your infrastructure using code. It helps you define the resources to be created and configured and how those resources interact with each other. </p>
			<h2 id="_idParaDest-296"><a id="_idTextAnchor301"/>CloudFormation templates</h2>
			<p>Amazon CloudFormation uses <em class="italic">templates</em>, which are text files that are written in either JSON or YAML format. The code describes<a id="_idIndexMarker1288"/> the resources that you wish to deploy, along with configuration information related to those resources. For example, if you need to deploy a <strong class="bold">security group</strong> as part of your VPC template, you can specify its name<a id="_idIndexMarker1289"/> and the inbound and outbound rules that are permitted.</p>
			<p>The best part about CloudFormation templates is that they contain descriptions of the resources that you want CloudFormation to deploy. This can double up as a technical document of your entire infrastructure. In addition, templates can be used repeatably to deploy infrastructure for different environments. This ensures that you have the same architecture for both your development and testing environments. While the configuration in each environment will be the same, they will be separate environments with different resource identifiers. </p>
			<p>AWS CloudFormation templates can also be used to accept input parameter values. This can further help expedite the process of building different environments for experimentation and testing. For example, if you were testing a new application and you wanted to compare performance levels based on the underlying EC2 instance type and size that the application was hosted on, you could deploy multiple test environments with different EC2 instance types and sizes. The input parameters, at the time of deploying the template, will prompt you to specify which instance type and size to use for a given environment. This also makes it easier to use the same template for different situations.</p>
			<p>CloudFormation templates are used to deploy CloudFormation stacks, which are a container that organizes the resources described in the template. We'll look at CloudFormation stacks next.</p>
			<h2 id="_idParaDest-297"><a id="_idTextAnchor302"/>CloudFormation stacks</h2>
			<p>With CloudFormation, you can create <em class="italic">stacks</em>, which are a container to collectively manage all related resources<a id="_idIndexMarker1290"/> as a single unit. So, for example, a stack could consist of the VPC, an Auto Scaling group, an elastic load balancer, and an Amazon RDS database instance. You can have multiple stacks that deploy a collection of resources that may also need to communicate with each other. </p>
			<p>You can also delete a stack when you no longer need the resources contained within it. AWS will then delete every resource that was deployed when the stack was created using your template. This ensures that you do not have any resources lingering, which often happens when you are manually<a id="_idIndexMarker1291"/> trying to delete resources from an environment. This also ensures that you can quickly get rid of test or development environments when they're no longer needed.</p>
			<p>Sometimes, you may need to modify your stack – for example, if you need to upgrade the EC2 instance type or change the database endpoint. We will look at how to implement changes to your stack next.</p>
			<h2 id="_idParaDest-298"><a id="_idTextAnchor303"/>Change sets</h2>
			<p>If you need to make changes to the resources that are deployed in your stack, you can create a <strong class="bold">change set</strong>. AWS CloudFormation creates this change set based on a summary of changes<a id="_idIndexMarker1292"/> you make to the template and gives you the details of the proposed changes. You can then decide whether to roll out those changes or make further modifications first. </p>
			<p>Change sets<a id="_idIndexMarker1293"/> are particularly useful at highlighting changes that may have catastrophic results, ensuring that you can perform all precautionary tasks first. For example, if you were to simply change the name of your Amazon RDS database in a template, AWS CloudFormation would create a new database and delete the old one. If you did not make a backup of the RDS database before performing this action, you would end up losing your data. Change sets can help you identify where such irreversible changes will occur, and you can make sure that you first perform a manual snapshot of your RDS database before rolling out the change.</p>
			<h2 id="_idParaDest-299"><a id="_idTextAnchor304"/>Drift detection</h2>
			<p>The recommended approach, when making any changes to your CloudFormation stack, is to use change sets. However, it is possible to make changes to the stack resources outside of CloudFormation. Sometimes, these may<a id="_idIndexMarker1294"/> be accidental but at other times, you may wish to make these changes urgently, although any change should follow a proper change management process.</p>
			<p>Another issue is that if changes<a id="_idIndexMarker1295"/> are made outside of CloudFormation, then any stack update or deletion requests may fail. AWS offers a feature of the CloudFormation service known as <em class="italic">drift detection</em>. You can use drift detection to identify stack resources that configuration changes have been made to outside of CloudFormation management.</p>
			<p>In this section, you learned about the AWS CloudFormation service, which uses an IaC approach to build and deploy infrastructure resources that can be used to support your application. CloudFormation enables<a id="_idIndexMarker1296"/> you to design templates using JSON- and YAML-formatted text files that describe your resources and how they can be configured. </p>
			<p>Then, CloudFormation does the heavy lifting of provisioning those resources just the way you want them. CloudFormation templates are used to build CloudFormation stacks, which collectively manage all the related resources as a single unit. </p>
			<p>In the next section, we will look at another AWS service that can help you orchestrate and deploy applications that have been designed for the Chef and Puppet automation tools.</p>
			<h1 id="_idParaDest-300"><a id="_idTextAnchor305"/>Introduction to the orchestration of Chef and Puppet solutions using AWS OpsWorks</h1>
			<p>In this section, we will provide a quick introduction to another configuration management and orchestration service known as <strong class="bold">AWS OpsWorks</strong>. AWS offers three different services that<a id="_idIndexMarker1297"/> fall under the AWS OpsWorks offering. There are AWS OpsWorks stacks and AWS OpsWorks for Chef Automate, which let you use Chef cookbooks for configuration management. The third service is OpsWorks for Puppet Enterprise, which lets you configure a Puppet Enterprise master server in AWS.</p>
			<p><strong class="bold">OpsWorks for Puppet Enterprise</strong> provides a <em class="italic">fully managed Puppet master server</em> that is used to communicate with, configure, deploy, and manage your nodes – which could be EC2 instances or even<a id="_idIndexMarker1298"/> on-premises servers. The service also takes care of handling tasks such as software and operating system configurations, package installations, database setups, and more.</p>
			<p><strong class="bold">AWS OpsWorks for Chef Automate</strong> lets you create <em class="italic">AWS-managed Chef servers</em>, including Chef Automate software solutions. AWS OpsWorks creates a Chef server that is used to manage<a id="_idIndexMarker1299"/> all your nodes and acts as a central repository for your Chef cookbooks. Chef cookbooks contain recipes that are authored using the Ruby programming language and enable you to define a collection of resources and their attributes that need to be configured. </p>
			<p>AWS OpsWorks for Puppet Enterprise<a id="_idIndexMarker1300"/> and OpsWorks for Chef Automate<a id="_idIndexMarker1301"/> require that you know how to operate the Chef and Puppet software. If you prefer a more IaC approach to deploying your application and are not familiar with Chef or Puppet, you can also use AWS OpsWorks stacks. Next, we will look at the AWS OpsWorks stacks service.</p>
			<h2 id="_idParaDest-301"><a id="_idTextAnchor306"/>AWS OpsWorks stacks</h2>
			<p>By now, you are aware that deploying a single application can be comprised of several resources running behind the scenes, including the host EC2 instances that the application runs on, backend databases<a id="_idIndexMarker1302"/> such as Amazon RDS to store the application data, load balancers to distribute traffic, and so on. This group of related resources is what we call a stack. </p>
			<p>A stack is a container for your AWS resources such as your EC2 instances, RDS databases, and all the related components, which are logically managed together. Each stack will contain at least one layer but can have more. </p>
			<p>Let's consider a typical example that consists of the following three layers<a id="_idIndexMarker1303"/> to support an application:</p>
			<ul>
				<li>A backend database layer, which can either be a self-hosted database solution or a managed service such as Amazon RDS</li>
				<li>An application layer, which is comprised of EC2 instances or containers</li>
				<li>A load balancing layer, which hosts your application load balancer to distribute traffic to your application layer</li>
			</ul>
			<p>The following diagram illustrates this configuration:</p>
			<div>
				<div id="_idContainer250" class="IMG---Figure">
					<img src="Images/B17124_12_03.jpg" alt="Figure 12.3 – AWS OpsWorks stacks&#13;&#10;" width="1125" height="709"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.3 – AWS OpsWorks stacks</p>
			<p>Amazon OpsWorks stacks will not only help you build out your stack but also monitor the stack's performance and health, security permissions, and more. With AWS OpsWorks stacks, you do not need to create or manage Chef servers as OpsWorks stacks performs some of the work for you. </p>
			<p>There are two types of layers that AWS OpsWorks stacks uses, both of which we will discuss next.</p>
			<h3>AWS OpsWorks layers</h3>
			<p>An OpsWorks layer represents<a id="_idIndexMarker1304"/> a particular service or task as part of your overall application stack. For example, your EC2 instances could represent the application layer, which is used to host the application. Next, your application load balancer will represent the load balancing layer, distributing traffic across the EC2 instances. Each layer is comprised of a template that allows you to specify the components of the resources that are being provisioned. For example, for the application layer, this would include your EC2 instance's security group or IP addressing details. You can provision any supported operating system and even add on-premises servers to the stack. </p>
			<p>AWS OpsWorks stacks<a id="_idIndexMarker1305"/> does not provision a Chef server or a Puppet Enterprise Master server; instead, all the management tasks are performed by AWS OpsWorks via the embedded Chef solo client that is installed on Amazon EC2 instances.</p>
			<h3>Service layers</h3>
			<p>AWS OpsWorks can also extend your stack to include service layers, which can be used to build a complete multi-tier application solution. These service layers<a id="_idIndexMarker1306"/> can include the following:</p>
			<ul>
				<li><strong class="bold">Amazon Relational Database Service </strong>(<strong class="bold">RDS</strong>): This layer will enable you to integrate<a id="_idIndexMarker1307"/> your application with an existing RDS database<a id="_idIndexMarker1308"/> deployment.</li>
				<li><strong class="bold">Elastic Load Balancing</strong>: This layer will enable you to distribute<a id="_idIndexMarker1309"/> traffic to your fleet of EC2 instances across multiple Availability Zones<a id="_idIndexMarker1310"/> while offering high-availability features.</li>
				<li><strong class="bold">Amazon Elastic Container Service</strong> (<strong class="bold">ECS</strong>)<strong class="bold"> cluster</strong>: This layer will enable you to create<a id="_idIndexMarker1311"/> an ECS cluster layer, allowing you to connect<a id="_idIndexMarker1312"/> your OpsWorks stacks to an ECS cluster running your Docker-based applications.</li>
			</ul>
			<p>In this section, we looked at the AWS OpsWorks suite of services, which enables you to orchestrate application deployment solutions using Chef and Puppet. You also learned about the OpsWorks stacks service, which allows you to create and manage stacks and applications.</p>
			<p>In the next section, we will look at the AWS Lambda service and how you can use it to automate administrative tasks on AWS.</p>
			<h1 id="_idParaDest-302"><a id="_idTextAnchor307"/>IT automation with Lambda</h1>
			<p>In <a href="B17124_07_Final_SK_ePub.xhtml#_idTextAnchor157"><em class="italic">Chapter 7</em></a>, <em class="italic">AWS Compute Services</em>, we learned that <strong class="bold">AWS Lambda</strong> is a serverless compute service that allows you to run code without having to provision or manage servers in the cloud. With AWS Lambda, you simply upload your code<a id="_idIndexMarker1313"/> and have it executed based on a specific trigger. AWS Lambda will provision<a id="_idIndexMarker1314"/> all the underlying infrastructure needed to run your code, be it compute power, memory, or temporary storage. </p>
			<p>Your code can be automatically triggered from various AWS services and SaaS applications or even be called directly from any web or mobile application. You could use AWS Lambda in conjunction with other serverless offerings such as API Gateway, DynamoDB, and the Amazon S3 static website hosting service to build the ultimate serverless application for your business or clients. </p>
			<p>In addition to this, Lambda can also be used to help automate a vast array of day-to-day administrative tasks. This can include any repetitive tasks that are triggered by a specific event or even on a specific schedule. For example, you can automate how firmware updates are installed on hardware devices, start and stop EC2 instances, schedule security group updates if you need to make changes, and much more.</p>
			<p>In the upcoming exercise in this chapter, we will look at one such use case for using AWS Lambda to help you perform the typical administrative task of stopping and restarting EC2 instances at regular intervals.</p>
			<h1 id="_idParaDest-303"><a id="_idTextAnchor308"/>Exercise 12.1 – stopping and starting EC2 instances at regular intervals using AWS Lambda</h1>
			<p>Imagine a scenario where you need<a id="_idIndexMarker1315"/> to run a fleet of on-demand EC2 test servers<a id="_idIndexMarker1316"/> that your <strong class="bold">user acceptance testing</strong> (<strong class="bold">UAT</strong>) team needs to perform multiple functional and technical tests on for an<a id="_idIndexMarker1317"/> upcoming application that you are developing. Your UAT team only works from Monday to Friday, 9 A.M. to 5 P.M. The UAT team only needs<a id="_idIndexMarker1318"/> access to the fleet of test servers during<a id="_idIndexMarker1319"/> this time. Rather than have a technician manually start up all the servers in the morning and shut them down again at the end of the business day, you could automate the process using AWS Lambda. You would not want to have your on-demand EC2 instances running when they are not needed because you are charged for every hour that those servers are running.</p>
			<p>In this exercise, we will look at how to configure AWS Lambda to automatically stop and then start your EC2 instances at defined schedules.</p>
			<p>To complete the exercises in this chapter, you will need to download the sample IAM policy from this book's Packt GitHub repository at: <a href="https://github.com/PacktPublishing/AWS-Certified-Cloud-Practitioner-Exam-Guide">https://github.com/PacktPublishing/AWS-Certified-Cloud-Practitioner-Exam-Guide</a></p>
			<h2 id="_idParaDest-304"><a id="_idTextAnchor309"/>Step 1 - Launching an EC2 instance</h2>
			<p>To complete this excercise, you will need to deploy an EC2 Instance running the Linux 2 AMI:</p>
			<ol>
				<li>Log into the AWS Management<a id="_idIndexMarker1320"/> Console as the IAM user called <strong class="bold">Alice</strong>.</li>
				<li>Navigate to the EC2 dashboard. Ensure that you are in the <strong class="bold">us-east-1 (N. Virginia)</strong> Region.</li>
				<li>Click on <strong class="bold">Instances</strong> from the left-hand menu and then click on the <strong class="bold">Launch instances</strong> button.</li>
				<li>For <strong class="bold">Step 1: Choose an Amazon Machine Image (AMI)</strong>, select the <strong class="bold">Amazon Linux 2</strong> AMI.</li>
				<li>For <strong class="bold">Step 2: Choose an Instance Type</strong>, select the <strong class="bold">t2.micro</strong> instance type and click the <strong class="bold">Next: Configure Instance Details</strong> button.</li>
				<li>For <strong class="bold">Step 3: Configure Instance Details</strong>, provide the following key details:<ul><li>For <strong class="bold">Network</strong>, select the default VPC.</li><li>For <strong class="bold">Subnet</strong>, select the subnet ID that represents the default subnet in <strong class="bold">us-east-1a</strong>.</li><li>In the text box next to <strong class="bold">Auto-assign Public IP</strong>, ensure that <strong class="bold">Enable</strong> is selected.</li><li>Leave all the remaining options as their default values and click the <strong class="bold">Next: Add Storage</strong> button at the bottom of the page.</li></ul></li>
				<li>For <strong class="bold">Step 4: Add Storage</strong>, leave all the options as their default values and click the <strong class="bold">Next: Add Tags</strong> button at the bottom of the page.</li>
				<li>For <strong class="bold">Step 5: Add Tags</strong>, click<a id="_idIndexMarker1321"/> the <strong class="bold">Add Tag</strong> button and provide a key-value name for your EC2 instance. For example, for <strong class="bold">Key</strong>, type in <strong class="source-inline">Name</strong>, and for <strong class="bold">Value</strong>, type in <strong class="source-inline">UAT-Server-01</strong>.</li>
				<li>Next, click on the <strong class="bold">Next: Configure Security Group</strong> button at the bottom of the page.</li>
				<li>For <strong class="bold">Step 6: Configure Security Group</strong>, ensure that the <strong class="bold">Create a new security group</strong> option is selected and set <strong class="bold">Security group name</strong> to <strong class="bold">UAT-SG</strong>. This will represent the security group of our UAT test server(s).</li>
				<li>Next, you need to configure the inbound rules. You should already have a pre-configured inbound rule defined that allows SSH traffic inbound from the internet, as per the following screenshot: <div id="_idContainer251" class="IMG---Figure"><img src="Images/B17124_12_04.jpg" alt="Figure 12.4 – Configure Security Group&#13;&#10;" width="1284" height="437"/></div><p class="figure-caption">Figure 12.4 – Configure Security Group</p></li>
				<li>Click the <strong class="bold">Review and Launch</strong> button at the bottom of the page.</li>
				<li>On the next page, review your configuration and then click the <strong class="bold">Launch</strong> button at the bottom of the page.</li>
				<li>You will be prompted to choose an existing key pair or create a new one. You can use the existing key pair you created for the previous exercise. You will need to click on the checkbox to acknowledge that you have access to this key pair and then click on the <strong class="bold">Launch instances</strong> button.</li>
				<li>Finally, click on the <strong class="bold">View Instances</strong> button to be taken back to the EC2 dashboard, where you can see the instance you just launched.</li>
			</ol>
			<p>Because we will be stopping<a id="_idIndexMarker1322"/> and starting these EC2 instances using a Lambda function, you will need to make a note of the EC2 instance ID, as per the following screenshot. Note that your EC2 instance ID will be different from the one shown in this screenshot:</p>
			<div>
				<div id="_idContainer252" class="IMG---Figure">
					<img src="Images/B17124_12_05.jpg" alt="Figure 12.5 – EC2 instance ID&#13;&#10;" width="948" height="523"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.5 – EC2 instance ID</p>
			<p>Once your instance is up and running, we can start creating the necessary IAM policy and IAM role to enable our Lambda functions to start and stop our EC2 instance.</p>
			<h2 id="_idParaDest-305"><a id="_idTextAnchor310"/>Step 2 - Creating an IAM policy and execution role for your Lambda function</h2>
			<p>For your Lambda function<a id="_idIndexMarker1323"/> to be able to start and stop your EC2 instances, it needs<a id="_idIndexMarker1324"/> to have the necessary permissions. In this step, you will configure an IAM policy and an IAM role to enable your Lambda function<a id="_idIndexMarker1325"/> to perform the start and stop operations<a id="_idIndexMarker1326"/> on your EC2 instances:</p>
			<ol>
				<li value="1">Navigate to the IAM dashboard.</li>
				<li>From the left-hand menu, click on <strong class="bold">Policies</strong>.</li>
				<li>Click the <strong class="bold">Create Policy</strong> button from the right-hand pane.</li>
				<li>Select the <strong class="bold">JSON</strong> tab and delete the default JSON text in the editor tool.</li>
				<li>Next, copy and paste the following JSON policy document into the policy editor (you can also download this policy from the Packt GitHub repository for this book <a href="https://github.com/PacktPublishing/AWS-Certified-Cloud-Practitioner-Exam-Guide">https://github.com/PacktPublishing/AWS-Certified-Cloud-Practitioner-Exam-Guide</a>):<p class="source-code"><strong class="bold">{</strong></p><p class="source-code"><strong class="bold">  "Version": "2012-10-17",</strong></p><p class="source-code"><strong class="bold">  "Statement": [</strong></p><p class="source-code"><strong class="bold">    {</strong></p><p class="source-code"><strong class="bold">      "Effect": "Allow",</strong></p><p class="source-code"><strong class="bold">      "Action": [</strong></p><p class="source-code"><strong class="bold">        "logs:CreateLogGroup",</strong></p><p class="source-code"><strong class="bold">        "logs:CreateLogStream",</strong></p><p class="source-code"><strong class="bold">        "logs:PutLogEvents"</strong></p><p class="source-code"><strong class="bold">      ],</strong></p><p class="source-code"><strong class="bold">      "Resource": "arn:aws:logs:*:*:*"</strong></p><p class="source-code"><strong class="bold">    },</strong></p><p class="source-code"><strong class="bold">    {</strong></p><p class="source-code"><strong class="bold">      "Effect": "Allow",</strong></p><p class="source-code"><strong class="bold">      "Action": [</strong></p><p class="source-code"><strong class="bold">        "ec2:Start*",</strong></p><p class="source-code"><strong class="bold">        "ec2:Stop*"</strong></p><p class="source-code"><strong class="bold">      ],</strong></p><p class="source-code"><strong class="bold">      "Resource": "*"</strong></p><p class="source-code"><strong class="bold">    }</strong></p><p class="source-code"><strong class="bold">  ]</strong></p><p class="source-code"><strong class="bold">}</strong></p></li>
				<li>Click the <strong class="bold">Next: Tags</strong> button at the bottom of the page.</li>
				<li>On the <strong class="bold">Add tags (Optional)</strong> page, click the <strong class="bold">Add tag</strong> button to provide a tag name for your policy. For example, for <strong class="bold">Key</strong>, type in <strong class="source-inline">Name</strong>, and for <strong class="bold">Value</strong>, type in <strong class="source-inline">Lambda-EC2-Access-Policy</strong>.</li>
				<li>Click <strong class="bold">Next: Review</strong>.</li>
				<li>On the <strong class="bold">Review Policy</strong> page, type in a name for your policy; for example,<strong class="source-inline">Lambda-EC2-Access-Policy</strong>.</li>
				<li>Click the <strong class="bold">Create policy</strong> button at the bottom<a id="_idIndexMarker1327"/> of the page. You will receive a notification that your<a id="_idIndexMarker1328"/> policy has been created.</li>
				<li>Next, you will need to create<a id="_idIndexMarker1329"/> an IAM role for Lambda. From<a id="_idIndexMarker1330"/> the left-hand menu, click on <strong class="bold">Roles</strong>.</li>
				<li>Click <strong class="bold">Create role</strong> from the right-hand pane.</li>
				<li>On the <strong class="bold">Create role</strong> page, ensure that the <strong class="bold">AWS service</strong> option is selected under <strong class="bold">Select type of trusted entity</strong>.</li>
				<li>Next, under <strong class="bold">Choose a use case</strong>, select <strong class="bold">Lambda</strong>.</li>
				<li>Click the <strong class="bold">Next: Permissions</strong> button at the bottom of the page.</li>
				<li>On the <strong class="bold">Attach permissions policies</strong> page, search for the policy you just created in the search box next to <strong class="bold">Filter policies</strong>. In the search box, start by typing in <strong class="source-inline">Lambda-EC2</strong>, which should filter the list down to the policy you just created. Select this policy and click on the <strong class="bold">Next: Tags</strong> button at the bottom of the page.</li>
				<li>On the <strong class="bold">Add tags (Optional)</strong> page, click the <strong class="bold">Add tag</strong> button and provide a tag name for your policy. For example, for <strong class="bold">Key</strong>, type in <strong class="source-inline">Name</strong>, and for <strong class="bold">Value</strong>, type in <strong class="source-inline">Lambda-EC2-Start-Stop-IAM-Role</strong>.</li>
				<li>Click the <strong class="bold">Next: Review</strong> button and set <strong class="bold">Role name</strong> to <strong class="source-inline">Lambda-EC2-Start-Stop-IAM-Role</strong>.</li>
				<li>Click the <strong class="bold">Create role</strong> button at the bottom of the page.</li>
				<li>You will get<a id="_idIndexMarker1331"/> a notification, stating<a id="_idIndexMarker1332"/> that the IAM role has been created.</li>
			</ol>
			<p>Now that your role<a id="_idIndexMarker1333"/> has been created, you can create Lambda functions<a id="_idIndexMarker1334"/> to stop and start your EC2 instances.</p>
			<h2 id="_idParaDest-306"><a id="_idTextAnchor311"/>Step 3 - Creating Lambda functions that stop and start your EC2 instances</h2>
			<p>Now, let's create<a id="_idIndexMarker1335"/> a Lambda function to stop<a id="_idIndexMarker1336"/> and start your EC2<a id="_idIndexMarker1337"/> instance at a predefined<a id="_idIndexMarker1338"/> schedule:</p>
			<ol>
				<li value="1">From the <strong class="bold">Services</strong> drop-down list at the top of the AWS Management Console page, select <strong class="bold">Lambda</strong>, which is located under the <strong class="bold">Compute</strong> category.</li>
				<li>From the left-hand menu, click on <strong class="bold">Functions</strong>.</li>
				<li>Click the <strong class="bold">Create function</strong> button in the right-hand pane.</li>
				<li>Select the <strong class="bold">Author from scratch</strong> option.</li>
				<li>Under <strong class="bold">Basic information</strong>, provide the following details:<ul><li>For <strong class="bold">Function name</strong>, provide a name that represents the purpose of the function. For example, if you are creating the Stop EC2 instance function first, in the name field, type in <strong class="source-inline">StopEC2Instances</strong>.</li><li>For <strong class="bold">Runtime</strong>, select <strong class="bold">Python 3.8</strong></li><li>Next, under <strong class="bold">Permissions</strong>, expand <strong class="bold">Change default execution role</strong>.</li><li>Under <strong class="bold">Execution role</strong>, select <strong class="bold">Use an existing role</strong>. Next, from the <strong class="bold">Existing role</strong> drop-down list, select the IAM role you created earlier.</li></ul></li>
				<li>Click the <strong class="bold">Create function</strong> button.</li>
				<li>You will be redirected to the <strong class="bold">StopEC2Instances</strong> function page.</li>
				<li>Next, in the <strong class="bold">Code source</strong> section, in the <strong class="bold">Code</strong> tab, you will be able to add your function code. From the left-hand <strong class="bold">Environment</strong> menu, expand the <strong class="source-inline">StopEC2Instance</strong> folder and double-click<a id="_idIndexMarker1339"/> on the <strong class="source-inline">lambda_function.py</strong> file. In the right-hand pane, you<a id="_idIndexMarker1340"/> will notice some sample code.</li>
				<li>Delete the sample<a id="_idIndexMarker1341"/> code and replace it with the following<a id="_idIndexMarker1342"/> code:<p class="source-code"><strong class="bold">import boto3</strong></p><p class="source-code"><strong class="bold">region = 'us-west-1'</strong></p><p class="source-code"><strong class="bold">instances = ['i-12345cb6de4f78g9h', 'i-08ce9b2d7eccf6d26']</strong></p><p class="source-code"><strong class="bold">ec2 = boto3.client('ec2', region_name=region)</strong></p><p class="source-code"><strong class="bold">def lambda_handler(event, context):</strong></p><p class="source-code"><strong class="bold">    ec2.stop_instances(InstanceIds=instances)</strong></p><p class="source-code"><strong class="bold">    print('stopped your instances: ' + str(instances))</strong></p><p class="callout-heading">Important Note </p><p class="callout">You will need to amend the code as follows.</p><p class="callout">For the Region, replace the <strong class="source-inline">us-west-1</strong> Region with the Region your EC2 instance is in. In our example, the Region would be <strong class="source-inline">us-east-1</strong>. </p></li>
				<li>Next, you will notice that the sample code refers to two EC2 instances. Replace this with the<a id="_idIndexMarker1343"/> instance ID of the server<a id="_idIndexMarker1344"/> you deployed in <em class="italic">Step 1 - Launching an EC2 instance</em> of this exercise, ensuring<a id="_idIndexMarker1345"/> that the instance ID is placed within<a id="_idIndexMarker1346"/> single quotes.</li>
				<li>Next, click on the <strong class="bold">Configuration</strong> tab.</li>
				<li>Click the <strong class="bold">Edit</strong> button from the <strong class="bold">General configuration</strong> pane.</li>
				<li>Next, set the timeout value to 10 seconds.</li>
				<li>Click the <strong class="bold">Save</strong> button. This will take you back to the <strong class="bold">Function</strong> page. Click the <strong class="bold">Code</strong> tab.</li>
				<li>Recheck your Lambda code and ensure that you have made all the preceding changes. Next, click on the <strong class="bold">Deploy</strong> button.</li>
				<li>If necessary, click on the ellipsis icon in the far left-hand pane to bring up the main menu and click on the <strong class="bold">Function</strong> link.</li>
				<li>You should now see a list of your functions, which will include the <strong class="source-inline">StopEC2Instances</strong> function you just created.</li>
				<li>Repeat <em class="italic">Steps 1</em> to <em class="italic">15</em> to create another function. This time, you will be creating a function to start your EC2 instances. For <em class="italic">Step 5</em>, enter a different function name than the one you used before; for example, <strong class="bold">StartEC2Instances</strong>.</li>
				<li>For <em class="italic">Step 9</em>, copy and paste<a id="_idIndexMarker1347"/> the following code into<a id="_idIndexMarker1348"/> the editor pane, remembering<a id="_idIndexMarker1349"/> to delete the sample<a id="_idIndexMarker1350"/> code that is already there: <p class="source-code"><strong class="bold">import boto3</strong></p><p class="source-code"><strong class="bold">region = 'us-west-1'</strong></p><p class="source-code"><strong class="bold">instances = ['i-12345cb6de4f78g9h', 'i-08ce9b2d7eccf6d26']</strong></p><p class="source-code"><strong class="bold">ec2 = boto3.client('ec2', region_name=region)</strong></p><p class="source-code"><strong class="bold">def lambda_handler(event, context):</strong></p><p class="source-code"><strong class="bold">    ec2.start_instances(InstanceIds=instances)</strong></p><p class="source-code"><strong class="bold">    print('started your instances: ' + str(instances))</strong></p></li>
				<li>Remember to also change the Region to <strong class="source-inline">us-east-1</strong> and amend the instance ID to the ID of your EC2 instance.</li>
				<li>Once you have deployed your function, go back to the list of functions by clicking on the link from the left-hand menu (if necessary, by first clicking on the ellipsis icon).</li>
			</ol>
			<p>You should now have two functions that will be used to stop and start your EC2 instances, as per the following screenshot:</p>
			<div>
				<div id="_idContainer253" class="IMG---Figure">
					<img src="Images/B17124_12_06.jpg" alt="Figure 12.6 – Functions&#13;&#10;" width="1101" height="311"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.6 – Functions</p>
			<p>Next, you will create CloudWatch<a id="_idIndexMarker1351"/> event rules to help you execute the Lambda functions<a id="_idIndexMarker1352"/> at scheduled times. We discussed CloudWatch<a id="_idIndexMarker1353"/> events briefly in <a href="B17124_13_Final_SK_ePub.xhtml#_idTextAnchor317"><em class="italic">Chapter 13</em></a><em class="italic">, Management and Governance on AWS</em>. We will look at<a id="_idIndexMarker1354"/> CloudWatch in more detail in the next chapter.</p>
			<h2 id="_idParaDest-307"><a id="_idTextAnchor312"/>Step 4 - Creating CloudWatch event rules to trigger your Lambda functions</h2>
			<p>In this step, you will learn<a id="_idIndexMarker1355"/> how to create CloudWatch event rules to trigger your Lambda<a id="_idIndexMarker1356"/> functions at a given schedule:</p>
			<ol>
				<li value="1">Navigate to the CloudWatch dashboard. You can either search for CloudWatch from the top search bar of the AWS Management Console page or click the <strong class="bold">CloudWatch</strong> link from the <strong class="bold">Management &amp; Governance</strong> category in the list of services.</li>
				<li>From the left-hand menu, click on <strong class="bold">Rules</strong>, under <strong class="bold">Events</strong>.</li>
				<li>Click the <strong class="bold">Create rule</strong> button.</li>
				<li>For <strong class="bold">Step 1: Create rule</strong>, select <strong class="bold">Schedule</strong> under <strong class="bold">Event Pattern</strong>.</li>
				<li>Next, select <strong class="bold">Cron expression</strong>. A CRON expression is a string comprised of six fields separated by white spaces that represent a set of times. These can be used as a schedule to execute a particular task regularly.</li>
				<li>In the text field next to <strong class="bold">Cron expression</strong>, you will need to type in an expression that<a id="_idIndexMarker1357"/> tells Lambda when to stop your instances. To learn more about how to define your expressions, visit <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html">https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html</a>.</li>
				<li>For this exercise, we wish to stop our EC2 instances at 6 P.M. Our UAT testers normally leave work at 5 P.M., but just in case anyone decides to work a bit late, we can execute the Lambda Stop function at 6 P.M.</li>
				<li>The cron expression<a id="_idIndexMarker1358"/> that you can use to execute the Lambda Stop function is <strong class="bold">0 18 ? * MON-FRI *</strong><a id="_idIndexMarker1359"/>. This will also display the next 10 triggers and their time of execution, as per the following screenshot:<div id="_idContainer254" class="IMG---Figure"><img src="Images/B17124_12_07.jpg" alt="Figure 12.7 – AWS CloudWatch event rule cron expression&#13;&#10;" width="756" height="597"/></div><p class="figure-caption">Figure 12.7 – AWS CloudWatch event rule cron expression</p></li>
				<li>Next, click on the <strong class="bold">Add target</strong> button under <strong class="bold">Targets</strong>.</li>
				<li>From the drop-down list that appears, select <strong class="bold">Lambda function</strong>.</li>
				<li>In the drop-down<a id="_idIndexMarker1360"/> list next to <strong class="bold">Function</strong>, select the <strong class="bold">StopEC2Instances</strong> function. As you may recall, this is a Lambda<a id="_idIndexMarker1361"/> function that will stop your EC2 instance.</li>
				<li>Next, click on the <strong class="bold">Configuration details</strong> button.</li>
				<li>For <strong class="bold">Step 2: Configure rule details</strong>, type an appropriate name in the <strong class="bold">Name</strong> field under <strong class="bold">Rule definition</strong>. For example, you can type in <strong class="source-inline">StopUATInstances</strong>.</li>
				<li>In the <strong class="bold">Description</strong> field, type <strong class="source-inline">Stops UAT instances at 6 PM Monday to Friday</strong>.</li>
				<li>Next, click the <strong class="bold">Create rule</strong> button.</li>
				<li>Repeat <em class="italic">Steps 3</em> to <em class="italic">15</em> to start your EC2 instances. For this rule, ensure that, in <em class="italic">Step 6</em>, for <strong class="bold">Cron expression</strong>, you provide an expression that defines a start time of 8 A.M. Monday to Friday. Here, again, our UAT engineers will start work at 9 A.M. but some may come in a bit early. You can refer to <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html">https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html</a> to help you build the cron expression. For this particular exercise, the cron expression<a id="_idIndexMarker1362"/> that's required is <strong class="bold">0 8 ? * MON-FRI *</strong><a id="_idIndexMarker1363"/>. Furthermore, in <em class="italic">Step 11</em>, for <strong class="bold">Function</strong>, select the <strong class="bold">StartEC2Instances</strong> function. Also, in <em class="italic">Step 13</em>, enter <strong class="source-inline">StartUATInstances</strong> for the name and for the description, <strong class="source-inline">Starts UAT instances at 8 AM Monday to Friday</strong>.</li>
				<li>At this point, you have ensured that your scheduled events automatically trigger the relevant Lambda functions, as per the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer255" class="IMG---Figure">
					<img src="Images/B17124_12_08.jpg" alt="Figure 12.8 – CloudWatch event rules&#13;&#10;" width="1276" height="340"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.8 – CloudWatch event rules</p>
			<p>You can wait for the designated times to check whether your EC2 instance has been stopped and then restarted. Alternatively, you can just test your Lambda function, which is what we will be doing next.</p>
			<h2 id="_idParaDest-308"><a id="_idTextAnchor313"/>Step 5 - Testing your Lambda function</h2>
			<p>We can test our Lambda function<a id="_idIndexMarker1364"/> rather than waiting for the scheduled times to see whether the functions work:</p>
			<ol>
				<li value="1">Navigate back to the Lambda dashboard.</li>
				<li>From the left-hand menu, select <strong class="bold">Functions</strong>. Then, from the right-hand pane, select the <strong class="bold">StopEC2Instances</strong> function.</li>
				<li>Next, from the <strong class="bold">Actions</strong> drop-down list, select <strong class="bold">Test</strong>.</li>
				<li>For <strong class="bold">StopEC2Instances</strong>, click on the <strong class="bold">Test</strong> button in the <strong class="bold">Test event</strong> pane.</li>
				<li>If the function has been configured correctly, you should see the <strong class="bold">Execution result: succeeded</strong> message and an option to expand the <strong class="bold">Details</strong> pane. This will provide details of the execution, as per the following screenshot:<div id="_idContainer256" class="IMG---Figure"><img src="Images/B17124_12_09.jpg" alt="Figure 12.9 – The Lambda function's execution details&#13;&#10;" width="1590" height="663"/></div><p class="figure-caption">Figure 12.9 – The Lambda function's execution details</p></li>
				<li>In another browser window, navigate to your EC2 dashboard. Here, you should find that your EC2 instance has been stopped. </li>
				<li>Return to the AWS Lambda browser tab and click on <strong class="bold">Functions</strong> from the far left-hand menu. </li>
				<li>Repeat <em class="italic">Steps 2</em> to <em class="italic">5</em>, this time selecting the <strong class="bold">StartEC2Instances</strong> function.</li>
				<li>Within a few seconds, you should find that the function was executed successfully, and you<a id="_idIndexMarker1365"/> can cross-reference this with the EC2 dashboard. You should find that your EC2 instance has started again.</li>
			</ol>
			<p>In this exercise, you learned how to create Lambda functions that can be used to perform repetitive IT tasks for your organization and help automate various processes. You also learned how to schedule those repetitive tasks using AWS CloudWatch event rules and cron expressions. </p>
			<h1 id="_idParaDest-309"><a id="_idTextAnchor314"/>Exercise 12.2 – cleaning up</h1>
			<p>In this exercise, you will terminate<a id="_idIndexMarker1366"/> your EC2 instance and delete your Lambda functions to avoid any unnecessary<a id="_idIndexMarker1367"/> charges to your AWS account:</p>
			<ol>
				<li value="1">Navigate to the EC2 dashboard and ensure that you are in the <strong class="bold">us-east-1</strong> (North Virginia) Region.</li>
				<li>Click on <strong class="bold">Instances</strong> from the left-hand menu.</li>
				<li>In the right-hand pane, under <strong class="bold">Instances</strong>, select the EC2 instance you launched earlier. Then, from the <strong class="bold">Instance state</strong> drop-down menu, click <strong class="bold">Terminate instance</strong>. Confirm that you wish to terminate the instance; AWS will terminate it.</li>
				<li>Next, navigate to the Lambda dashboard.</li>
				<li>Click on <strong class="bold">Functions</strong> from the left-hand menu. In the right-hand pane, for each function, select the function. Then, from the <strong class="bold">Actions</strong> drop-down list, click <strong class="bold">Delete</strong>. Click the <strong class="bold">Delete</strong> button in the pop-up dialog box to delete the function.</li>
				<li>Next, navigate to the CloudWatch management console.</li>
				<li>From the left-hand menu, click on <strong class="bold">Rules</strong>, under <strong class="bold">Events</strong>.</li>
				<li>For each rule, select the rule. Then, from the <strong class="bold">Actions</strong> drop-down list, click <strong class="bold">Delete</strong>. Click the <strong class="bold">Delete</strong> button in the pop-up dialog box to delete the rule.</li>
			</ol>
			<p>Your resources<a id="_idIndexMarker1368"/> have now been removed<a id="_idIndexMarker1369"/> from your AWS accounts. In the next section, we will provide a summary of this chapter.</p>
			<h1 id="_idParaDest-310"><a id="_idTextAnchor315"/>Summary</h1>
			<p>AWS offers numerous services and tools to help you architect efficient application deployment strategies with a focus on the application rather than the underlying infrastructure that supports it. Amazon Elastic Beanstalk helps your developers focus on the application code rather than how to go about configuring every minute infrastructure component to support it. </p>
			<p>AWS also offers you tools to build end-to-end infrastructure components using an IaC approach, which drastically improves speed and agility and reduces the human error element that manual configurations are prone to. AWS CloudFormation is an intelligent tool that accepts code in its declarative form to help an architect complete infrastructure deployments. </p>
			<p>You also learned how to automate day-to-day administrative tasks using serverless <strong class="bold">Function-as-a-Service</strong> (<strong class="bold">FaaS</strong>) tools such as AWS Lambda.</p>
			<p>In the next chapter, we will look at various management and governance tools that will help you efficiently manage your AWS resources and design for better performance, security, and operations. </p>
			<h1 id="_idParaDest-311"><a id="_idTextAnchor316"/>Questions</h1>
			<p>Answer the following questions to test your knowledge of this chapter:</p>
			<ol>
				<li value="1">Which AWS service automatically provisions the necessary infrastructure (for example, load balancing, auto-scaling, and health monitoring) and enables developers to automatically deploy an application's built-in supported languages such as Node.js, PHP, and Python?<ol><li>AWS CloudFormation</li><li>AWS Lambda</li><li>AWS Elastic Beanstalk</li><li>AWS Deployer</li></ol></li>
				<li>You work for a web application development company and have been asked to design an infrastructure solution that can be repeatedly created using scripted templates. This will allow you to create individual sandbox environments for your developers to use. Some infrastructure components will include the setup and configuration of a VPC, EC2 instances, S3 buckets, and more. Which AWS service enables you to design an infrastructure template that can be deployed to create repeatable infrastructure for your developers to use as a sandbox environment?<ol><li>AWS Systems Manager</li><li>AWS CloudFormation</li><li>AWS Config</li><li>AWS FSx for Lustre</li></ol></li>
				<li>Which two file formats are used when creating CloudFormation templates? (Choose 2.)<ol><li>JSON</li><li>YAML</li><li>XML</li><li>HTML</li><li>Java</li></ol></li>
			</ol>
			<ol>
				<li value="4">Which AWS service provides integration with Chef recipes to start new application instances, configure application server software, and deploy the application?<ol><li>Amazon CloudFormation</li><li>Amazon Elastic Beanstalk</li><li>Amazon OpsWorks</li><li>Amazon Cookbook.</li></ol></li>
				<li>Which type of environment do you need to configure for an Elastic Beanstalk deployment to host backend application layer services?<ol><li>Web server environment tier</li><li>Worker environment tier</li><li>Backend environment tier</li><li>Hybrid environment</li></ol></li>
				<li>Which feature of the Amazon CloudFormation service enables you to review any proposed changes you wish to make to an environment and identify how those changes will impact your environment?<ol><li>Drift detection</li><li>Change sets</li><li>Stack sets</li><li>Change management</li></ol></li>
			</ol>
		</div>
	</div></body></html>