<html><head></head><body>
		<div id="_idContainer111">
			<h1 id="_idParaDest-122" class="hapter-number"><a id="_idTextAnchor165"/>9</h1>
			<h1 id="_idParaDest-123"><a id="_idTextAnchor166"/>Using Python for CI/CD Pipelines</h1>
			<p class="author-quote">Iâ€™ve missed over 9,000 shots in my career. Iâ€™ve lost almost 300 games. 26 times Iâ€™ve been trusted to take the game-winning shot and missed. Iâ€™ve failed over and over and over again in my life. And that is why I succeed.</p>
			<p class="author-quote">â€“ Michael Jordan</p>
			<p><a id="_idTextAnchor167"/>In the past, when I was but a young college graduate (some two years ago), the term that kept coming up, right after being taught how to make a website, was <strong class="bold">Continuous Integration/Continuous Delivery</strong> (<strong class="bold">CI/CD</strong>). CI/CD was something that my college course did not teach. Most college courses do not; it is not enough of an academic exercise. However, if youâ€™re a DevOps engineer, this is all youâ€™ll do. This is your job. And Python is a great tool for doing your <span class="No-Break">job better.</span></p>
			<p>I have often described Python as a great facilitator, that is, as a tool that makes all other tools better. And that is the concept that we will explore further in this chapter. Python is a language that is very kind toward people who make mistakes; trust me, Iâ€™ve made plenty. It has a lot of features that reduce the impact of your mistakes. It also has error messages, which allow the tracing of errors to be simple and effective. If weâ€™re talking about actual application development from the perspective of a developer, everyone has their own opinion, which is, to an extent, valid. But as I have talked about throughout this book, Python is significantly ahead in terms of what it can offer <span class="No-Break">DevOps engineers.</span></p>
			<p>So, as we explore how to deliver a journey to our customers, this is what we are going <span class="No-Break">to learn:</span></p>
			<ul>
				<li>The philosophy and the concepts behind CI/CD and how it has evolved during the course of <span class="No-Break">its creation</span></li>
				<li>A basic CI/CD task using Python that can help you understand CI/CD, what it brings to the table, and how important its <span class="No-Break">implementation is</span></li>
				<li>How Python can be used to develop and enhance collaboration within a development team using its <span class="No-Break">flexible nature</span></li>
				<li>How Python can be used to enhance and automate the most sacred of DevOps traditions: <span class="No-Break">the rollback</span></li>
			</ul>
			<p>To accomplish these tasks, you will require a few tools in your bag. There are a few things that you need to set up before <span class="No-Break">we begin.</span></p>
			<h1 id="_idParaDest-124"><a id="_idTextAnchor168"/>Technical requirements</h1>
			<p>We have a short checklist here of things that you will need in order to follow along with <span class="No-Break">this chapter:</span></p>
			<ul>
				<li>A GitHub account for use of the <span class="No-Break">book repository</span></li>
				<li>A <span class="No-Break">Todoist account</span></li>
				<li>A <span class="No-Break">Microsoft account</span></li>
				<li>An <span class="No-Break">AWS account</span></li>
				<li>The ability to tolerate a large amount of sarcasm and <span class="No-Break">bad humor</span></li>
			</ul>
			<p>We also, of course, have an accompanying GitHub repository where you can reference the coding content in this <span class="No-Break">book: </span><a href="https://github.com/PacktPublishing/Hands-On-Python-for-DevOps/"><span class="No-Break">https://github.com/PacktPublishing/Hands-On-Python-for-DevOps/.</span></a></p>
			<h1 id="_idParaDest-125"><a id="_idTextAnchor169"/>The origins and philosophy of CI/CD</h1>
			<p>A question that people often ask me is, â€œYou started as a developer; how did you end up where you are?â€ Iâ€™ve answered this to an extent over several of the sections in this book, but in short, I had to make my way there because of necessity. These days, the people who develop applications are taught how to do so from the start and do not know about all of the rationale behind it, just how to use it. This is fine; there is no need to dive deeper than you want, but know that this was not always the case. Someone had to figure all of this stuff out (several someones, in fact). And I think my personal journey is more reflective of the people who figured this stuff out than your typical modern DevOps trainee. So, Iâ€™ll start recapping this journey as a short dialog of three scenes of me screaming into the void (letâ€™s call it DevOps Doug, that sounds fun). Weâ€™ll start <span class="No-Break">with CI.</span></p>
			<h2 id="_idParaDest-126"><a id="_idTextAnchor170"/>Scene 1 â€“ continuous integration</h2>
			<p>It was a late night at my home. I was doing my usual 200 push-up, 300 sit-up routine when it dawned on me that I am really good at writing code. This shouldnâ€™t have been a revelation, it was pretty obvious in hindsight, but upon making this discovery, I decided â€“ being the generous man that I am â€“ that I wanted to share my coding gift with the world, and so I called my old pal Doug for a <span class="No-Break">little help.</span></p>
			<p><em class="itali">Me</em>: Hello, Iâ€™d like some help. I have all of this code and I want to share it with <span class="No-Break">my friends.</span></p>
			<p><em class="itali">Doug</em>: Thatâ€™s easy enough. All you have to do is create, clone, initialize, pull, modify, then push the Git repository. That sounds <span class="No-Break">simple, right?</span></p>
			<p><em class="itali">Me</em>: Whatâ€™s a repository? Why canâ€™t I just email my code to them, then they can make the changes and email it back <span class="No-Break">to me?</span></p>
			<p><span class="No-Break"><em class="itali">Doug</em></span><span class="No-Break">: Wellâ€¦..</span></p>
			<p>Thus started a long back and forth and a lot of exposition about what version control is, how repositories work, why you have branches, and what pull requests are. If I started going through all of this, Iâ€™d have to write <span class="No-Break">another book.</span></p>
			<p><em class="itali">Doug</em>: Did that answer all <span class="No-Break">your questions?</span></p>
			<p><em class="itali">Me</em>: Yeah, I understand it and I understand why itâ€™d be useful, but why is it the way <span class="No-Break">it is?</span></p>
			<p><em class="itali">Doug</em>: Do more and youâ€™ll <span class="No-Break">learn more.</span></p>
			<p>And the journey continued, just like the integration, but much longer and sometimes very boring. Weâ€™ll skip the <span class="No-Break">boring parts.</span></p>
			<p>So, I started learning more and realized how important version control is. I also realized that there are very few younger developers who actually take the time to completely understand it. Some quit over the fact that they canâ€™t. But the purpose of CI is clear. It gives a clear history of the modification of code, and it gives you small increments of improvement, which are added on top of other improvements, creating a history of smaller changes that can be looked at, versioned, and understood. It increases organization and understanding more than anything, but those are the things you need first before increasing <span class="No-Break">your speed.</span></p>
			<p>Now, as I evolved, and my skill sets evolved, so did my curiosity. I started thinking, â€œIs this actually helping the other people on the project?â€ So I asked them, and they confirmed that it did. I felt it impolite to ask further (also they probably hadnâ€™t looked into it much further either), so I started looking for more advanced material on the internet. This next conversation, about continuous delivery, was <span class="No-Break">rather interesting.</span></p>
			<h2 id="_idParaDest-127"><a id="_idTextAnchor171"/>Scene 2 â€“ continuous delivery</h2>
			<p>A while after I was pushed down the DevOps river by Doug, I found myself facing a roadblock. If it were a physical roadblock, I would have no problem given the 400 crunches and 649 (yes, exactly that much) pull-ups I did every day. But this roadblock existed in the realm of computers, and it had a toll booth that rejected any code that didnâ€™t meet its requirements. Tired of the automatic rejection of my code, I decided to speak to the toll booth attendant, and lo and behold, I found that it was my old <span class="No-Break">friend Doug.</span></p>
			<p><em class="itali">Me</em>: Howâ€™d you get <span class="No-Break">here Doug?</span></p>
			<p><em class="itali">Doug</em>: I was <span class="No-Break">always here.</span></p>
			<p><em class="itali">Me</em>: (Visibly confused) Okay... So, whenever I push my code, it updates the test version of <span class="No-Break">the application?</span></p>
			<p><em class="itali">Doug</em>: That is correct, but only if your code passes testing and deploys successfully. Otherwise, it reverts to the older version of the project and tells you what <span class="No-Break">went wrong.</span></p>
			<p><em class="itali">Me</em>: Okay, canâ€™t you just take my word <span class="No-Break">for it?</span></p>
			<p><em class="itali">Doug</em>: Iâ€™d love to, but the last time we did that, a zebra came flying out of the server room and started biting people. Zebras <span class="No-Break">are mean.</span></p>
			<p><em class="itali">Me</em>: How did <span class="No-Break">a Zebraâ€¦</span></p>
			<p><em class="itali">Doug</em>: Thatâ€™s not the point. The point is that this system doesnâ€™t just exist to launch stuff, alright? Itâ€™s there because it simplifies and secures things for everybody. Once a dev pushes the code, itâ€™s over for them. If that code gives out an error, they resume work on it. DevOps people just exist to make that process as easy <span class="No-Break">as possible.</span></p>
			<p><em class="itali">Me</em>: Alright, is that easy to <span class="No-Break">set up?</span></p>
			<p><span class="No-Break"><em class="itali">Doug</em></span><span class="No-Break">: Nope.</span></p>
			<p>This is the part with a montage of me learning all of the testing and security principles and how to push code, create approval workflows, and a lot of other things that youâ€™ve seen in this book. Itâ€™s not an easy journey by any means, but a <span class="No-Break">rewarding one.</span></p>
			<p><em class="itali">Me</em>: Okay, <a id="_idTextAnchor172"/>thatâ€™s all <span class="No-Break">right. Right?</span></p>
			<p><em class="itali">Doug</em>: <span class="No-Break">Define </span><span class="No-Break"><em class="itali">all</em></span><span class="No-Break">.</span></p>
			<p><em class="itali">Me</em>: (Sighs) Alright, <span class="No-Break">whatâ€™s left?</span></p>
			<p><em class="itali">Doug</em>: Do more and youâ€™ll <span class="No-Break">learn more.</span></p>
			<p>Thus, the journey continued in earnest, revealing even more questions each time. It was honestly pretty boring. But I soon realized that there was a reason <span class="No-Break">for that...</span></p>
			<p>Well, after the truth was revealed to me, I realized that this actually was the way. A way created through trial and error to find out what works and what doesnâ€™t. A way based on real-life problems and their solutions. A more pragmatic way that brought order from chaos. But I also realized that there is such a thing as too much order (we call it bureaucracy if a government does it). There were a lot of necessary steps, but they generated a few unnecessary ones every time something was changed. The process needed to adapt to itself. An interesting concept. And it needed to do so while also delivering value. But to innovate, you must automate. And that is the story of <span class="No-Break">continuous deployment.</span></p>
			<h2 id="_idParaDest-128"><a id="_idTextAnchor173"/>Scene 3 â€“ continuous deployment</h2>
			<p>One fine day, I was sitting in my office, going through my regular routine, drinking some coffee, answering a few emails, and pushing a little bit of code, when I suddenly felt a chill down my spine, like someone was about to come in and turn my life <span class="No-Break">upside down...</span></p>
			<p><span class="No-Break"><em class="itali">Doug</em></span><span class="No-Break">: Hey!</span></p>
			<p><em class="itali">Me</em>: Doug! Howâ€™d you get in here? That door <span class="No-Break">was locked.</span></p>
			<p><em class="itali">Doug</em>: I am a figment of your imagination; youâ€™ll never get away from me. Whatâ€™re you <span class="No-Break">up to?</span></p>
			<p><em class="itali">Me</em>: (Pushing aside that disturbing thought) Well, alright. I have created this lovely pipeline that I am pushing code into. Iâ€™ve worked on it for the past three months. Now Iâ€™m going to release it <span class="No-Break">into production.</span></p>
			<p><em class="itali">Doug</em>: You havenâ€™t made a release in a full week? What do you think <span class="No-Break">youâ€™re doing?</span></p>
			<p><em class="itali">Me</em>: <span class="No-Break">My job...?</span></p>
			<p><em class="itali">Doug</em>: Well, I thought so. Thatâ€™s bad. Get this through your thick skull, kid. If youâ€™re doing your job, then youâ€™re doing a <span class="No-Break">bad job.</span></p>
			<p><em class="itali">Me</em>: Whose job should I be <span class="No-Break">doing then?</span></p>
			<p><em class="itali">Doug</em>: <span class="No-Break">Not yours.</span></p>
			<p><span class="No-Break"><em class="itali">Me</em></span><span class="No-Break">: </span><span class="No-Break">ğŸ˜</span></p>
			<p><em class="itali">Doug</em>: Your job is to automate your job, to make sure that as little is left to human judgment as possible. You must become an artist, striving to paint your masterpiece with as few strokes of the brush as possible. You have now entered the realm of <span class="No-Break">continuous deployment.</span></p>
			<p><em class="itali">Me</em>: If I deploy continuously, when do <span class="No-Break">I develop?</span></p>
			<p><em class="itali">Doug</em>: Thatâ€™s the trick: you donâ€™t deploy your app. You create a deployment that constantly deploys it <span class="No-Break">for you.</span></p>
			<p><em class="itali">Me</em>: What? What if I get <span class="No-Break">it wrong?</span></p>
			<p><em class="itali">Doug</em>: That is the other trick: donâ€™t be afraid of getting it wrong. Thatâ€™s the success behind DevOps and the CI/CD process; you can quickly identify mistakes, roll back, and refactor. Youâ€™re not tied down by <span class="No-Break">your failures.</span></p>
			<p><em class="itali">Me</em>: I see, but these are real users weâ€™re <span class="No-Break">talking about...</span></p>
			<p><em class="itali">Doug</em>: There is no better teacher than experience. You must get your product to the users if you ever want to learn anything significant. Will they go through a few hitches? Sure, but that happens with practically every application, right? When you are deploying continuously, when you have that pipeline, you have the power to change it and help that user. Not tomorrow, not next week, now. And thatâ€™s all that differentiates CD from CD (yes, I know itâ€™s confusing). Delivering something constantly and delivering it to the customer are two different things, and one of them is much more valuable than <span class="No-Break">the other.</span></p>
			<p><em class="itali">Me</em>: It makes no sense, but Iâ€™ll give it a <span class="No-Break">go, sure.</span></p>
			<p><em class="itali">Doug</em>: Do more and youâ€™ll <span class="No-Break">learn more.</span></p>
			<p>And so concluded this encounter with Doug. It was insightful but, as always, left me with more questions than answers. He hasnâ€™t shown up again since, but I know heâ€™s there and will appear when I need him the least, taking me on another mad journey through <span class="No-Break">the </span><span class="No-Break"><em class="itali">Dougverse</em></span><span class="No-Break">...</span></p>
			<p>That was quite the diatribe olâ€™ DevOps Doug went on, huh? But that is essentially the difference between the two CDs â€“ the philosophical difference between a semi-automatic and an automatic rifle. Each of them has its own uses. One can be seen as an extension of the other, and they both have <span class="No-Break">a place.</span></p>
			<p>Now that we have all of this theorizing out of the way (which is good, because this field is still growing and evolving), we can get to the fun part. Letâ€™s do a few tasks that will give us a clearer idea of how to use Python to accomplish these rather ambitious goals. Letâ€™s just do a simple one that you can perform with very little setup. Because as someone told me (I canâ€™t remember who), â€œ<em class="itali">Do more and youâ€™ll </em><span class="No-Break"><em class="itali">learn more</em></span><span class="No-Break">.â€</span></p>
			<h1 id="_idParaDest-129"><a id="_idTextAnchor174"/> Python CI/CD essentials â€“ automating a basic task</h1>
			<p>A big yet understated part of DevOps is the thoroughness of the documentation that the process forces you to produce. The documentation does not have to be large; it does not have to be so comprehensive that it confuses people and makes them think twice about ever reading or writing documentation. It must be clear, concise, and to the point. And most of all, it must exist. Seriously, that last part is rarer than <span class="No-Break">you think.</span></p>
			<p>So, how do we use Python to facilitate the documentation process? Well, for this we can use a little library called <strong class="bold">Sphinx</strong>. Sphinx is a library written in Python that can be used to generate explicit documentation on a number of code bases, even those not written in Python. Sphinx is one of the most prominent tools for documentation. Most Python frameworks have their documentation written in it. You can install Sphinx through a lot of avenues in all available operating systems, but the one that we are going to use is the <span class="No-Break">classic </span><span class="No-Break"><strong class="sour e-inline">pip</strong></span><span class="No-Break">:</span></p>
			<pre class="onsole">pip install sphinx</pre>
			<p>Once you have done this, go to the root directory of your project and initialize Sphinx using the <span class="No-Break">following command:</span></p>
			<pre class="onsole">sphinx-quickstart</pre>
			<p>Youâ€™ll be given a few settings for the setup. You can leave these as the default for now to get the sample document. You can later change this in the <span class="No-Break"><strong class="sour e-inline">conf.py</strong></span><span class="No-Break"> file.</span></p>
			<div>
				<div id="_idContainer103" class="IMG---Figure">
					<img src="image/B21320_09_1.jpg" alt="Figure 9.1 â€“ Quickstart menu for Sphinx"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.1 â€“ Quickstart menu for Sphinx</p>
			<p>This will create an initial directory structure that can be built in HTML or LaTeX, among many other documentation formats. </p>
			<div>
				<div id="_idContainer104" class="IMG---Figure">
					<img src="image/B21320_09_2.jpg" alt="Figure 9.2 â€“ Completion of Sphinx setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.2 â€“ Completion of Sphinx setup</p>
			<p>Now, letâ€™s write a bit of Python code to use with our <span class="No-Break">Sphinx generator.</span></p>
			<div>
				<div id="_idContainer105" class="IMG---Figure">
					<img src="image/B21320_09_3.jpg" alt="Figure 9.3 â€“ Initial code to be documented"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.3 â€“ Initial code to be documented</p>
			<p>Youâ€™ll notice the details in the code comments. These details are what Sphinx references when it creates the documentation. This is why open source projects emphasize code commenting on projects so much. If you ever encounter these comments in libraries, you now know why. Now, run a command to build an HTML file for documentation using <span class="No-Break">the following:</span></p>
			<pre class="onsole">make html</pre>
			<p>This will give you a documentation HTML file that you can host that looks something <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer106" class="IMG---Figure">
					<img src="image/B21320_09_4.jpg" alt="Figure 9.4 â€“ Documentation HTML page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.4 â€“ Documentation HTML page</p>
			<p>This was, of course, done manually. But with the correct documentation practices, it can be automated with a workflow that runs the <span class="No-Break">preceding commands.</span></p>
			<p>Now, whether you are an experienced DevOps engineer or a novice, you know that one of the main things that a DevOps person has to do (as experienced in this section) is work with developers and ask them to do things that will make the automation process and other DevOps processes smoother. One of the ways to gain a developerâ€™s trust in this process is to make their lives easier in some way to prove your worth, and to just be a good co-worker in general. You can do that by being polite, always making a new cup of coffee if it finishes on your pour, holding the door for themâ€¦ and also, as described in the next section, making their lives a <span class="No-Break">little easier.</span></p>
			<h1 id="_idParaDest-130"><a id="_idTextAnchor175"/>Working with devs and infrastructure to deliver your product</h1>
			<p>Being a DevOps engineer means being the ultimate team player. It also means you have to socialize with and be somewhat liked by practically everyone on your team. And honestly, itâ€™s not that hard; laugh at their awkward jokes and make a little small talk and suddenly youâ€™re everyoneâ€™s friend. Itâ€™s not that hard <a id="_idTextAnchor176"/>to get people to work together if you want to. It is, however, quite difficult, some of the time, to get their efforts to coordinate with yours. This is why we have collaboration tools. Besides ordinary GitHub, we have all sorts of tools for whatever development model you are using. Jira, Slack, Zoom, Google Chat, Teamsâ€¦ I could go on forever. What happens quite often is that a lot of teams use multiple collaboration tools. So, the question then becomes, how do we get these collaboration tools to collaborate with <span class="No-Break">each other?</span></p>
			<p>There are a lot of connectors that the tools themselves provide, but sometimes their functionality needs to be facilitated with some code and making a few API calls. We will try this now using Python to connect two very common productivity tools: Todoist and Microsoft To Do. You may have heard about or used either one or both of <span class="No-Break">these tools.</span></p>
			<p>Todoist is a simple to-do list application. Thereâ€™s nothing much to it; it is very similar to other such applications, such as Jira or Trello. Microsoft To Do is the same, except it is integrated into <span class="No-Break">Microsoft 365.</span></p>
			<p>Letâ€™s start by extracting a list of tasks from the Todoist API. To do that, letâ€™s create a Todoist account and add a few tasks from <span class="No-Break">the UI:</span></p>
			<div>
				<div id="_idContainer107" class="IMG---Figure">
					<img src="image/B21320_09_5.jpg" alt="Figure 9.5 â€“ Todoist dashboard"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.5 â€“ Todoist dashboard</p>
			<p>Just a couple of tasks with deadlines there. Now, letâ€™s get the API token to call this API. Under your accountâ€™s <strong class="bold">Settings</strong> | <strong class="bold">Integrations</strong> | <strong class="bold">Developer</strong> tab, you will find the API key, which you can copy and use. Now, you can also install the Python <span class="No-Break"><strong class="sour e-inline">todoist</strong></span><span class="No-Break"> library:</span></p>
			<pre class="onsole">pip install todoist_api_python</pre>
			<p>Next, write a script that integrates your API token and lists out all <span class="No-Break">the tasks.</span></p>
			<div>
				<div id="_idContainer108" class="IMG---Figure">
					<img src="image/B21320_09_6.jpg" alt="Figure 9.6 â€“ Code to get Todoist tasks"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.6 â€“ Code to get Todoist tasks</p>
			<p>Simple enough, with a little bit of syntactic sugar, it will get you a list of tasks <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer109" class="IMG---Figure">
					<img src="image/B21320_09_7.jpg" alt="Figure 9.7 â€“ Data extracted from the Todoist API"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.7 â€“ Data extracted from the Todoist API</p>
			<p>Thatâ€™s just a small sample, but you can see the content, the description, and the due date, which are the things that we are interested in. Now, we are going to attempt to do the same thing with Microsoft To Do. For this, we are simply going to call the API endpoint. There is a library for Microsoft To Do in Python as well, but it is still in the <span class="No-Break">experimental stage.</span></p>
			<p>You will need to get an authorization token from Microsoft, which you can get by calling the API for it, as shown here: <a href="https://learn.microsoft.com/en-us/graph/auth-v2-user?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0&amp;tabs=curl">https://learn.microsoft.com/en-us/graph/auth-v2-user?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0&amp;tabs=curl</a>. Iâ€™m not including the process for this because it is quite clearly laid out here. You can integrate it into the code later if you want to automatically generate the token. Now, letâ€™s modify our code in order to use the content, description, and due date that we have taken <span class="No-Break">from Todoist:</span></p>
			<pre class="sour e- ode">from todoist_api_python.api import TodoistAPIimport jsonfrom datetime import datetime, timezoneimport requests#API tokensapi = TodoistAPI("&lt;your_api_token_here&gt;")access_token = "&lt;Your_Microsoft_token_here&gt;"#Endpoint for your default task listTODO_API_ENDPOINT = YOUR_TODO_ENDPOINThttps://graph.microsoft.com/v1.0/me/todo/lists/@default/tasks#Function to create task in Microsoft Tododef create_todo_task(title,date):Â Â Â Â headers = {'Authorization': 'Bearer '+access_token,Â Â Â Â Â Â Â Â 'Content-Type': 'application/json'}Â Â Â Â payload = {'title': title,Â Â Â Â Â Â Â Â 'dueDateTime': date}Â Â Â Â response = requests.post(TODO_API_ENDPOINT, headers=headers, json=payload)Â Â Â Â return response.json() if response.status_code == 201 else Nonetry:Â Â Â Â Â #Get task in JSON formÂ Â Â Â Â tasks = json.dumps(api.get_tasks(),default=lambda o: o.__dict__,sort_keys=True, indent=4)Â Â Â Â #Parse tasksÂ Â Â Â for task in tasks:Â Â Â Â Â Â Â Â title = task["content"]Â Â Â Â Â Â Â Â date = task["due"]["date"].replace(tzinfo=timezone.utc).astimezone(tz=None)Â Â Â Â Â Â Â Â #Create tasks based on informationÂ Â Â Â Â Â Â Â create_todo_task(title, date)except Exception as error:Â Â Â Â print(error)</pre>
			<p>And itâ€™s as simple as that. We can use this code to take tasks from Todoist and put them in Microsoft To Do. We can even use the <strong class="bold">microservices-based architecture</strong> in our previous chapters (like in <a href="B21320_08.xhtml#_idTextAnchor155"><span class="No-Break"><em class="itali">Chapter 8</em></span></a>, <em class="itali">Understanding Event-Driven Architecture</em>) to make this even more efficient using webhooks and events. Speaking of events, in a lot of servers, one of the most common events is a failure. In the event of a failure, a rollback strategy is needed. Letâ€™s see how Python can <span class="No-Break">facilitate that.</span></p>
			<h1 id="_idParaDest-131"><a id="_idTextAnchor177"/>Performing rollback</h1>
			<p>I have said this many times during the course of this book: making mistakes is okay. That is because most mistakes are reversible. Some are not, but those are actually quite easy to recognize if you have your wits about you. In DevOps, this stands true as well. You can reverse your mistakes. Often, the question becomes how quickly, quietly, and effectively you can do this. That is exactly what <strong class="bold">rollbacks</strong> do. They aid in the identification and correction <span class="No-Break">of problems.</span></p>
			<p>Rollbacks can be performed manually, or they can be automated. Having a manual rollback at times is too slow and requires people to actually be aware of an incident or an error, something that can take a long time if the team is off on a weekend, for example. In such cases â€“ and in a lot of others â€“ an automatic rollback based on a metric is necessary. And as we all know, Python is good at <span class="No-Break">that stuff.</span></p>
			<p>There are many ways to roll back on a deployment: Blue/Green (50% on the old instance, 50% on the new), canary deployment (a minuscule percentage of users get new features to test them in production), and a whole host of other methods. One of my favorites is the <strong class="bold">Red/Black deployment</strong>. In this kind of deployment, there are two instances of an application: the current instance (red) and the future instance (black). You move your endpoint from red to black. If that doesnâ€™t work out, you move it back to red. Simple enough, right? Well, hereâ€™s an <span class="No-Break">illustration, anyway:</span></p>
			<p class="IMG---Figure">â€¨</p>
			<div>
				<div id="_idContainer110" class="IMG---Figure">
					<img src="image/B21320_9_8.jpg" alt=" Figure 9.8 â€“ Illustration of red/black deployment"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> Figure 9.8 â€“ Illustration of red/black deployment</p>
			<p>So, remember, <em class="itali">red on black, <a id="_idTextAnchor178"/>youâ€™re okay Jack, black on red, youâ€™re dead</em>. Oh, no wait, thatâ€™s coral snakes. But the concept here is simple enough. Itâ€™s a type of failover that can be handled pretty easily. Most DNS services have this functionality built in. But that doesnâ€™t mean it cannot be handled from a coding perspective. The reason we try to handle it like that is to give ourselves a little bit more control and to make room for possible future changes (such as failing over multiple sites at once). So, letâ€™s try this from a coding <a id="_idIndexMarker317"/>perspective and perform failover using a Lambda microservice on AWS <span class="No-Break">Route 53:</span></p>
			<pre class="sour e- ode">import boto3defÂ Â lambda_handler(event, context):Â Â Â Â Â domain_name = '&lt;your_domain_name_here&gt;'Â Â Â Â default_endpoint = '&lt;your_endpoint_here&gt;'Â Â Â Â # Initialize the Route 53 clientÂ Â Â Â client = boto3.client('route53')Â Â Â Â # Get the hosted zone ID for the domainÂ Â Â Â response = client.list_hosted_zones_by_name(DNSName=domain_name)Â Â Â Â hosted_zone_id = response['HostedZoneId']Â Â Â Â # Update the Route 53 record set to point to the default endpointÂ Â Â Â changes= {Â Â Â Â Â Â Â Â 'Changes': [Â Â Â Â Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'Action': 'UPSERT',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'ResourceRecordSet': {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'Name': domain_name,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'Type': 'A',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'TTL': 300,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'ResourceRecords': [{'Value': default_endpoint}]Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â ]Â Â Â Â }Â Â Â Â Â Â Â client.change_resource_record_sets(Â Â Â Â Â Â Â Â HostedZoneId=hosted_zone_id,Â Â Â Â Â Â Â Â ChangeBatch=changesÂ Â Â Â )Â Â Â Â Â Â Â Â return {Â Â Â Â Â Â Â Â 'statusCode': 200,Â Â Â Â Â Â Â Â 'body': "Nothing, really, no one's gonna see this}"Â Â Â Â }</pre>
			<p>Well, thatâ€™s the code. Stick it in a Lambda function and have the proper conditions to trigger that <a id="_idIndexMarker318"/>Lambda function and you can reset back to a set default whenever you want. Of course, you can do this with regular Route 53 as well, but this gives a whole host of options for modifications. Modifications are a very important part of the CI/CD process, where nothing is <span class="No-Break">solid forever.</span></p>
			<h1 id="_idParaDest-132">Summary</h1>
			<p>So, letâ€™s summarize what youâ€™ve learned in this chapter. You have learned that the philosophy and methodology of DevOps is an ever-flowing river, constantly in flux. You have also learned that you must adopt a similar philosophy while working with CI/CD. In the next section, you learned about a basic CI/CD task that can be performed in Python. We followed this up with the next section, where you learned how to help out your developers by making their day-to-day tasks easier and making sure that they have all the convenience and productivity tools they need. This was followed up with a lesson on performing rollbacks and a rather unique technique for a <span class="No-Break">simple rollback.</span></p>
			<p>If you have tolerated all of that, thank you. Youâ€™re nine chapters into this book and I still somehow have your attention. I must be doing something well, right? Maybe? Well, letâ€™s look ahead to the next chapter â€“ the next section, actually â€“ because weâ€™re about to get even more ambitious with our ideas. We are going to look at how some large companies use Python in their everyday work. <span class="No-Break">Sounds exciting!</span></p>
		</div>
		<div id="_idContainer112" class="Content">
			<p class="hidden"><a id="_idTextAnchor179"/><a id="_idTextAnchor180"/></p>
		</div>
		<div id="_idContainer113" class="Content">
			<p class="hidden"><a id="_idTextAnchor181"/></p>
		</div>
		<div id="_idContainer114" class="Content">
			<p class="hidden"><a id="_idTextAnchor182"/></p>
		</div>
		<div id="_idContainer115" class="Content">
			<p class="hidden"><a id="_idTextAnchor183"/></p>
		</div>
		<div id="_idContainer116" class="Content">
			<p class="hidden"><a id="_idTextAnchor184"/></p>
		</div>
		<div id="_idContainer117" class="Content">
			<p class="hidden"><a id="_idTextAnchor185"/></p>
		</div>
		<div id="_idContainer118" class="Content">
			<p class="hidden"><a id="_idTextAnchor186"/></p>
		</div>
		<div id="_idContainer119" class="Content">
			<p class="hidden"><a id="_idTextAnchor187"/></p>
		</div>
	

		<div id="_idContainer120" class="Content">
			<h1 id="_idParaDest-133" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor188"/>Part 3: Letâ€™s Go Further, Letâ€™s Build Bigger</h1>
			<p>In this part, we will take our DevOps and Python skills and knowledge to the next level and look at some advanced concepts regarding <span class="No-Break">the subject.</span></p>
			<p>This part has the <span class="No-Break">following chapters:</span></p>
			<ul>
				<li><a href="B21320_10.xhtml#_idTextAnchor189"><em class="itali">Chapter 10</em></a>, <em class="itali">Common DevOps Use Cases in Some of the Biggest Companies in the World</em></li>
				<li><a href="B21320_11.xhtml#_idTextAnchor204"><em class="itali">Chapter 11</em></a>, <em class="itali">MLOps and DataOps</em></li>
				<li><a href="B21320_12.xhtml#_idTextAnchor218"><em class="itali">Chapter 12</em></a>, <em class="itali">How Python Integrates with IaC Concepts</em></li>
				<li><a href="B21320_13.xhtml#_idTextAnchor226"><em class="itali">Chapter 13</em></a>, <em class="itali">The Tools to Take Your DevOps to the Next Level</em></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer121">
			</div>
		</div>
		<div>
			<div id="_idContainer122" class="Basic-Graphics-Frame">
			</div>
		</div>
	</body></html>