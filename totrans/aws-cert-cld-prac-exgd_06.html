<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer076">
			<h1 id="_idParaDest-68"><em class="italic"><a id="_idTextAnchor068"/></em><a href="B17124_04_Final_SK_ePub.xhtml#_idTextAnchor068"><em class="italic">Chapter 4</em></a>: Identity and Access Management</h1>
			<p>So far, you have learned about the basics of cloud computing and its advantages. You have also been introduced to AWS and had a quick overview of its services. We have discussed the AWS Global Infrastructure and its support plans for customers looking to use the services offered. We have also emphasized the importance of AWS accounts and how they help you gain isolated and secure access to the wide range of AWS services within which you can build your cloud solutions. We also identified the architectural reasons behind having multiple AWS accounts and using AWS Organizations to centrally manage all your accounts.</p>
			<p>You have also learned how to set up your first AWS Free Tier account, which will enable you to start configuring resources on the platform. </p>
			<p>In this chapter, we will look at the AWS <strong class="bold">Identity and Access Management</strong> (<strong class="bold">IAM</strong>) service. This is a critical foundational service designed to secure access to your AWS account. AWS IAM is an authentication and authorization service that enables you to decide who or what can access the AWS services in your account (known as <strong class="bold">authentication</strong>), and what these entities are permitted to do in your account (known as <strong class="bold">authorization</strong>). </p>
			<p>This chapter covers the following topics:</p>
			<ul>
				<li>Introduction to the AWS IAM service </li>
				<li>The root user account and implementing <strong class="bold">Multi-Factor Authentication</strong> (<strong class="bold">MFA</strong>)</li>
				<li>The importance of defining IAM password policies</li>
				<li>Key differences between IAM users and IAM groups </li>
				<li>Defining permissions with IAM policies</li>
				<li>Reviewing credential reports </li>
				<li>Exercise 4.1 – creating an IAM group</li>
				<li>Exercise 4.2 – creating an IAM user and attaching it to the developers group</li>
				<li>Exercise 4.3 – logging in to your AWS account as an IAM user</li>
				<li>Accessing AWS via the CLI</li>
				<li>Exercise 4.4 – accessing the AWS platform using the AWS CLI on a Windows computer</li>
			</ul>
			<h1 id="_idParaDest-69"><a id="_idTextAnchor069"/>Introduction to the AWS IAM service</h1>
			<p>At this point, you should have a single AWS Free Tier account that you can log in to using your chosen email address and password combination. This email address that you have used to create <a id="_idIndexMarker212"/>the account is also known as the <strong class="bold">root user</strong>. The root user <a id="_idIndexMarker213"/>is the person who created the account and holds the keys to the kingdom. This privileged user must be guarded well, and knowledge of its credentials (passwords and so on) should not be given to anyone who is not authorized to use it. The root user should also not be used for day-to-day operations. You can create additional user accounts (what we call IAM users) to perform daily tasks. We'll look at IAM users shortly in this chapter.</p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor070"/>The AWS IAM console</h2>
			<p>To access <a id="_idIndexMarker214"/>any AWS service, including the IAM service, you can either use <a id="_idIndexMarker215"/>the web-based management console, the <strong class="bold">command-line interface</strong> (<strong class="bold">CLI</strong>), or AWS SDKs if you are writing code. We will start with the AWS Management Console. Log in to your AWS account using your root user credentials and you will be presented with the following splash screen:</p>
			<div>
				<div id="_idContainer059" class="IMG---Figure">
					<img src="Images/B17124_04_01.jpg" alt="Figure 4.1 – AWS Management Console&#13;&#10;" width="1185" height="597"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.1 – AWS Management Console</p>
			<p>As you can <a id="_idIndexMarker216"/>see from the screenshot, the wide range of services is displayed under category headings, depending on the type of service. So, for example, we have categories such as <strong class="bold">Compute</strong>, <strong class="bold">Network</strong>, and <strong class="bold">Storage</strong> and under these categories, relevant services are listed.</p>
			<p>AWS IAM falls under the <strong class="bold">Security, Identity, &amp; Compliance</strong> category, but you can also search for the service using the search bar at the top of the page.</p>
			<h2 id="_idParaDest-71"><a id="_idTextAnchor071"/>The AWS IAM services </h2>
			<p>The first time <a id="_idIndexMarker217"/>you navigate to the IAM console, you will note some security alerts and a list of best practices to follow.</p>
			<p>You will also note a <em class="italic">sign-in URL</em> for IAM users in this account. This is a special URL that your IAM users can browse to access your account. This URL is customizable and you can replace the series of digits shown after the <strong class="source-inline">https://</strong> portion with a custom name that is easier to remember. The series of digits you see is, in fact, your AWS account ID.</p>
			<p>Simply click the <strong class="bold">Customize</strong> link after the URL, as shown in the following screenshot, and choose an appropriate name for your AWS account, for example, <strong class="source-inline">PacktDevAccount</strong>. Names chosen must be unique and you may need to associate a common name with your company name to create a name that is unique:</p>
			<div>
				<div id="_idContainer060" class="IMG---Figure">
					<img src="Images/B17124_04_02.jpg" alt="Figure 4.2 – IAM dashboard&#13;&#10;" width="941" height="604"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.2 – IAM dashboard</p>
			<p>Once you <a id="_idIndexMarker218"/>have customized your IAM sign-in URL, you can provide this link to other IAM users, who can use it to sign in to your account. This can only happen if your users have an IAM user account to sign in with. We discuss how to create IAM users later in this chapter.</p>
			<p>In the <a id="_idIndexMarker219"/>next section, we look at the root user account and discuss the implementation of an additional security measure, using <strong class="bold">Multi-Factor Authentication</strong> (<strong class="bold">MFA</strong>).</p>
			<h1 id="_idParaDest-72"><a id="_idTextAnchor072"/>The root user account and implementing Multi-Factor Authentication (MFA)</h1>
			<p>One <a id="_idIndexMarker220"/>of the <a id="_idIndexMarker221"/>first things you want to do is configure MFA for your root user account. Normally, when you log in to an AWS account, you simply provide a username and password. You are probably aware that you must choose a highly complex password – one that has lowercase letters, uppercase letters, numbers, and symbols, and must be randomly generated rather than dictionary words that can be guessed easily. </p>
			<p>However, a username and password combination alone is not sufficient in this age of malware attacks, hacking, and brute force attacks. MFA is a mechanism where you are prompted to verify your identity using more than one set of credentials. Instead of just having two passwords, however, MFA uses two separate secrets to verify your identity – <em class="italic">something you know</em> and <em class="italic">something you have</em>. So, for example, something you know would <a id="_idIndexMarker222"/>be your username and password, and something you have would be a one-time password <a id="_idIndexMarker223"/>pin that is generated on a <a id="_idIndexMarker224"/>device that you possess. An example of such a device could be an RSA token, a <strong class="bold">Universal Second Factor</strong> (<strong class="bold">U2F</strong>) device, or an authentication app that you can install and use on your smartphone. </p>
			<p>We strongly recommend that you set up MFA for your root user account. </p>
			<h2 id="_idParaDest-73"><a id="_idTextAnchor073"/>Setting up MFA</h2>
			<p>Let's quickly set up MFA for our root user account. To complete the step-by step guide, you will <a id="_idIndexMarker225"/>need access to a smartphone, either an Android or iOS device. There are several smartphone-based authenticators that are supported by AWS, including Google Authenticator and Microsoft Authenticator. You can review the supported apps at <a href="https://aws.amazon.com/iam/features/mfa/">https://aws.amazon.com/iam/features/mfa/</a>. For this exercise, go ahead and install the <strong class="bold">Google Authenticator app</strong> on your phone, which is available free of charge from your <a id="_idIndexMarker226"/>Google or iPhone play store. If you do not currently have the app installed, make sure you do this first before proceeding.</p>
			<p>Ensure that you have navigated to the IAM management console, then take the following steps:</p>
			<ol>
				<li>On the IAM console, click on <strong class="bold">Enable MFA</strong>, under <strong class="bold">Security alerts</strong>:<div id="_idContainer061" class="IMG---Figure"><img src="Images/B17124_04_03.jpg" alt="Figure 4.3 – Security alerts&#13;&#10;" width="901" height="105"/></div><p class="figure-caption">Figure 4.3 – Security alerts</p></li>
				<li>You are then presented with the <strong class="bold">Security Credentials</strong> page. Click on <strong class="bold">Activate MFA.</strong></li>
				<li>A pop-up <a id="_idIndexMarker227"/>dialog box is presented, and you need to select <strong class="bold">Virtual MFA device</strong>:<div id="_idContainer062" class="IMG---Figure"><img src="Images/B17124_04_04.jpg" alt="Figure 4.4 – Setting up a virtual MFA device&#13;&#10;" width="868" height="494"/></div><p class="figure-caption">Figure 4.4 – Setting up a virtual MFA device</p></li>
				<li>Click <strong class="bold">Continue</strong>.</li>
				<li>You are then presented with the <strong class="bold">Set up virtual MFA device</strong> dialog box. You will have the option to scan a QR code to link your Google Authenticator app on your mobile phone with your AWS account. To get started, launch the Google Authenticator app on your phone and select the <strong class="bold">Scan a QR code</strong> option (you may have to tap the plus sign (<strong class="bold">+</strong>) first). This will activate your phone camera.</li>
				<li>On the <a id="_idIndexMarker228"/>AWS console, in the <strong class="bold">Set up virtual MFA device</strong> dialog box, click <strong class="bold">Show QR code</strong> under list item number <strong class="bold">2</strong>:<div id="_idContainer063" class="IMG---Figure"><img src="Images/B17124_04_05.jpg" alt="Figure 4.5 – Setting up a virtual MFA device&#13;&#10;" width="847" height="795"/></div><p class="figure-caption">Figure 4.5 – Setting up a virtual MFA device</p></li>
				<li>The QR code <a id="_idIndexMarker229"/>will be displayed. At this point, you need to position your phone camera so that it captures the QR code while in the Google Authenticator app. </li>
				<li>Once the QR code is captured, you will be presented with an MFA code, which lasts for a few seconds. You will then need to type in the code in the textbox next to <strong class="bold">MFA code 1</strong>. Wait for the next code to be displayed and type that code into the textbox next to <strong class="bold">MFA code 2</strong>.</li>
				<li>Finally, click <strong class="bold">Assign MFA</strong>.</li>
			</ol>
			<p>Your root user has now been configured with MFA authentication. The next time you log out and then log back in, you will be prompted to enter the MFA code shown on your Google Authenticator app after you provide your root user's email address and password. Remember that the MFA one-time pin expires after a few seconds, so you need to promptly provide the code shown in your app or wait for the next code. </p>
			<p>Once you <a id="_idIndexMarker230"/>provide the MFA pin, you will then be logged in and redirected to the AWS Management Console.</p>
			<p>In this section, we introduced you to the basic AWS Management Console, and AWS IAM. We also looked at how to configure MFA for your root user account. </p>
			<p>In the next section, we will discuss password policies, which will allow you to enforce strong and complex passwords for any IAM users that you create in your AWS account.</p>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor074"/>The importance of defining IAM password policies </h1>
			<p>Now that you have secured your root user account, you should start creating additional accounts for <a id="_idIndexMarker231"/>users in your organization. Remember that the root user is the most privileged account, and you should not use the root user account for daily operations. Each member of your organization that needs to access the AWS services in your AWS account must be provided with an IAM user account. Never share your root credentials with other team members, even with other administrators, as they should be using their own IAM accounts with the appropriate administrative permissions.</p>
			<p>We discuss IAM users in the next section, but for now, it becomes obvious that an IAM user account will be configured with a password. And if you have a hundred different IAM user accounts, you want to enforce some sort of password policy so that those accounts do not have weak passwords that are easy to crack.</p>
			<p>AWS password policies enable you to define rules to enforce password complexity. This means that users will be forced to configure a password that is in compliance with your complexity rules and this will ensure strong passwords across all IAM user accounts. </p>
			<p>The password policies can be configured from the <strong class="bold">Account Settings</strong> section of the IAM dashboard.</p>
			<p>In the next section, we discuss the importance of creating additional IAM users and IAM groups. IAM users <a id="_idIndexMarker232"/>are additional identities that you can create in addition to your root user account. An IAM user can represent a physical person who needs access to your AWS account, such as a developer in your development team or a server administrator in your shared IT services team. </p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor075"/>Key differences between IAM users and IAM groups</h1>
			<p>In this section, we look at the importance of setting up additional identities that need to access <a id="_idIndexMarker233"/>your AWS account. We also look at best practices in <a id="_idIndexMarker234"/>managing what those identities can or cannot do in your AWS account, using IAM groups.</p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor076"/>IAM users</h2>
			<p>As discussed in <a id="_idIndexMarker235"/>the preceding section, in addition to the <strong class="bold">root user</strong>, you can create additional users known as <strong class="bold">IAM users</strong>. IAM users can be used to represent physical people in <a id="_idIndexMarker236"/>your organization, such as members of your development team or server administrators. These users can then use their IAM user accounts to log in to your AWS account and perform tasks based on permissions you grant them.</p>
			<p>IAM user accounts can also be used by applications and other services that need to authenticate themselves against a given AWS service. For example, if an application needs to update a backend Amazon RDS database, you want to make sure that the application is authorized to do so. The application can be assigned with an IAM user account that it can use to authenticate itself against the database and depending on the permissions you grant that IAM user account, the application will be able to modify the database as required. While this method of allowing an application to authenticate against AWS services is possible, it is not considered best practice for most use cases. This is partly since the credentials are usually stored in some configuration file in plain text. Furthermore, you would need to implement a process of regularly rotating the credentials to improve security somewhat and this can be a management overhead. AWS offers another type of identity specifically for this purpose known as IAM roles, which we discuss later in this chapter. </p>
			<p>As previously discussed, to access any AWS service, you can use the web-based management console, the CLI, or AWS SDKs. To access your AWS account using the AWS Management Console as an IAM user, you will create a username and password combination that will enable the user to authenticate against your AWS account. If you wish to access <a id="_idIndexMarker237"/>your AWS account using the CLI for programmatic access, you will need to configure a set of access keys. Access keys are similar to usernames and <a id="_idIndexMarker238"/>passwords and consist of an <strong class="bold">access key ID</strong> (such as a username) and a <strong class="bold">secret access key</strong> (such as a password). Access keys are for programmatic access, whereas <a id="_idIndexMarker239"/>the username and password combinations are used for web-based console access. </p>
			<p>In this section, we introduced you to IAM users, which can be used to represent physical people such as your colleagues who may need access to your AWS account. IAM user accounts can <a id="_idIndexMarker240"/>also be set up for specific applications to authenticate themselves against your account. These are known as <strong class="bold">service accounts</strong>. </p>
			<p>In the next section, we talk about IAM groups, which allow you to manage a group of IAM users who may share a common job role. </p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor077"/>IAM groups</h2>
			<p>When you create an IAM user for a particular colleague who needs access to your AWS account, you need <a id="_idIndexMarker241"/>to also configure a set of permissions for that user to ensure that they are permitted to perform tasks as required by their role in your organization. These permissions are assigned via IAM policies, which we will discuss shortly.</p>
			<p>Although you can create separate sets of IAM policies for each user in your account, an even better way of managing your users and the permissions you assign them is by combining those users who share a common job role into an AWS IAM group. By doing so, you can centrally manage the users assigned to that group by simply applying policies at the group level, which get filtered down to the users within the group.</p>
			<p>For example, if you have a team of 10 developers, all of whom need the ability to create and manage Amazon S3 storage buckets, then instead of assigning the same permission to each user individually at the IAM user level, you can assign a single permission to the developers group. Your developers, who are then made members of the group, will inherit that permission to access Amazon S3.</p>
			<p>In this section, we looked at the importance of setting up IAM users and IAM groups. This allows you <a id="_idIndexMarker242"/>to ensure that you can grant varying levels of access to different identities in your organization and use IAM groups to manage those identities. </p>
			<p>In the next section, we will take a look at IAM policies in detail. IAM policies enable us to define permissions for those additional identities and control what they are permitted to do in our AWS account. </p>
			<h1 id="_idParaDest-78"><a id="_idTextAnchor078"/>Defining permissions with IAM policies </h1>
			<p>IAM policies <a id="_idIndexMarker243"/>are objects attached to a given IAM identity, such as an IAM user, groups of IAM users, or an IAM role. These policies define what the identity can or cannot do within the AWS account and are written as <strong class="bold">JSON documents</strong>. In the following diagram, user <strong class="bold">Bob</strong> can access and read the content <a id="_idIndexMarker244"/>of an S3 bucket. The policy is attached to the group that <strong class="bold">Bob</strong> is a member of and therefore inherits the ability from the group. </p>
			<p>When a principal (IAM user or IAM role) tries to access an AWS service, AWS will evaluate the policy document attached to it and determine what action the principal can or cannot perform:</p>
			<div>
				<div id="_idContainer064" class="IMG---Figure">
					<img src="Images/B17124_04_06.jpg" alt="Figure 4.6 – Policy document attached to the developers group, granting Bob read access to the Marketing Documents bucket&#13;&#10;" width="1112" height="523"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.6 – Policy document attached to the developers group, granting Bob read access to the Marketing Documents bucket</p>
			<p>IAM policies enable you to follow the principle of least privileges, which means that identities <a id="_idIndexMarker245"/>can be configured to only have access to services and configuration options necessary to fulfill their roles, and nothing more. This greatly enhances the security of your AWS account and follows best practices.</p>
			<p>AWS offers six types of policies that you can create:</p>
			<ul>
				<li><strong class="bold">Identity-based policies</strong>: These are policies attached to your IAM identities that specify <a id="_idIndexMarker246"/>what those identities can or cannot do in your AWS account. IAM identities are your IAM users, groups of IAM users, or IAM roles within your AWS account. Note that you cannot attach an IAM identity policy to an identity in another AWS account. However, identities in other accounts can be configured to assume IAM roles in your AWS account, which can provide your external identities with access to certain services and resources in your account. We discuss IAM roles later in this chapter.</li>
				<li><strong class="bold">Resource-based policies</strong>: These are policies that are attached to the resource in <a id="_idIndexMarker247"/>each AWS account and are inline policies. Examples include the Amazon S3 bucket policies. The policy specifies the principal that is granted access to the resource to which the policy is attached. This enables you to grant access to principals in the same account as the resource or in external AWS accounts too. In addition, the policy requires you to define one or more principals that can be granted access to. You can also specify the principal as a wildcard (<strong class="source-inline">*</strong>), which means that you can grant anonymous access to some of your resources. Understandably, you should be extremely careful when granting anonymous access. </li>
				<li><strong class="bold">Permission boundaries</strong>: You can define a policy as a permission boundary for an <a id="_idIndexMarker248"/>IAM entity (user or role), which defines the maximum set of permissions that can be granted by an identity-based policy.</li>
				<li><strong class="bold">Organization Service Control Policies</strong> (<strong class="bold">SCPs</strong>): As discussed in the last chapter, organization SCPs enable you to define the maximum permissions for account <a id="_idIndexMarker249"/>members of an organization. SCPs enable you to restrict what permissions you can define in an identity- or resource-based policy in the member account. However, they are by themselves not able to grant permissions.</li>
				<li><strong class="bold">Access Control Lists</strong> (<strong class="bold">ACLs</strong>): These are permissions you use to manage access to certain resources such as Amazon S3 buckets and objects. You can use ACLs to <a id="_idIndexMarker250"/>grant basic read/write permissions to other AWS accounts; you cannot grant permissions to users in your account. They are used in certain cases where S3 bucket policies cannot be used, such as S3 server access logging. They are like resource-based policies, but the permission sets that can be configured are limited in granularity. In addition, they do not use a JSON structure to construct the policy.</li>
				<li><strong class="bold">Session policies</strong>: These allow you to pass session policies when you access services <a id="_idIndexMarker251"/>programmatically (for example, the CLI) to assume a role or federate a user. Session policies allow you to limit permissions for a specific session.</li>
			</ul>
			<p>Next, let's <a id="_idIndexMarker252"/>further study the types of identity-based policies in detail.</p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor079"/>Types of identity-based policies</h2>
			<p>As previously mentioned, identity-based policies are written in JSON format and these policies <a id="_idIndexMarker253"/>are attached to IAM identities, defining what those identities can or cannot do within your AWS account.</p>
			<p>Identity-based policies can be categorized as follows:</p>
			<ul>
				<li><strong class="bold">Managed AWS policies</strong>: These are standard policies pre-configured with specific <a id="_idIndexMarker254"/>permissions that AWS provides. A <em class="italic">managed</em> policy is one that is created independent of any IAM identity and can be attached to one or many identities. You can use these typical policies for most of the permission sets you need to define, for example, granting <em class="italic">read-only</em> access to Amazon S3. AWS managed policies cannot be edited by the customer and only AWS can update and manage them.</li>
				<li><strong class="bold">Customer-managed policies</strong>: Customers can create their own managed policies and then attach them to any IAM identity as required. Creating your own <a id="_idIndexMarker255"/>managed policies allows you to generate more granular sets of permissions. In addition, IAM creates up to five versions of your managed policies whenever you update them and this allows you to revert to older versions if necessary.</li>
				<li><strong class="bold">Inline policies</strong>: These policies are created and attached directly to the IAM identity, for example, an IAM user. This also allows you to maintain a strict one-to-one <a id="_idIndexMarker256"/>relationship between a given policy and an identity. However, too many inline policies can be more difficult to manage and must be used sparingly. Ultimately, inline policies are tied to the life cycle of the entity it is associated with.</li>
			</ul>
			<p>Let's understand IAM policies with the help of an example.</p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor080"/>Example of an IAM policy</h2>
			<p>In <em class="italic">Figure 4.6</em>, we saw an example of Bob, who is a member of the developers group, being able <a id="_idIndexMarker257"/>to access the Marketing Documents bucket because of the IAM policy attached to the group.</p>
			<p>Here is an example of what a JSON policy document looks like for the preceding scenario:</p>
			<div>
				<div id="_idContainer065" class="IMG---Figure">
					<img src="Images/B17124_04_07.jpg" alt="Figure 4.7 – AWS managed policy: AmazonS3ReadOnlyAccess&#13;&#10;" width="323" height="378"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.7 – AWS managed policy: AmazonS3ReadOnlyAccess</p>
			<p>The preceding screenshot shows a managed AWS policy that grants the identity it is attached to <a id="_idIndexMarker258"/>the ability to read contents from any S3 buckets in your AWS account. </p>
			<p>Identity policies do not need to specify a principal within the policy, because by its very nature, it will be attached to the identity that requires the level of access specified in the policy. </p>
			<p>Let's look at some of the components of the policy document:</p>
			<ul>
				<li><strong class="source-inline">Version:</strong> This is <a id="_idIndexMarker259"/>the JSON document version currently supported by AWS and should be listed as <strong class="source-inline">2012-10-17</strong>.</li>
				<li><strong class="source-inline">Statement</strong>: This is the beginning of the policy statement. You can have multiple <a id="_idIndexMarker260"/>statement blocks within a single policy, allowing you to grant various levels of access across different services.</li>
				<li><strong class="source-inline">Effect</strong>: This specifies <a id="_idIndexMarker261"/>whether the statement block is going to allow some level of access or deny access.</li>
				<li><strong class="source-inline">Action</strong>: This is the actual permission that is either permitted or denied based on the <a id="_idIndexMarker262"/>preceding <strong class="source-inline">Effect</strong> statement. The <strong class="source-inline">Action</strong> component of your JSON document will refer to the service of concern and the actual permission that is being granted. So, for example, in the preceding JSON statement, we have two sets of actions being permitted, namely the <strong class="source-inline">Get</strong> action and the <strong class="source-inline">List</strong> action of the Amazon S3 service. This means that the identity associated with this policy will be able to <em class="italic">list</em> your Amazon S3 buckets and perform various other list operations and be able to read the contents of the buckets along with other <strong class="source-inline">Get</strong> operations. These action statements actually have more granular-level operations that can be performed. So, for example, the <strong class="source-inline">Get</strong> operation includes a number of operations such as <strong class="source-inline">GetObject</strong> (which allows you to access an object) and <strong class="source-inline">GetBucketVersion</strong> (which returns the versioning state of a bucket) among others. You will notice the asterisks (<strong class="source-inline">*</strong>) after the <strong class="source-inline">Get</strong> and <strong class="source-inline">List</strong> actions in the preceding screenshot. You use the asterisks (<strong class="source-inline">*</strong>) when you want to allow all operations within a given <strong class="source-inline">Action</strong> statement. So, in the preceding example, <strong class="source-inline">Get*</strong> would include both the <strong class="source-inline">GetObject</strong> and <strong class="source-inline">GetBucketVersion</strong> operations.</li>
				<li><strong class="source-inline">Resource</strong>: This component describes the actual resource against which this policy <a id="_idIndexMarker263"/>permits or denies access. A wildcard (<strong class="source-inline">*</strong>) denotes all resources of that service. So, in this case, the resources allow the <strong class="source-inline">Get</strong> action and the <strong class="source-inline">List</strong> action against all S3 buckets in your AWS account. To restrict access to a specific resource, you will need to specify the actual <strong class="bold">Amazon Resource Name</strong> (<strong class="bold">ARN</strong>) of that resource. The ARN is a unique <a id="_idIndexMarker264"/>identifier of the resource in your AWS account. For the preceding example, if we wanted to restrict the permission sets to just the marketing bucket, we would need to specify the ARN of the bucket. In our example, it looks something like this: <strong class="source-inline">arn:aws:s3:::packt-marketing-docs</strong>. So, our JSON policy will then need to be amended to look like this:</li>
			</ul>
			<div>
				<div id="_idContainer066" class="IMG---Figure">
					<img src="Images/B17124_04_08.jpg" alt="Figure 4.8 – Customer-managed policy restricting access to a single Amazon S3 bucket&#13;&#10;" width="718" height="312"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.8 – Customer-managed policy restricting access to a single Amazon S3 bucket</p>
			<p>ARNs are <a id="_idIndexMarker265"/>composed of segments and each segment is delimited with a colon (<strong class="source-inline">:</strong>). The following are the formats in which ARNs can be constructed with their individual segments:</p>
			<p>a) <strong class="source-inline">arn:partition:service:region:account-id:resource-id</strong></p>
			<p>b) <strong class="source-inline">arn:partition:service:region:account-id:resource-type/resource-id</strong></p>
			<p>c) <strong class="source-inline">arn:partition:service:region:account-id:resource-type:resource-id</strong></p>
			<p>Let's look at the individual segments:</p>
			<p>a) <strong class="bold">partition</strong>: This represents the partition of AWS that the resource resides in. AWS has several partitions, representing different customer groups. For example, the standard partition accessible to retail customers in most countries is <strong class="source-inline">aws</strong>. A separate partition also exists for China and this is named <strong class="source-inline">aws-cn</strong>, and so on.</p>
			<p>b) <strong class="bold">service</strong>: The service namespace that identities the AWS product. For example, the Amazon S3 service is represented by the name <strong class="source-inline">s3</strong>.</p>
			<p>c) <strong class="bold">region</strong>: The Region that the resource resides in. Note for some services, such as Amazon S3, the ARN does not require you to list out the region segment. This is because S3 bucket names are globally unique, and you do not need to specify a Region as part of the ARN. For these resources, the Region name segment is simply replaced with an additional colon (<strong class="source-inline">:</strong>). </p>
			<p>d) <strong class="bold">accountID</strong>: This is the ID that owns the resource. Note that the account ID is a series of 12-digit numbers with the hyphens omitted. Here, again, for certain resources, you do <a id="_idIndexMarker266"/>not need the account ID for the ARN of the resource to be listed. So, with Amazon S3 buckets, you omit the region and account ID from the ARN, replacing them with just colons (<strong class="source-inline">:</strong>). For example, here is a valid ARN for our marketing docs bucket:: <strong class="source-inline">arn:aws:s3:::packt-marketing-docs</strong>.</p>
			<p>e) <strong class="bold">resource</strong> or <strong class="bold">resourcetype</strong>: This part of the ARN varies by service. A resource identifier can be a name or ID of the resource, for example, <strong class="source-inline">user/John</strong> or <strong class="source-inline">instance/i-1234567890xydcdeg0.</strong></p>
			<ul>
				<li><strong class="source-inline">Condition</strong>: In addition to the preceding list of components defined in a policy document, you <a id="_idIndexMarker267"/>can also create conditional elements for your statement so that you can further restrict the application of the policy based on a predetermined condition. For example, you might want to restrict access only if the source of that access is from within your corporate network IP address space.</li>
			</ul>
			<p>In the next section, we'll study the IAM policy simulator.</p>
			<h3>IAM policy simulator</h3>
			<p>If you need <a id="_idIndexMarker268"/>to test out your policies or troubleshoot any access issues, you can use the IAM policy simulator. This tool, located at <a href="https://policysim.aws.amazon.com/">https://policysim.aws.amazon.com/</a>, can help you troubleshoot identity-based policies, IAM permissions boundaries, organizations' SCPs, and resource-based policies. Note that the simulator only simulates attempted access and whether that access will be granted or denied. It does not actually make calls to the service APIs.</p>
			<p>In the <a id="_idIndexMarker269"/>screenshot shown next, you will note that we have currently selected the <strong class="bold">Database Team</strong> (<strong class="bold">DB Team</strong>) IAM group. In this example, you would have thought that <strong class="bold">DB Team</strong> can access the AWS <strong class="bold">Relational Database Service</strong> (<strong class="bold">RDS</strong>) to create <a id="_idIndexMarker270"/>database instances. However, you will see that when we ran the simulation, for the <strong class="source-inline">CreateDBInstance</strong> action, we got a <strong class="bold">denied</strong> result. This can be cross-referenced with the list of policies attached to the group on the left-hand pane. The <strong class="bold">DB Team</strong> group seems to have only the <strong class="source-inline">AllowS3FullAccess</strong> policy attached. While this example is fairly simple, you can image an IAM user, group, or role having multiple complex policies attached to it and running <a id="_idIndexMarker271"/>the simulator can enable you to test out specific levels of access:</p>
			<div>
				<div id="_idContainer067" class="IMG---Figure">
					<img src="Images/B17124_04_09.jpg" alt="Figure 4.9 – Amazon policy simulator&#13;&#10;" width="1289" height="499"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.9 – Amazon policy simulator</p>
			<p>In this section, we examined how IAM policies can be used to grant access based on the principle of least privileges. We looked at the different types of policies and the different categories of IAM policies. We also examined the JSON structure of a typical IAM policy.</p>
			<p>In the next section, we will discuss IAM roles, which are another type of identity that can be used to grant access to services and resources in your AWS account.</p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor081"/>Assigning temporary credentials with IAM roles </h2>
			<p>While an IAM user account either represents a physical person or can be used as a "service account" for an application that requires authentication, IAM roles are, in fact, independent <a id="_idIndexMarker272"/>identities that can be assumed by other entities to gain access to AWS services and resources. In other words, IAM roles are not attached to a specific user. IAM roles also have IAM policy documents attached to them to determine what services and actions can be granted or denied.</p>
			<p>IAM roles <a id="_idIndexMarker273"/>are generally used to grant access for the following use cases:</p>
			<ul>
				<li>An AWS service that needs access to another service in your own AWS account, for example, an application running on an EC2 instance that needs access to a database to update customer records.</li>
				<li>An IAM user in another account that needs access to services in your account via cross-account access.</li>
				<li>A federated user from another web <strong class="bold">Identity Provider</strong> (<strong class="bold">Idp</strong>) such as Google, Facebook, or Amazon that needs access to resources in your AWS account. IAM roles can <a id="_idIndexMarker274"/>be used to grant those external users with only the specific rights to specific services and resources in your account, without the need to create yet another IAM user account for them.</li>
				<li>A federated corporate user using an identity service such as Microsoft Active Directory, who needs access to a service in your AWS account.</li>
			</ul>
			<p>As mentioned in the preceding list, IAM roles can be used to grant access to federated users. Identity federation is a process where you trust an external Idp to verify a given user's identity and then grant the user access on that basis. After authenticating the user, the Idp sends an assertion, which contains the user's login name and any attributes that AWS needs to establish a session with the user. The policy attached to the IAM role is then used to determine the level of access that can be granted to the user.</p>
			<p>Identity federation thus allows you to grant external identities access to your AWS environment, whether via the Management Console or APIs. It also allows access to resources without the need to create an IAM user account for each external user.</p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor082"/>Temporary credentials</h2>
			<p>A key benefit of using IAM roles is that they make use of temporary credentials that are rotated on a regular basis by AWS. For example, with IAM roles, you can grant a third-party mobile <a id="_idIndexMarker275"/>app access to resources in your AWS account without storing long-term credentials on the mobile phone of the user. This greatly enhances security and reduces management overhead. Imagine having to create an IAM user account for every individual that uses the app and then finding a secure method to distribute those IAM user credentials. IAM roles come to the rescue, because by themselves, they do not contain any credentials. </p>
			<p>IAM roles <a id="_idIndexMarker276"/>make use of a service called <strong class="bold">Security Token Service</strong> (<strong class="bold">STS</strong>). The <strong class="bold">STS</strong> service assigns temporary credentials to the identity that assumes the role. These <a id="_idIndexMarker277"/>temporary credentials will include an <strong class="bold">access key ID</strong>, a <strong class="bold">secret access key</strong>, and a <strong class="bold">security token</strong>. This security token is valid for <a id="_idIndexMarker278"/>only a short term and becomes useless after expiration. The STS service <a id="_idIndexMarker279"/>will renew the temporary credentials before expiry for the identity if the identity is still permitted access, and this happens in the backend and is managed by AWS. Ultimately, temporary credentials grant users temporary access to resources in your AWS account and are much more secure than using long-term access credentials.</p>
			<p>When you create an IAM role, you <a id="_idIndexMarker280"/>also define a <strong class="bold">trust policy</strong>. Within the trust policy, you specify the entities that will be trusted to assume the role. These entities can be AWS services or identities external to your organization that need access to your AWS resources. Furthermore, the entities themselves will need to have permissions to be able to assume that role. </p>
			<p>Where possible, using IAM roles instead of creating an IAM user account is the recommended approach, primarily for entities external to your organization and because of the benefits of using temporary credentials. So, using the example of the mobile app that needs to update a database in your AWS account, it is safe to say that using an IAM role will ensure that long-term credentials are not stored locally on the phone. This also greatly reduces the chances of malicious attacks using stolen credentials.</p>
			<p>In this section, we looked at IAM roles, which allow you to grant secure access to your AWS services and resources using temporary security credentials. </p>
			<p>In the next section, we'll look at credential reports, which allow you to audit your IAM identities.</p>
			<h1 id="_idParaDest-83"><a id="_idTextAnchor083"/>Reviewing credential reports</h1>
			<p>AWS enables you to download a <strong class="bold">comma-separated values</strong> (<strong class="bold">CSV</strong>) file, updated every 4 hours, which <a id="_idIndexMarker281"/>allows you to audit your IAM user security state and review important information. The information could be a list of all your IAM users in your AWS account and the status of their credentials (such as if they have <a id="_idIndexMarker282"/>been configured with passwords and access keys). The report also highlights if your user accounts have been configured with MFA.</p>
			<p>Monitoring your credentials report will also help you pick up on identities that may not have accessed resources in your AWS accounts recently. You can then work out whether those users still need access and delete unwanted users from your AWS accounts. </p>
			<p>In this section, we looked at credential reports, which allow you to generate details of your IAM users and their current access status. In the next sections, we provide a number of exercises to help you build hands-on experience of using the IAM service to secure access to your AWS accounts.</p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor084"/>Exercise 4.1 – creating an IAM group</h1>
			<p>In this exercise, you will <a id="_idIndexMarker283"/>create an IAM group for a development team that is going to require full access to Amazon S3:</p>
			<ol>
				<li value="1">Log in to your AWS account.</li>
				<li>Click on the <strong class="bold">IAM</strong> link under the <strong class="bold">Security, Identity, &amp; Compliance</strong> category on your <strong class="bold">AWS Services</strong> home page.</li>
				<li>From the left-hand menu, click <strong class="bold">Groups</strong>.</li>
				<li>Next, click on the <strong class="bold">Create New Group</strong> button.</li>
				<li>You will then be presented with a step-by-step wizard. Provide a group name for your new group. For this exercise, type in <strong class="source-inline">Developers</strong>.</li>
				<li>Click the <strong class="bold">Next Step</strong> button in the bottom right-hand corner of the screen.</li>
				<li>You now need to attach a policy. You can create your own customer-managed policies but for the purposes of this exercise, type <strong class="source-inline">S3</strong> in the <strong class="bold">Policy Type</strong> filter search box. This will narrow down the available policies that relate to Amazon S3.</li>
				<li>Tick the checkbox next to the <strong class="bold">AmazonS3FullAccess</strong> policy.</li>
				<li>Click the <strong class="bold">Next Step</strong> button in the bottom right-hand corner of the screen.</li>
				<li>Finally, click the <strong class="bold">Create Group</strong> button in the bottom right-hand corner of the screen.</li>
			</ol>
			<p>You will now <a id="_idIndexMarker284"/>see that your group has been created and listed under <strong class="bold">Group Name</strong>. Now that you have created a group, you can proceed to create an IAM user and add it to the group. This allows you to manage multiple users more effectively. In the next exercise, we will create an IAM user and add it to the developers group.</p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor085"/>Exercise 4.2 – creating an IAM user </h1>
			<p>Now that you have created a developers group, you can add your developers to this group. To illustrate this, we will <a id="_idIndexMarker285"/>create a new user, John. John is one of our senior developers at Packt and we would like to ensure that he is a member of the developers group, which will give him full access to Amazon S3:</p>
			<ol>
				<li value="1">In the IAM dashboard, click on <strong class="bold">Users</strong> from the left-hand menu.</li>
				<li>Click the <strong class="bold">Add user</strong> button.</li>
				<li>In the <strong class="bold">User name</strong> textbox, type in <strong class="source-inline">john</strong> (all lowercase).</li>
				<li>Next, you need to select the type of access you want to grant John. John is a developer and will require both console access and programmatic access. This means that sometimes, John will use the web-based console to configure resources in Amazon S3, and at other times, he may use the CLI. For this exercise, tick both boxes – <strong class="bold">Programmatic Access</strong> and <strong class="bold">AWS Management Console access</strong>.</li>
				<li>To access the AWS account via the console, you need to create a password for the user. For <strong class="source-inline">john</strong>, you can have AWS automatically generate a password for you or you can create a custom one yourself. Select <strong class="bold">Custom password</strong> and choose a complex password of your choice. Type that password in the textbox provided.</li>
				<li>An additional setting, <strong class="bold">Require password reset</strong>, enables you to force your IAM users to change their password at the next login. That way, you will not know what their password is when they change it and it is best practice to follow. For the purposes of this lab, disable this checkbox for now.</li>
				<li>Click the <strong class="bold">Next:Permissions</strong> button in the bottom left-hand corner of the screen.</li>
				<li>You now have the option to set permissions for the user. As we have already created a group <a id="_idIndexMarker286"/>with the right set of permissions attached to it, we simply need to make this user a member of the group. For this exercise, under <strong class="bold">Add user to group</strong>, tick the box next to the <strong class="bold">Developers</strong> group and click the <strong class="bold">Next:Tags</strong> button in the bottom right-hand corner of the screen.</li>
				<li>Tags are key-value pairs that you can attach to any resource. You can attach up to 50 tags to each resource and they enable you to classify your resources better. You can then use tags to understand cost allocation and to identify and manage your resources. Tags can include user information, such as an email address, or can be descriptive, such as a job title. For this exercise, set a single tag, with the key set to <strong class="source-inline">Name</strong> and the value set to <strong class="source-inline">John</strong>.</li>
				<li>Click the <strong class="bold">Next:Review</strong> button in the bottom right-hand corner of the screen.</li>
				<li>You can now review all your settings for the user and once satisfied, go ahead and click the <strong class="bold">Create user</strong> button in the bottom right-hand corner of the screen.</li>
				<li>You are now presented with a <strong class="bold">Success</strong> screen, which confirms that the user has been created. You are also informed of the option to download your access keys. Access keys are like usernames and passwords and comprise an access key ID (similar to the username) and the secret access key (similar to the password). Access keys are used to grant programmatic access via the AWS CLI or using the AWS SDKs. It is <a id="_idIndexMarker287"/>important that you download these keys now and keep them safe on your computer. If you move away from this screen, the secret access key (such as the password) is no longer visible, and you would need to recreate the keys. For this exercise, ensure that you download the keys by clicking on the <strong class="bold">Download .csv</strong> button. Store the <strong class="source-inline">.csv</strong> file.</li>
				<li>You will also note that you have been provided with a special link to log in to your AWS Free Tier account using an IAM user account. The AWS account sign-in page for IAM users is slightly different from that of the root user. This is because when you sign in as an IAM user, you need to specify the AWS account ID you are trying to sign into. In our example, we have a link like this:<p class="source-code">Users with AWS Management Console access can sign-in at: https://111222333444.signin.aws.amazon.com/console</p><p>The series of numbers just before <strong class="source-inline">.signin</strong> represents your AWS account ID.</p></li>
				<li>Click the <strong class="bold">Close</strong> button in the bottom right-hand corner of the screen to exit from the user setup wizard.</li>
			</ol>
			<p>We have now created a user who represents a developer in our organization and we have added the user to the developers group. In the next exercise, you will learn how to access your AWS account as the IAM user you created previously.</p>
			<h1 id="_idParaDest-86"><a id="_idTextAnchor086"/>Exercise 4.3 – logging in to your AWS account as an IAM user</h1>
			<p>In this exercise, we log out of the AWS account as the root user and re-login as the IAM user you <a id="_idIndexMarker288"/>just created. If you did not make a note of the special sign-in link, you will need to know what your AWS account ID is. You can easily <a id="_idIndexMarker289"/>discover this by clicking on your account name in the top right-hand corner of your web-based management console and noting the account ID:</p>
			<div>
				<div id="_idContainer068" class="IMG---Figure">
					<img src="Images/B17124_04_10.jpg" alt="Figure 4.10 – Drop-down box when clicking on the account name to discover the account ID, which is shown after My Account&#13;&#10;" width="495" height="364"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.10 – Drop-down box when clicking on the account name to discover the account ID, which is shown after My Account</p>
			<p>Now that you have the account ID (or you can make a note of the sign-in URL previously discussed), we can proceed to log in as the IAM user you created earlier:</p>
			<ol>
				<li value="1">Sign out of the AWS account (remember, you are currently signed in as the root user).</li>
				<li>You will be taken to the AWS console home page where you can click the <strong class="bold">Log back in</strong> button or the <strong class="bold">Sign in to the Console</strong> button.</li>
				<li>Clicking <a id="_idIndexMarker290"/>on either of these will take you <a id="_idIndexMarker291"/>to the AWS sign-in page.</li>
				<li>Click on <strong class="bold">IAM user</strong> and provide the account ID in the available textbox:<div id="_idContainer069" class="IMG---Figure"><img src="Images/B17124_04_11.jpg" alt="Figure 4.11 – AWS signing page&#13;&#10;" width="484" height="520"/></div><p class="figure-caption">Figure 4.11 – AWS signing page</p></li>
				<li>Once you have provided the account ID, click <strong class="bold">Next</strong>.</li>
				<li>Now, provide your username, in this case, <strong class="source-inline">john</strong>, and the password you chose when you created the user.</li>
				<li>You will now be logged in to the AWS Management Console as our developer, John. You will note that your username is displayed in the top right-hand corner of the screen:</li>
			</ol>
			<div>
				<div id="_idContainer070" class="IMG---Figure">
					<img src="Images/B17124_04_12.jpg" alt="Figure 4.12 – IAM user John has successfully logged in to this AWS account&#13;&#10;" width="597" height="415"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.12 – IAM user John has successfully logged in to this AWS account</p>
			<p>In this <a id="_idIndexMarker292"/>section, we completed a series of exercises <a id="_idIndexMarker293"/>using the AWS IAM service. We demonstrated how to create IAM groups and users and how to log in to the AWS Management Console as an IAM user.</p>
			<p>In the next section, we look at how you can access your AWS account using the AWS CLI.</p>
			<h1 id="_idParaDest-87"><a id="_idTextAnchor087"/>Accessing the AWS platform using the CLI</h1>
			<p>As previously <a id="_idIndexMarker294"/>discussed, you can access the vast <a id="_idIndexMarker295"/>array of AWS services using the web-based management console or the CLI. The AWS CLI is a unified tool to manage your AWS services programmatically. The AWS CLI gives you access to the <strong class="bold">application programming interface</strong> (<strong class="bold">API</strong>) of each AWS service. This enables you to <a id="_idIndexMarker296"/>remotely access your AWS account and run commands from your Terminal application on Linux and Mac computers or use Command Prompt on Windows computers.</p>
			<p>The AWS <a id="_idIndexMarker297"/>CLI is therefore ideal for running simple commands to complete repetitive tasks and because a single <a id="_idIndexMarker298"/>command string can contain necessary attributes of your request, you will find it a lot faster than using mouse clicks within the web console. The CLI is something you will need to get accustomed to—for one, you will need to know how to construct commands, but AWS offers complete reference documentation for this.</p>
			<p>You can run your CLI commands line by line individually, or you can even create scripts to run a series of commands for a set of tasks. For example, you can create a script that launches a new EC2 instance, configures it as a web server, and installs any third-party applications.</p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor088"/>Accessing your account via the CLI</h2>
			<p>In this section, we will walk you through the steps of configuring the CLI on your computer <a id="_idIndexMarker299"/>and accessing your AWS platform using John's account.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">It is highly recommended that you avoid creating and using access keys for the root user account unless you have certain specific requirements. For example, to enable MFA-delete on Amazon S3 buckets (which we look at in <a href="B17124_05_Final_SK_ePub.xhtml#_idTextAnchor094"><em class="italic">Chapter 5</em></a>, <em class="italic">Amazon Simple Storage Service (S3)</em>), you need to use the CLI, for which you will need a set of access keys. The problem is when you use the AWS CLI to access your AWS account, your credentials (access key ID and secret access keys) get stored locally on the computer that you are using. This means that you should consider rotating your keys on a regular basis and ensure you secure your computer, for example, by enabling local disk encryption. As a best practice, if you need to create a set of access keys for the root user account, you should follow a process of creating the keys, using them for the specific task, and then disabling or deleting the keys once the task is complete.</p>
			<p>Accessing your AWS account using the CLI from your local computer as the root user therefore means that the root user's credentials are also stored on the local machine. This is considered a major security risk because you really should not be using the root user account for day-to-day operations. Even if you need full administrative privileges, you should ideally create an IAM user and assign it with the necessary admin rights. You can then configure your AWS CLI with the IAM administrator user account credentials instead.</p>
			<p>The root <a id="_idIndexMarker300"/>user is the ultimate owner of your account and can even close your account. This is the reason why extreme caution is advised in how you manage the root user's credentials.</p>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor089"/>Downloading the CLI tools</h2>
			<p>To use the AWS CLI, you first need to download and install it on your local computer. You can <a id="_idIndexMarker301"/>access the AWS CLI tools here: <a href="https://aws.amazon.com/cli/">https://aws.amazon.com/cli/</a>.</p>
			<p>Depending <a id="_idIndexMarker302"/>on your operating system, you will need to download and install the appropriate tool. The AWS CLI tool is currently available in version 2 and comes <a id="_idIndexMarker303"/>with new and improved installers, new configuration options, such as AWS <strong class="bold">Single Sign-On</strong> (<strong class="bold">SSO</strong>), and various interactive features. You can download the installers for your specific operating system, whether it is Windows, Mac, or Linux. Previously, you had to have Python installed to use the AWS CLI, but this is no longer the case.</p>
			<p>Download and install the appropriate installer for your operating system from the preceding link:</p>
			<div>
				<div id="_idContainer071" class="IMG---Figure">
					<img src="Images/B17124_04_13.jpg" alt="Figure 4.13 – Links to download the appropriate AWS CLI installer for your operating system&#13;&#10;" width="429" height="474"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.13 – Links to download the appropriate AWS CLI installer for your operating system</p>
			<p>Once you have installed the AWS CLI, the next step is to configure it with a set of access keys to <a id="_idIndexMarker304"/>log in to your AWS account programmatically. If you are using Windows, you can access the AWS CLI from Command Prompt. If you are using Linux or Mac, you can use the Terminal application. The installer would have already set up any environmental variables, so you can access the tool from anywhere in your Command Prompt.</p>
			<p>In the next exercise, you will learn how to access the AWS platform using the Amazon CLI on a Windows computer.</p>
			<h1 id="_idParaDest-90"><a id="_idTextAnchor090"/>Exercise 4.4 – accessing the AWS platform using the AWS CLI on a Windows computer</h1>
			<p>Once <a id="_idIndexMarker305"/>you have installed <a id="_idIndexMarker306"/>the AWS <a id="_idIndexMarker307"/>CLI tools on your Windows machine, the next step is to configure it to access your AWS account as the IAM user you created earlier:</p>
			<ol>
				<li value="1">Open the credentials file, which you downloaded earlier when you created the IAM user <strong class="source-inline">john</strong>. This file has the access keys for your user, which comprises the <strong class="bold">access key ID</strong> and the <strong class="bold">secret access key</strong>.</li>
				<li>On your Windows desktop, click on the <strong class="bold">Start</strong> button and search for Command Prompt by typing in <strong class="source-inline">CMD</strong>:<div id="_idContainer072" class="IMG---Figure"><img src="Images/B17124_04_14.jpg" alt="Figure 4.14 – Command Prompt on a Windows computer&#13;&#10;" width="624" height="95"/></div><p class="figure-caption">Figure 4.14 – Command Prompt on a Windows computer</p></li>
				<li>At <a id="_idIndexMarker308"/>the prompt, type in <strong class="source-inline">AWS configure</strong> to start the configuration process.</li>
				<li>You <a id="_idIndexMarker309"/>will then be <a id="_idIndexMarker310"/>prompted to enter the <strong class="bold">AWS access key ID</strong>, followed by the <strong class="bold">AWS secret access key</strong>. These keys are in your credentials document that you downloaded earlier.</li>
				<li>For <strong class="bold">Default region name</strong>, type in <strong class="source-inline">us-east-1</strong>.</li>
				<li>For <strong class="bold">Default output format</strong>, leave this blank and press <em class="italic">Enter</em>:<div id="_idContainer073" class="IMG---Figure"><img src="Images/B17124_04_15.jpg" alt="Figure 4.15 – Configuring the AWS CLI with access key ID and secret access keys&#13;&#10;" width="741" height="170"/></div><p class="figure-caption">Figure 4.15 – Configuring the AWS CLI with access key ID and secret access keys</p></li>
				<li>Your <a id="_idIndexMarker311"/>AWS CLI tool has now been configured with John's credentials.</li>
				<li>You <a id="_idIndexMarker312"/>can try <a id="_idIndexMarker313"/>running a command such as <strong class="source-inline">aws s3 ls</strong>. This command lists out any Amazon S3 bucket you have in your account. If you have not created any buckets yet, you will just have the prompt return. In my case, I have already got one bucket in my account as you can see in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer074" class="IMG---Figure">
					<img src="Images/B17124_04_16.jpg" alt="Figure 4.16 – Configuring the AWS CLI with access key ID and secret access keys&#13;&#10;" width="734" height="229"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.16 – Configuring the AWS CLI with access key ID and secret access keys</p>
			<p>In this section, we discussed the necessary steps required to configure your AWS CLI tool, so that you can access your AWS account as an IAM user using Command Prompt on a Windows machine. You can also use Terminal on a Mac or Linux computer to complete the same tasks. You would need to install the appropriate tool for your operating system.</p>
			<p>Using <a id="_idIndexMarker314"/>the CLI can <a id="_idIndexMarker315"/>be very efficient, especially <a id="_idIndexMarker316"/>if you are trying to perform repeat tasks as you can also create scripts to automate the whole process.</p>
			<p>You should try and avoid using the root account to perform any day-to-day operations in your AWS account. Instead, you must log in with an IAM user account that has only the necessary privileges to carry out the task at hand. This is known as following the principle of least privilege. </p>
			<p>In the next exercise, you will create another IAM user account that you will use for all the exercises in the upcoming chapters.</p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor091"/>Exercise 4.5 – creating an IAM user with administrative privileges</h1>
			<p>In this exercise, you will create another IAM user account that you will use to log in to your <a id="_idIndexMarker317"/>AWS account. This IAM user will be provided with full administrative access to help you work through the upcoming <a id="_idIndexMarker318"/>exercises easily, although in the real world, you would want to restrict permissions to only the job function of the users in question. By getting used to logging in as an IAM user, you will build a habit of avoiding the use of the root user credentials for your day-to-day tasks:</p>
			<ol>
				<li value="1">Ensure that you are logged in to your AWS account as the root user (the email address and password combination you used to create your AWS account).</li>
				<li>Navigate to the IAM dashboard.</li>
				<li>From the left-hand menu, click on <strong class="bold">Users</strong>. Next, from the right-hand pane, click <strong class="bold">Add user</strong>.<p>You will be redirected to the <strong class="bold">Add user</strong> wizard page.</p></li>
				<li>For the username, type in <strong class="source-inline">Alice</strong>. Throughout the rest of this guide, you will be logging in as <strong class="source-inline">Alice</strong> to carry out all upcoming exercises.</li>
				<li>Under <strong class="bold">Select AWS access type</strong>, select both <strong class="bold">Programmatic access</strong> and <strong class="bold">AWS Management Console access</strong>.</li>
				<li>For <strong class="bold">Console password</strong>, select the <strong class="bold">Custom password</strong> option and provide a complex password of your choice.</li>
				<li>Uncheck <a id="_idIndexMarker319"/>the box next to <strong class="bold">Require password reset</strong> and click the <strong class="bold">Next: Permissions</strong> button.</li>
				<li>In <a id="_idIndexMarker320"/>step 2, under <strong class="bold">Set permissions</strong>, select the <strong class="bold">Attach existing policies directly</strong> option. This will allow you to attach an inline policy to Alice's account alone.</li>
				<li>From the list of policies provided, select the checkbox next to <strong class="bold">AdministratorAccess</strong> as per the following screenshot:<div id="_idContainer075" class="IMG---Figure"><img src="Images/B17124_04_17.jpg" alt="Figure 4.17 – IAM user (Alice) with administrator access permissions&#13;&#10;" width="1082" height="491"/></div><p class="figure-caption">Figure 4.17 – IAM user (Alice) with administrator access permissions</p></li>
				<li>Click the <strong class="bold">Next: Tags</strong> button at the bottom of the screen.</li>
				<li>In step 3, under <strong class="bold">Add tags (optional)</strong>, provide a key-value pair where the key is set to <strong class="source-inline">Name</strong> and the value is set to <strong class="source-inline">Alice</strong>.</li>
				<li>Click the <strong class="bold">Next: Review</strong> button.</li>
				<li>Next, click the <strong class="bold">Create user</strong> button.</li>
				<li>You will <a id="_idIndexMarker321"/>then be prompted <a id="_idIndexMarker322"/>to download the <strong class="source-inline">.csv</strong> file containing Alice's access keys and secret access keys. Download the file and ensure you keep it in a folder on your computer that you can easily access. Once downloaded, go ahead and click the <strong class="bold">Close</strong> button.</li>
				<li>Your IAM user Alice is now ready to log in. Going forward, you will need to log in as the IAM user Alice for all upcoming exercises. Ensure you also make a note of either the special sign-in link for your AWS account or the AWS account ID, which you will need to log in as an IAM user.</li>
			</ol>
			<p>In this exercise, you created an IAM user account that you will use to log in to your AWS account and perform all the upcoming exercises. In the next section, we'll review a summary of this chapter.</p>
			<h1 id="_idParaDest-92"><a id="_idTextAnchor092"/>Summary</h1>
			<p>In this chapter, we discussed the AWS IAM service and how it acts as the gatekeeper to your AWS account. We discussed the root user of your account, which is the most senior administrative account for your AWS account. The root user has complete access and protecting this account with MFA is a recommended best practice. </p>
			<p>With AWS IAM, you can create and manage identities that are granted or denied access to the various AWS services in your account. These identities can include IAM users, groups of IAM users, or IAM roles. You can also further enhance the security of your IAM users by configuring them with MFA. </p>
			<p>We discussed best practices when configuring your IAM users and IAM groups. We emphasized that, as best practice, you should create IAM groups and subsequently place any necessary IAM users within groups that share a common task. For example, if you have a developers group, you can place all your developers in that group. In addition, you can create IAM policies, which can be attached to your IAM identities to determine what they can or cannot do within your AWS account. AWS IAM thus offers authentication and authorization services to your account. </p>
			<p>We also examined IAM roles, which allow you to create identities not specifically attached to any physical user. IAM roles enable you to grant access to those entities that may not necessarily have access. IAM roles can be used to grant temporary credentials to entities when they need them and, depending on the use case, are more secure than using IAM user accounts.</p>
			<p>Next, we discussed credential reports, which allow you to audit your existing user base within your AWS account and audit usage patterns. Finally, we looked at how you can access your AWS account using the AWS CLI. </p>
			<p>At this point, you have now learned the importance of creating IAM users, groups, and roles and have understood their application. You have learned that the root user account must not be used for day-to-day operations and you must set up MFA for your root user account as well as your IAM users. You have also gained knowledge on how IAM roles can be used to grant cross-account access and federated access and enable one AWS service to access another AWS service. You have also learned how IAM policies can be used to enforce the principle of least privileges, thereby improving the security of your AWS account. </p>
			<p>In the next chapter, we look at another core AWS service, called <strong class="bold">Amazon Simple Storage Service</strong> (<strong class="bold">Amazon S3</strong>). Amazon S3 is an object storage solution that allows you to store unlimited amounts of data in the cloud. Amazon S3 can be used for a wide range of use cases, including storage of digital assets for your web applications, such as documents, images, and video, as well as for archive storage. </p>
			<h1 id="_idParaDest-93"><a id="_idTextAnchor093"/>Questions</h1>
			<p>Here are a few questions to test your knowledge:</p>
			<ol>
				<li value="1">You wish to deploy a dev and test environment on AWS. You want to ensure that your developers can access your AWS account using a highly secure authentication process and follow best practices. Which of the following two configuration options will help ensure enhanced security? (Choose two answers)<ol><li>Configure your IAM accounts with MFA.</li><li>Configure your IAM password policy with complexity rules.</li><li>Ensure you encrypt your EBS volumes.</li><li>Create RDS databases with Multi-AZ.</li><li>Provide the root account credential details to your developers.</li></ol></li>
				<li>Your developer is working from home this weekend and needs to access your AWS account using the CLI to configure your RDS database from their local computer. Which type of IAM credentials would they need to configure the AWS CLI tool on their machine?<ol><li>IAM username and password</li><li>Access key IDs and secret access keys</li><li>Access keys and secret ID</li><li>HTTPS</li></ol></li>
				<li>Which AWS service enables you to troubleshoot your IAM policies and identify the sets of permissions that may be denying access to a given AWS service?<ol><li>IAM policy simulator</li><li>CloudWatch</li><li>CloudTrail</li><li>IAM policy manager</li></ol></li>
				<li>Which of the following AWS services is a better option to securely grant your application running on an EC2 instance access to a backend database running on Amazon RDS?<ol><li>Access keys</li><li>IAM role</li><li>IAM group</li><li>Security group</li></ol></li>
				<li>Which format are IAM policy documents written in?<ol><li>JSON</li><li>YAML</li><li>XML</li><li>JAVA</li></ol></li>
				<li>What best practice strategy should you follow when assigning permissions to IAM users and groups?<ol><li>Follow the principle of least privilege.</li><li>Follow the principle of most privilege.</li><li>Follow the ITIL principles.</li><li>Follow the GDPR principle.</li></ol></li>
				<li>Which IAM service enables you to effectively manage users by creating a collection of them based on their job function and assigning them permissions according to their roles to the entire collective?<ol><li>IAM groups</li><li>IAM policies</li><li>IAM collection</li><li>IAM roles</li></ol></li>
				<li>Which feature of IAM enables you to use your existing corporate Active Directory user credentials to log in to the AWS Management Console and therefore offer an SSO service?<ol><li>Identity federation</li><li>IAM user database</li><li>Active Directory users and computers</li><li>MFA</li></ol></li>
				<li>Which AWS service enables you to generate and download a report that lists your IAM users and the state of their various credentials, including passwords, access keys, and MFA devices?<ol><li>AWS policies</li><li>AWS Explorer</li><li>Credentials report</li><li>User report</li></ol></li>
				<li>Which AWS service is responsible for assigning and managing temporary credentials to entities that assume an IAM role?<ol><li>AWS Password Manager</li><li>AWS Security Token Service</li><li>AWS Credentials Manager</li><li>AWS Credentials Report</li></ol></li>
			</ol>
		</div>
	</div></body></html>