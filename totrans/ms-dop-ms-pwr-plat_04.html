<html><head></head><body>
		<div id="_idContainer055">
			<h1 id="_idParaDest-72" class="chapter-number"><a id="_idTextAnchor074"/><st c="0">4</st></h1>
			<h1 id="_idParaDest-73"><a id="_idTextAnchor075"/><st c="2">Understanding Power Platform Environments and Solutions</st></h1>
			<p><st c="57">Now that we have learned about the Power Platform products, as well as </st><strong class="bold"><st c="129">Application Life Cycle Management</st></strong><st c="162"> (</st><strong class="bold"><st c="164">ALM</st></strong><st c="167">) and DevOps approaches, in the previous chapters, it is time to explore the fundamental building blocks of successful ALM by introducing the concepts of </st><strong class="bold"><st c="322">environments</st></strong><st c="334"> and </st><strong class="bold"><st c="339">solutions</st></strong><st c="348">. We will start by explaining what constitutes a solution in the Power Platform and then discuss </st><strong class="bold"><st c="445">Dataverse</st></strong><st c="454"> and data modeling within this framework. </st><st c="496">We will also cover the versioning of solutions and packages in the platform to understand how to manage different versions of solutions. </st><st c="633">We will learn about the concepts of </st><strong class="bold"><st c="669">Managed Environments</st></strong><st c="689"> and </st><strong class="bold"><st c="694">managed pipelines</st></strong><st c="711">, and we will also discover how we can use them to automate and streamline the software development process. </st><st c="820">We will conclude this section with a step-by-step guide on our first </st><strong class="bold"><st c="889">Continuous Integration and Continuous Deployment</st></strong><st c="937"> (</st><strong class="bold"><st c="939">CI/CD</st></strong><st c="944">) pipeline in the Power Platform, giving us a practical understanding of how CI/CD processes work in this </st><span class="No-Break"><st c="1051">specific context.</st></span></p>
			<p><st c="1068">By the end of this chapter, we will be able to set up a CI/CD pipeline using the built-in Power Platform pipelines, deploy solutions to different environments, and use Copilot to generate deployment notes </st><span class="No-Break"><st c="1274">in pipelines.</st></span></p>
			<p><st c="1287">In this chapter, we’re going to cover the following </st><span class="No-Break"><st c="1340">main topics:</st></span></p>
			<ul>
				<li><st c="1352">What comes to </st><span class="No-Break"><st c="1367">a solution?</st></span></li>
				<li><st c="1378">Versioning of solutions </st><span class="No-Break"><st c="1403">and packages</st></span></li>
				<li><st c="1415">What about data – Dataverse and data </st><span class="No-Break"><st c="1453">modeling aspects</st></span></li>
				<li><st c="1469">Environments – Managed Environments and </st><span class="No-Break"><st c="1510">environment strategy</st></span></li>
				<li><st c="1530">Managed pipelines – our </st><span class="No-Break"><st c="1555">first CI/CD</st></span></li>
			</ul>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor076"/><st c="1566">Technical requirements</st></h1>
			<p><st c="1589">To be able to create our first CD pipeline using Power Platform pipelines, we need to have a Power Platform subscription. </st><st c="1712">We can sign up for a Power Apps Developer Plan (</st><a href="https://www.microsoft.com/en-us/power-platform/products/power-apps/free"><st c="1760">https://www.microsoft.com/en-us/power-platform/products/power-apps/free</st></a><st c="1832">), if we already have a Microsoft Entra ID work account, or we can join the Microsoft 365 developer </st><span class="No-Break"><st c="1933">program (</st></span><a href="https://developer.microsoft.com/en-us/microsoft-365/dev-program"><span class="No-Break"><st c="1942">https://developer.microsoft.com/en-us/microsoft-365/dev-program</st></span></a><span class="No-Break"><st c="2006">).</st></span></p>
			<p><st c="2009">In addition, we need to install the PAC CLI tool and PowerShell administrator module. </st><st c="2096">See </st><a href="B22208_02.xhtml#_idTextAnchor030"><span class="No-Break"><em class="italic"><st c="2100">Chapter 2</st></em></span></a><st c="2109"> for setup and </st><span class="No-Break"><st c="2124">installation information.</st></span></p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor077"/><st c="2149">What comes to a solution?</st></h1>
			<p><st c="2175">As we have learned in the previous chapters, Power Platform consists of multiple products, including Power Apps, Power Automate, Power Pages, Microsoft Copilot Studio, Dataverse, AI Builder, and so on. </st><st c="2378">We often refer to the building blocks that we can create in these products as assets or solution components. </st><st c="2487">An asset can be a canvas app, a connection reference, a cloud flow, a custom copilot, or even a plugin developed for Dataverse or a Dataverse Table </st><span class="No-Break"><st c="2635">schema definition.</st></span></p>
			<p><strong class="bold"><st c="2653">Solutions</st></strong><st c="2663"> are</st><a id="_idIndexMarker381"/><st c="2667"> the containers of the assets that build up a Power Platform application. </st><st c="2741">They can contain one or more apps as well as other components such as flows, custom Copilots, Power Pages websites, site maps, entities, processes, web resources, option sets, pro-dev components, such as plugins, PCF components, and more. </st><st c="2980">Some components are nested within other components; for example, a Dataverse Table contains forms, views, charts, columns, table relationships, messages, and business rules. </st><st c="3154">Each of these components requires a table to exist and they cannot exist outside of a table. </st><st c="3247">On the other hand, solutions need environments with </st><span class="No-Break"><st c="3299">Dataverse installed.</st></span></p>
			<p><st c="3319">We need solutions because Power Platform solutions are the way to transport apps and components from one environment to another or to apply a set of customizations to existing apps. </st><st c="3502">This is one of the key fundamentals of ALM processes in Power Platform. </st><st c="3574">To implement these releases and to</st><a id="_idIndexMarker382"/><st c="3608"> get </st><strong class="bold"><st c="3613">Continuous Deployments</st></strong><st c="3635"> (</st><strong class="bold"><st c="3637">CDs</st></strong><st c="3640">) to work fluently, the platform defines two types </st><span class="No-Break"><st c="3692">of solutions:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="3705">Managed solutions</st></strong><st c="3723"> are </st><a id="_idIndexMarker383"/><st c="3728">created by exporting </st><a id="_idIndexMarker384"/><st c="3749">an unmanaged solution as a managed solution package. </st><st c="3802">Once a managed solution is imported into a target environment, the components within the solution are locked and can only be modified by the publisher of the solution. </st><st c="3970">This allows</st><a id="_idIndexMarker385"/><st c="3981"> the </st><a id="_idIndexMarker386"/><st c="3986">publisher to control how the solution is used and updated in the target environment. </st><st c="4071">Managed solutions are like generated binaries; they are immutable in the </st><span class="No-Break"><st c="4144">target environments.</st></span></li>
				<li><strong class="bold"><st c="4164">Unmanaged solutions</st></strong><st c="4184"> are typically used in development environments where</st><a id="_idIndexMarker387"/><st c="4237"> changes and customizations are made to the application. </st><st c="4294">Unlike managed solutions, the components within an unmanaged solution are not locked and can be modified by anyone with the appropriate permissions. </st><st c="4443">These solutions are like the source code of applications</st><a id="_idIndexMarker388"/><st c="4499"> in custom development projects. </st><st c="4532">Unmanaged solutions are exported as unmanaged solution packages and can be imported into other environments for further development or testing. </st><st c="4676">However, it is important to note that unmanaged solutions should not be used in production environments as they can be changed by anyone who has access to the components defined </st><span class="No-Break"><st c="4854">within them.</st></span></li>
			</ul>
			<p><st c="4866">Every development project starts with an unmanaged solution, which developers extend with components to realize the original customer requirements. </st><st c="5015">After finalizing the development and going through the testing phase, the unmanaged solution is converted to a </st><span class="No-Break"><st c="5126">managed one.</st></span></p>
			<p><st c="5138">We can also export solutions manually, which results in ZIP files. </st><st c="5206">In the case of a managed solution, the ZIP file only contains a few files. </st><st c="5281">One of them is an </st><strong class="source-inline"><st c="5299">.msapp</st></strong><st c="5305"> file. </st><st c="5312">On the other hand, the ZIP files of unmanaged solutions contain a large number of JSON and XML files that describe the configuration of Power Platform assets included in the solution. </st><st c="5496">We can also edit the latter ones </st><span class="No-Break"><st c="5529">if needed.</st></span></p>
			<p><st c="5539">Considering the traditional development terms and methodologies, creating a managed solution is equal to generating binaries, so it is exactly </st><a id="_idIndexMarker389"/><st c="5683">what a </st><strong class="bold"><st c="5690">Continuous Integration</st></strong><st c="5712"> (</st><strong class="bold"><st c="5714">CI</st></strong><st c="5716">) build does. </st><st c="5731">Moving the managed solution through different environments corresponds to </st><span class="No-Break"><st c="5805">CD steps.</st></span></p>
			<p class="callout-heading"><st c="5814">Solution as starting point</st></p>
			<p class="callout"><st c="5841">It is highly recommended to start any customization on any Power Platform components or assets by creating a solution. </st><st c="5961">We should then create any components inside the solution rather than in the corresponding editor. </st><st c="6059">When we use this approach, the platform immediately appends every dependency to the Power </st><span class="No-Break"><st c="6149">Platform solution.</st></span></p>
			<p><strong class="bold"><st c="6167">Solution layering</st></strong><st c="6185"> is a</st><a id="_idIndexMarker390"/><st c="6190"> feature in the Power Platform that allows us to manage the dependencies and behaviors of components within solutions. </st><st c="6309">When we import a solution into an environment, the components within the solution are organized into layers based on their dependencies. </st><st c="6446">Each layer represents a specific solution that has extended or changed the behavior of a component. </st><st c="6546">Solution layers allow us to control how different solutions interact with each other and how changes to one solution can affect other solutions. </st><st c="6691">This is particularly useful when we have multiple solutions that modify the same component, as it allows us to manage conflicts and ensure that the behavior of the component is consistent across all solutions. </st><st c="6901">The following figure shows how solution layering works </st><span class="No-Break"><st c="6956">in practice:</st></span></p>
			<div>
				<div id="_idContainer040" class="IMG---Figure">
					<img src="image/B22208_04_1.jpg" alt="Figure 4.1 – Solution layers"/><st c="6968"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="7171">Figure 4.1 – Solution layers</st></p>
			<p><st c="7199">On top of the </st><strong class="bold"><st c="7214">System Solution</st></strong><st c="7229"> and the </st><strong class="bold"><st c="7238">System Layer</st></strong><st c="7250">, every </st><a id="_idIndexMarker391"/><st c="7258">managed solution creates its</st><a id="_idIndexMarker392"/><st c="7286"> own managed solution layer. </st><st c="7315">If multiple solutions change the same underlying component (asset), then the last customization wins (</st><em class="italic"><st c="7417">last one wins</st></em><st c="7431">). </st><st c="7435">To avoid merge conflicts with other solutions, the best practice is using unique asset names, such as unique form and view names on common Dataverse tables. </st><st c="7592">Since the automated deployment pipelines run in the background, we need to be aware of such conflicting </st><span class="No-Break"><st c="7696">situations too.</st></span></p>
			<p><st c="7711">In order to support modern ALM and DevOps processes, in addition to having immutable binaries (solutions), we also </st><a id="_idIndexMarker393"/><st c="7827">need version numbers. </st><strong class="bold"><st c="7849">Version numbers</st></strong><st c="7864"> help developers and ops teams identify the software running in the production environment. </st><st c="7956">Power Platform solutions provide versioning features as well, which we will discuss in the </st><span class="No-Break"><st c="8047">next section.</st></span></p>
			<h1 id="_idParaDest-76"><a id="_idTextAnchor078"/><st c="8060">Versioning of solutions and packages</st></h1>
			<p><st c="8097">Every</st><a id="_idIndexMarker394"/><st c="8103"> solution has a version number that follows this </st><span class="No-Break"><st c="8152">well-known </st></span><span class="No-Break"><a id="_idIndexMarker395"/></span><span class="No-Break"><st c="8163">pattern:</st></span></p>
			<pre class="source-code"><st c="8171">
Major.Minor.Build.Revision</st></pre>			<p><st c="8198">Each part of the version number has a </st><span class="No-Break"><st c="8237">specific meaning:</st></span></p>
			<ul>
				<li><strong class="source-inline"><st c="8254">Major</st></strong><st c="8260">: This number is incremented when there are significant changes to the software, such as the addition of new features or changes that are not </st><span class="No-Break"><st c="8403">backward compatible</st></span></li>
				<li><strong class="source-inline"><st c="8422">Minor</st></strong><st c="8428">: This number is incremented when there are minor changes to the software, such as the addition of new functionalities or improvements to existing features that are </st><span class="No-Break"><st c="8594">backward compatible</st></span></li>
				<li><strong class="source-inline"><st c="8613">Build</st></strong><st c="8619">: This number is incremented when there are changes to the software that do not affect its functionality, such as bug fixes or </st><span class="No-Break"><st c="8747">performance improvements</st></span></li>
				<li><strong class="source-inline"><st c="8771">Revision</st></strong><st c="8780">: This number is incremented when there are small changes to the software, such as hotfixes or </st><span class="No-Break"><st c="8876">security updates</st></span></li>
			</ul>
			<p><st c="8892">The life cycle of a Power Platform solution involves several stages, including creating, updating, upgrading, patching, and staging for upgrade. </st><st c="9038">Here is an overview of when to apply each of </st><span class="No-Break"><st c="9083">these actions:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="9097">Update</st></strong><st c="9104">: This</st><a id="_idIndexMarker396"/><st c="9111"> option substitutes our solution with th</st><a id="_idTextAnchor079"/><st c="9151">e new version. </st><st c="9167">The assets that are not part of the newer version will not be erased and will be still available in the environment. </st><st c="9284">This option has the best performance by typically finishing in less time than the upgrade methods. </st><st c="9383">We can create updates to a managed solution that are deployed to the parent-managed solution, that is, under that solution. </st><st c="9507">We cannot delete components with </st><span class="No-Break"><st c="9540">an update.</st></span></li>
				<li><strong class="bold"><st c="9550">Upgrade</st></strong><st c="9558">: Upgrades </st><a id="_idIndexMarker397"/><st c="9570">combine all patches into a new version of the solution. </st><st c="9626">During the upgrade process, any components that are no longer included in the new version will be removed. </st><st c="9733">The upgrade can be done immediately </st><span class="No-Break"><st c="9769">or staged.</st></span></li>
				<li><strong class="bold"><st c="9779">Staging for upgrades</st></strong><st c="9800">: This</st><a id="_idIndexMarker398"/><st c="9807"> is used to prepare the target environment before deploying the solution. </st><st c="9881">Staging for an upgrade does not delete the previous version of the solution; the old and new versions are installed side-by-side. </st><st c="10011">We can use this scenario if we need to do some data migration before we complete the </st><span class="No-Break"><st c="10096">solution upgrade.</st></span></li>
				<li><strong class="bold"><st c="10113">Patch</st></strong><st c="10119">: A patch</st><a id="_idIndexMarker399"/><st c="10129"> includes only the modifications made to a parent-managed solution, such as adding or modifying components and assets. </st><st c="10248">Patches are useful for making minor updates like hotfixes are. </st><st c="10311">When a patch is imported, it is applied on top of the parent solution. </st><st c="10382">It is not possible to delete components using </st><span class="No-Break"><st c="10428">a patch.</st></span></li>
			</ul>
			<p><st c="10436">The following figure shows the life cycle of Power Platform solutions, highlighting the main stages of </st><span class="No-Break"><st c="10540">an application:</st></span></p>
			<div>
				<div id="_idContainer041" class="IMG---Figure">
					<img src="image/B22208_04_2.jpg" alt="Figure 4.2 – A solution’s life cycle"/><st c="10555"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="10650">Figure 4.2 – A solution’s life cycle</st></p>
			<p><st c="10686">Every solution</st><a id="_idIndexMarker400"/><st c="10701"> starts its life cycle in the </st><strong class="bold"><st c="10731">create</st></strong><st c="10737"> stage. </st><st c="10745">During the </st><strong class="bold"><st c="10756">development and releases</st></strong><st c="10780"> phase, multiple updates, upgrades, and patches are delivered in the form of managed solutions. </st><st c="10876">At the end of the application’s life cycle, the managed solution is deleted, which removes every customized object from </st><span class="No-Break"><st c="10996">the Dataverse.</st></span></p>
			<p><st c="11010">In the case of managed solutions, the </st><strong class="source-inline"><st c="11049">upgrade</st></strong><st c="11056"> action is the default option among the </st><strong class="source-inline"><st c="11096">update</st></strong><st c="11102">, </st><strong class="source-inline"><st c="11104">upgrade</st></strong><st c="11111">, </st><strong class="source-inline"><st c="11113">stage for upgrade</st></strong><st c="11130">, and </st><strong class="source-inline"><st c="11136">patch</st></strong><st c="11141"> actions, whereas unmanaged solutions can be </st><span class="No-Break"><st c="11186">only updated.</st></span></p>
			<p><st c="11199">Power Platform solution patches are a way to update only the components of a solution that have changed instead of deploying the whole solution again. </st><st c="11351">They are useful for reducing deployment time and avoiding conflicts with other solutions. </st><st c="11441">Patches contain only the changes for a parent-managed solution, such as adding or editing components and assets. </st><st c="11554">Typical examples of using patches include adding a new button on a canvas app or extending the column definition of a custom or system table. </st><st c="11696">Patches get version number incremented by </st><strong class="source-inline"><st c="11738">1</st></strong><st c="11739"> in the </st><span class="No-Break"><strong class="source-inline"><st c="11747">build</st></strong></span><span class="No-Break"><st c="11752"> number:</st></span></p>
			<pre class="source-code"><st c="11760">
{major}.{minor}.{build+1}.{version}</st></pre>			<p><st c="11796">Only unmanaged solutions can have one or more patches that we can export as managed patches to deploy them to other environments. </st><st c="11927">The solution to which the patch has been created is locked until the patches are merged and a new version of the solution is cloned. </st><st c="12060">This version will get the </st><strong class="source-inline"><st c="12086">{major}.{minor+1}.{build}.{version}</st></strong><st c="12121"> version number as we can see in the </st><span class="No-Break"><st c="12158">following figure:</st></span></p>
			<div>
				<div id="_idContainer042" class="IMG---Figure">
					<img src="image/B22208_04_3.jpg" alt="Figure 4.3 – Patches and versions"/><st c="12175"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="12247">Figure 4.3 – Patches and versions</st></p>
			<p><st c="12280">The parent</st><a id="_idIndexMarker401"/><st c="12291"> solution is the unmanaged solution with version 1.2.0.0. </st><st c="12349">The patches get the incremented version numbers 1.2.1.0 and 1.2.2.0, respectively. </st><st c="12432">After rolling up the patches, the new version of the unmanaged solution will </st><span class="No-Break"><st c="12509">be 1.3.0.0.</st></span></p>
			<p><st c="12520">We recommend using patches very rarely because sooner or later, we will need to roll up the patches together and release a </st><span class="No-Break"><st c="12644">solution update.</st></span></p>
			<p><st c="12660">If our solution contains too many customizations, then we might encounter timeouts during the synchronous import. </st><strong class="bold"><st c="12775">Solution staging</st></strong><st c="12791"> breaks</st><a id="_idIndexMarker402"/><st c="12798"> the import process into more controllable phases and executes those steps asynchronously. </st><st c="12889">This option is available in the Dataverse SDK for .NET, through Web API, in the build tools of Azure DevOps and GitHub, and in the </st><span class="No-Break"><st c="13020">PAC CLI.</st></span></p>
			<p><st c="13028">There are two advanced pro-dev tools we can use to customize the solution import and export process </st><span class="No-Break"><st c="13129">in depth:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="13138">The SolutionPackager tool</st></strong><st c="13164"> unpacks </st><a id="_idIndexMarker403"/><st c="13173">a managed solution file into multiple files, including XML files, for easy management by a source control system. </st><st c="13287">The tool decompresses the solution file into individual files for each asset, allowing changes to be tracked in version control systems. </st><st c="13424">The tool can also repackage individual files from source control into a managed solution file for deployment to other environments. </st><st c="13556">PAC CLI uses </st><strong class="source-inline"><st c="13569">SolutionPackager</st></strong><st c="13585"> under the hood to unpack a solution ZIP file to a solution folder, or to pack a solution folder to a solution ZIP file. </st><st c="13706">We can also configure </st><a id="_idIndexMarker404"/><st c="13728">whether the resulting ZIP file should be a managed or </st><span class="No-Break"><st c="13782">unmanaged solution.</st></span></li>
				<li><strong class="bold"><st c="13801">The Package Deployer tool</st></strong><st c="13827"> is a</st><a id="_idIndexMarker405"/><st c="13832"> powerful tool in the Power Platform that allows administrators to deploy packages on Microsoft Dataverse instances. </st><st c="13949">A Package Deployer package can contain any or all of </st><span class="No-Break"><st c="14002">the following:</st></span><ul><li><st c="14016">One or more Dataverse </st><span class="No-Break"><st c="14039">solution files</st></span></li><li><st c="14053">Plain text files or exported configuration data files from the Configuration </st><span class="No-Break"><st c="14131">Migration tool</st></span></li></ul></li>
			</ul>
			<p><st c="14145">Package Deployer is a great tool to deploy multiple solutions as one monolith package to our Power Platform environments. </st><st c="14268">All we need is to create an MSBuild project file in Visual Studio 2019 or later, or with Visual Studio Code. </st><st c="14377">We can then add the solutions, additional configuration files, HTML content, and even custom code to this MSBuild project. </st><st c="14500">After building the package, administrators can install it in the target environment. </st><st c="14585">Our custom code is executed during the import process and the HTML content is displayed for admins to get to know what exactly our package does. </st><st c="14730">The Enterprise templates that we learned about in </st><a href="B22208_02.xhtml#_idTextAnchor030"><span class="No-Break"><em class="italic"><st c="14780">Chapter 2</st></em></span></a><st c="14789"> have been created in this </st><span class="No-Break"><st c="14816">way too.</st></span></p>
			<p><st c="14824">Now that we have learned the solution concept of Power Platform, let’s move on to Dataverse, in which these solutions (among others) </st><span class="No-Break"><st c="14958">are stored.</st></span></p>
			<h1 id="_idParaDest-77"><a id="_idTextAnchor080"/><st c="14969">What about data – Dataverse and data modeling aspects</st></h1>
			<p><st c="15023">We all know that applications don’t work without data. </st><st c="15079">Either they use the data to change their</st><a id="_idIndexMarker406"/><st c="15119"> own behavior (as for applications run on data), or they manipulate it with the well-known </st><strong class="bold"><st c="15210">Create-Read-Update-Delete</st></strong><st c="15235"> (</st><span class="No-Break"><strong class="bold"><st c="15237">CRUD</st></strong></span><span class="No-Break"><st c="15241">) operations.</st></span></p>
			<p><st c="15255">Microsoft Dataverse is a</st><a id="_idIndexMarker407"/><st c="15280"> cloud-based data platform, a powerful database layer, the first party storage service of Microsoft Power Platform that stores not just relational data in SQL-like tables but also files, logs, and NoSQL IoT data. </st><st c="15493">Under the hood, Dataverse seamlessly uses many Azure services, behaving </st><a id="_idIndexMarker408"/><st c="15565">as a </st><strong class="bold"><st c="15570">polyglot persistence layer</st></strong><st c="15596">. The following figure shows the</st><a id="_idIndexMarker409"/><st c="15628"> high-level architecture of Dataverse and the Microsoft Azure </st><span class="No-Break"><st c="15690">services used:</st></span></p>
			<div>
				<div id="_idContainer043" class="IMG---Figure">
					<img src="image/B22208_04_4.jpg" alt="Figure 4.4 – The Dataverse polyglot concept under the hood"/><st c="15704"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="15928">Figure 4.4 – The Dataverse polyglot concept under the hood</st></p>
			<p><st c="15986">As we can see in the</st><a id="_idIndexMarker410"/><st c="16007"> figure, an Azure Load Balancer scales requests across several </st><span class="No-Break"><st c="16070">compute services:</st></span></p>
			<ul>
				<li><st c="16087">Web for handling </st><strong class="bold"><st c="16105">OData </st></strong><span class="No-Break"><strong class="bold"><st c="16111">API</st></strong></span><span class="No-Break"><st c="16114"> requests</st></span></li>
				<li><strong class="bold"><st c="16123">Azure Jobs</st></strong><st c="16134"> for handling </st><span class="No-Break"><st c="16148">asynchronous processing</st></span></li>
				<li><st c="16171">Sandbox for running customer C# code that is executed within the </st><span class="No-Break"><st c="16237">processing pipeline</st></span></li>
				<li><st c="16256">Reporting servers that handle </st><span class="No-Break"><st c="16287">paginated reports</st></span></li>
			</ul>
			<p><st c="16304">A variety of storage services are used to persist our data in the most proficient and performant way possible. </st><st c="16416">Relational data</st><a id="_idIndexMarker411"/><st c="16431"> is stored in </st><strong class="bold"><st c="16445">Azure SQL Managed Instance</st></strong><st c="16471">, files and attachments are written to </st><strong class="bold"><st c="16510">Azure Blob storage</st></strong><st c="16528">, and analytical</st><a id="_idIndexMarker412"/><st c="16544"> data produced by DataFlows is stored </st><a id="_idIndexMarker413"/><st c="16582">in </st><strong class="bold"><st c="16585">Azure Data Lake Storage</st></strong><st c="16608">. We have </st><strong class="bold"><st c="16618">Elastic Tables</st></strong><st c="16632"> as</st><a id="_idIndexMarker414"/><st c="16635"> well, a new concept to store </st><strong class="bold"><st c="16665">Internet of Things</st></strong><st c="16683"> (</st><strong class="bold"><st c="16685">IoT</st></strong><st c="16688">) data </st><a id="_idIndexMarker415"/><st c="16696">with tens of millions of records </st><a id="_idIndexMarker416"/><st c="16729">powered by </st><strong class="bold"><st c="16740">Azure </st></strong><span class="No-Break"><strong class="bold"><st c="16746">Cosmos DB</st></strong></span><span class="No-Break"><st c="16755">.</st></span></p>
			<p><st c="16756">Dataverse manages </st><a id="_idIndexMarker417"/><st c="16775">all these Azure data services, providing 99.9% availability, enterprise scalability, backups, audit logs, and disaster-recovery management out of the box. </st><st c="16930">Dataverse is also the main data storage solution behind the Dynamics 365 </st><span class="No-Break"><st c="17003">product family.</st></span></p>
			<p><st c="17018">One of the key differentiators of the database service is the built-in security solution with a strict role-based access model, as well as row-level and column-level security configurations. </st><st c="17210">Dataverse security is based on a role-based security model that protects data integrity and privacy while supporting efficient data access and collaboration. </st><st c="17368">Users who can access Dataverse are Microsoft Entra ID accounts, that is, Azure AD users. </st><st c="17457">Each user can be assigned to a set of pre-defined security roles that determine the types of records a user can access, the scope of data that users can manage, and the specific tasks that they can perform. </st><st c="17664">This model is called row-level security and provides users with access to only the appropriate level of information that is required to do their jobs. </st><st c="17815">For instance, users can view and edit the records they have created. </st><st c="17884">Their supervisors can view and edit every record their directs have created. </st><st c="17961">Common </st><strong class="bold"><st c="17968">security roles</st></strong><st c="17982"> are </st><span class="No-Break"><st c="17987">as follows:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="17998">System Administrator</st></strong><st c="18019">: This</st><a id="_idIndexMarker418"/><st c="18026"> role has access to all data and can perform all tasks, including customizing </st><span class="No-Break"><st c="18104">the system</st></span></li>
				<li><strong class="bold"><st c="18114">System Customizer</st></strong><st c="18132">: This </st><a id="_idIndexMarker419"/><st c="18140">role can customize the system but does not have access to </st><span class="No-Break"><st c="18198">all data</st></span></li>
				<li><strong class="bold"><st c="18206">Environment Admin</st></strong><st c="18224">: This </st><a id="_idIndexMarker420"/><st c="18232">role has access to all resources in the environment </st><span class="No-Break"><st c="18284">including Dataverse</st></span></li>
				<li><strong class="bold"><st c="18303">Environment Maker</st></strong><st c="18321">: This</st><a id="_idIndexMarker421"/><st c="18328"> role can create new environment resources, such as apps, flows, and APIs, but cannot access data in the </st><span class="No-Break"><st c="18433">environment (Dataverse)</st></span></li>
				<li><strong class="bold"><st c="18456">Basic User</st></strong><st c="18467">: This </st><a id="_idIndexMarker422"/><st c="18475">role has limited access to data and can perform </st><span class="No-Break"><st c="18523">basic tasks</st></span></li>
			</ul>
			<p><st c="18534">Dataverse also</st><a id="_idIndexMarker423"/><st c="18549"> provides </st><strong class="bold"><st c="18559">field-level security</st></strong><st c="18579">, which allows us to secure the data stored in individual columns. </st><st c="18646">This means that we can restrict access to specific data within a record based on the user’s security role. </st><st c="18753">For instance, managers can see employee records, but HR can also see the </st><strong class="source-inline"><st c="18826">salary</st></strong><st c="18832"> column within </st><span class="No-Break"><st c="18847">those records.</st></span></p>
			<p><st c="18861">In addition, Dataverse</st><a id="_idIndexMarker424"/><st c="18884"> provides </st><strong class="bold"><st c="18894">Data Loss Prevention</st></strong><st c="18914"> (</st><strong class="bold"><st c="18916">DLP</st></strong><st c="18919">) capabilities to enforce policies across connectors. </st><st c="18974">Policies can be defined at the tenant or environment level. </st><st c="19034">We will see later that every environment can have one or zero Dataverse created. </st><st c="19115">Environment-level policies are applied at the environment level and only at that level, whereas tenant-level policies are applied to the entire tenant and have precedence over environment-level ones. </st><st c="19315">The management and governance of DLP involves incident alerts and reports that provide administrators with detailed information on policy matches, enabling them to monitor and protect sensitive data effectively. </st><st c="19527">These reports help administrators understand the number of DLP policy and rule matches over time, filter those matches by action and location, and determine whether rule matches are trending up </st><span class="No-Break"><st c="19721">or down.</st></span></p>
			<p><st c="19729">The </st><strong class="bold"><st c="19734">zero trust security principle</st></strong><st c="19763"> is </st><a id="_idIndexMarker425"/><st c="19767">based </st><a id="_idIndexMarker426"/><st c="19773">on the idea that trust is a vulnerability, and that security must be designed with the strategy of </st><em class="italic"><st c="19872">never trust, always verify</st></em><st c="19898">. This means that instead of assuming that everything behind the corporate firewall is safe, the zero trust model assumes a breach and verifies each request as though it originates from an uncontrolled network. </st><st c="20109">In the context of Dataverse and Power Platform, the zero trust security principle can be applied by using role-based access control, field-level security, and DLP capabilities to enforce policies and protect data. </st><st c="20323">By implementing</st><a id="_idIndexMarker427"/><st c="20338"> the </st><strong class="bold"><st c="20343">least privileged strategy</st></strong><st c="20368"> when designing security roles, we can ensure that users only have access to the resources they need to do their jobs. </st><st c="20487">Additionally, we can use Microsoft Entra ID to manage user identities</st><a id="_idIndexMarker428"/><st c="20556"> and access and implement </st><strong class="bold"><st c="20582">Just-in-Time</st></strong><st c="20594"> (</st><strong class="bold"><st c="20596">JIT</st></strong><st c="20599">) and </st><strong class="bold"><st c="20606">Just-Enough-Access</st></strong><st c="20624"> (</st><strong class="bold"><st c="20626">JEA</st></strong><st c="20629">) policies to ensure that users only have access</st><a id="_idIndexMarker429"/><st c="20678"> to what they need when they need it. </st><st c="20716">By following the zero trust security principle, we can minimize the risk of data breaches and protect our organization’s data while still enabling efficient data access </st><span class="No-Break"><st c="20885">and collaboration.</st></span></p>
			<p><st c="20903">In addition to these comprehensive features, Dataverse</st><a id="_idIndexMarker430"/><st c="20958"> has a common database schema. </st><st c="20989">The </st><strong class="bold"><st c="20993">Common Data Model</st></strong><st c="21010"> (</st><strong class="bold"><st c="21012">CDM</st></strong><st c="21015">) is a</st><a id="_idIndexMarker431"/><st c="21022"> shared, standardized collection of data schemas published by Microsoft and its partners to the open source community on GitHub. </st><st c="21151">It unifies data into a known form and applies structural and semantic consistency across multiple apps and deployments, making data management and app development simpler. </st><st c="21323">The CDM is influenced by data schemas found in Dynamics 365 and covers a wide range of business areas. </st><st c="21426">It brings, among others, common data table definitions such as </st><strong class="bold"><st c="21489">Account</st></strong><st c="21496">, </st><strong class="bold"><st c="21498">Customer</st></strong><st c="21506">, </st><strong class="bold"><st c="21508">Product</st></strong><st c="21515">, </st><strong class="bold"><st c="21517">Opportunity</st></strong><st c="21528">, </st><strong class="bold"><st c="21530">Sale</st></strong><st c="21534">, </st><strong class="bold"><st c="21536">Purchase Order</st></strong><st c="21550">, and many more to Dataverse. </st><st c="21580">The CDM definitions are open and available to any service or application that wants to use them. </st><st c="21677">By using the CDM, we can easily integrate with Dataverse and other services, and we can build custom applications that use the entity definitions available to us. </st><st c="21840">This can save us time and effort, as we don’t have to build a new data model </st><span class="No-Break"><st c="21917">from scratch.</st></span></p>
			<p><st c="21930">Dataverse schema definitions, such as </st><strong class="bold"><st c="21969">Tables</st></strong><st c="21975">, </st><strong class="bold"><st c="21977">Columns</st></strong><st c="21984">, </st><strong class="bold"><st c="21986">Relationships</st></strong><st c="21999">, </st><strong class="bold"><st c="22001">Business rules</st></strong><st c="22015">, </st><strong class="bold"><st c="22017">Views</st></strong><st c="22022">, </st><strong class="bold"><st c="22024">Forms</st></strong><st c="22029">, </st><strong class="bold"><st c="22031">Dashboards</st></strong><st c="22041">, </st><strong class="bold"><st c="22043">Charts</st></strong><st c="22049">, </st><strong class="bold"><st c="22051">Messages</st></strong><st c="22059">, </st><strong class="bold"><st c="22061">Keys</st></strong><st c="22065">, and </st><strong class="bold"><st c="22071">Commands</st></strong><st c="22079">, are part of the solution definition, which means that database-level changes are one of the assets that developers can include in their solutions. </st><st c="22228">On the other hand, solutions are themselves stored in Dataverse. </st><st c="22293">When we import a solution into Dataverse, its metadata and dependency configurations are imported into various system tables, such as </st><strong class="bold"><st c="22427">Solution</st></strong><st c="22435">, </st><strong class="bold"><st c="22437">Solution Component Attribute Configuration</st></strong><st c="22479">, </st><strong class="bold"><st c="22481">Solution History</st></strong><st c="22497">, </st><strong class="bold"><st c="22499">Solution Component History</st></strong><st c="22525">, and so on. </st><st c="22538">After the metadata import, the underlying system flows install the solution and apply </st><span class="No-Break"><st c="22624">the changes.</st></span></p>
			<p class="callout-heading"><st c="22636">Data in Dataverse and Solution</st></p>
			<p class="callout"><st c="22667">To add data to a Dataverse table in a Power Platform solution, we can use the </st><strong class="bold"><st c="22746">Import data</st></strong><st c="22757"> option in the top command bar of the </st><strong class="bold"><st c="22795">Tables</st></strong><st c="22801"> page in Power Apps. </st><st c="22822">There is (intentionally) no way to include data in a Power Platform solution. </st><st c="22900">However, we can export the data and then import it into the new environment. </st><st c="22977">Alternatively, we can copy our entire development environment in the Power Platform admin center, if there is nothing currently in production. </st><st c="23120">Tools, such as Configuration Migration tool, Package Deployer, Power Platform DataFlow or writing code in Dataverse SDK for .NET to create entities in the target environment are the recommended tools and approaches to import data </st><span class="No-Break"><st c="23350">into environments.</st></span></p>
			<p><st c="23368">Dataverse </st><a id="_idIndexMarker432"/><st c="23379">instances live in environments, an additional concept to organize our applications and solutions tenant-wide. </st><st c="23489">In the next section, we will learn how to consider these environments from </st><span class="No-Break"><st c="23564">pro-dev perspectives.</st></span></p>
			<h1 id="_idParaDest-78"><a id="_idTextAnchor081"/><st c="23585">Environments, managed environments, and environment strategy</st></h1>
			<p><st c="23646">Environments </st><a id="_idIndexMarker433"/><st c="23660">are containers of our apps, flows, connections, and other components along with security and data access management capabilities. </st><st c="23790">To draw an analogy from the cloud world, we can look at environments such as Microsoft Azure subscriptions, which act as logical containers capable of hosting one or more applications. </st><st c="23975">Perhaps the term </st><em class="italic"><st c="23992">workload</st></em><st c="24000"> is more appropriate here, as our Power Platform applications can include Power Apps, Flows, custom Copilots, Power Pages websites, and more. </st><st c="24142">It is highly recommended to use solutions to deploy workloads </st><span class="No-Break"><st c="24204">to environments.</st></span></p>
			<p><st c="24220">Microsoft Power Platform tenants can have thousands of environments. </st><st c="24290">Microsoft Entra ID is the glue that provides security controls, governance, and guardrails that surround every product in Power Platform. </st><st c="24428">As mentioned earlier, Power Platform runs on top of Microsoft Azure. </st><st c="24497">Environments are the key concept for isolation and to define system boundaries in different geolocations. </st><st c="24603">We can create environments without Dataverse, but those environments provide only very </st><span class="No-Break"><st c="24690">limited capabilities.</st></span></p>
			<p class="callout-heading"><st c="24711">Environments without Dataverse</st></p>
			<p class="callout"><st c="24742">Environments without Dataverse only support Power Apps canvas-apps and Power Automate </st><span class="No-Break"><st c="24829">Cloud Flows.</st></span></p>
			<p><st c="24841">If we create environments with Dataverse, we get the whole spectrum of Power Platform security</st><a id="_idIndexMarker434"/><st c="24936"> features as well. </st><st c="24955">It means we can assign role-based security roles to different hierarchical levels inside the environment to </st><span class="No-Break"><st c="25063">segment security.</st></span></p>
			<p><st c="25080">In the Power Platform, a </st><strong class="bold"><st c="25106">business unit</st></strong><st c="25119"> represents </st><a id="_idIndexMarker435"/><st c="25131">a unit of an organization that performs one or more business functions that can be rolled up in a management hierarchy. </st><st c="25251">Business units can be used to mirror the organizational structure of a company and to control data access. </st><st c="25358">Each business unit has its own set of security roles that define the access rights of users within the business unit. </st><st c="25476">There are built-in security roles, such as Basic User, System Administrator, and so on, and we can also create our own security roles. </st><st c="25611">For instance, if we introduce a custom table that stores records for reviewing, we can create a custom security role (such as Reviewer) that allows its members to read every record from the custom table whereas, others can only see their own records. </st><em class="italic"><st c="25862">We can add these Security roles to </st></em><span class="No-Break"><em class="italic"><st c="25897">solutions too</st></em></span><span class="No-Break"><st c="25910">.</st></span></p>
			<p><strong class="bold"><st c="25911">Teams</st></strong><st c="25917"> are </st><a id="_idIndexMarker436"/><st c="25922">groups of users who work together and share a common set of access rights. </st><st c="25997">There are two types of teams in the Power Platform: </st><strong class="bold"><st c="26049">Owner Teams </st></strong><st c="26061">and </st><strong class="bold"><st c="26065">Access Teams</st></strong><st c="26077">. Owner Teams</st><a id="_idIndexMarker437"/><st c="26090"> own records and have security roles assigned to them, while</st><a id="_idIndexMarker438"/><st c="26150"> Access Teams are used to grant access to records without owning them. </st><st c="26221">A team can consist of users from one or multiple business units within the same organization (under the environment). </st><st c="26339">A user can be assigned to one or </st><span class="No-Break"><st c="26372">more teams.</st></span></p>
			<p><st c="26383">The relationship between business units, teams, and users is important for controlling data access and ensuring that users have the appropriate level of access to records. </st><st c="26556">By setting up business units and teams correctly, administrators can ensure that users can collaborate and share information effectively while maintaining </st><span class="No-Break"><st c="26711">data security.</st></span></p>
			<p class="callout-heading"><st c="26725">Microsoft Entra ID and Power Platform environments</st></p>
			<p class="callout"><st c="26776">Due to the connection</st><a id="_idIndexMarker439"/><st c="26798"> between Microsoft Entra ID and Power Platform, it is common practice to use Microsoft Entra ID groups to grant access to Power Platform environments and the business units and teams within </st><span class="No-Break"><st c="26988">those environments.</st></span></p>
			<p><st c="27007">There are different types </st><span class="No-Break"><st c="27034">of environments:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="27050">Production</st></strong><st c="27061">: This is the</st><a id="_idIndexMarker440"/><st c="27075"> default environment type for creating and running apps, flows, and other resources. </st><st c="27160">It has full functionality and can be connected to any data source. </st><st c="27227">Only the production environments are backed by SLAs, and all production data is backed up to the paired or secondary Azure region (geo-replication </st><span class="No-Break"><st c="27374">is enabled).</st></span></li>
				<li><strong class="bold"><st c="27386">Trial</st></strong><st c="27392">: This is a </st><a id="_idIndexMarker441"/><st c="27405">temporary environment that can be used for testing or learning purposes. </st><st c="27478">It has the same functionality as a production environment, but it expires after 30 days and cannot be extended </st><span class="No-Break"><st c="27589">or converted.</st></span></li>
				<li><strong class="bold"><st c="27602">Sandbox</st></strong><st c="27610">: This is </st><a id="_idIndexMarker442"/><st c="27621">an isolated environment that can be used for development, testing, or training purposes. </st><st c="27710">It has limited functionality and cannot be connected to production data sources. </st><st c="27791">It can be reset, copied, or converted back to production </st><span class="No-Break"><st c="27848">as needed.</st></span></li>
				<li><strong class="bold"><st c="27858">Developer</st></strong><st c="27868">: This is a</st><a id="_idIndexMarker443"/><st c="27880"> special environment type that can be used by individual developers to create and test apps, flows, and other resources. </st><st c="28001">It has the same functionality as a sandbox environment, but it has a lower capacity and can only be used by one user. </st><st c="28119">Developer environments require no licenses and a developer can have up to three different developer environments. </st><st c="28233">Administrators can allow or deny the creation of developer environments depending on the </st><span class="No-Break"><st c="28322">organization’s needs.</st></span></li>
			</ul>
			<p><st c="28343">Environments are tied </st><a id="_idIndexMarker444"/><st c="28366">to a </st><strong class="bold"><st c="28371">geographic location</st></strong><st c="28390"> that cannot be changed after environment creation. </st><st c="28442">Microsoft Power Platform guarantees that the data is held in the selected region (data residency) and the data will never be transferred to </st><span class="No-Break"><st c="28582">other locations.</st></span></p>
			<p><st c="28598">Environments are also used to </st><a id="_idIndexMarker445"/><st c="28629">allocate </st><strong class="bold"><st c="28638">capacity add-ons</st></strong><st c="28654"> that we can purchase in addition to our Power Platform enrollment. </st><st c="28722">Capacity add-ons are, among other things, Microsoft Copilot Studio messages, Power Pages capacity tiers, AI Builder credits, Power Automate hosted RPAs, Power Automate processes or Process Mining capacity add-ons. </st><st c="28936">We can assign some or all these capacities to different environments in the Power Platform </st><span class="No-Break"><st c="29027">admin center.</st></span></p>
			<p><st c="29040">Finally, environments can be tied to Microsoft Azure subscriptions. </st><st c="29109">The </st><strong class="bold"><st c="29113">Pay-as-You-Go</st></strong><st c="29126"> (</st><strong class="bold"><st c="29128">PAYGO</st></strong><st c="29133">) services</st><a id="_idIndexMarker446"/><st c="29144"> of Power Platform, such as Power Apps per app meter, Power Pages Authenticated users meter, Power Pages Anonymous users meter, Dataverse Database capacity meter, Dataverse File capacity meter and Dataverse Log capacity meter, are cross-charged to existing Microsoft </st><span class="No-Break"><st c="29411">Azure subscriptions.</st></span></p>
			<p><st c="29431">There is an even more controlled environment that we recommend using in production. </st><st c="29516">Let’s learn about </st><span class="No-Break"><strong class="bold"><st c="29534">Managed Environments</st></strong></span><span class="No-Break"><st c="29554">.</st></span></p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor082"/><st c="29555">Managed Environments</st></h2>
			<p><st c="29576">Managed Environments </st><a id="_idIndexMarker447"/><st c="29598">is a suite of features that helps admins manage Power Platform at scale. </st><st c="29671">It provides several benefits including risk assessment and threat alerts with Microsoft Defender, richer analytics with multi-year history, compliance reports, and recommendations. </st><st c="29852">It also lets you audit user behavior. </st><st c="29890">It also offers more control by tailoring permissions, policies, and automations to our organization’s needs, or simply activating the best out-of-the-box practice settings with a single click. </st><st c="30083">The following list goes through</st><a id="_idIndexMarker448"/><st c="30114"> these features </st><span class="No-Break"><st c="30130">in detail:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="30140">Limit sharing</st></strong><st c="30154"> allows admins to control the sharing of data and resources within their organization. </st><st c="30241">Admins can block sharing with security groups and limit the number of individuals that can be </st><span class="No-Break"><st c="30335">shared with.</st></span></li>
				<li><strong class="bold"><st c="30347">Weekly usage insights</st></strong><st c="30369"> provide analytics about our top apps, our most impactful makers, and inactive resources that we can safely clean up. </st><st c="30487">These insights are delivered to our mailbox once </st><span class="No-Break"><st c="30536">a week.</st></span></li>
				<li><strong class="bold"><st c="30543">Data policies</st></strong><st c="30557">: Data policies in Power Platform allow us to control data flows across data connectors when used within Power Apps and Power Automate. </st><st c="30694">DLP policies enable admins to isolate business data from personal use data within Power Platform by classifying Power Platform connectors across business and non-business groups. </st><st c="30873">We can additionally choose to block certain connectors </st><span class="No-Break"><st c="30928">from use.</st></span></li>
				<li><strong class="bold"><st c="30937">Pipelines in Power Platform</st></strong><st c="30965"> aim to democratize ALM for Power Platform customers. </st><st c="31019">Pipelines provide an easy and approachable method for all makers, admins, and developers to do ALM automation, CI, and CD workflows. </st><st c="31152">We will cover this topic in the </st><span class="No-Break"><st c="31184">next sections.</st></span></li>
				<li><strong class="bold"><st c="31198">Maker welcome content</st></strong><st c="31220"> allows admins to add a welcome message for new makers in their </st><a id="_idIndexMarker449"/><st c="31284">organization. </st><st c="31298">This message can include validated resources, company-specific resources, and links to upcoming internal events to help new makers get started with Power Platform. </st><st c="31462">The welcome content can be added to a Managed Environment and can include plain text </st><span class="No-Break"><st c="31547">or markdown.</st></span></li>
				<li><strong class="bold"><st c="31559">The solution checker</st></strong><st c="31580"> tool allows us to check our solutions for best practices and common issues. </st><st c="31657">It analyzes our code and customizations and provides detailed reports with information on issues and how to fix them. </st><st c="31775">This helps improve the performance, maintainability, and reliability of our solutions in Managed Environments. </st><st c="31886">Admins can enforce the execution of the solution checker </st><span class="No-Break"><st c="31943">during deployments.</st></span></li>
				<li><strong class="bold"><st c="31962">The IP firewall</st></strong><st c="31978"> allows us to restrict access to our data and resources based on the IP addresses of incoming requests. </st><st c="32082">This helps to prevent unauthorized access to our data and resources from outside </st><span class="No-Break"><st c="32163">our organization.</st></span></li>
				<li><strong class="bold"><st c="32180">IP cookie binding</st></strong><st c="32198"> is a security feature that binds a user’s session cookie to their IP address. </st><st c="32277">This helps prevent session hijacking attacks, where an attacker steals a user’s session cookie and uses it to </st><span class="No-Break"><st c="32387">impersonate them.</st></span></li>
				<li><strong class="bold"><st c="32404">A Customer Managed Key</st></strong><st c="32427"> (</st><strong class="bold"><st c="32429">CMK</st></strong><st c="32432">) allows us to use our own encryption keys to encrypt our data at rest. </st><st c="32505">This gives us more control over the security of our data and helps us meet </st><span class="No-Break"><st c="32580">compliance requirements.</st></span></li>
				<li><strong class="bold"><st c="32604">Lockbox</st></strong><st c="32612"> provides an additional layer of security for our data. </st><st c="32668">It allows us to control whether Microsoft support engineers can access our data to resolve support cases. </st><st c="32774">We can approve or deny each access request and all access is logged and audited </st><span class="No-Break"><st c="32854">for compliance.</st></span></li>
				<li><strong class="bold"><st c="32869">Extended backup</st></strong><st c="32885"> allows us to retain backups of our data for a longer period. </st><st c="32947">This can help us recover data in the event of accidental deletion </st><span class="No-Break"><st c="33013">or corruption.</st></span></li>
				<li><strong class="bold"><st c="33027">DLP for desktop flow</st></strong><st c="33048"> is a feature in Power Platform that allows us to apply DLP policies to desktop flows (Robotic Process Automation flows). </st><st c="33170">This helps prevent the accidental or intentional sharing of sensitive data between different systems </st><span class="No-Break"><st c="33271">and applications.</st></span></li>
				<li><strong class="bold"><st c="33288">Exporting data to Azure Application Insights</st></strong><st c="33333"> allows us to send telemetry data from our apps and flows to Azure Application Insights. </st><st c="33422">This allows us to monitor the </st><a id="_idIndexMarker450"/><st c="33452">performance and usage of our apps and flows and to diagnose and </st><span class="No-Break"><st c="33516">troubleshoot issues.</st></span></li>
				<li><strong class="bold"><st c="33536">Catalog in Power Platform</st></strong><st c="33562"> is a central repository for our assets in the organization. </st><st c="33623">It is a private marketplace through which we can share custom connectors, PAC framework controls, Power Automate flows, canvas apps, and model-driven apps, as well as various other templates, with </st><span class="No-Break"><st c="33820">other developers.</st></span></li>
				<li><strong class="bold"><st c="33837">Default environment routing</st></strong><st c="33865"> allows us to control which environment is used as the default for new users in our organization. </st><st c="33963">This helps ensure that new users are automatically added to the appropriate environment for their roles </st><span class="No-Break"><st c="34067">and responsibilities.</st></span></li>
				<li><strong class="bold"><st c="34088">Creating an app description with Copilot</st></strong><st c="34129"> is an AI-powered feature that helps us create app descriptions. </st><st c="34194">It uses natural language processing to understand our requirements and the changes we have made to provide a human-like description (change log) to </st><span class="No-Break"><st c="34342">our application.</st></span></li>
			</ul>
			<p class="callout-heading"><st c="34358">Managed Environments</st></p>
			<p class="callout"><st c="34379">We highly recommend using Managed Environments for production workloads. </st><st c="34453">In general, every environment with environment type </st><strong class="source-inline"><st c="34505">Production</st></strong><st c="34515"> shall be a Managed Environment. </st><st c="34548">Microsoft invests heavily in Managed Environments and more and more features are being released. </st><st c="34645">We can follow the upcoming features in the Release Planner; </st><span class="No-Break"><st c="34705">see </st></span><a href="https://releaseplans.microsoft.com"><span class="No-Break"><st c="34709">https://releaseplans.microsoft.com</st></span></a><span class="No-Break"><st c="34743">.</st></span></p>
			<p><st c="34744">After discussing environments, let’s explore why an </st><strong class="bold"><st c="34797">environment strategy</st></strong><st c="34817"> is essential to maintain and govern tens or hundreds of them at an </st><span class="No-Break"><st c="34885">enterprise level.</st></span></p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor083"/><st c="34902">Environment strategies</st></h2>
			<p><st c="34925">This is one of the</st><a id="_idIndexMarker451"/><st c="34944"> most crucial questions that we need to decide not just on the first enrollment of our Power Platform tenant but also every time we start a new project. </st><st c="35097">The environment strategy defines how environments are created, how many of them we need per workload and project, how we apply the security posture of our organization, how we establish role-based access management, and how environments are related to other products, such as Microsoft Azure subscriptions, Azure DevOps projects or GitHub </st><span class="No-Break"><st c="35436">Enterprise repositories.</st></span></p>
			<p><st c="35460">The following are the most </st><span class="No-Break"><st c="35488">common strategies:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="35506">Ad-hoc</st></strong><st c="35513">: As the </st><a id="_idIndexMarker452"/><st c="35523">name suggests, there is no strategy at all. </st><st c="35567">Environments are created randomly; even the default environment is used to host </st><span class="No-Break"><st c="35647">production workloads.</st></span></li>
				<li><strong class="bold"><st c="35668">Departmental</st></strong><st c="35681">: Every </st><a id="_idIndexMarker453"/><st c="35690">department in the organization has its own environment. </st><st c="35746">HR, finance, sales, operations, and all other departments have dedicated production environments, hosting and executing several solutions within them. </st><st c="35897">These departmental environments can have also dev and test environments that are sometimes shared with more </st><span class="No-Break"><st c="36005">business units.</st></span></li>
				<li><strong class="bold"><st c="36020">Project-based</st></strong><st c="36034">: Large </st><a id="_idIndexMarker454"/><st c="36043">workloads have dedicated developer, test, and production environments. </st><st c="36114">Those projects get dev-test-prod environments, but the smaller solutions still live in </st><span class="No-Break"><st c="36201">departmental environments.</st></span></li>
				<li><strong class="bold"><st c="36227">Multi-tenant</st></strong><st c="36240">: Developers</st><a id="_idIndexMarker455"/><st c="36253"> work in a different tenant to create and develop Power Platform solutions. </st><st c="36329">Advanced automated pipelines and workflows deploy solutions to the test and production environments of the </st><span class="No-Break"><st c="36436">production tenant.</st></span></li>
			</ul>
			<p><st c="36454">The following figure shows the typical environment strategy of a department that combines departmental and project-based strategies based on </st><span class="No-Break"><st c="36596">project needs:</st></span></p>
			<div>
				<div id="_idContainer044" class="IMG---Figure">
					<img src="image/B22208_04_5.jpg" alt="Figure 4.5 – The environment strategy of a business unit"/><st c="36610"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="36656">Figure 4.5 – The environment strategy of a business unit</st></p>
			<p><st c="36712">There are </st><a id="_idIndexMarker456"/><st c="36723">shared dev, shared test, and shared prod environments for the workloads that are shared inside the business unit. </st><st c="36837">Small workloads and/or the widely used applications of the department are hosted here. </st><st c="36924">Complex solutions get their dedicated project-based environments with dev, test, and prod environment types (see </st><em class="italic"><st c="37037">Proj (n) Dev</st></em><st c="37049"> – </st><em class="italic"><st c="37052">Proj (n) Test</st></em><st c="37065"> and </st><em class="italic"><st c="37070">Proj (n) Prod</st></em><st c="37083">, where </st><em class="italic"><st c="37091">n</st></em><st c="37092"> represents the number of </st><span class="No-Break"><st c="37118">unique projects).</st></span></p>
			<p><st c="37135">There are also dedicated environments for training and for power users who experiment with new features of Power Platform. </st><st c="37259">For instance, this is the only environment in which the process mining add-on is already enabled for testing purposes. </st><st c="37378">Personal productivity provides a sandbox environment for business users for their own experimental </st><span class="No-Break"><st c="37477">use cases.</st></span></p>
			<p><st c="37487">It is very important to note that this concept provides isolated environments per business unit, and that it ensures governance, compliance, and security control of those environments within the department. </st><st c="37695">Other business units have no access to these environments </st><span class="No-Break"><st c="37753">at all.</st></span></p>
			<p><st c="37760">To scale out this concept in global organizations with multiple sites across the globe, we recommend applying the </st><span class="No-Break"><st c="37875">following approach:</st></span></p>
			<div>
				<div id="_idContainer045" class="IMG---Figure">
					<img src="image/B22208_04_6.jpg" alt="Figure 4.6 – The environment strategy of a global organization"/><st c="37894"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="38394">Figure 4.6 – The environment strategy of a global organization</st></p>
			<p><st c="38456">Office A/Department A represents</st><a id="_idIndexMarker457"/><st c="38489"> a business unit operating in Region/Country A under one common tenant. </st><st c="38561">Every region and office (business unit or department) has the same structure with shared and dedicated environments for performance (close to the end users) and compliance reasons (data residency requirements). </st><st c="38772">The development of solutions can happen in this tenant, but the concept allows us to use more tenants for development. </st><st c="38891">Automation is unavoidable here. </st><st c="38923">ALM and DevOps tools help us automatically create environments based on project needs and automatically deploy the solutions into different geolocations even from </st><span class="No-Break"><st c="39086">different tenants.</st></span></p>
			<p class="callout-heading"><st c="39104">Power Automate flows</st></p>
			<p class="callout"><st c="39125">Power Automate flows</st><a id="_idIndexMarker458"/><st c="39146"> with the Power Platform for Admins V2 connector provide ALM and DevOps-like capabilities inside the platform. </st><st c="39257">There are activities that we can use to create environments, assign security roles, and set DLP policies. </st><st c="39363">This connector also supports cross-tenant integration, a multi-tenant concept previously described as one of the </st><span class="No-Break"><st c="39476">environment strategies.</st></span></p>
			<p><st c="39499">Environment strategy does not only focus on environments in Power Platform, but it describes the interaction with other surrounding services. </st><st c="39642">It defines whether a new Azure Subscription</st><a id="_idIndexMarker459"/><st c="39685"> or only a Resource Group inside an existing Azure Subscription needs to be created for any new environment or for any new project. </st><st c="39817">It also provides guidelines for ALM processes, such as </st><em class="italic"><st c="39872">Proj (n)</st></em><st c="39880"> shall store its artifacts (managed and unmanaged solutions) in a</st><a id="_idIndexMarker460"/><st c="39945"> new </st><strong class="bold"><st c="39950">Azure DevOps Services</st></strong><st c="39971"> project or in that </st><strong class="bold"><st c="39991">GitHub Enterprise</st></strong><st c="40008"> repository. </st><st c="40021">Last</st><a id="_idIndexMarker461"/><st c="40025"> but not least, the strategy covers security considerations, such as creating Microsoft Entra ID security groups for administrators, makers, developers, and users during environment creation. </st><st c="40217">When we fully</st><a id="_idIndexMarker462"/><st c="40230"> define all these areas surrounding environment strategy, we partially address </st><span class="No-Break"><strong class="bold"><st c="40309">DevSecOps</st></strong></span><span class="No-Break"><st c="40318"> principles.</st></span></p>
			<p><st c="40330">After getting familiar with the concept of environment strategy, let’s delve into our first Power Platform pipeline that can partially manage this approach within </st><span class="No-Break"><st c="40494">a department.</st></span></p>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor084"/><st c="40507">Managed pipelines – Our first CI/CD</st></h1>
			<p><st c="40543">Now we have </st><a id="_idIndexMarker463"/><st c="40556">everything </st><a id="_idIndexMarker464"/><st c="40567">in place to create our first Power Platform CI/CD pipeline with the help of the built-in capabilities of </st><span class="No-Break"><st c="40672">the platform.</st></span></p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor085"/><st c="40685">Power Platform pipelines</st></h2>
			<p><st c="40710">Power Platform pipelines</st><a id="_idIndexMarker465"/><st c="40735"> are CI/CD pipelines managed by the platform. </st><st c="40781">They provide ALM features to build and deploy our solutions in a fully automated way without having deep knowledge of DevOps tools, such as Azure</st><a id="_idIndexMarker466"/><st c="40926"> DevOps Services or GitHub Enterprise. </st><st c="40965">Of course, we can integrate those tools into our managed pipelines to store the managed and unmanaged solutions in Git repositories as well, but it is not mandatory. </st><st c="41131">The idea of the Power Platform pipelines is to democratize the build and release processes and to provide an easy-to-configure and easy-to-use experience for administrators </st><span class="No-Break"><st c="41304">and developers.</st></span></p>
			<p><st c="41319">Platform Pipeline is a Dynamics 365 application that we need to install in one of our environments. </st><st c="41420">For the built-in pipeline management, we only need to have Managed Environments; no Dynamics 365 licenses are required. </st><st c="41540">It is highly recommended to create a dedicated environment for installing this application. </st><st c="41632">This environment is called the </st><strong class="bold"><st c="41663">host environment</st></strong><st c="41679"> because </st><a id="_idIndexMarker467"/><st c="41688">it hosts the pipeline definitions, the pipeline runs with history, security settings, and deployment artifacts with history as the following </st><span class="No-Break"><st c="41829">figure shows:</st></span></p>
			<div>
				<div id="_idContainer046" class="IMG---Figure">
					<img src="image/B22208_04_7.jpg" alt="Figure 4.7 – Environments in Power Platform pipelines"/><st c="41842"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="42083">Figure 4.7 – Environments in Power Platform pipelines</st></p>
			<p><st c="42136">Developer environments</st><a id="_idIndexMarker468"/><st c="42159"> are the environments in which developers or makers create and modify solutions. </st><st c="42240">Test and prod Environments represent</st><a id="_idIndexMarker469"/><st c="42276"> the </st><strong class="bold"><st c="42281">target environments</st></strong><st c="42300"> that get the managed version of the solution deployed by our defined pipelines. </st><st c="42381">Test and prod environments must be Managed Environments, whereas developer environments and the host environment can be normal ones. </st><st c="42514">Every pipeline starts with a developer environment and continues with one or more chained </st><span class="No-Break"><st c="42604">target environments.</st></span></p>
			<p class="callout-heading"><st c="42624">Azure DevOps Services pipelines</st></p>
			<p class="callout"><st c="42656">Power Platform Pipeline Dynamics 365 app </st><a id="_idIndexMarker470"/><st c="42698">uses under-the-hood Azure DevOps Services Pipelines and Azure DevOps Services Deployment Groups in a fully managed way. </st><st c="42818">This is completely hidden from our eyes, and it is offered as a SaaS feature on top of Azure </st><span class="No-Break"><st c="42911">DevOps Services.</st></span></p>
			<p><st c="42927">As one of the premium features of Managed Environments, a Dynamics 365 app called Power Platform Pipelines brings the following Dataverse tables to the </st><span class="No-Break"><st c="43080">host environment:</st></span></p>
			<div>
				<div id="_idContainer047" class="IMG---Figure">
					<img src="image/B22208_04_8.jpg" alt="Figure 4.8 – Power Platform Pipelines’ Dataverse tables in a host environment"/><st c="43097"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="43540">Figure 4.8 – Power Platform Pipelines’ Dataverse tables in a host environment</st></p>
			<p><strong class="bold"><st c="43617">Deployment Artifact</st></strong><st c="43637">, </st><strong class="bold"><st c="43639">Deployment Environment</st></strong><st c="43661">, </st><strong class="bold"><st c="43663">Deployment Pipeline</st></strong><st c="43682">, </st><strong class="bold"><st c="43684">Deployment Stage</st></strong><st c="43700">, </st><strong class="bold"><st c="43702">Deployment Stage Run</st></strong><st c="43722">, and </st><strong class="bold"><st c="43728">Deployment Stage Run Suboperations</st></strong><st c="43762"> are standard Dataverse tables that we can also use to create approval flows based </st><a id="_idIndexMarker471"/><st c="43845">on different trigger conditions. </st><st c="43878">The </st><strong class="bold"><st c="43882">Deployment Artifact</st></strong><st c="43901"> table retrospectively stores the managed and unmanaged solutions that have been created by pipelines. </st><st c="44004">The maximum size of the managed and unmanaged solutions is </st><span class="No-Break"><st c="44063">128 MB.</st></span></p>
			<p><st c="44070">Aside from the tables, the Power Platform Pipeline introduces two additional security roles in the </st><span class="No-Break"><st c="44170">host environment:</st></span></p>
			<ul>
				<li><strong class="bold"><st c="44187">Deployment Pipeline Administrator</st></strong><st c="44221">: Owners of this role can create deployment</st><a id="_idIndexMarker472"/><st c="44265"> configurations in the </st><strong class="bold"><st c="44288">Deployment Pipeline</st></strong><st c="44307"> configuration. </st><st c="44323">It is a model-driven application installed by the Power Platform Pipelines D365 app that helps administrators configure the environments, stages, and pipelines stored in the previously mentioned </st><span class="No-Break"><st c="44518">Dataverse tables.</st></span></li>
				<li><strong class="bold"><st c="44535">Deployment Pipeline User</st></strong><st c="44560">: Owners </st><a id="_idIndexMarker473"/><st c="44570">of this role can use the pipelines created in the Deployment Pipeline Configuration app in the corresponding environments. </st><st c="44693">If this user has access to the environment, and the Pipeline record from the </st><strong class="bold"><st c="44770">Deployment Pipeline</st></strong><st c="44789"> table is shared with them, then they are eligible to use the pipeline in any solutions in </st><span class="No-Break"><st c="44880">that environment.</st></span></li>
			</ul>
			<p><st c="44897">The user (maker) experience of the </st><strong class="bold"><st c="44933">Pipelines</st></strong><st c="44942"> tab in the solution view looks </st><span class="No-Break"><st c="44974">as follows:</st></span></p>
			<div>
				<div id="_idContainer048" class="IMG---Figure">
					<img src="image/B22208_04_9.jpg" alt="Figure 4.9 – The Pipelines user experience in Solutions"/><st c="44985"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="45885">Figure 4.9 – The Pipelines user experience in Solutions</st></p>
			<p><st c="45940">We are </st><a id="_idIndexMarker474"/><st c="45948">within a solution (editing an unmanaged solution) and when pipelines are configured, an additional </st><strong class="bold"><st c="46047">Pipeline</st></strong><st c="46055"> tab on the left will become visible. </st><st c="46093">In our example, there is a pipeline in the drop-down box that targets two environments: first the test and then the prod. </st><st c="46215">Since this user has access to more pipelines through the shared Dataverse Deployment Pipeline table’s row, the dropdown provides </st><span class="No-Break"><st c="46344">more choices.</st></span></p>
			<p><st c="46357">To be able to execute a pipeline configured in the Deployment Pipeline Configuration tool from the source environment, the following conditions must </st><span class="No-Break"><st c="46507">be met:</st></span></p>
			<ul>
				<li><st c="46514">We need to share the pipeline record (</st><strong class="bold"><st c="46553">Read privileges</st></strong><st c="46569">) with makers. </st><st c="46585">We should use the appropriate Microsoft Entra groups to give this right </st><span class="No-Break"><st c="46657">to them.</st></span></li>
				<li><st c="46665">We need to have privileges to export solutions from the source environments and we need to have the appropriate rights to import solutions to target environments. </st><st c="46829">The</st><a id="_idIndexMarker475"/><st c="46832"> built-in </st><strong class="bold"><st c="46842">System customizer</st></strong><st c="46859"> and </st><strong class="bold"><st c="46864">Environment maker</st></strong><st c="46881"> security </st><a id="_idIndexMarker476"/><st c="46891">roles have </st><span class="No-Break"><st c="46902">these rights.</st></span></li>
			</ul>
			<p><st c="46915">The pipeline will then deploy the managed solution on behalf of the user who triggered the action by default. </st><st c="47026">If we would like to use service accounts instead of users, service principals are supported. </st><st c="47119">In this case, the import of the solution to the target environment happens on behalf of the assigned service principal with the main security benefit that only the service principal has access to the </st><span class="No-Break"><st c="47319">production environment.</st></span></p>
			<p><st c="47342">The real power of the </st><a id="_idIndexMarker477"/><st c="47365">deployment pipelines is that we can introduce those additional </st><em class="italic"><st c="47428">quality gates</st></em><st c="47441"> in our CD pipelines that we have discussed in </st><a href="B22208_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic"><st c="47488">Chapter 1</st></em></span></a><st c="47497"> by building our own deployment approval logic (release approvals) before new versions of solutions hit target environments. </st><st c="47622">These quality gates can vary from very simple release manager approvals to advanced automated test executions. </st><st c="47733">There is the </st><strong class="bold"><st c="47746">Pre-Deployment Step Required</st></strong><st c="47774"> option in each </st><strong class="bold"><st c="47790">deployment stage</st></strong><st c="47806"> that we can use to trigger our custom logic-based approval process via Power Automate Cloud Flow. </st><st c="47905">The deployment requests will be pending until they are approved. </st><st c="47970">The following figure shows the </st><strong class="bold"><st c="48001">Pre-Deployment Step Required</st></strong><st c="48029"> and </st><strong class="bold"><st c="48034">Pre-Export Step Required</st></strong><st c="48058"> options in the Deployment Pipeline </st><span class="No-Break"><st c="48094">Configuration tool:</st></span></p>
			<div>
				<div id="_idContainer049" class="IMG---Figure">
					<img src="image/B22208_04_10.jpg" alt="Figure 4.10 – Creating a new deployment in Deployment Pipeline Configuration tool"/><st c="48113"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="48580">Figure 4.10 – Creating a new deployment in Deployment Pipeline Configuration tool</st></p>
			<p><st c="48661">With the help of </st><strong class="bold"><st c="48679">Pre-Export Step Required</st></strong><st c="48703">, we can introduce custom validation logic that is executed before the solution is first exported from the development environment as a managed and </st><span class="No-Break"><st c="48851">unmanaged solution.</st></span></p>
			<p><st c="48870">The </st><a id="_idIndexMarker478"/><st c="48875">cloud flows involved in the quality gates shall be created in the Host Environment and their trigger conditions are Dataverse Action. </st><st c="49009">We can create multiple cloud flows reacting to the same </st><span class="No-Break"><st c="49065">pipeline event.</st></span></p>
			<p><st c="49080">Currently, there are some limitations to using </st><span class="No-Break"><st c="49128">managed pipelines:</st></span></p>
			<ul>
				<li><st c="49146">Having multiple developers working on the same solution in dedicated developer environments requires a more careful process to avoid overwriting each other’s changes. </st><st c="49314">Currently, pipelines only support a unidirectional flow from developer environments to production environments. </st><st c="49426">This means that pulling the latest version of the solution and deploying it into a different developer environment requires careful and </st><span class="No-Break"><st c="49562">manual intervention.</st></span></li>
				<li><st c="49582">Rollback is partially supported. </st><st c="49616">We can already </st><strong class="bold"><st c="49631">redeploy</st></strong><st c="49639"> an earlier version of the solution to the target environment in Power Platform pipelines, but we cannot roll back the entire multi-stage pipeline as </st><span class="No-Break"><st c="49789">one step.</st></span></li>
			</ul>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor086"/><st c="49798">Step-by-step walkthrough – creating our first CI/CD pipeline</st></h2>
			<p><st c="49859">Let’s create our</st><a id="_idIndexMarker479"/><st c="49876"> first end-to-end CI/CD pipeline</st><a id="_idIndexMarker480"/><st c="49908"> using Power Platform pipelines. </st><st c="49941">What we are going to do is take one of the environment templates and one of the solutions available in the GitHub repository. </st><st c="50067">We will use these to set up a pipeline that will build a managed version from the unmanaged version of the solution and deploy it from a developer environment to a </st><span class="No-Break"><st c="50231">production environment:</st></span></p>
			<ol>
				<li><st c="50254">Install the PAC CLI (assuming .NET 6.0 is installed in </st><span class="No-Break"><st c="50310">our environment):</st></span><pre class="source-code">
<strong class="bold"><st c="50327">dotnet tool install --global Microsoft.PowerApps.CLI.Tool</st></strong></pre></li>				<li><st c="50385">Install the </st><span class="No-Break"><st c="50398">PowerShell module:</st></span><pre class="source-code">
<strong class="bold"><st c="50416">Install-Module -Name Microsoft.PowerApps.Administration.PowerShell</st></strong></pre></li>				<li><st c="50483">Create an environment for hosting the managed pipelines. </st><st c="50541">This environment will represent the host environment of the pipelines. </st><st c="50612">We should choose the same region that our development, test, and production environments are </st><span class="No-Break"><st c="50705">created in:</st></span><pre class="source-code">
<strong class="bold"><st c="50716">#Authentication – in both tools</st></strong>
<strong class="bold"><st c="50748">Add-PowerAppsAccount</st></strong>
<strong class="bold"><st c="50769">pac auth create</st></strong>
<strong class="bold"><st c="50785">#Create Host Environment - Pipelinehost</st></strong>
<strong class="bold"><st c="50825">$result=New-AdminPowerAppEnvironment -Location europe -DisplayName 'Pipelinehost' -ProvisionDatabase -EnvironmentSku Production</st></strong></pre></li>				<li><st c="50953">Install the</st><a id="_idIndexMarker481"/><st c="50965"> Power Platform Pipelines Dynamics 365 app. </st><st c="51009">The PAC CLI provides an easy way to install Dynamics 365 apps</st><a id="_idIndexMarker482"/><st c="51070"> to environments (no PowerShell cmdlet exists as of the time of writing </st><span class="No-Break"><st c="51142">this book):</st></span><pre class="source-code">
<strong class="bold"><st c="51153">#Install Power Platform Pipelines to "Pipelinehost"</st></strong>
<strong class="bold"><st c="51205">#It takes approx. </st><st c="51224">5 minutes</st></strong>
<strong class="bold"><st c="51233">pac application install `</st></strong>
<strong class="bold"><st c="51259"> --environment $resultNewEnvironment.EnvironmentName `</st></strong>
<strong class="bold"><st c="51313"> --application-name "msdyn_AppDeploymentAnchor"</st></strong></pre></li>				<li><st c="51360">Create a </st><span class="No-Break"><st c="51370">developer environment:</st></span><pre class="source-code">
<strong class="bold"><st c="51392">pac admin create `</st></strong>
<strong class="bold"><st c="51411">  --name "DevelopmentEnvironment" `</st></strong>
<strong class="bold"><st c="51445">  --currency EUR `</st></strong>
<strong class="bold"><st c="51462">  --region europe `</st></strong>
<strong class="bold"><st c="51480">  --type Sandbox</st></strong></pre></li>				<li><st c="51495">Create a target environment (managed </st><span class="No-Break"><st c="51533">and production):</st></span><pre class="source-code">
<strong class="bold"><st c="51549">#Create a production environment</st></strong>
<strong class="bold"><st c="51582">$resultProductionEnvironment=New-AdminPowerAppEnvironment -DisplayName 'Production' `</st></strong>
<strong class="bold"><st c="51668">        -ProvisionDatabase `</st></strong>
<strong class="bold"><st c="51689">        -Location europe `</st></strong>
<strong class="bold"><st c="51708">        -EnvironmentSku Production</st></strong>
<strong class="bold"><st c="51735">#Turn on Managed Environment</st></strong>
<strong class="bold"><st c="51764">pac admin set-governance-config `</st></strong>
<strong class="bold"><st c="51798">   --environment $resultProductionEnvironment.EnvironmentName `</st></strong>
<strong class="bold"><st c="51859">   --protection-level Standard</st></strong></pre></li>				<li><st c="51887">Let’s </st><a id="_idIndexMarker483"/><st c="51894">create the pipeline using </st><a id="_idIndexMarker484"/><st c="51920">the </st><strong class="bold"><st c="51924">Deployment Pipeline Configuration tool</st></strong><st c="51962"> in</st><a id="_idIndexMarker485"/><st c="51965"> the </st><span class="No-Break"><strong class="source-inline"><st c="51970">Pipelinehost</st></strong></span><span class="No-Break"><st c="51982"> environment:</st></span><ol><li class="upper-roman"><st c="51995">Start </st><span class="No-Break"><st c="52002">the application.</st></span></li><li class="upper-roman"><st c="52018">Go to </st><strong class="bold"><st c="52025">Environments</st></strong><st c="52037"> under </st><strong class="bold"><st c="52044">Pipeline Setup</st></strong><st c="52058">, open it, and click on the </st><strong class="bold"><st c="52086">New</st></strong><st c="52089"> button at </st><span class="No-Break"><st c="52100">the top.</st></span></li><li class="upper-roman"><st c="52108">Fill out it with the data of your developer environment as the following </st><span class="No-Break"><st c="52182">figure shows:</st></span></li></ol></li>
			</ol>
			<div>
				<div id="_idContainer050" class="IMG---Figure">
					<img src="image/B22208_04_11.jpg" alt="Figure 4.11 – Creating a new Deployment Environment"/><st c="52195"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="52690">Figure 4.11 – Creating a new Deployment Environment</st></p>
			<ol>
				<li class="upper-roman" value="4"><st c="52741">Create </st><a id="_idIndexMarker486"/><st c="52749">another </st><strong class="bold"><st c="52757">Deployment Environment</st></strong><st c="52779"> with</st><a id="_idIndexMarker487"/><st c="52784"> the configuration data of your recently created production</st><a id="_idIndexMarker488"/><st c="52843"> environment and with the </st><strong class="bold"><st c="52869">Environment Type</st></strong> <em class="italic"><st c="52885">Target Environment</st></em><st c="52904">, see the previous figure </st><span class="No-Break"><st c="52930">for details.</st></span></li>
			</ol>
			<p class="callout-heading"><st c="52942">Tip</st></p>
			<p class="callout"><st c="52946">Use the </st><strong class="source-inline"><st c="52955">pac admin list</st></strong><st c="52969"> command to get the environment IDs of your recently </st><span class="No-Break"><st c="53022">created environments.</st></span></p>
			<ol>
				<li class="upper-roman" value="5"><st c="53043">Go to </st><strong class="bold"><st c="53050">Pipeline</st></strong><st c="53058"> under </st><strong class="bold"><st c="53065">Pipeline Setup</st></strong><st c="53079">, open it, and click on the </st><strong class="bold"><st c="53107">New</st></strong><st c="53110"> button at the top. </st><st c="53130">Add the </st><strong class="source-inline"><st c="53138">PipelineToProd</st></strong><st c="53152"> name and save the form to be able to configure it completely. </st><st c="53215">If we would like to get AI deployment notes, then we can enable this here </st><span class="No-Break"><st c="53289">as well:</st></span></li>
			</ol>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="image/B22208_04_12.jpg" alt="Figure 4.12 – The details of the new deployment pipeline"/><st c="53297"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="53584">Figure 4.12 – The details of the new deployment pipeline</st></p>
			<ol>
				<li class="upper-roman" value="6"><st c="53640">Add </st><a id="_idIndexMarker489"/><st c="53645">the </st><a id="_idIndexMarker490"/><st c="53649">developer environment (</st><strong class="bold"><st c="53672">DevelopmentEnvironment</st></strong><st c="53695">) to the </st><strong class="bold"><st c="53705">Linked Development </st></strong><span class="No-Break"><strong class="bold"><st c="53724">Environments</st></strong></span><span class="No-Break"><st c="53736"> section.</st></span></li>
				<li class="upper-roman"><st c="53745">Create a new deployment stage by clicking on the </st><strong class="bold"><st c="53795">New Deployment </st></strong><span class="No-Break"><strong class="bold"><st c="53810">Stage</st></strong></span><span class="No-Break"><st c="53815"> button.</st></span></li>
				<li class="upper-roman"><st c="53823">Set the </st><strong class="bold"><st c="53832">Name</st></strong><st c="53836"> and </st><strong class="bold"><st c="53841">Target Deployment Environment ID</st></strong><st c="53873"> fields on </st><span class="No-Break"><st c="53884">the form.</st></span></li>
				<li class="upper-roman"><st c="53893">Save </st><span class="No-Break"><st c="53899">the record.</st></span></li>
			</ol>
			<ol>
				<li value="8"><st c="53910">Set </st><span class="No-Break"><st c="53915">up security:</st></span><ol><li class="upper-roman"><st c="53927">Share this new deployment pipeline Dataverse record with the users or group of users who will use this pipeline in the developer environment, that is, in </st><strong class="bold"><st c="54082">DevelopmentEnvironment</st></strong><st c="54104"> in </st><span class="No-Break"><st c="54108">our case.</st></span></li><li class="upper-roman"><st c="54117">Add the </st><strong class="bold"><st c="54126">System customizer</st></strong><st c="54143"> or </st><strong class="bold"><st c="54147">Environment maker</st></strong><st c="54164"> built-in security roles to these members in both the </st><strong class="bold"><st c="54218">Production</st></strong><st c="54228"> and </st><span class="No-Break"><strong class="bold"><st c="54233">DevelopmentEnvironment</st></strong></span><span class="No-Break"><st c="54255"> environments.</st></span></li><li class="upper-roman"><st c="54269">Add the </st><strong class="bold"><st c="54278">Deployment Pipeline User</st></strong><st c="54302"> security role to these members in the </st><span class="No-Break"><strong class="bold"><st c="54341">Pipelinehost</st></strong></span><span class="No-Break"><st c="54353"> environment.</st></span></li></ol></li>
				<li><st c="54366">Go to </st><a id="_idIndexMarker491"/><st c="54373">developer environment and import</st><a id="_idIndexMarker492"/><st c="54405"> the </st><strong class="bold"><st c="54410">unmanaged solution</st></strong><st c="54428"> IT Base Pack from Power Platform Enterprise templates. </st><st c="54484">You can find it </st><span class="No-Break"><st c="54500">at </st></span><a href="https://github.com/microsoft/Templates-for-Power-Platform/blob/main/Solution%20Packages%20For%20Manual%20Install/IT/IT%20Base%20Pack/mpa_ITBase_managed.zip"><span class="No-Break"><st c="54503">https://github.com/microsoft/Templates-for-Power-Platform/blob/main/Solution%20Packages%20For%20Manual%20Install/IT/IT%20Base%20Pack/mpa_ITBase_managed.zip</st></span></a><span class="No-Break"><st c="54658">.</st></span></li>
				<li><st c="54659">Open the </st><a id="_idIndexMarker493"/><st c="54669">solution and look for the pipeline icon (it looks like a rocket) on the left side. </st><st c="54752">Open the pipelines and select the </st><span class="No-Break"><strong class="bold"><st c="54786">PipelineToProd</st></strong></span><span class="No-Break"><st c="54800"> pipeline:</st></span></li>
			</ol>
			<div>
				<div id="_idContainer052" class="IMG---Figure">
					<img src="image/B22208_04_13.jpg" alt="Figure 4.13 – Selecting PipelineToProd"/><st c="54810"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="55562">Figure 4.13 – Selecting PipelineToProd</st></p>
			<ol>
				<li value="11"><st c="55600">Click on </st><strong class="bold"><st c="55610">Deploy here</st></strong><st c="55621"> or use the </st><strong class="source-inline"><st c="55633">pac pipeline </st></strong><span class="No-Break"><strong class="source-inline"><st c="55646">deploy</st></strong></span><span class="No-Break"><st c="55652"> command.</st></span></li>
				<li><st c="55661">Check the deployment result in the </st><span class="No-Break"><st c="55697">production environment.</st></span></li>
			</ol>
			<p><st c="55720">Congratulations, we have created our first CI/CD Power </st><span class="No-Break"><st c="55776">Platform pipeline.</st></span></p>
			<p><st c="55794">To make this </st><a id="_idIndexMarker494"/><st c="55808">pipeline even more professional and secure, we </st><a id="_idIndexMarker495"/><st c="55855">can create a service principal and an enterprise application </st><a id="_idIndexMarker496"/><st c="55916">in </st><strong class="bold"><st c="55919">Microsoft Entra ID</st></strong><st c="55937"> (within </st><strong class="bold"><st c="55946">Microsoft Azure Portal</st></strong><st c="55968">) and assign it to the deployment stage as the following </st><span class="No-Break"><st c="56026">figure shows:</st></span></p>
			<div>
				<div id="_idContainer053" class="IMG---Figure">
					<img src="image/B22208_04_14.jpg" alt="Figure 4.14 – Using the service principal in Pipeline"/><st c="56039"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="56581">Figure 4.14 – Using the service principal in Pipeline</st></p>
			<p><st c="56634">This is the </st><strong class="bold"><st c="56647">delegated deployment</st></strong><st c="56667"> process</st><a id="_idIndexMarker497"/><st c="56675"> by which we assign </st><a id="_idIndexMarker498"/><st c="56695">our </st><strong class="bold"><st c="56699">Service Principal Name</st></strong><st c="56721"> (</st><strong class="bold"><st c="56723">SPN</st></strong><st c="56726">) client ID to let the pipeline engine use it in the solution import phase. </st><st c="56803">After creating this assignment, there is one last thing that we need to do. </st><st c="56879">This is to create a delegated approval flow connecting to the Power Platform pipeline Dataverse tables by using the service principal and its client secret to approve the deployment. </st><st c="57062">The next figure will show the simplest approval by reacting to the </st><strong class="bold"><st c="57129">OnApprovalStarted</st></strong><st c="57146"> Dataverse action, waiting five seconds, and setting the approval status to 20 (20 means approved; 30 would be the </st><span class="No-Break"><st c="57261">rejected state):</st></span></p>
			<div>
				<div id="_idContainer054" class="IMG---Figure">
					<img src="image/B22208_04_15.jpg" alt="Figure 4.15 – Delegated deployment with he service principal"/><st c="57277"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="57474">Figure 4.15 – Delegated deployment with he service principal</st></p>
			<p><st c="57534">The underlying</st><a id="_idIndexMarker499"/><st c="57549"> Power Platform pipeline engine uses</st><a id="_idIndexMarker500"/><st c="57585"> this flow to run on behalf of the defined service principal and not on behalf of the user. </st><st c="57677">With these additional steps, we have significantly improved the resiliency and security of </st><span class="No-Break"><st c="57768">our pipeline.</st></span></p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor087"/><st c="57781">Summary</st></h1>
			<p><st c="57789">In this chapter, we learned about Power Platform solutions, the modern executables that can move between environments, their upgrade options, and different approaches for how solution layering and versioning can be realized. </st><st c="58015">After that, we discussed Dataverse, the enterprise-grade data platform with advanced security and governance capabilities. </st><st c="58138">We also got familiar with the CDM, a database schema to model our data that’s accepted industry-wide. </st><st c="58240">We also spent time on environments, the execution hosts of our solutions, learned about the advanced features of Managed Environments, and elaborated on the environment strategy at large-scale global enterprises. </st><st c="58453">At the end of the chapter, we learned how Power Platform pipelines – as one of the greatest features of Managed Environments – work under the hood. </st><st c="58601">We also successfully created our first </st><span class="No-Break"><st c="58640">CI/CD pipeline.</st></span></p>
			<p><st c="58655">In the next chapter, we will discover the pro developer tools available for creating those CI/CD pipelines and other ALM automations that we have partially seen regarding Power </st><span class="No-Break"><st c="58833">Platform pipelines.</st></span></p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor088"/><st c="58852">Further reading</st></h1>
			<ul>
				<li><st c="58868">Solution </st><span class="No-Break"><st c="58878">layers: </st></span><a href="https://learn.microsoft.com/en-us/power-apps/maker/data-platform/solution-layers"><span class="No-Break"><st c="58886">https://learn.microsoft.com/en-us/power-apps/maker/data-platform/solution-layers</st></span></a></li>
				<li><strong class="bold"><st c="58966">Common Data </st></strong><span class="No-Break"><strong class="bold"><st c="58979">Model</st></strong></span><span class="No-Break"><st c="58984"> (</st></span><span class="No-Break"><strong class="bold"><st c="58986">CDM</st></strong></span><span class="No-Break"><st c="58989">):</st></span><ul><li><a href="https://learn.microsoft.com/en-us/common-data-model/use"><span class="No-Break"><st c="58992">https://learn.microsoft.com/en-us/common-data-model/use</st></span></a></li><li><a href="https://github.com/microsoft/CDM"><span class="No-Break"><st c="59048">https://github.com/microsoft/CDM</st></span></a></li></ul></li>
				<li><st c="59081">Solution </st><span class="No-Break"><st c="59091">patching: </st></span><a href="https://learn.microsoft.com/en-us/power-platform/alm/create-patches-simplify-solution-updates"><span class="No-Break"><st c="59101">https://learn.microsoft.com/en-us/power-platform/alm/create-patches-simplify-solution-updates</st></span></a></li>
				<li><st c="59194">Managed </st><span class="No-Break"><st c="59203">Environments: </st></span><a href="https://learn.microsoft.com/en-us/power-platform/admin/managed-environment-overview"><span class="No-Break"><st c="59217">https://learn.microsoft.com/en-us/power-platform/admin/managed-environment-overview</st></span></a></li>
				<li><st c="59300">Environment </st><span class="No-Break"><st c="59313">strategy: </st></span><a href="https://learn.microsoft.com/en-us/power-platform/guidance/adoption/environment-strategy"><span class="No-Break"><st c="59323">https://learn.microsoft.com/en-us/power-platform/guidance/adoption/environment-strategy</st></span></a></li>
				<li><st c="59410">Enterprise </st><span class="No-Break"><st c="59422">templates:</st></span><span class="No-Break"><span class="P---URL"> </span></span><a href="https://github.com/microsoft/Templates-for-Power-Platform"><span class="No-Break"><st c="59432">https://github.com/microsoft/Templates-for-Power-Platform</st></span></a></li>
				<li><st c="59490">Power Platform </st><span class="No-Break"><st c="59506">pipelines: </st></span><a href="https://learn.microsoft.com/en-us/power-platform/alm/pipelines"><span class="No-Break"><st c="59517">https://learn.microsoft.com/en-us/power-platform/alm/pipelines</st></span></a></li>
				<li><st c="59579">Microsoft Entra ID service </st><span class="No-Break"><st c="59607">principals: </st></span><a href="https://learn.microsoft.com/en-us/entra/identity-platform/app-objects-and-service-principals"><span class="No-Break"><st c="59619">https://learn.microsoft.com/en-us/entra/identity-platform/app-objects-and-service-principals</st></span></a></li>
				<li><st c="59711">Service principals in </st><span class="No-Break"><st c="59734">pipelines: </st></span><a href="https://learn.microsoft.com/en-us/power-platform/alm/delegated-deployments-setup"><span class="No-Break"><st c="59745">https://learn.microsoft.com/en-us/power-platform/alm/delegated-deployments-setup</st></span></a></li>
			</ul>
		</div>
	<div id="charCountTotal" value="59825"/></body></html>