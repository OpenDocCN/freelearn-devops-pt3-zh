<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer013">
<h1 class="chapter-number" id="_idParaDest-48"><a id="_idTextAnchor050"/>3</h1>
<h1 id="_idParaDest-49"><a id="_idTextAnchor051"/>Intermediate Linux</h1>
<p>In this chapter, we’re going to continue with the introduction to the Linux shell. The topic itself is vast and warrants a book of its own. We will be coming back to the topics from the previous chapter and introducing <span class="No-Break">new ones.</span></p>
<p>In this chapter, we will cover the <span class="No-Break">following topics:</span></p>
<ul>
<li><span class="No-Break">Globs</span></li>
<li>Automating <span class="No-Break">repetitive tasks</span></li>
<li><span class="No-Break">Software installation</span></li>
<li><span class="No-Break">Managing users</span></li>
<li><strong class="bold">Secure Shell</strong> (<span class="No-Break"><strong class="bold">SSH</strong></span><span class="No-Break">) protocol</span></li>
</ul>
<h1 id="_idParaDest-50">Technical requirements</h1>
<p>It is highly recommended that you have a Linux system installed and ready for use. We recommend it be a virtual machine or a laptop that you can safely reinstall from scratch in case something goes horribly wrong. This will let you follow the examples in this book and perform any kind of exercise that we <span class="No-Break">give you.</span></p>
<p>We are not going to cover an installation. Every distribution may use its own installer, be it graphical or text (depending on the distribution and which variant you’ve picked). You’ll need to note down or remember the name of your user (conveniently called <strong class="bold">username</strong> or <strong class="bold">login</strong>) and password. There are ways to get into the system if you have physical access and you don’t know either the login or password or both, but they are way outside the scope of <span class="No-Break">this book.</span></p>
<p>Our main distribution in this book is <strong class="bold">Debian</strong>. However, you should be okay with any of the major ones we covered in the previous chapter, so long as it <span class="No-Break">isn’t Alpine.</span></p>
<h1 id="_idParaDest-51">Globs</h1>
<p>There is a lot that a shell can <a id="_idIndexMarker173"/>do for you to make your life easier. One of them is allowing for a level of <em class="italic">uncertainty</em> when typing in arguments on the shell. To that end, the shell defines several special characters that are treated like symbols for something, not like literal input. These are called <strong class="bold">global patterns</strong>, or <strong class="bold">globs</strong>. The characters that are used in globs are sometimes <a id="_idIndexMarker174"/>referred to <span class="No-Break">as </span><span class="No-Break"><strong class="bold">wildcards</strong></span><span class="No-Break">.</span></p>
<p>Do not confuse globs <a id="_idIndexMarker175"/>with <strong class="bold">regular expressions</strong> (<strong class="bold">regexps</strong>). While globs are quite a powerful tool on their own, they are no match for regexps. On the other hand, regexps are not evaluated by bash when it performs <span class="No-Break">pattern matching.</span></p>
<p>The following table describes shell globs and their meaning. We’re going to explain their exact meaning<a id="_idIndexMarker176"/> through <span class="No-Break">several examples:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-1">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Glob</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Meaning</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">*</strong></p>
</td>
<td class="No-Table-Style">
<p>Matches any number of any characters (<span class="No-Break">also zero)</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">?</strong></p>
</td>
<td class="No-Table-Style">
<p>Matches exactly <span class="No-Break">one character</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">[...]</strong></p>
</td>
<td class="No-Table-Style">
<p>Matches any one character from a set inside <span class="No-Break">the brackets</span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 3.1 – Shell globs</p>
<p>The preceding table may be unclear to you, so let’s cover <span class="No-Break">some examples:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Example</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Meaning</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">*</strong></p>
</td>
<td class="No-Table-Style">
<p>This will match any string of <span class="No-Break">any length.</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">*</strong><span class="No-Break"><strong class="source-inline">test*</strong></span></p>
</td>
<td class="No-Table-Style">
<p>This will match anything that has the word <em class="italic">test</em> inside it: <strong class="source-inline">test.txt</strong>, <strong class="source-inline">good_test.txt</strong>, <strong class="source-inline">test_run</strong>, and simply <strong class="source-inline">test</strong> (remember, it matches <span class="No-Break">nothing too).</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline">test*txt</strong></span></p>
</td>
<td class="No-Table-Style">
<p>This will match anything that has a name starting with <em class="italic">test</em> and ending in <em class="italic">txt</em>, so <strong class="source-inline">test.txt</strong>, <strong class="source-inline">testtxt</strong>, <strong class="source-inline">test_file.txt</strong>, and <span class="No-Break">so on.</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline">test?</strong></span></p>
</td>
<td class="No-Table-Style">
<p>This will match any occurrence of <em class="italic">test</em> plus one character: <strong class="source-inline">test1</strong>, <strong class="source-inline">test2</strong>, <strong class="source-inline">testa</strong>, <strong class="source-inline">test</strong>, and <span class="No-Break">so on.</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline">test.[ch]</strong></span></p>
</td>
<td class="No-Table-Style">
<p>This will match one of two things: <strong class="source-inline">test.c</strong> or <strong class="source-inline">test.h</strong> and <span class="No-Break">nothing else.</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">*.[</strong><span class="No-Break"><strong class="source-inline">ab]</strong></span></p>
</td>
<td class="No-Table-Style">
<p>This will match any string that ends in a dot and either <em class="italic">a</em> <span class="No-Break">or </span><span class="No-Break"><em class="italic">b.</em></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">?[</strong><span class="No-Break"><strong class="source-inline">tf]</strong></span></p>
</td>
<td class="No-Table-Style">
<p>This will match exactly one character of any kind followed by either <em class="italic">t</em> <span class="No-Break">or </span><span class="No-Break"><em class="italic">f.</em></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 3.2 – Shell globs – examples</p>
<p>The true <a id="_idIndexMarker177"/>power of globs emerges once you start writing some more complicated strings of commands (so-called one-liners) <span class="No-Break">or scripts.</span></p>
<p>Some examples of simple commands that get on an entirely new level when combined with globs are <strong class="source-inline">find</strong>, <strong class="source-inline">grep</strong>, and <strong class="source-inline">rm</strong>. In the following example, I am using globs to remove all files that start with anything, then have test followed by a dot, and then log followed by<a id="_idIndexMarker178"/> anything. So, the <strong class="source-inline">weirdtest.log</strong>, <strong class="source-inline">anothertest.log1</strong>, and <strong class="source-inline">test.log.3</strong> files will be matched, but not <strong class="source-inline">testlog</strong> and <strong class="source-inline">important_test.out</strong>. First, let’s list all the files that contain the word <em class="italic">test</em> in <span class="No-Break">their name:</span></p>
<pre class="console">
admin@myhome:~$ ls -ahl *test*
-rw-r--r-- 1 admin admin 0 Sep 17 20:36 importat_test.out
-rw-r--r-- 1 admin admin 0 Sep 17 20:36 runner_test.lo
-rw-r--r-- 1 admin admin 0 Sep 17 20:36 runner_test.log
-rw-r--r-- 1 admin admin 0 Sep 17 20:36 test.log
-rw-r--r-- 1 admin admin 0 Sep 17 20:35 test.log.1
-rw-r--r-- 1 admin admin 0 Sep 17 20:35 test.log.2
-rw-r--r-- 1 admin admin 0 Sep 17 20:35 test.log.3
-rw-r--r-- 1 admin admin 0 Sep 17 20:35 test.log.4
-rw-r--r-- 1 admin admin 0 Sep 17 20:35 test.log.5
-rw-r--r-- 1 admin admin 0 Sep 17 20:35 test.log.6
-rw-r--r-- 1 admin admin 0 Sep 17 20:35 test.log.7</pre>
<p>You will notice that I have used a wildcard (<strong class="source-inline">*</strong>) to achieve my goal. Now, it’s time for the <span class="No-Break">actual removal:</span></p>
<pre class="console">
admin@myhome:~$ rm *test.log*
admin@myhome:~$ ls -ahl *test*
-rw-r--r-- 1 admin admin 0 Sep 17 20:36 importat_test.out
-rw-r--r-- 1 admin admin 0 Sep 17 20:36 runner_test.lo</pre>
<p>As demonstrated here, it worked. You will also notice that a properly executed command doesn’t print <span class="No-Break">any messages.</span></p>
<p>In this section, we explained how to use globs – special characters that allow us to match names in the system with some level of uncertainty. In the next section, we are going to introduce mechanisms to automate <span class="No-Break">repetitive tasks.</span></p>
<h1 id="_idParaDest-52">Automating repetitive tasks</h1>
<p>There <a id="_idIndexMarker179"/>are times when you’ll want to make some tasks repetitive. You may write a script that will create a backup of a database, check users’ home directory permissions, or dump current operating system preformance metrics into a file. Modern Linux distributions provide you with two ways of setting these up. There is a third method that allows you to run a task once, at a delayed time (the <strong class="source-inline">at</strong> command), but here, we’re interested in <span class="No-Break">repetitive tasks.</span></p>
<h2 id="_idParaDest-53"><a id="_idTextAnchor052"/>Cron jobs</h2>
<p><strong class="bold">Cron</strong> is a<a id="_idIndexMarker180"/> traditional way of running tasks that <a id="_idIndexMarker181"/>need to be executed regularly at specified intervals. Usually, they should be obsolete<a id="_idIndexMarker182"/> by <strong class="bold">systemd timers</strong>, but a lot of software provides repeatability through the use of cron jobs and Alpine Linux won’t have this in the name of the <span class="No-Break">minimal-sized distribution.</span></p>
<p>Cron jobs are<a id="_idIndexMarker183"/> essentially commands that are run at predefined intervals. The command and their trigger timers are defined in configuration files that live in the <strong class="source-inline">/etc/</strong> directory. The exact number of files and directories differ by distribution. All of them will have a <strong class="source-inline">/etc/crontab</strong> file. This file usually contains an explanation of the fields within it and several actual commands that you can use as templates. In the following code block, I have pasted explanations from the default <strong class="source-inline">/</strong><span class="No-Break"><strong class="source-inline">etc/crontab</strong></span><span class="No-Break"> file:</span></p>
<pre class="console">
# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</pre>
<p>Normally, there<a id="_idIndexMarker184"/> are two ways to set up a cron job. One of them is to put a script that will run your command in one of four directories: <strong class="source-inline">/etc/cron.hourly</strong>, <strong class="source-inline">/etc/cron.daily</strong>, <strong class="source-inline">/etc/cron.weekly</strong>, or <strong class="source-inline">/etc/cron.monthly</strong>. They should suffice for normal operations. The <strong class="source-inline">/etc/crontab</strong> file specifies when those will <span class="No-Break">be run.</span></p>
<p>The second option is to use the <strong class="source-inline">crontab</strong> command. The <strong class="source-inline">crontab</strong> command lets a given user create an entry in their crontab file. However, there’s a difference between a system-wide crontab file (living in the <strong class="source-inline">/etc/</strong> directory) and a per-user one. The user cron file doesn’t specify the user field. All entries are run with the user’s permission. Let’s look at <span class="No-Break">the differences:</span></p>
<ul>
<li><strong class="source-inline">crontab -l</strong> lists all cron jobs that the user has defined in their <span class="No-Break">crontab file</span></li>
<li><strong class="source-inline">crontab -e</strong> lets the user edit the crontab file to add, remove, or modify <span class="No-Break">the jobs</span></li>
</ul>
<h2 id="_idParaDest-54"><a id="_idTextAnchor053"/>Systemd timer</h2>
<p>We are<a id="_idIndexMarker185"/> not going to cover <strong class="bold">systemd timers</strong> here in detail and will only mention why they may be a <span class="No-Break">better option.</span></p>
<p><strong class="bold">Systemd timer</strong> units<a id="_idIndexMarker186"/> are newer versions of <strong class="bold">cron daemon</strong> jobs. They can do <a id="_idIndexMarker187"/>everything that cron can. However, they offer some <span class="No-Break">additional capabilities:</span></p>
<ul>
<li>You can specify the job to run at some time after a <span class="No-Break">system boots.</span></li>
<li>You can specify that the job has to run at some interval after some other job <span class="No-Break">has run.</span></li>
<li>The dependency on the timer unit can even be a service unit – the normal system <span class="No-Break">service task.</span></li>
<li>The <a id="_idIndexMarker188"/>granularity is much better. Cron jobs only go down to every minute. Systemd timers can trigger with accuracy defined to <span class="No-Break">a second.</span></li>
</ul>
<p>In this section, we <a id="_idIndexMarker189"/>have covered cron jobs and mentioned systemd timers as the two most important ways to automate tasks that have to occur regularly. In the next section, we are going to introduce <span class="No-Break">managing software.</span></p>
<h1 id="_idParaDest-55">Software installation</h1>
<p>Depending <a id="_idIndexMarker190"/>on which distribution you’ve chosen and the type of installation you’ve decided on, your system may lack software that’s essential for your everyday work. It may also be that you one day require a piece of software that isn’t installed <span class="No-Break">by default.</span></p>
<p>Linux distributions pioneered something that other operating systems mirrored later on. The common way of installing software on the Linux operating system is by running an appropriate command that will fetch a binary, put it properly on the system, add some configuration if required, and make it available to users. Today, this may not sound revolutionary at all. After all, we’re living in a world of Apple App Store, Google Play, and Microsoft Apps. But back in the day when Windows and macOS users had to navigate the internet to find a suitable installer for their software, Linux users could install most of it with a <span class="No-Break">single command.</span></p>
<p>This is important in the automated environments that DevOps would strive to set up for <span class="No-Break">several reasons:</span></p>
<ul>
<li>The installable software (distributed in packages) is held in repositories maintained by the distribution team. This means that you don’t need to know the software’s location on the internet; you just need to know its package name and ensure it’s in <span class="No-Break">the repository.</span></li>
<li>The package standards that we’ll cover here (<strong class="source-inline">rpm</strong> and <strong class="source-inline">deb</strong>) <em class="italic">know</em> dependencies. This means that if the software you’re trying to install depends on another not-yet-installed software, it will automatically get pulled <span class="No-Break">and installed.</span></li>
<li>The distributions that we’ll cover here have security teams. They work with package maintainers to keep them patched against any known vulnerabilities. However, this does not mean that they will actively research vulnerabilities in <span class="No-Break">said packages.</span></li>
<li>The<a id="_idIndexMarker191"/> repositories are mirrored over the internet. This means that even if one of them fails (goes offline or is DDoS-ed or for any other reason), you can reach its mirror copies from all over the world. This is not necessarily true for <span class="No-Break">commercial repositories.</span></li>
<li>You can create a local repository mirror in your LAN if you wish. This will give you the fastest download times at the cost of a lot of hard drive space. Package repositories can <span class="No-Break">be huge.</span></li>
</ul>
<p>The amount and versions of the software depend on the distribution in <span class="No-Break">many ways:</span></p>
<ul>
<li><strong class="bold">The policy distribution has to distribute software with different types of licenses</strong>: Some distributions will forbid any software that isn’t strictly open and free as defined by the Open Source Initiative. Other distributions will give the user a choice of adding repositories that may contain software that is more restrictive in <span class="No-Break">its licensing.</span></li>
<li><strong class="bold">The number of maintainers and maintainership models</strong>: It is quite obvious that distributions can only do as much work as they have man hours to spare. The smaller the team, the less software they can package and maintain. Part of the work is automated, but a lot will always need to be manual. With Debian being a non-commercial distribution, it relies solely on the work of volunteers. Ubuntu and Fedora do have commercial backing and part of the team is even employed by one of the companies: Canonical and Red Hat. <strong class="bold">Red Hat Enterprise Linux</strong> (<strong class="bold">RHEL</strong>) is entirely built and maintained by Red <span class="No-Break">Hat employees.</span></li>
<li><strong class="bold">The type of repositories you decide to use</strong>: Some software makers distribute their packages in separate repositories, after which you can add them to your configuration and use them as if they were regular distribution repositories. However, if you do so, there are some things to keep <span class="No-Break">in mind:</span><ul><li><strong class="bold">The software in the third-party repository is not part of the quality effort made by the distribution</strong>: This is solely at the discretion of the repository maintainer – in this case, the software vendor. This will include <span class="No-Break">security fixes.</span></li><li><strong class="bold">The software in the third-party repository may not be updated at the same time as the core distribution repositories</strong>: This means that sometimes, there will be conflicts in package versions required by the software and delivered by the distribution. Moreover, the probability of conflict rises with the number of third-party repositories you add to <span class="No-Break">your server.</span></li></ul></li>
</ul>
<h2 id="_idParaDest-56"><a id="_idTextAnchor054"/>Debian and Ubuntu</h2>
<p>The<a id="_idIndexMarker192"/> Debian distribution and its derivative, Ubuntu, use <a id="_idIndexMarker193"/>the <strong class="source-inline">DEB</strong> package format. It was<a id="_idIndexMarker194"/> created solely for Debian. We won’t be going into its history here, and we will only touch on technical details <span class="No-Break">as required.</span></p>
<p>The command <a id="_idIndexMarker195"/>that works directly with package files is <strong class="source-inline">dpkg</strong>. It is used to install, remove, configure, and, importantly, build <strong class="source-inline">.deb</strong> packages. It can only install packages that exist on the filesystem and doesn’t understand remote repositories. Let’s<a id="_idIndexMarker196"/> look at some of the possible actions <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">dpkg</strong></span><span class="No-Break">:</span></p>
<ul>
<li><strong class="source-inline">dpkg -i package_file.deb</strong>: Installs the package file. This command will go through several stages, after which it will install <span class="No-Break">the software.</span></li>
<li><strong class="source-inline">dpkg –unpack package_file.deb</strong>: Unpacking means it puts all important files in their respective places but does not configure <span class="No-Break">the package.</span></li>
<li><strong class="source-inline">dpkg –configure package</strong>: Note that this requires the package name, not the package filename. If, for some reason, packages have been unpacked but not configured, you can use the <strong class="source-inline">-a</strong> or <strong class="source-inline">–pending</strong> flag to work <span class="No-Break">on them.</span></li>
<li><strong class="source-inline">dpkg -r package</strong>: This action removes the software but does not delete configuration files and eventual data it will contain. This can be useful if you plan to reinstall the software in <span class="No-Break">the future.</span></li>
<li><strong class="source-inline">dpkg -p package</strong>: This <a id="_idIndexMarker197"/>action purges the package and removes everything: software, data, configuration files, and <span class="No-Break">caches. Everything.</span></li>
</ul>
<p>In the following example, we’re installing a nano-editor from a package that was physically downloaded to the system, possibly by clicking a download button on a web page. Note that this is not a very usual way of <span class="No-Break">doing things:</span></p>
<pre class="console">
root@myhome:~# dpkg -i nano_5.4-2+deb11u1_amd64.deb
(Reading database ... 35904 files and directories currently installed.)
Preparing to unpack nano_5.4-2+deb11u1_amd64.deb ...
Unpacking nano (5.4-2+deb11u1) over (5.4-2+deb11u1) ...
Setting up nano (5.4-2+deb11u1) ...
Processing triggers for man-db (2.9.4-2) ...</pre>
<p>More often than not, you’ll need to install and remove software using the <strong class="source-inline">apt</strong> suite <span class="No-Break">of tools:</span></p>
<ul>
<li><strong class="source-inline">apt-cache search NAME</strong> will <a id="_idIndexMarker198"/>search for a package that contains the given string. In the following example, I’m looking for a package that contains the <strong class="source-inline">vim</strong> string (vim is one of several popular command-line text editors). The output has been shortened by me <span class="No-Break">for brevity:</span></li>
</ul>
<pre class="console">
root@myhome:~# apt-cache search vim
acr - autoconf like tool
alot - Text mode MUA using notmuch mail
[...]
vim - Vi IMproved - enhanced vi editor
[...]</pre>
<ul>
<li><strong class="source-inline">apt-get install NAME</strong> will install the package whose name you specify. You can install several packages in one line. In the following example, I am installing a C compiler, a C++ compiler, and a Go language suite. Note that the output<a id="_idIndexMarker199"/> also contains a list of packages that are required for my desired software to work and that they will be installed to provide <span class="No-Break">that functionality:</span></li>
</ul>
<pre class="console">
root@myhome:~# apt-get install gcc g++ golang
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
gcc is already the newest version (4:10.2.1-1).
The following additional packages will be installed:
  bzip2 g++-10 golang-1.15 golang-1.15-doc golang-1.15-go golang-1.15-src golang-doc golang-go golang-src libdpkg-perl libfile-fcntllock-perl libgdbm-compat4 liblocale-gettext-perl libperl5.32 libstdc++-10-dev perl perl-modules-5.32
  pkg-config
Suggested packages:
  bzip2-doc g++-multilib g++-10-multilib gcc-10-doc bzr | brz git mercurial subversion debian-keyring gnupg patch bzr libstdc++-10-doc perl-doc libterm-readline-gnu-perl | libterm-readline-perl-perl libtap-harness-archive-perl dpkg-dev
The following NEW packages will be installed:
  bzip2 g++ g++-10 golang golang-1.15 golang-1.15-doc golang-1.15-go golang-1.15-src golang-doc golang-go golang-src libdpkg-perl libfile-fcntllock-perl libgdbm-compat4 liblocale-gettext-perl libperl5.32 libstdc++-10-dev perl
  perl-modules-5.32 pkg-config
0 upgraded, 20 newly installed, 0 to remove and 13 not upgraded.
Need to get 83.9 MB of archives.
After this operation, 460 MB of additional disk space will be used.
Do you want to continue? [Y/n]</pre>
<p>The installer<a id="_idIndexMarker200"/> stops here and waits for our input. The default action is to accept all the additional packages and follow the installation. By typing in <strong class="source-inline">n</strong> or <strong class="source-inline">N</strong> and pressing <em class="italic">Enter</em>, we can stop the process. The <strong class="source-inline">-y</strong> switch for the install action will skip that question and automatically proceed to the <span class="No-Break">next step:</span></p>
<ul>
<li><strong class="source-inline">apt-get update</strong> will refresh the package database with new available packages and <span class="No-Break">new versions.</span></li>
<li><strong class="source-inline">apt-get upgrade</strong> will upgrade all installed packages to the newest versions listed in <span class="No-Break">the database.</span></li>
<li><strong class="source-inline">apt-get remove NAME</strong> will remove the package of the given name. In the following example, we are uninstalling the <span class="No-Break">C++ compiler:</span></li>
</ul>
<pre class="console">
root@myhome:~# apt-get remove g++
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  g++-10 libstdc++-10-dev
Use 'apt autoremove' to remove them.
The following packages will be REMOVED:
  g++
0 upgraded, 0 newly installed, 1 to remove and 13 not upgraded.
After this operation, 15.4 kB disk space will be freed.
Do you want to continue? [Y/n]
(Reading database ... 50861 files and directories currently installed.)
Removing g++ (4:10.2.1-1) ...</pre>
<h2 id="_idParaDest-57"><a id="_idTextAnchor055"/>CentOS, RHEL, and Fedora</h2>
<p>The other popular <a id="_idIndexMarker201"/>group of distributions uses the <strong class="source-inline">RPM</strong> package format. The<a id="_idIndexMarker202"/> basic tool to interact with packages is <strong class="source-inline">rpm</strong>. The main<a id="_idIndexMarker203"/> distribution that uses this format is RHEL, which is made by the Red Hat company. The packages always have the <strong class="source-inline">.rpm</strong> <span class="No-Break">file extension.</span></p>
<p>They use the <strong class="source-inline">dnf</strong> command to manage packages. There is also the <strong class="source-inline">yum</strong> command, which is<a id="_idIndexMarker204"/> the original package<a id="_idIndexMarker205"/> manager for the RHEL distribution (and, by extension, the<a id="_idIndexMarker206"/> Fedora and CentOS distributions), but it has been removed. <strong class="source-inline">dnf</strong> is a next-generation rewrite of <strong class="source-inline">yum</strong>, with many improvements underneath to make it more robust <span class="No-Break">and modern:</span></p>
<ul>
<li><strong class="source-inline">dnf install package_name</strong> will install a package of a given name, along with <span class="No-Break">its dependencies.</span></li>
<li><strong class="source-inline">dnf remove package_name</strong> will remove <span class="No-Break">the package.</span></li>
<li><strong class="source-inline">dnf update</strong> will update all packages to the latest versions in the package database. You can specify a package name, after which <strong class="source-inline">yum</strong> will update <span class="No-Break">that package.</span></li>
<li><strong class="source-inline">dnf search NAME</strong> will search for package names containing the <span class="No-Break"><strong class="source-inline">NAME</strong></span><span class="No-Break"> string.</span></li>
<li><strong class="source-inline">dnf check-update</strong> will refresh the <span class="No-Break">package database.</span></li>
</ul>
<p>With that, let’s take a look at another Linux distribution that is widely used, especially as a base for Docker images – <span class="No-Break">Alpine Linux.</span></p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor056"/>Alpine Linux</h2>
<p>Alpine Linux<a id="_idIndexMarker207"/> is <a id="_idIndexMarker208"/>loved especially by engineers working mainly with Docker and Kubernetes. As the main web page of the distribution claims, <strong class="bold">Small. Simple. Secure.</strong> There are no bells and whistles you can find in Debian-based or Red Hat-based distributions, but the output Docker image is really small and due to their focus on security, you can presume there are no major security vulnerabilities if you’ve updated all packages to the <span class="No-Break">recent version.</span></p>
<p>Alpine Linux’s main downside (and an upside, depending on your viewpoint) is that it’s compiled with the use of the <strong class="source-inline">musl</strong> libraries instead of the widely spread <strong class="source-inline">libc</strong> libraries, although it does use<a id="_idIndexMarker209"/> the <strong class="bold">GNU C Compiler</strong> (<strong class="bold">GCC</strong>), just like most other Linux distributions. Most of the time, it’s not going to bother you, except when you’re installing applications written in Python. That’s because some Python packages use extensions written in C, and naturally, pre-built packages are compiled with <strong class="source-inline">libc</strong>, so you will need to carry out extra steps to ensure you have your compile-time dependencies installed before installing any <span class="No-Break">Python dependencies.</span></p>
<p>The command to<a id="_idIndexMarker210"/> interact with <a id="_idIndexMarker211"/>packages is <strong class="bold">Alpine Package Keeper</strong> (<strong class="bold">apk</strong>). Alpine has two types of releases: stable (with a proper version; for example <strong class="source-inline">3.16</strong>) and edge, which is a rolling release (it always has the latest available version <span class="No-Break">of packages).</span></p>
<p>Additionally, there are three repositories you can use to install packages: <strong class="source-inline">main</strong>, <strong class="source-inline">community</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">testing</strong></span><span class="No-Break">.</span></p>
<p>You will find officially supported packages in the main repository; all tested packages are placed inside the community repository, and testing is used, well, for testing, which means that there can be some broken or outdated packages or some with <span class="No-Break">security flaws.</span></p>
<h3>Searching for packages</h3>
<p>Before<a id="_idIndexMarker212"/> searching for or installing any package, it’s advisable to download the latest package cache. You can do this by invoking the <strong class="source-inline">apk </strong><span class="No-Break"><strong class="source-inline">update</strong></span><span class="No-Break"> command:</span></p>
<pre class="console">
root@myhome:~# apk update
fetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz
v3.16.2-376-g3ff8974e73 [https://dl-cdn.alpinelinux.org/alpine/v3.16/main]
v3.16.2-379-g3c25b38306 [https://dl-cdn.alpinelinux.org/alpine/v3.16/community]
OK: 17037 distinct packages available</pre>
<p>If you’re<a id="_idIndexMarker213"/> building a Docker image for later use, it’s a good idea to remove this cache on the final step of the build process using the <strong class="source-inline">apk cache </strong><span class="No-Break"><strong class="source-inline">clean</strong></span><span class="No-Break"> command.</span></p>
<p>Sometimes, we<a id="_idIndexMarker214"/> don’t know the exact name of the package while we’re working on creating a new Docker image. The easiest way to find whatever you’re searching for in this case is just using the web <span class="No-Break">interface: </span><a href="https://pkgs.alpinelinux.org/packages"><span class="No-Break">https://pkgs.alpinelinux.org/packages</span></a><span class="No-Break">.</span></p>
<p>Using the CLI, you will be able to search for partial library names and binary names, though you can specify that what you’re searching for is a library using the <strong class="source-inline">so:</strong> prefix. Other useful prefixes are <strong class="source-inline">cmd:</strong> for commands and <strong class="source-inline">pc:</strong> for <span class="No-Break"><strong class="source-inline">pkg-config</strong></span><span class="No-Break"> files:</span></p>
<pre class="console">
root@myhome:~# apk search libproc
libproc-3.3.17-r1
libksysguard-5.24.5-r0
process-cpp-3.0.1-r3
samba-dc-libs-4.15.7-r0
procps-dev-3.3.17-r1
root@myhome:~# apk search vim
neovim-doc-0.7.0-r0
gvim-8.2.5000-r0
vim-tutor-8.2.5000-r0
faenza-icon-theme-vim-1.3.1-r6
notmuch-vim-0.36-r0
kmymoney-5.1.2-r3
faenza-icon-theme-gvim-1.3.1-r6
meson-vim-0.62.1-r0
runvimtests-1.30-r1
graphviz-3.0.0-r0
neovim-0.7.0-r0
py3-pynvim-0.4.3-r3
nftables-vim-0_git20200629-r1
vim-doc-8.2.5000-r0
vim-editorconfig-0.8.0-r0
apparmor-vim-3.0.4-r0
geany-plugins-vimode-1.38-r1
vimdiff-8.2.5000-r0
vimb-3.6.0-r0
neovim-lang-0.7.0-r0
u-boot-tools-2022.04-r1
fzf-neovim-0.30.0-r7
nginx-vim-1.22.1-r0
msmtp-vim-1.8.20-r0
protobuf-vim-3.18.1-r3
vimb-doc-3.6.0-r0
icinga2-vim-2.13.3-r1
fzf-vim-0.30.0-r7
vim-sleuth-1.2-r0
gst-plugins-base-1.20.3-r0
mercurial-vim-6.1.1-r0
skim-vim-plugin-0.9.4-r5
root@myhome:~# apk search -e vim
gvim-8.2.5000-r0
root@myhome:~# apk search -e so:libproc*
libproc-3.3.17-r1
libksysguard-5.24.5-r0
process-cpp-3.0.1-r3
samba-dc-libs-4.15.7-r0</pre>
<h3>Installing, upgrading, and uninstalling packages</h3>
<p>You can <a id="_idIndexMarker215"/>perform basic operations on packages by using the <strong class="source-inline">add</strong> (installing), <strong class="source-inline">del</strong> (uninstalling), and <strong class="source-inline">upgrade</strong> commands. While installing, you can also use special prefixes <a id="_idIndexMarker216"/>that are available during search operations, but it’s recommended to use the exact name of the package instead. Please also note that when adding a new package to the system, <strong class="source-inline">apk</strong> will choose the latest version of <span class="No-Break">the package:</span></p>
<pre class="console">
root@myhome:~# apk search -e postgresql14
postgresql14-14.5-r0
root@myhome:~# apk add postgresql14
(1/17) Installing postgresql-common (1.1-r2)
Executing postgresql-common-1.1-r2.pre-install
(2/17) Installing libpq (14.5-r0)
(3/17) Installing ncurses-terminfo-base (6.3_p20220521-r0)
(4/17) Installing ncurses-libs (6.3_p20220521-r0)
(5/17) Installing readline (8.1.2-r0)
(6/17) Installing postgresql14-client (14.5-r0)
(7/17) Installing tzdata (2022c-r0)
(8/17) Installing icu-data-en (71.1-r2)
Executing icu-data-en-71.1-r2.post-install
*
* If you need ICU with non-English locales and legacy charset support, install
* package icu-data-full.
*
(9/17) Installing libgcc (11.2.1_git20220219-r2)
(10/17) Installing libstdc++ (11.2.1_git20220219-r2)
(11/17) Installing icu-libs (71.1-r2)
(12/17) Installing gdbm (1.23-r0)
(13/17) Installing libsasl (2.1.28-r0)
(14/17) Installing libldap (2.6.3-r1)
(15/17) Installing xz-libs (5.2.5-r1)
(16/17) Installing libxml2 (2.9.14-r2)
(17/17) Installing postgresql14 (14.5-r0)
Executing postgresql14-14.5-r0.post-install
*
* If you want to use JIT in PostgreSQL, install postgresql14-jit or
* postgresql-jit (if you didn't install specific major version of postgresql).
*
Executing busybox-1.35.0-r17.trigger
Executing postgresql-common-1.1-r2.trigger
* Setting postgresql14 as the default version
OK: 38 MiB in 31 packages</pre>
<p>You can <a id="_idIndexMarker217"/>also choose to install a specific version of a package instead of the latest version. Unfortunately, it’s impossible to install older versions of the package from the same repository because when a new version is deployed, the old version is removed. You can, however, install older versions of packages from <span class="No-Break">other repositories:</span></p>
<pre class="console">
root@myhome:~# apk add bash=5.1.16-r0 --repository=http://dl-cdn.alpinelinux.org/alpine/v3.15/main
(1/4) Installing ncurses-terminfo-base (6.3_p20220521-r0)
(2/4) Installing ncurses-libs (6.3_p20220521-r0)
(3/4) Installing readline (8.1.2-r0)
(4/4) Installing bash (5.1.16-r0)
Executing bash-5.1.16-r0.post-install
Executing busybox-1.35.0-r17.trigger
OK: 8 MiB in 18 packages</pre>
<p>You can also install a custom package you’ve prepared beforehand using the <span class="No-Break">following command:</span></p>
<pre class="console">
root@myhome:~# apk add --allow-untrusted your-package.apk</pre>
<p>To upgrade all<a id="_idIndexMarker218"/> available packages in your system, you can simply invoke the <strong class="source-inline">apk upgrade</strong> command. However, if you want to upgrade only a specific package, you will need to add its name after the upgrade option. Remember to refresh the package <span class="No-Break">cache beforehand:</span></p>
<pre class="console">
root@myhome:~# apk update
fetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz
v3.16.2-376-g3ff8974e73 [https://dl-cdn.alpinelinux.org/alpine/v3.16/main]
v3.16.2-383-gcca4d0a396 [https://dl-cdn.alpinelinux.org/alpine/v3.16/community]
OK: 17037 distinct packages available
root@myhome:~# apk upgrade
(1/2) Upgrading alpine-baselayout-data (3.2.0-r22 -&gt; 3.2.0-r23)
(2/2) Upgrading alpine-baselayout (3.2.0-r22 -&gt; 3.2.0-r23)
Executing alpine-baselayout-3.2.0-r23.pre-upgrade
Executing alpine-baselayout-3.2.0-r23.post-upgrade
Executing busybox-1.35.0-r17.trigger
OK: 8 MiB in 18 packages</pre>
<p>You can find all<a id="_idIndexMarker219"/> other possible operations by invoking <strong class="source-inline">apk</strong> without any other options. One of the most useful operations is the <strong class="source-inline">apk info</strong> command. It will print out information about a package or repository (the following output has <span class="No-Break">been abbreviated):</span></p>
<pre class="console">
root@myhome:~# apk info --all bash
bash-5.1.16-r2 description:
The GNU Bourne Again shell
bash-5.1.16-r2 webpage:
https://www.gnu.org/software/bash/bash.xhtml
bash-5.1.16-r2 installed size:
1308 KiB
bash-5.1.16-r2 depends on:
/bin/sh
so:libc.musl-x86_64.so.1
so:libreadline.so.8
bash-5.1.16-r2 provides:
cmd:bash=5.1.16-r2.</pre>
<p>In this section, we<a id="_idIndexMarker220"/> introduced package managers – the standard way to manage software in Linux distributions. In the next section, we are going to cover managing <span class="No-Break">user accounts.</span></p>
<h1 id="_idParaDest-59">Managing users</h1>
<p>The user in a <a id="_idIndexMarker221"/>Linux system is defined by a set of <span class="No-Break">three files:</span></p>
<ul>
<li><strong class="source-inline">/etc/passwd</strong>: This file contains information about the user – that is, the user’s name, <strong class="bold">unique numerical ID</strong> (<strong class="bold">UID</strong>) in <a id="_idIndexMarker222"/>the system, the primary group the user belongs to GID, the path to the home directory, and the shell that is loaded when the user logs in. A typical entry looks <span class="No-Break">like this:</span></li>
</ul>
<pre class="console">
   admin:x:1000:1000:Debian:/home/admin:/bin/bash</pre>
<p class="list-inset">Each line describes exactly one user. Fields are separated by a colon. The second field will only contain anything other than <strong class="source-inline">x</strong> in very exotic cases. Here, <strong class="source-inline">x</strong> means that the password is stored separately in the <strong class="source-inline">/etc/shadow</strong> file. The reason is that permissions for the <strong class="source-inline">/etc/passwd</strong> file have to be a bit more relaxed so that the login process can work. <strong class="source-inline">/etc/shadow</strong> can only be read by root and root group and written to only <span class="No-Break">by root:</span></p>
<pre class="console">
    root@myhome:~# ls -ahl /etc/passwd
    -rw-r--r-- 1 root root 1.6K Aug 22 18:38 /etc/passwd
    root@myhome:~# ls -ahl /etc/shadow
    -rw-r----- 1 root shadow 839 Aug 22 18:38 /etc/shadow</pre>
<ul>
<li><strong class="source-inline">/etc/shadow -</strong>: This file contains an encrypted password. As mentioned in the preceding bullet, for security reasons, this file can only be read and written to by the <span class="No-Break">root user.</span></li>
<li><strong class="source-inline">/etc/group -</strong>: This <a id="_idIndexMarker223"/>file contains information about user groups that the user belongs to. Groups are exactly that: accounts that have been grouped together so that their permissions can <span class="No-Break">be managed.</span></li>
</ul>
<p>You should never have a reason to modify these files by hand and that goes especially for the <strong class="source-inline">/etc/shadow</strong> file. The only way to properly change its contents is by using the <strong class="source-inline">passwd</strong> command. We encourage you to read the man page for <span class="No-Break">more information.</span></p>
<p>Three commands take part in user modification and there are three for managing groups: <strong class="source-inline">useradd</strong>, <strong class="source-inline">userdel</strong>, <strong class="source-inline">usermod</strong>, <strong class="source-inline">groupadd</strong>, <strong class="source-inline">groupdel</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">groupmod</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-60"><a id="_idTextAnchor057"/>Adding users</h2>
<p><strong class="source-inline">useradd</strong> adds a<a id="_idIndexMarker224"/> user account to the system. Various switches modify the behavior of this command. One of the most common versions of calling the <strong class="source-inline">useradd</strong> command will add a user, create its home directory, and specify the <span class="No-Break">default shell:</span></p>
<pre class="console">
root@myhome:~# useradd -md /home/auser -s /bin/bash auser</pre>
<p><strong class="source-inline">-m</strong> tells the command to create a home directory, <strong class="source-inline">-d</strong> (here, it’s been passed with one minus sign alongside the m) tells the command what the home directory should be (notice the absolute path), and <strong class="source-inline">-s</strong> specifies the default shell. More parameters can be specified and, again, we encourage you to read the man page for <span class="No-Break">more details.</span></p>
<h2 id="_idParaDest-61"><a id="_idTextAnchor058"/>Modifying users</h2>
<p><strong class="source-inline">usermod</strong> modifies<a id="_idIndexMarker225"/> existing user accounts. It can be used to change the group membership of the user, home directory, lock the account, and more. One interesting option here is the <strong class="source-inline">-p</strong> flag, which lets you non-interactively apply a new password. This is useful in automation, when we may want to update a user password from a script or a tool, not from the command line. However, there is a security risk associated with this: during the command’s execution, anyone in the system can list running processes with their parameters and see the password entry. This does not automatically compromise the password as it must be provided as encrypted through the use of the <strong class="source-inline">crypt (3)</strong> function. However, if an attacker has the encrypted version of the password, they can run a password-cracking program against it and, finally, brute force its clear <span class="No-Break">text version:</span></p>
<pre class="console">
root@myhome:~# usermod -a -G admins auser</pre>
<p>The preceding <a id="_idIndexMarker226"/>command will add the <strong class="source-inline">auser</strong> user to a group called <strong class="source-inline">admins</strong>. The <strong class="source-inline">-a</strong> option means that the user will be added to the supplementary group (it won’t be removed from other groups it’s a <span class="No-Break">member of).</span></p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor059"/>Removing users</h2>
<p>The <strong class="source-inline">userdel</strong> command <a id="_idIndexMarker227"/>is used to remove a user from a system. It can only remove user entries from system files and leave the home directory intact or delete users with <span class="No-Break">home directories:</span></p>
<pre class="console">
root@myhome:~# userdel -r auser</pre>
<p>The preceding command will remove the user, along with its home directory and all files. Note that if the user is still logged in, it will not <span class="No-Break">be removed.</span></p>
<h2 id="_idParaDest-63"><a id="_idTextAnchor060"/>Managing groups</h2>
<p>Similarly to <a id="_idIndexMarker228"/>managing users, you can add, remove, and modify groups within your Linux system. There are equivalent commands to <span class="No-Break">accomplish this:</span></p>
<ul>
<li><strong class="source-inline">groupadd</strong>: Creates a group in the system. Groups can later be used to group users together and specify their execution, directory, or file <span class="No-Break">access rights.</span></li>
<li><strong class="source-inline">groupdel</strong>: Removes the group from <span class="No-Break">the system.</span></li>
<li><strong class="source-inline">groupmod</strong>: Changes the <span class="No-Break">group definition.</span></li>
</ul>
<p>You can also check which users are currently logged into the system by using the <span class="No-Break"><strong class="source-inline">who</strong></span><span class="No-Break"> command:</span></p>
<pre class="console">
admin@myhome:~$ who
ubuntu   tty1         2023-09-21 11:58
ubuntu   pts/0        2023-09-22 07:54 (1.2.3.4)
ubuntu   pts/1        2023-09-22 09:25 (5.6.7.8)
trochej  pts/2        2023-09-22 11:21 (10.11.12.13)</pre>
<p>You can also find the UID and GID of the user you’re currently logged into using the <span class="No-Break"><strong class="source-inline">id</strong></span><span class="No-Break"> command:</span></p>
<pre class="console">
admin@myhome:~$ id
uid=1000(ubuntu) gid=1000(ubuntu) 
groups=1000(ubuntu),4(adm),20(dialout), 24(cdrom),25(floppy),27(sudo),29(audio), 30(dip),44(video),46(plugdev),119(netdev),120(lxd),123(docker)</pre>
<p>By <a id="_idIndexMarker229"/>executing this command without any options, it will show your user ID and all the corresponding groups the user is in. Alternatively, you can provide a name you’d like to view the UID or <span class="No-Break">GID of:</span></p>
<pre class="console">
admin@myhome:~$ id dnsmasq
uid=116(dnsmasq) gid=65534(nogroup) groups=65534(nogroup)</pre>
<p>To view the primary group’s ID and UID, you can use the <strong class="source-inline">-u</strong> and <strong class="source-inline">-g</strong> <span class="No-Break">options, respectively:</span></p>
<pre class="console">
admin@myhome:~$ id -u
1000
admin@myhome:~$ id -g
1000</pre>
<p>In this section, we introduced commands that are used to manage user accounts and groups in Linux systems. The next section will explain securely connecting to remote systems <span class="No-Break">using SSH.</span></p>
<h1 id="_idParaDest-64">Secure Shell (SSH) protocol</h1>
<p>In the<a id="_idIndexMarker230"/> DevOps world, almost nothing runs locally on your laptop or PC. There is one golden standard among ways to reach remote systems and it’s the SSH protocol. SSH was developed in 1995 as a secure, encrypted remote shell access tool that would replace plaintext utilities such as <strong class="bold">telnet</strong> or <strong class="bold">rsh</strong>. The main reason for this is that in distributed networks, it is too easy to eavesdrop on communication and anything that is being transmitted in open text can easily be intercepted. This includes important data such as <span class="No-Break">login details.</span></p>
<p>The most <a id="_idIndexMarker231"/>commonly used SSH <a id="_idIndexMarker232"/>server (and the client) in the Linux world is <strong class="bold">OpenSSH</strong> (<a href="https://www.openssh.com/">https://www.openssh.com/</a>). Other open source <a id="_idIndexMarker233"/>servers<a id="_idIndexMarker234"/> that <a id="_idIndexMarker235"/>are still maintained at the time of writing are <strong class="bold">lsh</strong> (<a href="http://www.lysator.liu.se/~nisse/lsh/">http://www.lysator.liu.se/~nisse/lsh/</a>), <strong class="bold">wolfSSH</strong> (<a href="https://www.wolfssl.com/products/wolfssh/">https://www.wolfssl.com/products/wolfssh/</a>), and <span class="No-Break"><strong class="bold">Dropbear</strong></span><span class="No-Break"> (</span><a href="https://matt.ucc.asn.au/dropbear/dropbear.xhtml"><span class="No-Break">https://matt.ucc.asn.au/dropbear/dropbear.xhtml</span></a><span class="No-Break">).</span></p>
<p>SSH is mainly<a id="_idIndexMarker236"/> used to log into a remote machine to execute commands. But it’s also capable of transferring files (<strong class="bold">Secure File Transfer Protocol</strong> (<strong class="bold">SFTP</strong>)), forwarding<a id="_idIndexMarker237"/> ports, and creating <strong class="bold">X Window System</strong> (<strong class="bold">X11</strong>), a <a id="_idIndexMarker238"/>graphical user interface) connections. It’s also capable of acting<a id="_idIndexMarker239"/> as a <strong class="bold">socket secure</strong> (<strong class="bold">SOCKS</strong>) proxy. Typically, an SSH server listens for connections on TCP <span class="No-Break">port </span><span class="No-Break"><strong class="source-inline">22</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-65"><a id="_idTextAnchor061"/>Configuring OpenSSH</h2>
<p>After <a id="_idIndexMarker240"/>installing the OpenSSH server, your<a id="_idIndexMarker241"/> distribution will place a basic configuration inside the <strong class="source-inline">/etc/ssh/sshd_config</strong> file. The most basic configuration looks <span class="No-Break">like this:</span></p>
<pre class="console">
AuthorizedKeysFile .ssh/authorized_keys
AllowTcpForwarding no
GatewayPorts no
X11Forwarding no
Subsystem sftp /usr/lib/ssh/sftp-server</pre>
<p>Let’s investigate each of them before <span class="No-Break">moving option:</span></p>
<ul>
<li><strong class="source-inline">AuthorizedKeysFIle</strong> tells <a id="_idIndexMarker242"/>our server where to look inside the user directory for the file where you will store all public keys that can be used to connect to this machine as a specified user. So, if you put your public key inside the <strong class="source-inline">AlphaOne</strong> home directory, <strong class="source-inline">/home/AlphaOne/.ssh/authorized_keys</strong>, you will be able to connect as this user using a counterpart private key (more about keys will be covered in the <em class="italic">Creating and managing SSH </em><span class="No-Break"><em class="italic">keys</em></span><span class="No-Break"> subsection).</span></li>
<li><strong class="source-inline">AllowTCPForwarding</strong> will enable or disable the ability for all users to forward<a id="_idIndexMarker243"/> TCP ports. <strong class="bold">Port forwarding</strong> is used to access<a id="_idIndexMarker244"/> remote machines that are not available directly on the internet, but you have access to another machine that can connect. This means you’re using an SSH box as a so-called jump host to connect to a private network, similar to using <span class="No-Break">a VPN.</span></li>
<li><strong class="source-inline">GatewayPorts</strong> is another <a id="_idIndexMarker245"/>option that’s connected directly to the port forwarding feature. By allowing <strong class="source-inline">GatewayPorts</strong>, you can expose forwarded ports <a id="_idIndexMarker246"/>not only to your machine but also to other hosts within the network you are connected to. Setting this option to <strong class="source-inline">yes</strong> is not recommended for security reasons; you can accidentally expose a private network to a network you happen to be connected to, for example, in a <span class="No-Break">coffee shop.</span></li>
<li><strong class="source-inline">X11Forwarding</strong> has<a id="_idIndexMarker247"/> a very specific use case. Usually, you don’t want to have a full-fledged GUI on your servers, but if you have that need, by enabling this option, you will be able to log into the remote machine and start a remote graphical application, which will appear to run on your <span class="No-Break">local host.</span></li>
<li><strong class="source-inline">Subsystem</strong> enables <a id="_idIndexMarker248"/>you to extend the OpenSSH server with additional features, such as SFTP in <span class="No-Break">this case.</span></li>
</ul>
<p>A very important option that is not specified in the preceding command block is <strong class="source-inline">PermitRootLogin</strong>, which, by default, is set to <strong class="source-inline">prohibit-password</strong>. This means that you will be able to log in as a root user, but only if you need to authenticate using a public and private pair of keys. We recommend setting this option to <strong class="source-inline">no</strong> and allowing access to the root user only via the <span class="No-Break"><strong class="source-inline">sudo</strong></span><span class="No-Break"> command.</span></p>
<p>That’s all. You can, of course, add more advanced <a id="_idIndexMarker249"/>configurations, such as using <strong class="bold">Pluggable Authentication Modules</strong> (<strong class="bold">PAMs</strong>), only allowing logging into specific users or groups, or closing users in a specific directory after logging<a id="_idIndexMarker250"/> in (the <strong class="bold">ChrootDirectory</strong> option). You can find all available options for the OpenSSH server by invoking the <strong class="source-inline">man </strong><span class="No-Break"><strong class="source-inline">sshd_config</strong></span><span class="No-Break"> command.</span></p>
<p>In the same way, you can find out how to configure your SSH client – that is, by running <span class="No-Break"><strong class="source-inline">man ssh_config</strong></span><span class="No-Break">.</span></p>
<p>Some very useful options for the client are <span class="No-Break">shown here:</span></p>
<pre class="console">
# Show keys ascii graphics
VisualHostKey yes
# Offer only one Identity at a time
Host *
  ForwardAgent yes
  IdentitiesOnly yes
  IdentityFile ~/.ssh/mydefaultkey
# Automatically add all used keys to agent
AddKeysToAgent yes</pre>
<p><strong class="source-inline">VisualHostKey</strong>, when set to <strong class="source-inline">yes</strong>, will show ASCII graphics for the public key of the server. Every <a id="_idIndexMarker251"/>server you will be connected to will have a unique key, so it’s going to be unique graphics. It’s useful because, as humans, we’re very good at spotting patterns, so if you are connecting to the <strong class="source-inline">1.2.35.2</strong> server but you intend to get into a different system, chances are that you will figure out something is not right just by seeing different graphics than what <span class="No-Break">you expected.</span></p>
<p>Here’s <span class="No-Break">an example:</span></p>
<pre class="console">
root@myhome:~# ssh user@hosts
Host key fingerprint is SHA256:EppY0d4YBvXQhCk0f98n1tyM7fBoyRMQl2o3ife1pY
+--[ED25519 256]--+
|    .oB++o       |
|     +o*o ..     |
|    +..o*.+ .    |
|    .o +.= . +   |
|    ..o.S.= = .  |
|      .ooooE. .  |
|        .o.o     |
|                 |
|                 |
+----[SHA256]-----+</pre>
<p>The host<a id="_idIndexMarker252"/> option allows you to set specific options for one or multiple servers. In this example, we’re enabling forwarding SSH agent and disabling password logins for all servers. Also, we’re setting a default private key we will be using to connect to any server. This leads us to SSH keys <span class="No-Break">and ciphers.</span></p>
<p>The final option, <strong class="source-inline">AddKeysToAgent</strong>, means<a id="_idIndexMarker253"/> that whenever you use (and unlock) a key, it will also be added to the SSH agent for future use. That way, you won’t need to specify a key to use while connecting and you won’t have to unlock the key on every <span class="No-Break">connection attempt.</span></p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor062"/>Creating and managing SSH keys</h2>
<p>SSH consists of<a id="_idIndexMarker254"/> three components: the transport layer (<strong class="bold">Transmission Control Protocol</strong> (<strong class="bold">TCP</strong>)/<strong class="bold">Internet Protocol</strong> (<strong class="bold">IP</strong>)), the user <a id="_idIndexMarker255"/>authentication layer, and a connection layer, which can effectively be multiple connections transferring <span class="No-Break">data independently.</span></p>
<p>In terms of the<a id="_idIndexMarker256"/> different authentication options, you have a basic form of password authentication, which has proved to be not enough. There’s also public-key authentication, which we’ll talk about here. The two<a id="_idIndexMarker257"/> remaining ones are <strong class="source-inline">keyboard-interactive</strong> and <strong class="bold">Generic Security Service Application Programming </strong><span class="No-Break"><strong class="bold">Interface</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">GSSAPI</strong></span><span class="No-Break">).</span></p>
<p>Public-key authentication requires us to generate a key that will have two counterparts: private and public. You will put the public key on the server inside <strong class="source-inline">authorized_keys</strong>; the private key will be used <span class="No-Break">to authenticate.</span></p>
<p>At the time of writing this book, RSA keys are standard for use with SSH. It is secure, but it’s recommended to use bigger keys that are 4,096 bits long, but 3,072 bits (the default) are considered sufficient. Bigger keys mean <span class="No-Break">slower connections.</span></p>
<p>Currently, a <a id="_idIndexMarker258"/>better choice is using the <strong class="source-inline">ed25519</strong> type of key, which has a <span class="No-Break">fixed length.</span></p>
<p>Additionally, all keys can be secured with <span class="No-Break">a password.</span></p>
<p>The following code shows how to generate both <span class="No-Break">key types:</span></p>
<pre class="console">
root@myhome:~# ssh-keygen -b 4096 -o -a 500 -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa
Your public key has been saved in /root/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:eMu9AMUjpbQQ7DJIl4MB2UnpfiUqwZJi+/e9dsKWXZg root@614bbd02e559
The key's randomart image is:
+---[RSA 4096]----+
|o=+++.. .        |
|.o++.o =         |
|o+... + +        |
|*o+ o .+ .       |
|+o.+ oo S   o    |
|..o .  + o E .   |
| ...    = + .    |
|   . .  .B +     |
|    . ..oo=      |
+----[SHA256]-----+
root@myhome:~# ssh-keygen -o -a 100 -t ed25519
Generating public/private ed25519 key pair.
Enter file in which to save the key (/root/.ssh/id_ed25519):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_ed25519
Your public key has been saved in /root/.ssh/id_ed25519.pub
The key fingerprint is:
SHA256:EOCjeyRRIz+hZy6Pbtcnjan2lucJ2Mdih/rFc/ZnthI
root@614bbd02e559
The key's randomart image is:
+--[ED25519 256]--+
|  . =..          |
|   * o .         |
|  o B .          |
|   * o .         |
|  + o   S        |
|   B o +    E    |
|  o +.*=B o  .   |
| ...ooB*+= .. +  |
| ..oo=o=o   .=.. |
+----[SHA256]-----+</pre>
<p>Now, to put <a id="_idIndexMarker259"/>this newly created key on a server, you will need to either copy it manually to the <strong class="source-inline">authorized_keys</strong> file or use the <strong class="source-inline">ssh-copy-id</strong> command, which will do this for you if you already have other means of access, such as <span class="No-Break">password authentication:</span></p>
<pre class="console">
root@myhome:~# ssh-copy-id -i ~/.ssh/id_ed25519 user@remote-host</pre>
<p>You can only perform the next login to this server by using <span class="No-Break">a key.</span></p>
<p>At this point, you should have a good understanding of how SSH works and how to use its most used features. You now know how to create your keys and where to save them on the <span class="No-Break">remote system.</span></p>
<h1 id="_idParaDest-67">Summary</h1>
<p>This chapter concludes our introduction to the basic Linux operations you will need in your daily work. It has by no means been comprehensive enough to explain everything that you need to know to manage your Linux system, but it is enough to get you started and should be enough to help you manage your system. In the next chapter, we are going to cover writing shell scripts from the very beginning and guide you through basic and more <span class="No-Break">advanced topics.</span></p>
<h1 id="_idParaDest-68">Exercises</h1>
<p>Try out the following exercises to test your knowledge of <span class="No-Break">this chapter:</span></p>
<ol>
<li>In Debian/Ubuntu, install the <span class="No-Break"><strong class="source-inline">vim</strong></span><span class="No-Break"> package.</span></li>
<li>Create a cron job that will create a file called <strong class="source-inline">/tmp/cronfile</strong> every Saturday at <span class="No-Break">10:00 A.M.</span></li>
<li>Create a group called <strong class="source-inline">admins</strong> and add an existing user <span class="No-Break">to it.</span></li>
</ol>
</div>
</div></body></html>