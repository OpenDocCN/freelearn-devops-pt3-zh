<html><head></head><body>
		<div id="_idContainer017">
			<h1 id="_idParaDest-24" class="chapter-number"><a id="_idTextAnchor027"/>2</h1>
			<h1 id="_idParaDest-25"><a id="_idTextAnchor028"/>Major Changes, Useful Tools, and References</h1>
			<p>This chapter will set out the major changes that have taken place since Puppet 5 up to the current versions, Puppet 6.28 and 7.21. This is viewed as the modern era of Puppet, where in the previous chapter, the change of focus was highlighted in the history of Puppet. This summary of changes will also cover some redundant patterns and approaches that might still be seen from earlier versions of Puppet, as these can still be visible in code and various sources. The chapter will then go on to discuss tooling to create a productive developer environment for Puppet, which will be used for the lab environment throughout this book. The aim will be to give an opinionated view of how to develop Puppet code and tooling that can assist with this. These tools can be installed in an environment of the readers’ choice. The lab environment itself will then be demonstrated by standing up a simple setup and logging in. The chapter will finish by looking at what resources are available for you to keep up to date with Puppet and research further topics <span class="No-Break">of interest.</span></p>
			<p>In this chapter, we’re going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Major changes since <span class="No-Break">Puppet 5</span></li>
				<li>Legacy patterns before <span class="No-Break">Puppet 5</span></li>
				<li>IDEs and tooling to assist in <span class="No-Break">Puppet development</span></li>
				<li>How to deploy your Puppet lab and <span class="No-Break">development tools</span></li>
				<li>References and <span class="No-Break">further research</span></li>
			</ul>
			<h1 id="_idParaDest-26"><a id="_idTextAnchor029"/>Technical requirements</h1>
			<p>The development environment will require an OS with access to the internet, which can be any of <span class="No-Break">the following:</span></p>
			<ul>
				<li>macOS using Homebrew to install <span class="No-Break">the software</span></li>
				<li>Windows 10/11 or Windows Server using Chocolatey to install <span class="No-Break">the software</span></li>
				<li>A Linux environment using package managers such as apt for Ubuntu or RHEL-based <span class="No-Break">using Yum</span></li>
			</ul>
			<p>The following software is required for the <span class="No-Break">development environment:</span></p>
			<ul>
				<li>Puppet <span class="No-Break">agent (</span><a href="https://www.puppet.com/docs/puppet/8/install_agents.html"><span class="No-Break">https://www.puppet.com/docs/puppet/8/install_agents.html</span></a><span class="No-Break">)</span></li>
				<li><span class="No-Break">Bolt (</span><a href="https://puppet.com/docs/bolt/latest/bolt.html"><span class="No-Break">https://puppet.com/docs/bolt/latest/bolt.html</span></a><span class="No-Break">)</span></li>
				<li>Visual Studio Code (<a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>) with the <span class="No-Break">following extensions:</span><ul><li>JSON for Visual <span class="No-Break">Studio Code</span></li><li><span class="No-Break">Puppet</span></li><li><span class="No-Break">rest client</span></li><li><span class="No-Break">Ruby</span></li><li><span class="No-Break">ShellCheck</span></li><li><span class="No-Break">Thunder client</span></li><li><span class="No-Break">VSCode Ruby</span></li><li><span class="No-Break">YAML</span></li><li><span class="No-Break">PowerShell</span></li><li>The Puppet module <span class="No-Break">PECDM (</span><span class="No-Break">https://github.com/puppetlabs/puppetlabs-pecdm</span><span class="No-Break">)</span></li></ul></li>
				<li>The GitHub <span class="No-Break">CLI (</span><a href="https://github.com/cli/cli"><span class="No-Break">https://github.com/cli/cli</span></a><span class="No-Break">)</span></li>
				<li>The Puppet development <span class="No-Break">toolkit (</span><a href="https://puppet.com/try-puppet/puppet-development-kit/"><span class="No-Break">https://puppet.com/try-puppet/puppet-development-kit/</span></a><span class="No-Break">)</span></li>
				<li>The Azure <span class="No-Break">CLI (</span><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli"><span class="No-Break">https://docs.microsoft.com/en-us/cli/azure/install-azure-cli</span></a><span class="No-Break">)</span></li>
				<li>An <span class="No-Break">Azure account</span></li>
				<li>A GitHub account (<span class="No-Break">free account)</span></li>
				<li>The SSH keys created to communicate <span class="No-Break">with GitHub</span></li>
			</ul>
			<p>The PECDM module (<a href="https://github.com/puppetlabs/puppetlabs-pecdm">https://github.com/puppetlabs/puppetlabs-pecdm</a>) will create resources as specified via the <strong class="source-inline">bolt</strong> command. The cost of running the labs in Azure should be carefully watched via the Azure cost analysis tools to avoid unexpected bills. Labs not in use should be destroyed or at least deallocated to <span class="No-Break">reduce charges.</span></p>
			<p>All of these components have equivalents that you might use in your organization. However, the purpose of this development and lab setup is to make it as simple and automated a setup as possible. It might well be an exercise you wish to do as the book progresses to test out your own components. PECDM itself supports AWS, Azure, and GCP with instructions on the module to configure the <span class="No-Break">necessary CLI.</span></p>
			<p>The code for this section can be found <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/tree/main/ch02"><span class="No-Break">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/tree/main/ch02</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-27"><a id="_idTextAnchor030"/>Major changes since Puppet 5</h1>
			<p>Puppet 5 reflects the change in direction of Puppet as an organization, which was highlighted in the previous chapter. Its focus is on performance and scaling for infrastructure and stability in the language. This section will cover the changes that have taken place between Puppet 5 and 7; these versions reflect the versions of Puppet in use, which you are likely to see in code bases you are working with and in modules you would take from the Puppet forge. It will also cover some old patterns and issues you might see in code that reflect how Puppet was before <span class="No-Break">version 5.</span></p>
			<h2 id="_idParaDest-28"><a id="_idTextAnchor031"/>Puppet 5</h2>
			<p>Puppet 4 had a large<a id="_idIndexMarker036"/> number of deprecated features, which were almost all removed in Puppet 5. It is not worth listing all of these features, but just to set the context of the release, it was more about finishing what had been started in Puppet 4 by introducing more new features. It standardized package numbering, with all the Puppet packages starting at 5.0.0 instead of the mismatches of various packages, such as Puppet 4 requiring Puppet Server 2.x and Puppet <span class="No-Break">agent 1.x.</span></p>
			<p>Puppet 5 as a server platform delivered big boosts in performance: agent runtimes were 30 percent lower, CPU utilization was at least 20 percent lower, the catalog compile times reported by Puppet Server were 7 to 10 percent lower, and Puppet 5 was able to scale to 40 percent more agents. Puppet Server metrics were introduced to give greater observability of the Puppet platform. In addition to this greater performance and scalability, Puppet Enterprise 2017.4 onward had capabilities to allow for disaster recovery along with package inspection, which stored information about software installed across the estate regardless<a id="_idIndexMarker037"/> of whether Puppet managed it or not. Full technical details of the Puppet Enterprise features will be discussed in <a href="B18492_14.xhtml#_idTextAnchor340"><span class="No-Break"><em class="italic">Chapter 14</em></span></a><span class="No-Break">.</span></p>
			<p>Although not affiliated directly with Puppet 5, the <strong class="bold">Puppet Development Kit</strong> (<strong class="bold">PDK</strong>) was released around the same time, which automated a lot of tool installation, testing, linting, and the creation of module directories (this will be covered in detail in <a href="B18492_08.xhtml#_idTextAnchor212"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>). Previously, this had to be done by hand or by individual developer automation. Additionally, Hiera 5 integrated with EYAML (a mechanism of encrypted data covered in <a href="B18492_09.xhtml#_idTextAnchor233"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>), which was introduced and massively simplified how data could be secured and <span class="No-Break">still used.</span></p>
			<h2 id="_idParaDest-29"><a id="_idTextAnchor032"/>Puppet 6</h2>
			<p>Puppet 6 came with a substantial change when a lot of types that had been included with the core Puppet install were removed and put into modules, which users could choose to download from the<a id="_idIndexMarker038"/> Puppet forge. This was to narrow down the installation, as the number of core types had grown over time, and it was far more efficient for users to choose what they wanted. A review of what functions were being consistently used took place, and a number of string and math functions were moved from the <strong class="source-inline">stdlib</strong> module into core Puppet to reflect their core use. The trusted external command was also introduced; this allowed for external data sources to be queried and brought in like facts, so an API on a Satellite server or a database server could be called and brought in for use in Puppet code. This will be covered in detail in <a href="B18492_13.xhtml#_idTextAnchor321"><span class="No-Break"><em class="italic">Chapter 13</em></span></a>. Additionally, the deferred data type was introduced, which allowed variables to run deferred functions locally on machines at deployment time. This is particularly useful for use cases such as secret management, for example, a vault, where a traditional function would make its call from the Puppet primary server and send the secret to the agent over the Puppet infrastructure. Parametrized execs were introduced in 6.24, which allow for the separation of commands from parameters when using the <strong class="source-inline">exec</strong> resource type – a powerful security measure to prevent commands from being passed instead <span class="No-Break">of parameters.</span></p>
			<p>On the platform side, the Puppet certificate commands were changed from <strong class="source-inline">puppet cert</strong> commands to <strong class="source-inline">puppet server ca</strong>, which were more complete and more powerful commands. Also, PuppetDB <a id="_idIndexMarker039"/>was included on Puppet compiler servers to better manage the load of requests on PuppetDB. The full details of the platform are covered in <a href="B18492_10.xhtml#_idTextAnchor252"><span class="No-Break"><em class="italic">Chapter 10</em></span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor033"/>Puppet 7</h2>
			<p>One of the most noticeable changes<a id="_idIndexMarker040"/> in Puppet 7 was the removal of harmful terminology following a review and work beginning in 2014. This focused on phrases such as master/slave and blacklists/whitelists. For Puppet, this means that master servers became primary servers, master services became server services, and in modules, the master branch became the main branch. It also means blacklist/whitelist terminology was replaced with allow <span class="No-Break">list/block list.</span></p>
			<p>The parameterized execs mentioned in the Puppet 6 updates were available with the 7.9 Puppet language. Factor was upgraded to version 4, a re-write in Ruby, which provides features such as benchmarking, timeouts, and user caching, which will be discussed in <a href="B18492_05.xhtml#_idTextAnchor123"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>. The option to not include legacy facts via the <strong class="source-inline">include_legacy_facts</strong> option was included as <span class="No-Break">of 7.21.</span></p>
			<p>The platform upgraded to Postgres 11 and Ruby 2.7, which further <span class="No-Break">increased performance.</span></p>
			<p>The reporting mechanism also had the option to not include unchanged resources in its reports via the <span class="No-Break"><strong class="source-inline">exclude_unchanged_resources</strong></span><span class="No-Break"> option.</span></p>
			<p>Again, although not affiliated with Puppet releases directly, PDK 2.0 was released close to Puppet 7, dropping support for <span class="No-Break">Puppet 4.</span></p>
			<h1 id="_idParaDest-31"><a id="_idTextAnchor034"/>Legacy Puppet patterns</h1>
			<p>This section will highlight some old patterns and their reason for use in old versions of Puppet. This will help you to understand <a id="_idIndexMarker041"/>code that can be commonly found in older, unmaintained modules or code that simply has never been refactored over time. Puppet 4 introduced data types, but before this, all variables were strings, and a lot of comparisons and other functions could have quite strange and inconsistent results. To understand the full extent of this, you can view <a href="https://www.youtube.com/watch?v=aU7vjKYqMUo">www.youtube.com/watch?v=aU7vjKYqMUo</a>. Therefore, you might see in historic code the odd handling of variables and checks for undefined<a id="_idIndexMarker042"/> variables. Originally, <strong class="bold">facter</strong> facts were also just called <strong class="bold">top-level variables</strong>, which <a id="_idIndexMarker043"/>could be very confusing with normal variables and created the opportunity for accidental overrides. This<a id="_idIndexMarker044"/> changed to the <strong class="bold">facts hash</strong>, which we will show in more detail in <a href="B18492_05.xhtml#_idTextAnchor123"><span class="No-Break"><em class="italic">Chapter 5</em></span></a><span class="No-Break">.</span></p>
			<p>The platform infrastructure was more complicated and varied with the options of using Rack or WEBrick configurations. In very early versions of Puppet code, which predate the <strong class="source-inline">file_line</strong> function of the Puppet <strong class="source-inline">stdlib</strong> module, there was no way to manage single lines of a file. This resulted in the overuse of Augeas (a tool that can parse files to allow for manipulation) and templates (which allow for the creation of file using conditional logic and variables). Augeuas is very advanced but often over-complicated and a drain on performance, while the overuse of templates resulted in whole files being enforced instead of just the individual line or setting required. Therefore, when working with Puppet code that was developed in earlier versions, it is worth reviewing to make sure any code <a id="_idIndexMarker045"/>you inherit really does need to control a whole file and does not overuse Augeas when simpler solutions now exist. The <strong class="source-inline">params.pp</strong> pattern was heavily used in modules before Hiera offered the ability for class parameters to be overwritten. The sensitive data type was not introduced until 4.6, which made it hard to handle any secret data securely in code. Finally, the original Puppet versions had no concept of loops, as provided by lambda functions, which were introduced in Puppet 4. So, you might find, in old code examples, obscure patterns being used to achieve a <span class="No-Break">similar effect.</span></p>
			<h1 id="_idParaDest-32"><a id="_idTextAnchor035"/>IDEs and tools to assist in Puppet development</h1>
			<p>One of the greatest issues with early Puppet development was the lack of a consensus around how to develop and a lack of integration. As discussed in <a href="B18492_01.xhtml#_idTextAnchor018"><span class="No-Break"><em class="italic">Chapter 1</em></span></a> this changed <a id="_idIndexMarker046"/>greatly around the time Puppet 5 was released. This section highlights some tools as opinionated recommendations based on usage and experience in Puppet, and most of them will be used in the labs and demonstrations. This is certainly not the only way to develop Puppet code, and your organization might require the usage of different tools depending on <span class="No-Break">the environment.</span></p>
			<p>The <strong class="bold">PDK</strong> is central to <a id="_idIndexMarker047"/>how Puppet development has changed for the better and will be discussed, in full, in <a href="B18492_08.xhtml#_idTextAnchor212"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>. It bundles various elements of tooling for creating modules, linting, and testing and allows them to be run from the <strong class="source-inline">pdk</strong> command. Previously, Puppet developers had to gather the tools, install dependencies, and then run each of the various commands that <strong class="source-inline">pdk</strong> is made <span class="No-Break">up of.</span></p>
			<p>Visual Studio Code has become an incredibly powerful and popular source code editor. It is free and multiplatform, with a vast selection of extensions including the Puppet extension (<a href="https://marketplace.visualstudio.com/items?itemName=puppet.puppet-vscode">https://marketplace.visualstudio.com/items?itemName=puppet.puppet-vscode</a>). It creates powerful shortcuts that allow all your work to take place in the IDE, which will be demonstrated throughout <span class="No-Break">this book.</span></p>
			<p>I will not be using it as part of the lab directly, but since many prefer a command-line editor as opposed to Visual Studio Code, it should be noted there are Vim modules (<a href="https://github.com/rodjek/vim-puppet">https://github.com/rodjek/vim-puppet</a>) that can provide linting and syntax checking <span class="No-Break">within VIM.</span></p>
			<p>A particularly useful web<a id="_idIndexMarker048"/> page for development is the <a href="https://validate.puppet.com/">https://validate.puppet.com/</a> site, which can be used to quickly paste in Puppet code to validate and parse it and create <span class="No-Break">relationship graphs.</span></p>
			<p>At an even more advanced level is the Puppet debugger (<a href="https://github.com/nwops/puppet-debugger">https://github.com/nwops/puppet-debugger</a>), which allows for running Puppet code and taking breaks in the code, which allows you to see the state of variables. This will become useful as more advanced code <span class="No-Break">is authored.</span></p>
			<h1 id="_idParaDest-33"><a id="_idTextAnchor036"/>How to deploy your Puppet lab and development tools</h1>
			<p>This section will run through how to install and configure your desktop environment and then use that environment to<a id="_idIndexMarker049"/> stand up the Puppet infrastructure in Azure, configure it with a control repo, deploy some modules to an environment, and test logins to the web console. This will confirm the lab environment functions as expected and should give you the confidence to start up and shut down the labs as required to avoid paying for unecessary virtual machine running time costs <span class="No-Break">on Azure.</span></p>
			<p>In <span class="No-Break"><em class="italic">Figure 2</em></span><em class="italic">.1</em>, the final result of this exercise is shown. The device you use as a development environment will have Visual Studio Code installed to edit the code that has been cloned from GitHub. A PowerShell or shell session, depending on the OS, will use Bolt with Terraform to stand up the infrastructure in Azure and then apply the configuration to that infrastructure, configuring a Puppet Enterprise server and an attached instance to that <a id="_idIndexMarker050"/>server. The web console of the Puppet Enterprise server will be accessible via HTTPS to a <span class="No-Break">web browser:</span></p>
			<div>
				<div id="_idContainer016" class="IMG---Figure">
					<img src="image/Figure_02.01.jpg" alt="Figure 2.1 – The ﻿lab setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.1 – The lab setup</p>
			<h2 id="_idParaDest-34"><a id="_idTextAnchor037"/>Mac desktop</h2>
			<p>The Mac installation<a id="_idIndexMarker051"/> will rely on Homebrew to automate the<a id="_idIndexMarker052"/> installation process, for which Puppet has created its own repos (<a href="https://github.com/puppetlabs/homebrew-puppet">https://github.com/puppetlabs/homebrew-puppet</a>). Run the following commands to install the desktop tooling that was highlighted in the <em class="italic">Technical </em><span class="No-Break"><em class="italic">requirements</em></span><span class="No-Break"> section:</span></p>
			<pre class="console">
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
brew update
brew install azure-cli
brew install --cask puppetlabs/puppet/puppet-agent
brew install --cask puppetlabs/puppet/pdk
brew install --cask puppetlabs/puppet/puppet-bolt
brew install --cask visual-studio-code
brew install gh
brew install shellcheck
brew install puppetlabs/puppet/pe-client-tools
brew install git</pre>
			<h2 id="_idParaDest-35"><a id="_idTextAnchor038"/>Windows desktop</h2>
			<p>The Windows installation<a id="_idIndexMarker053"/> relies on Chocolatey for installation. Run<a id="_idIndexMarker054"/> the following code in a PowerShell session; note that administrative rights are only required for the <span class="No-Break">first command:</span></p>
			<pre class="console">
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
choco install pdk -y
choco install puppet-agent -y
choco install vscode-puppet-y
choco install puppet-bolt -y
choco install vscode -y
choco install git -y
choco install pe-client-tools -y
choco install gh -y
choco install azure-cli -y
choco install shellcheck -y
Install-Module PuppetBolt
Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</pre>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor039"/>Linux desktop – RPM-based</h2>
			<p>This RPM-based Linux desktop installation was tested with Rocky Linux 8. So, some localized adjustments need to be<a id="_idIndexMarker055"/> made depending on your specific OS version and the difference in flavor. However, running the following code will <a id="_idIndexMarker056"/>add necessary the Yum repositories from the vendors and install <span class="No-Break">the packages:</span></p>
			<pre class="source-code">
<strong class="bold">release=$(rpm -E '%{?rhel}')</strong>
<strong class="bold">sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc</strong>
<strong class="bold">sudo sh -c 'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" &gt; /etc/yum.repos.d/vscode.repo'</strong>
<strong class="bold">sudo rpm -Uvh https://yum.puppet.com/puppet7-release-el-${release}.noarch.rpm</strong>
<strong class="bold">sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc</strong>
<strong class="bold">echo -e "[azure-cli]</strong>
<strong class="bold">name=Azure CLI</strong>
<strong class="bold">baseurl=https://packages.microsoft.com/yumrepos/azure-cli</strong>
<strong class="bold">enabled=1</strong>
<strong class="bold">gpgcheck=1</strong>
<strong class="bold">gpgkey=https://packages.microsoft.com/keys/microsoft.asc" | sudo tee /etc/yum.repos.d/azure-cli.repo</strong>
<strong class="bold">sudo dnf config-manager --add-repo https://cli.github.com/packages/rpm/gh-cli.repo</strong>
<strong class="bold">sudo rpm -Uvh https://yum.puppet.com/puppet-tools-release-el-8.noarch.rpm</strong>
<strong class="bold">sudo yum -y install epel-release</strong>
<strong class="bold">sudo yum check-update</strong>
<strong class="bold">sudo dnf install gh</strong>
<strong class="bold">sudo yum install code</strong>
<strong class="bold">sudo dnf install azure-cli</strong>
<strong class="bold">sudo yum install ShellCheck</strong>
<strong class="bold">sudo yum install puppet-bolt</strong>
<strong class="bold">sudo yum install https://pm.puppetlabs.com/pe-client-tools/2021.7.0/21.7.0/repos/el/8/PC1/x86_64/pe-client-tools-21.7.0-1.el8.x86_64.rpm</strong></pre>
			<p>The client tools are at a<a id="_idIndexMarker057"/> specific version and should be <a id="_idIndexMarker058"/>adjusted to match your installation. Check out <a href="https://puppet.com/try-puppet/puppet-enterprise-client-tools/">https://puppet.com/try-puppet/puppet-enterprise-client-tools/</a> to find the <span class="No-Break"><strong class="source-inline">curl</strong></span><span class="No-Break"> command.</span></p>
			<h2 id="_idParaDest-37"><a id="_idTextAnchor040"/>Linux desktop – APT-based</h2>
			<p>The APT-based Linux desktop <a id="_idIndexMarker059"/>was tested with Ubuntu 20.04, so<a id="_idIndexMarker060"/> some localized adjustments need to be made depending on your specific OS version and the difference in flavor. However, running the following code should add the necessary APT repositories and install the desktop development <span class="No-Break">software required:</span></p>
			<pre class="source-code">
<strong class="bold">release=$(lsb_release -c | awk '{print $2}')</strong>
<strong class="bold">wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; packages.microsoft.gpg</strong>
<strong class="bold">sudo install -o root -g root -m 644 packages.microsoft.gpg /etc/apt/trusted.gpg.d/</strong>
<strong class="bold">sudo sh -c 'echo "deb [arch=amd64,arm64,armhf signed-by=/etc/apt/trusted.gpg.d/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main" &gt; /etc/apt/sources.list.d/vscode.list'</strong>
<strong class="bold">wget https://apt.puppet.com/puppet7-release-${release}.deb</strong>
<strong class="bold">wget https://apt.puppet.com/puppet-tools-release-${release}.deb</strong>
<strong class="bold">curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg</strong>
<strong class="bold">echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list &gt; /dev/null</strong>
<strong class="bold">sudo apt-get update</strong>
<strong class="bold">sudo dpkg -i puppet7-release-${release}.deb</strong>
<strong class="bold">sudo dpkg -i puppet-tools-release-${release}.deb</strong>
<strong class="bold">rm packages.microsoft.gpg</strong>
<strong class="bold">rm puppet7-release-${release}.deb</strong>
<strong class="bold">rm puppet-tools-release-${release}.deb</strong>
<strong class="bold">sudo apt install apt-transport-https</strong>
<strong class="bold">sudo apt update</strong>
<strong class="bold">sudo apt install code</strong>
<strong class="bold">sudo apt –y install puppet-agent</strong>
<strong class="bold">sudo apt-get install git</strong>
<strong class="bold">sudo dpkg -i puppet-tools-release-${release}.deb</strong>
<strong class="bold">sudo apt-get install puppet-bolt</strong>
<strong class="bold">sudo apt install gh</strong>
<strong class="bold">curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash</strong>
<strong class="bold">sudo apt install shellcheck</strong>
<strong class="bold">curl -JLO ' https://pm.puppetlabs.com/pe-client-tools/2021.7.0/21.7.0/repos/deb/focal/PC1/pe-client-tools_21.7.0-1focal_amd64.deb'</strong>
<strong class="bold">sudo apt install ./pe-client-tools_21.7.0-1focal_amd64.deb</strong></pre>
			<p>The client tools are at<a id="_idIndexMarker061"/> a specific version and should be adjusted to<a id="_idIndexMarker062"/> match your installation. Check out <a href="https://puppet.com/try-puppet/puppet-enterprise-client-tools/">https://puppet.com/try-puppet/puppet-enterprise-client-tools/</a> to find the <span class="No-Break"><strong class="source-inline">curl</strong></span><span class="No-Break"> command.</span></p>
			<h2 id="_idParaDest-38"><a id="_idTextAnchor041"/>Configuring tools</h2>
			<p>Now that you have the core tools installed on whichever desktop environment you are using, the core steps<a id="_idIndexMarker063"/> will be the same for running and managing <span class="No-Break">the applications.</span></p>
			<p>First of all, we need to register with GitHub (<a href="https://github.com/join">https://github.com/join</a>) and register with Azure (<a href="https://azure.microsoft.com/en-gb/free/">https://azure.microsoft.com/en-gb/free/</a>). Once these registrations are complete, log in to the CLIs for both. Run the following and log in to the web page that <span class="No-Break">will appear:</span></p>
			<pre class="source-code">
<strong class="bold">gh auth login</strong>
<strong class="bold">az login</strong></pre>
			<p>The next step is to generate keys that will allow for communication with GitHub. You can do this by running <span class="No-Break">the following:</span></p>
			<pre class="source-code">
<strong class="bold">ssh-keygen -t rsa –b 4096 -P ''</strong></pre>
			<p>Then, we upload the key we have created using the GitHub CLI. For Mac or Linux, run <span class="No-Break">the following:</span></p>
			<pre class="source-code">
<strong class="bold">gh ssh-key add ~/.ssh/id_rsa.pub</strong></pre>
			<p>For the equivalent location of the SSH key in Windows, run <span class="No-Break">the following:</span></p>
			<pre class="source-code">
<strong class="bold">gh ssh-key add %USERPROFILE%\.ssh\id_rsa.pub</strong></pre>
			<p>Then, extensions for Visual Studio Code can be added by downloading the <strong class="source-inline">extension<a id="_idTextAnchor042"/>s.list</strong> file from the Packt GitHub repo at <a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch02/extensions.list">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch02/extensions.list</a> and looping through the lines <span class="No-Break">to install.</span></p>
			<p>For Mac or Linux, you can achieve this by running <span class="No-Break">the following:</span></p>
			<pre class="source-code">
<strong class="bold">cat extensions.list | xargs -L1 code --install-extension</strong></pre>
			<p>For Windows, you can run <span class="No-Break">the following:</span></p>
			<pre class="source-code">
<strong class="bold">foreach($line in get-content extensions.list) {code --install-extension $($line)}</strong></pre>
			<p>The next step will be to create<a id="_idIndexMarker064"/> an area for you to have a code workspace and then download the <strong class="source-inline">pecdm</strong> module into it. For Linux and Mac, in your home directory, we will create a workspace and then clone <strong class="source-inline">pecdm</strong> into this directory by running <span class="No-Break">the following:</span></p>
			<pre class="source-code">
<strong class="bold">mkdir ~workspace/pecdm</strong>
<strong class="bold">git clone git@github.com:puppetlabs/puppetlabs-pecdm.git ~workspace/pecdm</strong>
<strong class="bold">cd ~workspace/pecdm</strong></pre>
			<p>For Windows, we will assume the equivalent directory in the user profile, creating a <strong class="source-inline">workspace</strong> directory there, and then cloning it by running <span class="No-Break">the following:</span></p>
			<pre class="source-code">
<strong class="bold">mkdir %USERPROFILE%\workspace</strong>
<strong class="bold">git clone git@github.com:puppetlabs/puppetlabs-pecdm.git %USERPROFILE%\workspace\pecdm</strong>
<strong class="bold">cd %USERPROFILE%\workspace\pecdm</strong></pre>
			<p>Now that we have everything installed and have a work area with the cloned module, we can configure the module and run the following Bolt plan to create the Puppet infrastructure in Azure. This will stand up a Puppet 2021.7.0 primary server and create a single client registered to it. The SSH user allows you to use the SSH keys created earlier to connect to the hosts. For this example, the <strong class="source-inline">params.json</strong> file should be downloaded to the pecdm directory from <a href="https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch02/params.json">https://github.com/PacktPublishing/Puppet-8-for-DevOps-Engineers/blob/main/ch02/params.json</a>, I have used the UK south region and allowed an open-to-anything firewall, but you will want to choose the cloud region closest to you and set a firewall with rules to allow only your desktop environment and Azure region to access it. The following links can help you to work out <span class="No-Break">this choice:</span></p>
			<ul>
				<li><a href="https://azure.microsoft.com/en-gb/global-infrastructure/geographies/#geographies"><span class="No-Break">https://azure.microsoft.com/en-gb/global-infrastructure/geographies/#geographies</span></a></li>
				<li><a href="https://www.azurespeed.com/Azure/Latency"><span class="No-Break">https://www.azurespeed.com/Azure/Latency</span></a></li>
			</ul>
			<p>The code is <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
<strong class="bold">bolt module install --no-resolve</strong>
<strong class="bold">bolt --verbos<a id="_idTextAnchor043"/>e plan run pecdm::provision @params.json</strong></pre>
			<p>This should take around <a id="_idIndexMarker065"/>20 to 30 minutes <span class="No-Break">to complete.</span></p>
			<p>You can then run the following Azure CLI command to return the list of hostnames and <span class="No-Break">public IPs:</span></p>
			<pre class="source-code">
<strong class="bold">az network public-ip list -g packtlab --query "[].{Hostname:name,Public_IP:ipAddress}" --output tsv</strong></pre>
			<p>The output will look similar <span class="No-Break">to this:</span></p>
			<pre class="source-code">
<strong class="bold">pe-node-packtlab-0-cffe02      20.108.156.266</strong>
<strong class="bold">pe-server-packlab-0-cffe02    20.108.156.67</strong></pre>
			<p>Copy the IP address listed for the entry that starts with <strong class="source-inline">pe-server</strong> into a web browser to reach the Puppet Enterprise console screen. Then, you can use the login details with the username <a id="_idTextAnchor044"/>of <strong class="source-inline">admin</strong> and the password <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">puppetlabs</strong></span><span class="No-Break">.</span></p>
			<p>To destroy this infrastructure and ensure no unnecessary costs are incurred, run the <span class="No-Break">following command:</span></p>
			<pre class="source-code">
<strong class="bold">bolt plan run pecdm::destroy provider=azure</strong></pre>
			<p>Alternatively, if labs are to be kept for periods of time, it is possible to stop and deallocate each virtual machine to minimize the charge and then restart them later using the <span class="No-Break">following commands:</span></p>
			<pre class="source-code">
<strong class="bold">az vm deallocate --resource-group packtlab --name &lt;VM name&gt;</strong>
<strong class="bold">az vm start --resource-group packtlab --name &lt;VM name&gt;</strong></pre>
			<p>This section has fully run through the creation of your developer desktop and then standing up and destroying Puppet infrastructure. It ensures you are ready for the labs in future chapters. In this lab, the <strong class="source-inline">pecdm</strong> and <strong class="source-inline">peadm</strong> modules are used to configure a standard architecture, which is one of Puppet’s supported architectures: <a href="https://puppet.com/docs/pe/latest/supported_architectures.html">https://puppet.com/docs/pe/latest/supported_architectures.html</a>. In <a href="B18492_14.xhtml#_idTextAnchor340"><span class="No-Break"><em class="italic">Chapter 14</em></span></a><em class="italic">, </em>we will discuss, in more detail, the different architecture options. But for now, it is important to understand that the standard is the base level providing a single Puppet Server. In this scenario, <strong class="source-inline">pecdm</strong> configures the necessary infrastructure using Terraform, while <strong class="source-inline">peadm</strong> installs the Puppet Enterprise components. Both modules will be used as <a id="_idIndexMarker066"/>examples of using Bolt projects, tasks, and plans and will be reviewed in <a href="B18492_12.xhtml#_idTextAnchor293"><span class="No-Break"><em class="italic">Chapter 12</em></span></a><span class="No-Break"><em class="italic">.</em></span></p>
			<h1 id="_idParaDest-39"><a id="_idTextAnchor045"/>References and further research</h1>
			<p>This section will cover further resources and references that can be used alongside this book. They go into further depth and enable you to learn about Puppet from both Puppet and <span class="No-Break">the community.</span></p>
			<p>The general page (<a href="https://puppet.com/docs/">https://puppet.com/docs/</a>) is the core doc page, where you can find all the products of Puppet and sections such as patterns and tactics. We will highlight different sections of the docs to<a id="_idIndexMarker067"/> refer to as we progress through <span class="No-Break">the book.</span></p>
			<p>Puppet runs through various media forms where a variety of articles are published covering new product releases, security updates, and guides for implementations. Their handles are listed <span class="No-Break">as follows:</span></p>
			<ul>
				<li><span class="No-Break">Blog: </span><a href="https://puppet.com/blog"><span class="No-Break">https://puppet.com/blog</span></a></li>
				<li><span class="No-Break">Podcast: </span><a href="https://pulling-the-strings.simplecast.com/"><span class="No-Break">https://pulling-the-strings.simplecast.com/</span></a></li>
				<li>Dev.to articles: <a href="https://dev.to/puppetecosystem">https://dev.to/puppetecosystem</a> <span class="No-Break">and </span><a href="https://dev.to/puppet"><span class="No-Break">https://dev.to/puppet</span></a></li>
				<li>Twitter: <a href="https://twitter.com/puppetize">https://twitter.com/puppetize</a> <span class="No-Break">and </span><a href="https://twitter.com/PuppetEcosystem"><span class="No-Break">https://twitter.com/PuppetEcosystem</span></a></li>
				<li><span class="No-Break">YouTube: </span><a href="https://www.youtube.com/channel/UCPfMWIY-qNbLhIrbZm2BFMQ"><span class="No-Break">https://www.youtube.com/cha<span id="_idTextAnchor046"/>nnel/UCPfMWIY-qNbLhIrbZm2BFMQ</span></a></li>
			</ul>
			<p>Puppet has its own learning site (<a href="https://training.puppet.com/learn">https://training.puppet.com/learn</a>),this site includes various elements such as the Puppet practice labs, which are online labs you can run entirely from a web browser and tackle boxes, which are guides on achieving small focused tasks. Puppet’s support knowledge base was made public in April 2022, allowing anyone to search and view the troubleshooting guides, best practices, and FAQs, which are available at <a href="https://support.puppet.com">https://support.puppet.com</a>, without the need for a login. Archived articles for the older version of Puppet can be found <span class="No-Break">at </span><a href="https://github.com/puppetlabs/docs-archive/tree/main/supportkb#readme"><span class="No-Break">https://github.com/puppetlabs/docs-archive/tree/main/supportkb#readme</span></a><span class="No-Break">.</span></p>
			<p>Puppet previously run two, instructor-led training courses, which had to be paid for and lasted 3 days (<em class="italic">Getting started with Puppet </em>and<em class="italic"> Puppet Practioner</em>). During 2022 the <em class="italic">Fundamental Core Training</em> modules replaced <em class="italic">Getting started with Puppet</em>, and the <em class="italic">Advanced Core Training</em> modules replaced <span class="No-Break"><em class="italic">Puppet Practioner</em></span><span class="No-Break">.</span></p>
			<p>The key difference is that the <strong class="source-inline">Fundamental Core Training</strong> modules are free to register for, and both training sets are broken<a id="_idIndexMarker068"/> up into three module sets that are each a day long. More details can be found on the Puppet <span class="No-Break">Compass site.</span></p>
			<p><em class="italic">Fundamental </em><span class="No-Break"><em class="italic">Core Training</em></span><span class="No-Break">:</span></p>
			<ul>
				<li>PE101: Deploy <span class="No-Break">and Discover</span></li>
				<li>PE201: Design <span class="No-Break">and Manage</span></li>
				<li>PE301: Develop <span class="No-Break">and Maintain</span></li>
			</ul>
			<p><em class="italic">Advanced </em><span class="No-Break"><em class="italic">Core Training</em></span><span class="No-Break">:</span></p>
			<ul>
				<li>PE401: <span class="No-Break">Extend Capability</span></li>
				<li>PE501: <span class="No-Break">Continuously Deliver</span></li>
				<li>PE601: Automate <span class="No-Break">at Scale</span></li>
			</ul>
			<p>Enterprise modules that produce commercially licensed Puppet modules on the Puppet forge have a blog discussing various Puppet topics at <a href="https://www.enterprisemodules.com/blog/">https://www.enterprisemodules.com/blog/</a> and a Twitter account <span class="No-Break">at </span><a href="https://twitter.com/enterprisemodul"><span class="No-Break">https://twitter.com/enterprisemodul</span></a><span class="No-Break">.</span></p>
			<p>Two other noted Puppet consultancy and development groups were formed after the split of Example42 GmbH into Example42, which is now a brand of Lab42 with a blog at <a href="https://blog.example42.com/blog/">https://blog.example42.com/blog/</a> and a Twitter account at <a href="https://twitter.com/example42">https://twitter.com/example42</a>, and Betabots, which has a blog at <a href="https://dev.to/betadots">https://dev.to/betadots</a> and a Twitter account at <a href="https://twitter.com/betadots">https://twitter.com/betadots</a>. Both provide insights into their Puppet development work <span class="No-Break">and approaches.</span></p>
			<p>To ask questions about Puppet or talk with people in the community, you can join <a href="https://slack.puppet.com/">https://slack.puppet.com/</a> and <a href="https://www.reddit.com/r/Puppet/">https://www.reddit.com/r/Puppet/</a> to ask questions about Puppet and <span class="No-Break">the community.</span></p>
			<p>This section is not<a id="_idIndexMarker069"/> supposed to be an exhaustive list of references. It is to give a view of some of the better-known and long-lasting sources of information and communities to view and follow to get to know <span class="No-Break">Puppet better.</span></p>
			<h1 id="_idParaDest-40"><a id="_idTextAnchor047"/>Summary</h1>
			<p>In this chapter, we discussed the changes in the modern versions of Puppet 5 to 7 and some antipatterns to look out for that could be left over from legacy Puppet code. It might be more practical to come back to this section if you aren’t familiar with Puppet and read through the changes again once completing <span class="No-Break">the book.</span></p>
			<p>We covered the available tooling to use in a developer environment and the IDE to automate and quicken your Puppet development environment, and we have installed these tools to introduce the lab. We have learned how to stand up both the reader’s development environment and the Puppet infrastructure <span class="No-Break">in Azure.</span></p>
			<p>At the end of this chapter, we covered the various sources and communities that can be used to further learn about Puppet, keep up to date with ongoing developments, and signpost where to ask questions and discuss Puppet with <span class="No-Break">the community.</span></p>
			<p>In the next chapter, we will begin to look at the Puppet language, covering the fundamental building blocks of resources, types, and providers. We will look at the basic syntax and style of coding in Puppet and how to use various references and commands to make it easier to generate code and find documentation. We will look at the core types to start coding in Puppet and how to use them well. Then, we will look at how to use defined types for repeatable patterns of resources, use classes to contain and include resources in catalogs, and finally, finish by looking at the more advanced feature of exporting and collecting resources to share resource declarations across <span class="No-Break">multiple clients.</span></p>
		</div>
	</body></html>