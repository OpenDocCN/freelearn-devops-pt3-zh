

# 数据与元数据备份

在本章中，我们将探讨将数据和元数据备份作为全面 Salesforce DevOps 战略的一部分的关键重要性。我们将讨论组织面临的数据丢失和系统停机带来的巨大成本，包括生产力损失、收入损失和声誉损害。有效的备份可以通过快速恢复减少业务中断的影响。我们将探讨一些关键功能，如外部存储、自动化、集成、安全性和智能恢复功能，帮助您为 Salesforce 架构备份方案。

本章强调在备份中同时捕获元数据和数据，以充分保护业务连续性。将重点介绍元数据在保障数据安全、提供上下文、支持自动化以及维护配置中的不可或缺作用。类似地，我们将讨论如何在大规模备份 Salesforce 灵活数据模型时使用有效的技术。您将学会如何将备份工具集成到开发工作流中，以增加其价值，不仅限于保护功能，还能优化恢复过程。

我们将涵盖以下主要主题：

+   *为何备份应成为 DevOps 流程的一部分*：我们将首先探讨定期且准确备份在整体 DevOps 战略中所扮演的基础性角色。

+   *元数据备份*：在本节中，我们将讨论为何制定元数据架构的备份计划至关重要，而不仅仅是备份其中的数据。

+   *数据备份*：接下来，我们将讨论在数据备份时需要考虑的因素。

+   *恢复过程*：备份仅仅是挑战的一半——在本节中，我们将探讨从备份恢复时需要考虑的步骤和流程。

+   *事件与灾难恢复计划*：高效的数据恢复依赖于有效的规划，尤其是在出现问题时。本节将介绍在规划恢复方法时需要考虑的因素。

+   *确保备份数据安全*：您的备份需要与 Salesforce 实施的安全性一样高。因此，在本节中，我们将讨论如何加强备份的安全措施。

+   *如何应对 GDPR 与 CCPA 数据备份法规*：您备份的数据与您的工作数据一样，受相同的法律和法规约束。在本节中，我们将简要讨论可能适用于您数据备份的两个最常见法规——**通用数据保护条例**（**GDPR**）和**加利福尼亚消费者隐私法案**（**CCPA**）。

+   *数据保留考虑事项*：在本节中，我们将回顾可能影响您数据保留政策的因素，探讨您应保留备份数据的时长。

+   *Salesforce 备份选项*：最后，在前述主题讨论完毕后，我们将探讨当前可用于有效 Salesforce 备份的选项。

到本章结束时，您将了解有效的数据和元数据备份在限制业务中断中的关键作用，并获得实用的见解，以评估和实施专为 Salesforce 平台定制的强大备份解决方案。

# 技术要求

本章没有技术要求，因为这里讨论的原则可以与市场上多种 Salesforce 备份解决方案一起使用。

# 为什么备份应该成为 DevOps 流程的一部分

Salesforce 常常作为许多组织的关键参与和运营系统。Salesforce 中的数据提供了客户的 360 度全景视图，并支持营销、销售和服务活动。因此，Salesforce 中的任何长时间停机或数据丢失都可能严重影响组织的业务运作。客户关系受损、创收活动停滞、生产力陷入停顿。

根据多项研究，大多数公司每小时的停机成本超过$300,000\. 对于一些大型企业而言，这一小时的成本可能达到数百万美元。如果停机时间延长，几小时或几天的停机将造成巨大的财务和声誉损失。在最坏的情况下，缺乏足够的数据保护和恢复计划的公司可能会因为灾难性的数据丢失而完全退出市场。

然而，切实可行的集成数据备份为组织提供了快速恢复服务并限制中断的能力。与其永久丢失数据和生产力，公司可以从最近的备份中恢复并继续运营，在恢复过程中只有短暂的活动受限。先进的工具可以自动化备份过程，使恢复过程无缝衔接。

除了防止灾难发生外，完全将备份工具和流程纳入 DevOps 工具链还有其他好处。备份让开发人员更加有信心进行快速创新和实验，因为他们知道自己的工作是受到保护的。集成的备份还鼓励在开发、测试和生产过程中使用一致的流程和环境，以减少恢复时的混乱。

将备份视为 Salesforce DevOps 的核心元素可以减少潜在的业务中断，增强开发人员的能力，并确保组织的关键 Salesforce 数据得到充分保护。

## 数据丢失的成本

关键系统停机的平均每小时成本会根据组织规模、行业和受影响的具体系统有所不同。然而，研究表明，大型企业的平均停机成本每小时在$300,000 到$400,000 之间（来源：[`www.statista.com/statistics/753938/worldwide-enterprise-server-hourly-downtime-cost/`](https://www.statista.com/statistics/753938/worldwide-enterprise-server-hourly-downtime-cost/)）。对于中小型企业，每小时停机成本通常在$10,000 到$23,000 之间。

这些数字代表的是平均值，但对于与收入密切相关的系统或受严格监管的行业，实际成本可能会更高。导致停机成本的几个关键因素包括：

+   **生产力和收入损失**：员工无法工作，收入生成停滞

+   **客户不满**：停机侵蚀客户信任、满意度和忠诚度

+   **恢复和修复成本**：恢复系统和数据的过程会产生大量 IT 费用

+   **违规罚款**：医疗、金融及其他受监管行业会面临高额罚款

+   **声誉损害**：品牌声誉因长时间停机而受损，影响未来业务

鉴于关键系统停机可能带来的巨大潜在成本，业务连续性规划对于最小化影响至关重要。诸如冗余系统、全面的灾难恢复计划、定期备份、测试、监控和维护等策略有助于降低停机成本。投资于业务连续性帮助组织在停机期间维持运营和客户服务。

## 备份有助于减少中断

尽管数据丢失和系统停机无法完全避免，但可行的数据备份为组织提供了快速恢复服务并限制中断的能力。与其永久丢失数据并遭受长期的生产力损失，企业可以从最近的备份中恢复，并在恢复过程中经历短暂的受限活动后恢复运营。

在适当的备份系统到位的情况下，组织可以将**恢复时间目标**（**RTO**）缩短至仅几个小时或几分钟，尤其是像 Salesforce 这样的关键系统。例如，针对 Salesforce 平台优化的先进备份工具使管理员在许多情况下能够在不到一小时的时间内恢复到停机前的状态。

精心设计的备份解决方案集成了一系列关键功能，可以在停机后实现快速而安全的恢复，同时无缝集成到日常开发工作流中。

例如，外部基于云的备份存储对于确保在主系统完全瘫痪时仍能访问数据副本至关重要。通过将备份存储在与实时数据不同的位置，企业能够防止灾难同时影响两个系统。配置自动化的定期备份，无论是按日还是按日内计划执行，都能通过持续捕获时点快照来提供持续保护，无需人工监督，从而避免可能的备份漏洞。

专注于与现代开发实践对齐的备份解决方案，允许在有风险的发布事件前触发按需备份，在出现问题时提供一个故障恢复点。高级分析有助于通过检测备份中的异常数据变化来识别潜在的损坏或丢失，从而进行调查。

与现有开发工具、环境和工作流的集成，利用熟悉的界面简化了恢复过程。这减少了事故发生时的困惑，加速了恢复进程。经过成千上万次实际恢复优化的强大恢复引擎确保能够快速重建故障前的配置。

企业级安全性，包括访问控制和对静态数据及传输数据的强加密，对于保护高度敏感的备份副本至关重要。通过引入这些复杂的功能，备份解决方案可以在确保可靠保护的同时，增强开发成果。

通过将具备这些功能的解决方案融入常规运营，团队可以快速诊断问题，迅速恢复服务，并将数据丢失或系统故障带来的业务中断限制在最短的恢复窗口内。整体成本和声誉损害都被控制在从可行备份恢复所需的短暂恢复时间内。

## 备份与开发相辅相成

将备份工具和程序完全融入开发生命周期和 DevOps 工具链中，带来的好处远远超出了灾难恢复的准备。当备份被视为开发过程的一个重要组成部分而非事后的补救措施时，它能增强开发者的敏捷性，提升测试效率，并加快发布周期。

对于开发者而言，可靠的备份提供了一个安全网，使得创新速度和自由度得以提高。开发者不再因担心不良后果而小心翼翼地限制变更，而是可以快速实现新特性和演进系统架构，因为他们知道如果出现问题，可以回滚到备份快照。备份让开发者从谨慎地修改系统转变为大胆推动系统发展。

备份还促进了创建更真实和可复现的测试和暂存环境。捕获数据和配置细节可以让你刷新沙箱环境，使其更接近生产环境。这有助于更精确的测试和培训模拟。备份数据还可以用来生成经过脱敏的测试数据集，用于开发和质量保证测试，同时不影响安全性。

在日常开发操作中，集成备份提供了额外的优势。异常检测算法帮助在编码周期早期识别数据问题，从而快速修复。与**持续集成/持续交付**（**CI/CD**）管道的流畅集成使得备份能够在每次新的构建时轻松捕获，以便在管道变更产生意外影响时，进行后续恢复。

对于那些由数据（而非元数据）决定业务逻辑的应用程序（如 Salesforce CPQ），开发人员在部署后能快速回滚的能力，可能比在每次更改前进行大量端到端的自动化测试更有效。

对于在空白组织上构建的开发人员，恢复功能通过在必要时恢复到之前已知的良好状态，保持他们的生产力，尤其是在进行激进的定制化实验后。包括代码、配置和依赖项的全面备份有助于开发人员进行故障排除和调试。

对于管理员和发布经理来说，在部署前进行按需备份，如果新的变更或升级导致生产环境出现问题，可以提供即时的回滚点。这个安全网使得持续交付（CD）能够以较低的风险进行。发布经理可以在知道可以回滚的情况下，放心地持续改进系统。

通过促进开发人员的自由、增强测试和加速发布周期，集成备份提高了业务敏捷性，并缩短了新创新的上市时间。将备份视为开发和运维的补充过程，而不仅仅是灾难恢复工具，能在现代 DevOps 实践中放大其价值。

## 备份保护免受错误影响

即使是最谨慎的管理员和开发人员，也难免会犯一些影响数据完整性的错误。尽管出于最好的意图，偶然的配置变更或无意间的代码部署总会发生。更令人担忧的是，受损用户的恶意行为也对组织构成威胁。当发生人为错误或故意篡改时，可靠的备份作为快速恢复的最后防线。

在开发方面，即使是经过广泛测试的代码变更，在部署到生产环境后，仍可能会产生无法预见的下游影响，影响数据的准确性或可用性。备份可以帮助快速回滚代码更改，以恢复系统稳定性和数据可靠性。通过比较部署前后的备份，可以正确诊断与代码相关的事件并找出根本原因。

数据事故也可能发生，例如对错误数据集执行批量记录删除或修改。没有备份的情况下，丢失数据的重新输入可能需要数小时或数天，甚至可能根本无法恢复。如果原始数据丢失，数据保留政策可能还会要求长期备份某些数据集。通过定期的备份计划和存储，快速恢复信息可以最大限度地减少业务中断。

在内部安全威胁和恶意行为的情况下，备份可能是灾难性事件（如大规模数据删除）后的唯一恢复选项。尽管预防是理想的，但备份提供了一种应对最坏情况的保险政策。备份的法医分析还可以帮助调查安全漏洞的可疑活动。

2016 年的 NA14 故障和 2019 年的**Permageddon**权限问题等显著的 Salesforce 特定事件，Salesforce 需要重置集成了 Pardot 的团队的权限，以保护用户数据，最终要求管理员重建配置文件和权限，这些事件突显了即使依赖于主要云平台，仍然需要可行的备份。没有可访问的备份，公司可能会面临巨大的成本和中断。

最终，在管理像 Salesforce 这样的大型复杂系统时，必须考虑到人为错误和故意滥用作为现实情况。维护可行的备份、适当保护访问权限，并在变更上实施检查和警报，可以帮助组织快速撤销不可避免的错误或恶意行为的影响。拥有可靠的数据恢复能力可以为管理员和开发人员提供更大的日常安心。

## 备份验证发布

现代开发环境中变化的快速节奏意味着新的功能和升级不断发布给用户。尽管在发布前会进行广泛的测试，但预见所有用户如何与变更互动，在即使是大规模的测试环境中也是不可能的。因此，随着时间的推移，由于真实世界的使用与预测模式不同，无法预见的影响不可避免地发生。

为了在这个动态环境中实现增量改进的持续交付，开发团队需要一种快速诊断和解决新发布引入的问题的方法。通过在任何给定发布部署之前捕获一个已知的良好状态，备份提供了这种能力。如果用户在发布后遇到问题，管理员可以通过快速恢复到部署前的备份快照来确定根本原因是否源于该发布。

凭借备份回滚和基于备份进行根本原因分析的能力，开发团队在频繁发布变更时获得了信心。由于他们知道如果出现重大问题，可以回滚发布，因此对持续交付增量改进、新功能和升级的抵触心理较少。发布速度和创新加快。

在每次部署之前的按需备份还创建了可重复使用的发布测试环境。可以反复部署到从同一备份恢复的测试环境中，以精确验证所有更改。将按需备份自动化为 CI/CD 流水线的一部分进一步增强了发布验证。

对于用户而言，基于备份快速解决与发布相关的缺陷维护了他们的信心和满意度。当可以使用备份快速恢复到之前的稳定状态时，就无需等待漫长的调试和新的修补版本。开发流程的总体质量和响应能力得到提升。

可行的备份使开发团队能够加速创新，并确信可以管理持续交付的风险。在知道可以撤销任何负面影响的情况下，可以大胆进行发布更改。

# 元数据备份

在当今数字时代，数据通常被称为*新黄金*。然而，在 Salesforce 领域，如果数据被视为黄金，那么元数据可以被看作是展示如何提取、精炼和塑造这些有价值实体的复杂蓝图。这种比较突显了元数据在 Salesforce 复杂世界中的重要意义。

元数据不仅仅是信息的孤立层面；它是一个全面的配置、定义和自动化的马赛克，为数据注入生命。元数据决定了每个对象和字段的行为方式、它们之间的关系以及它们向用户展示的方式。它充当 Salesforce 组织的 DNA，控制着形式和功能。

解释和理解数据的能力与元数据所建立的上下文基础密不可分。设想一个情境，其中包含数百万条记录，但没有任何关于它们结构或相互关系的提示。这就像在没有盒子上图像的情况下尝试拼接一个复杂的十亿块拼图。数据，例如账户记录，只有与相关的元数据结合时，才能实现其最大潜在价值。这种结合确保了数据不仅仅是一些数字和字符的堆砌，而是一个连贯且具有影响力的编译体，推动决策和操作。从实际角度来看，这意味着数据恢复往往完全依赖于匹配的元数据状态。包含不存在字段值（如选择列表值）的记录可能会成为问题，存储在新增必要字段之前的记录也是如此。

此外，对于 Salesforce 管理员和开发人员来说，真正关心的并不仅仅是潜在的数据丢失本身，而是可能会丢失数月或数年的精心定制的配置。重建数百个自定义对象、重新定义成千上万的页面布局配置、重新校准复杂的用户权限、重新开发复杂的流程和触发器的前景是一个令人生畏的场景。如此大规模的重建意味着需要大量的时间、精力和资源，才能恢复到以前的业务流程自动化水平。在这种背景下，强大的元数据备份作为一个至关重要的安全网出现，确保能够迅速从中断中恢复。

我们无法过分强调元数据在保护组织数据安全和访问控制中的核心作用。虽然数据可能代表离散的记录，但正是元数据包含了规定哪些用户可以查看和修改这些记录的策略，以及如何查看和修改。元数据不仅仅决定了用户可以访问哪些原始数据，还调节了他们如何与数据互动及数据与其他数据组件之间的关系。在缺乏有效元数据备份的情况下，你可能拥有一堆宝贵的数据，但却缺乏适当的机制来安全地保护和控制对数据的访问。

此外，虽然静态数据提供了有形的历史记录，但正是元数据通过自动化将其推动到动态行动中。从简化日常任务（如线索分配）到协调跨部门的复杂多步骤流程，元数据在幕后默默运作，使 Salesforce 能够保持响应能力。编码在元数据中的规则、验证和触发器确保了数据的准确性和一致性。

在 Salesforce 庞大的框架内，数据和元数据是综合组织的元素，描绘出一个全面的画卷。尽管备份数据对于保留历史记录和洞察力至关重要，但这些数据的相关性、安全性和可操作性牢牢地根植在周围的元数据中。随着企业继续投入大量资源来定制 Salesforce 部署以满足其独特的需求，全面元数据备份策略的不可或缺性显而易见。一个真正强大的备份策略必须无缝整合数据和元数据，确保这两个基础元素都不会被忽视。

# 数据备份

虽然元数据在 Salesforce 中捕捉了结构蓝图和逻辑，组织也必须备份其数据以全面保护业务运营。数据包括用户在 Salesforce 中创建、更新和管理的实际记录和内容，作为其日常工作的一部分。这包括账户、联系人、潜在客户、机会、案例和自定义对象。

Salesforce 中的数据通常代表核心客户信息、销售交易、服务问题历史记录和其他运营数据集。丢失对当前生产数据的访问可能使运营倒退数月或数年，具体取决于数据量。

然而，在 Salesforce 内进行大规模数据备份引入了独特的挑战。灵活的数据模型，结合涵盖数百个对象和大量数据量的复杂关系，需要备份技术和工具专门为 Salesforce 优化。

例如，Salesforce 的声明性、可配置的架构允许创建业务域的相互链接的多对象数据图。一个账户记录可以在联系人、机会、案例和其他对象中拥有数百个相关的子记录。为 Salesforce 设计的备份解决方案可以在捕获和恢复数据时保留这些复杂的对象关系网。

数据的数量也要求优化备份性能和精细恢复能力。Salesforce 生产实例通常包含数千亿条记录的数 TB 数据。必须高效执行完整数据备份和还原，以适应有限的维护窗口。精细恢复功能帮助通过仅恢复被意外修改的选择记录或字段来应用手术性更改。

最后，Salesforce 的灵活架构要求在对象和字段随时间变化时保持数据完整性。备份工具需要将备份映射到当前结构，而不是强制使用僵化的模式，在数据模型演变时出现故障。跟踪字段历史记录有助于正确对齐变化的数据类型和属性。

数据备份和元数据一样重要，都是全面保护 Salesforce 业务连续性的关键。但为了有效，数据备份解决方案必须针对 Salesforce 独特的数据建模、大规模以及灵活的架构能力量身定制。该平台的独特性要求数据备份工具具备特定功能。

初看之下，你可能会认为备份组织中所有元素是最明智的做法。然而，事实并非总是如此，有时反而适得其反。有些对象虽然经常更新，但在备份中并不具有重要价值。例如，`AuthSession`、`LoginGeo`和`LoginIp`等对象，经常发生变化，但不包含关键信息数据。

类似地，如果你考虑备份一个自定义对象，比如`Case`，关联的`CaseFeed`、`CaseHistory`和`CaseShare`对象可能没有太大的备份价值，原因相同。省略这些对象可以生成更紧凑的备份，从而加快备份和恢复过程——在共享表的情况下，这些表会在相关记录恢复后动态重建。如果使用能够跟踪和评估数据修改的备份解决方案，那么排除高变动对象将更加有效。这样做可以简化监控过程，使识别对关键数据有影响的更改变得更加容易。

# 恢复过程

在危机发生时，当 Salesforce 数据遭到破坏或丢失时，备份的即时可用性就是生命线。然而，仅仅准备好备份并不能完全保证业务连续性。一个复杂的架构，包括恢复过程、验证以及数据的无缝恢复至关重要。

该过程的初步步骤是验证备份的可行性。一个常见的误区是，假设最新的备份没有错误并且可以使用。这种假设可能导致更多的复杂问题，突显出持续监控备份完整性的重要性。通过自动化并持续监控备份，组织可以迅速检测异常，确保随时能够获取到可靠且未受污染的备份。

然而，即使在进入恢复模式之前，组织也必须采取战略性的立场。分析数据丢失的性质和范围至关重要。深入分析备份数据可以揭示数据是被破坏还是完全删除。它有助于确定具体哪些记录和对象受到影响，以及异常发生的时间。这种深入的检查确保恢复过程能够集中于受影响的区域，防止未受影响的数据被意外覆盖。

一旦需要恢复的数据范围明确，恢复过程本身可以规划。对于元数据，建议按逻辑顺序逐步恢复组件，匹配依赖关系。应首先处理基础元素，如核心自定义对象和字段，为权限、业务逻辑和展示层提供基础。将恢复过程分为更小的部分可以避免错误级联并简化故障排除。

当存在大量元数据时，按阶段恢复优先级分类可以降低风险。推荐的顺序如下：

1.  **数据层**：定义组织数据结构基础的核心自定义对象、字段和模式。

1.  **安全性**：控制用户访问和数据隔离的权限集、配置文件和共享规则。

1.  **可编程性**：任何支持自定义业务逻辑的 Apex 类、触发器、组件和测试。

1.  **展示**：构成 UI 展示层的 Visualforce、Lightning 和布局元数据。

1.  **其他**：如电子邮件、报告和文档等附加元数据，用于自定义和配置组织。

此工作流程与平台固有的层次结构相匹配，从原始数据组件到复杂的叠加层。

同样，在恢复大量数据时，应优先处理核心对象，同时捕获相关数据依赖关系。Salesforce 推荐的优先顺序如下：

1.  用户

1.  账户

1.  活动

1.  联系人

1.  商机

1.  案件

1.  价格书籍

1.  产品

1.  潜在客户

1.  合同

这种对象数据的划分进一步得到了 Salesforce 平台的鼓励，具体取决于恢复机制。如果你在使用 Apex，架构师应当充分理解记录分块的行为——务必阅读并参考 Salesforce 文档中的*创建多对象类型记录*部分，链接：[`developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/langCon_apex_dml_limitations.htm#:~:text=Creating%20Records%20for%20Multiple%20Object%20Types`](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/langCon_apex_dml_limitations.htm#:~:text=Creating%20Records%20for%20Multiple%20Object%20Types)。

强大的备份解决方案可以恢复跨多个对象的互相关联数据，以维护关系完整性。通过所有者或时间框架对非常大的数据集进行分段有助于避免恢复时的平台限制。架构师还应注意查找偏斜、所有权偏斜的概念以及平台在设计恢复过程时的记录锁定行为。

Salesforce 中的查找偏斜指的是通过查找关系将许多记录（通常是成千上万条记录）与单一记录关联的情况。这可能导致性能问题，并且可能对数据库操作（如查询、报告和数据加载）产生负面影响。Salesforce 中的所有权偏斜是一个与查找偏斜不同但相关的概念。它发生在 Salesforce 组织中许多记录由单一用户或少数用户拥有时。这可能导致性能问题和操作上的挑战，类似于查找偏斜所带来的问题。

通过遵循一个结构化、分阶段的恢复工作流程，针对数据丢失的情况，组织可以简化恢复过程，尽早排查问题，并最小化因忽视处理相互依赖关系而导致的错误。

你可能会想知道如何完善这个恢复过程。答案就在于利用 Salesforce 沙盒。通过在这些环境中进行模拟演练，团队可以优化恢复程序。随着时间的推移，这些反复的实践可以培养出一种*肌肉记忆*，使团队能够迅速高效地应对实时危机。此外，详细的恢复蓝图文档具有双重目的：它既是宝贵的参考指南，又是为新团队成员提供培训的必要工具。

对于将 DevOps 集成到运营中的组织，恢复过程可以进一步简化。利用熟悉的工具和环境可以加快恢复工作。当团队能够使用他们每天都在使用的工具和界面时，可以减少由于不熟悉而产生的错误可能性。

虽然强大的备份的重要性不可低估，但组织在面对数据危机时的恢复能力不仅仅依赖于备份。它需要精心的规划、严格的测试、全面的文档和持续的培训相结合。只有这样，组织才能确信在数据故障时能够迅速且有效地做出响应。备战不仅仅是一种策略，它是 Salesforce 生态系统中数据安全的基石。

# 事件和灾难恢复规划

强大的备份解决方案是数据保护的重要基础，但组织还必须制定详细的应对和恢复计划。将事件响应和灾难恢复程序与备份工具一起准备，可以提供一种全面的方法来减少业务中断。

## 事件响应计划

事件响应计划概述了在危机（如数据泄露或系统故障）期间采取的立即行动。它们为调查、遏制、沟通和初步恢复步骤建立了明确的协议。以下是一些关键元素：

+   定义组建具有跨职能专长的事件响应团队的角色

+   收集证据、评估损害和进行事件根本原因分析的检查表

+   与受影响的利益相关者进行内部和外部沟通的计划

+   向监管机构报告事件的合规协议

+   从备份中安全恢复的初步恢复工作流程

+   事件后总结经验教训并改进计划的文档

拥有事件响应计划可以帮助你避免在危机期间做出仓促、紧张的决策，而是能够采取深思熟虑、优化的反应。

## 灾难恢复计划

灾难恢复计划侧重于在重大故障后恢复正常业务操作的长期过程。它们为韧性制定政策和技术战略，例如以下内容：

+   确定系统的最大可接受停机阈值

+   架构基础设施冗余和备用站点

+   定义备份计划频率以限制潜在的数据丢失

+   计算从备份恢复所需的时间

+   制定有序恢复程序并进行测试

+   培训人员并进行模拟演练以完善恢复能力

+   确保符合关于可用性的监管要求

+   文档化计划、系统图、依赖关系和程序

仔细的灾难恢复规划可以减少灾难性系统中断带来的运营、财务、法律和声誉后果。

通过制定协调一致的事件响应和灾难恢复计划以及数据备份，组织可以最大限度地减少业务中断、增强韧性并提高响应能力。

当然，我们都知道 Salesforce 有一些其他软件系统中可能不存在的考虑因素。例如，架构师应考虑如何处理比典型的新记录更早进入业务流程的数据，提前做好任何数据恢复的准备。想象一个规则，机会记录不能被创建为“已关闭并赢得”。然而，如果你在数据丢失的情况下恢复备份，可能非常希望这么做。

验证规则是另一个简单的例子，一些 DevOps 解决方案可以在恢复之前停用这些规则。然而，围绕流程和触发器已经形成了更复杂的框架——并且托管包可能有进一步的定制解决方案，因为托管的流程和触发器无法停用。因此，在设计处理数据验证的业务逻辑时，确保在数据恢复过程中能够插入任何状态的数据。

# 确保备份数据的安全

备份数据通常包含敏感信息，如客户详情、员工记录、知识产权和其他专有或受监管的数据类型。因此，正确地保护备份数据对于减轻合规性、合同和网络安全风险至关重要。

在存储方面，考虑到 Salesforce 的云平台特性，基于云的备份较为常见，但司法管辖区的数据主权政策可能要求使用本地备份。无论如何，备份应与实时数据分开存储，以减少单点故障的暴露风险。

管理备份访问至关重要。这可以通过基于角色的控制、最小权限和严格的身份管理来实现。这样可以确保只有授权人员才能查看或修改备份。使用行业标准如 AES-256 对传输中和静态数据进行加密保护是必须的。加密密钥还应具备强大的生命周期管理。

监控备份操作、访问、异常和变更，提供有价值的活动审计日志，以证明合规性并在需要时支持事件调查。

备份平台必须帮助应对与保留政策、数据驻留、被遗忘权和监管要求相关的合规需求的变化。服务提供商应拥有严格的网络安全程序，涵盖软件开发、事件响应、漏洞管理和业务连续性。

通过从一开始就全面解决备份安全和合规要求，组织可以适当地保护敏感数据，并在需要时实现高效恢复。

# 应对 GDPR 和 CCPA 数据备份法规

在数据保护和隐私意识日益增强的时代，跨欧洲和美国运营的企业受到两大主要监管框架的制约：GDPR 和 CCPA。这些法规直接影响组织如何管理和存储备份数据。

## GDPR 概述

**GDPR** 赋予**欧洲联盟**（**EU**）和**欧洲经济区**（**EEA**）的个人对其数据的广泛权利。在许多条款中，考虑备份策略时，删除权尤其突出。根据 GDPR 第 17 条的规定，个人有权要求几乎所有公司——即使是位于欧盟和欧洲经济区之外的公司——在规定的 30 天内删除其档案中的数据。因此，服务于 EU 和 EEA 客户的企业必须具备识别并删除备份中特定记录的能力。

## CCPA 的见解

自 2020 年起生效的**加利福尼亚消费者隐私法案**（**CCPA**）赋予加利福尼亚州居民类似的权利。尽管 CCPA 的适用范围相较于 GDPR 较窄，但它对公司在承担 CCPA 相关请求责任之前必须满足的具体标准进行了规定。值得注意的是，像欧洲的类似法规，CCPA 也赋予个人查询其持有数据的权利，并要求删除这些数据。随着这些法规逐渐成为标准，企业应预见到需要遵守 GDPR 和 CCPA 两者或其中之一。因此，评估备份策略是否符合这些数据保护规范至关重要。

# 数据保留考虑因素

架构备份解决方案时，一个重要的决策是建立数据保留政策，以规范备份数据在删除前的存储时长。组织根据业务需求、法律因素和预算约束采取不同的保留策略。

许多组织选择无限期保留数据，以最大化可用于恢复的历史快照。没有设定删除时间表，所有备份数据将永久可用。这确保了即使是非常旧的备份副本，也可以在需要时恢复丢失的生产数据或进行历史审计。然而，无限期保留会导致存储消耗和成本随着时间的推移不断增加，因为新备份不断积累。

其他公司选择实施有限的数据保留窗口，在设定的时间段后自动删除备份。保留期可能由行业法规要求，规定由于隐私法的要求，数据只能保留特定年限。与客户或合作伙伴的合同条款也可能规定最大保留期限。从预算的角度来看，定期删除备份有助于控制在无限期保留策略下，存储费用无限增长的问题。

一些组织将备份数据保留时间表与其消费者数据保留政策对齐，以限制个人信息的存储时间。这确保了备份反映出公司删除承诺。然而，如果有价值的历史业务数据与过期的消费者记录一起被过早删除，这可能会带来风险。一种更好的方法是无限期保留业务数据，同时根据数据类型仅删除备份中的消费者数据。

限制性保留政策的权衡在于，历史恢复快照的可用性会随着时间的推移而减少。虽然最近的备份数据会被保留，但较旧的备份最终会被永久删除。因此，保留时间表意味着在保留期过后，可能无法访问过时的记录。

在金融服务和医疗等受监管行业中，某些数据类型的最低保留期限可能是强制性的，允许在数据达到特定年龄后删除其他数据。在定义保留政策时，应纳入合规因素。

最终，组织需要根据其独特的业务需求、数据恢复要求、增长约束和法律义务来权衡不同的保留方法的利弊。然而，制定明确的正式数据保留政策以备份数据提供一致性、可预测性，并与公司数据治理标准保持一致。与所有数据政策一样，保留指南应定期审查。

# Salesforce 备份选项

在设计备份策略时，组织有多种方法可供考虑。

## 没有备份

不采取行动本身可以是有意的行为，但在数据备份的情况下，这并不推荐。缺乏数据保护将使公司面临严重的业务中断、合规违规甚至在数据丢失后破产的风险。对本地 Salesforce 恢复或回收站服务的过度信任会留下不应忽视的漏洞。

## 手动导出

自助数据导出至少提供了最低限度的保护，但需要手动重复操作，恢复速度慢且有限，同时会带来存储和合规的额外开销。缺乏元数据备份来补充数据备份并提供上下文，只会阻碍完整恢复。

## 版本控制

**版本控制系统**（**VCS**）作为元数据和数据备份机制的集成，相较于手动方法，代表了一项显著的进步。在发生灾难性故障的情况下，VCS 可以作为可靠的灾难恢复来源，帮助团队将整个元数据重新部署到新的 Salesforce 组织中，从而确保业务连续性。此外，保持详细的变更历史对于审计追踪和合规要求至关重要，VCS 通过以结构化且可访问的方式跟踪变更来促进这一过程。

然而，在 Salesforce DevOps 中依赖 VCS 进行备份并非没有挑战和局限性。将 VCS 集成到 Salesforce 中的复杂性需要对 Salesforce 环境和版本控制实践有深入的理解，这对于不熟悉版本控制的基于点击的管理员来说可能会显得特别艰难。当多个开发人员在同一项目上工作时，即使 VCS 提供了防止覆盖的保护措施，覆盖现有代码或引入与主代码库冲突的更新的风险也会增加。

VCS 在捕捉 Salesforce 数据的细微差别方面的能力有限，这可能导致备份不完整并带来恢复挑战。依赖外部工具引入了备份和恢复过程中的额外失败点，使得备份过程既耗时又资源密集。VCS 可能不足以在系统完全故障或数据损坏的情况下进行全面的灾难恢复。

实现 VCS 的无缝高效集成，并使其对 Salesforce 管理员来说既易于访问又用户友好，仍然是一项巨大挑战。确保符合数据保护法和安全标准，为将 VCS 作为备份解决方案的使用增添了额外的复杂性。VCS 使用不当可能导致技术债务增加，尤其是在部署过程中经常出现错误和漏洞时，技术债务的潜在增长尤为严重。没有全面的 VCS 策略，可能会缺乏对变更历史和上下文的完整视图，从而阻碍调试、决策和了解特定变更在 Salesforce 环境中的影响。

## 本地 Salesforce 工具

Salesforce 的备份解决方案目前已全面推出，提供自动化备份、轻松的数据恢复和强大的加密功能，以增强数据安全性。然而，一个显著的限制是数据被局限在 Salesforce 基础设施内。它缺乏平台外备份选项，这可能会对寻求多样化数据备份策略的组织构成障碍。最初，Salesforce 曾有一个数据恢复服务，但该服务被停用，随后由于客户的强烈反馈，恢复了该服务，并因此创建了新的备份和恢复服务。

## 定制化备份解决方案

专门为 Salesforce 设计的强大第三方工具提供自动化、数据监控、快速完全恢复、安全集成和其他针对平台独特需求的高级功能。

在评估选项时，最高优先级是确保全面和快速的恢复，最小化事件中的干扰，以及保障安全和合规性。预算必须与停机高昂的成本进行权衡。集成的 DevOps 工具能最大化价值。

这些解决方案中的许多（如果不是所有）都提供免费试用，这将帮助你确保它们具有所需的覆盖范围和易用性——这两者是决策的关键因素。

准确恢复数据和元数据可能非常困难。在 Salesforce 中，某些元数据类型及其对应的数据无法恢复。这些考虑因素应当是备份和灾难恢复架构规划的一部分，以便企业理解能够恢复的内容的限制。例如，在大多数情况下，恢复记录后，你无法恢复原始的 Salesforce 记录 ID，因此其他系统不应依赖记录 ID。

考虑到任何限制因素，有助于选择备份工具。如果某些方面对企业来说既困难又重要，那么这应该是任何供应商评估中的优先事项。

# 总结

本章讨论了在 Salesforce 中全面备份数据和元数据的关键需求，以减少数据丢失事件对业务的干扰。

我们讨论了如果恢复不及时，数据丢失和系统停机可能导致的灾难性成本，包括生产力损失、收入损失、声誉损害和合规性问题。可行的备份通过支持快速恢复来减少损害。

强大的 Salesforce 备份解决方案需要具备外部存储、自动化、集成、智能恢复和企业级安全等关键能力。元数据必须与原始数据一起备份，以提供结构、访问控制和自动化。还讨论了大规模 Salesforce 数据备份的有效技术。

事件响应计划概述了危机期间的紧急措施，而灾难恢复计划则专注于长期的恢复程序。测试和文档记录是关键。谨慎保护敏感的备份数据也是至关重要的。

结合备份、规划、安全性、合规性和专为 Salesforce 设计的解决方案，全面的数据保护使组织能够最大限度地减少中断，保护信息资产，并保持业务连续性和客户信任。

归根结底，你的备份只能像你恢复它们的能力一样有效。同样，如果你没有备份，就不能恢复。因此，备份应该是全面的并定期进行。

在接下来的章节中，我们将处理 DevOps 更具操作性的另一个方面，即监控变更。在 Salesforce 中，变更可以来自多个来源，甚至包括生产环境。通过有效的监控保持对这些变更的严格控制，并确保所有环境都是最新且同步的，将是我们的下一个主题。
