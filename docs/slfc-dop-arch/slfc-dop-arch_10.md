

# 监控变化

在本章中，我们将探讨管理 Salesforce 环境的一些关键方面。保持一个稳定、顺畅运行的 Salesforce 环境的关键在于高效的变更管理和监控。然而，随着数据复杂度和体积的增加，手动的变更控制变得越来越不可行。因此，自动化和全面的环境监控需求应运而生。

本章将深入探讨监控 Salesforce 环境的重要性。我们将研究如何即便是出于良好意图进行的无控制变更，也可能导致环境不稳定，破坏 Salesforce 环境的顺畅运行。我们还将讨论监控工具如何帮助我们检测环境中的变化，使我们能够了解所有变化的发生者、内容、时间和地点，无论这些变化是有意的还是无意的。

除了元数据监控，我们还将探讨如何通过监控其他因素，如数据指标，帮助我们在问题影响用户之前发现潜在问题。我们将讨论如何通过监控变更为我们提供关于环境健康的关键信息，以及这如何增强我们对环境与真相来源一致性的信心。

我们还将了解不同类型的监控，例如元数据监控、数据监控、姿态监控以及运营监控与可观察性。每一种监控类型在维持稳定的 Salesforce 环境中都有其独特的重要性和作用。

本章将涵盖以下主题：

+   如何通过不同种类的监控来管理你的环境

+   元数据监控如何工作

+   如何以及为何监控环境中的相关数据变化

本章结束时，你将全面理解 Salesforce 环境监控的重要性，以及它如何帮助你保持一个稳定、高效的 Salesforce 环境。你将从本章中获得的知识，将帮助你避免 Salesforce 环境中的不稳定性和中断。

# 如何管理你的 Salesforce 环境

管理你的 Salesforce 环境对于你组织运营的稳定性和效率至关重要。这个任务的重要性不容小觑——一个管理良好的 Salesforce 环境能确保工作流的顺畅、数据的完整性以及最佳的性能。忽视这一方面的后果可能是严重的。从轻微的数据差异开始，问题可能逐渐升级，最终导致重大工作流中断。这些问题最终可能导致客户信任的显著流失和收入的明显下降。

这强调了，如果没有警惕的管理，运营中断、数据安全受损，最终可能导致财务和声誉损害的风险会显著增加。在接下来的部分中，我们将深入探讨维护 Salesforce 环境健康和一致性所必需的不同类型的监控，说明为什么主动和全面的管理不仅有益，而且对任何利用 Salesforce 的企业都是至关重要的。

## 监控的必要性

我们力求保持 Salesforce 环境的稳定性和完整性。然而，不受控制的变更，无论出于何种良好意图，都可能破坏我们的努力。开发人员直接在生产环境中调整验证规则。管理员在沙盒中删除一些看似过时的字段。变更发生在管道之外，导致环境不同步。没过多久，我们就开始与不稳定作斗争，而不是进行创新。

变更管理对企业 Salesforce 开发来说是不可妥协的。然而，手动变更控制有其局限性。随着环境和团队规模的增长，我们需要自动化来跟踪变更。全面的环境监控为我们提供了这一优势。

在 DevOps 和系统监控的背景下，强调强大部署流程的重要性作为防范意外系统更改的首要防线至关重要。高效且简洁的部署流程可以最大程度地减少绕过源代码控制的可能性，从而降低意外变更的风险。尽管监控仍然是一个重要环节，但完善部署流程可以显著降低监控过程中发现的异常的频率和严重性。这种方法强调了部署策略与监控效果之间的相互依赖，说明优化部署流程可以带来更稳定、可预测的系统行为。

强大的监控不仅限于生产环境，还要检查我们环境中的所有变更。沙盒，尤其是开发者沙盒，是实验的温床。这里的变更可能一开始有意地不在管道内。但我们依然需要可视性。暂存和测试沙盒也需要监督，以防未经验证的变更扩散。

通过自动化监控，我们可以检测所有环境中的变更，而不仅仅是生产环境。最先进的工具能够捕捉元数据的即时快照，并与之前的快照进行对比，以识别修改。这使我们能够看到所有变更的具体信息——谁做了什么、何时做的、在哪里做的，无论是有意的还是无意的。

元数据监控专注于组件的变更，如自定义对象、字段、Apex 类和 Lightning 页面。但关注其他环境因素同样重要。数据指标能够帮助我们在问题影响用户之前发现许多潜在问题。

监控更改为我们提供了关于环境健康的关键洞察。我们可以确信环境与真实数据源保持一致。我们可以验证预期的更改是否正确地通过管道传播。我们还可以在问题引发稳定性问题之前，快速响应未预期的更改。

通过将主动监控与简化的补救措施结合起来，我们可以掌控 Salesforce 中的更改。我们的开发团队可以在不危及稳定性的情况下自由创新。架构师能够安然入睡，知道环境与设计保持一致，而我们的用户则享有最大程度的正常运行时间和生产力。在接下来的章节中，我们将更详细地讨论这些主题。

## 探索不同种类的监控

有效的监控是维护和提高系统性能、安全性和可靠性的基石。不同种类的监控针对 Salesforce 环境的不同方面，每种都具有独特的目的，并提供不同的洞察。了解这些种类不仅仅是收集数据，而是要战略性地利用这些信息来做出明智决策，并主动管理系统。

在本节中，我们将深入探讨不同形式的监控——从元数据和数据模式监控到姿态监控和操作可观察性。每种类型在理解和优化 Salesforce 环境中都发挥着至关重要的作用。

### 元数据监控

**元数据监控**是指跟踪对 Salesforce 元数据组件（如自定义对象、字段、工作流和 Apex 代码）所做的更改的实践。通过监控元数据，管理员可以保持对其组织内配置更改的较低延迟的意识。这提供了谁在何时做了什么更改的可视性，这对于故障排除、合规性和变更管理非常有用。元数据监控的目标是保持对自定义设置的控制和透明度，随着团队扩展 Salesforce 开发工作。与手动检查不同，自动化工具可以全天候监控元数据，并在发生重要更新时提醒相关人员。

### 监控 Salesforce 数据的变化和模式

除了监控元数据之外，监控 Salesforce 数据本身的变化和模式同样重要。配置数据，如 CPQ 配置，应该像监控元数据一样进行跟踪。数据异常，如激增、下降或异常值，应当进行监控，以识别潜在的数据质量问题或业务变更。持续的数据行为，如增长趋势、使用模式和数据流，应进行分析，以指导容量规划和优化。自动化工具可以应用逻辑实时从生产数据中提取洞察。目标是获取对数据稳定性和变化的可视性，主动识别和解决潜在问题。

### 姿态监控

**态势监控**指的是评估 Salesforce 组织的整体安全健康状况。这包括跟踪配置设置，如用户权限、凭证策略和共享规则，以检测可能导致访问泄露或违规的风险设置。态势监控还意味着分析使用模式，识别异常的终端用户或集成行为，这些行为可能表明凭证被泄露或遭到攻击。工具可以自动将配置与安全基准进行比较，并在潜在漏洞被引入时发出警报。其目标是实现对 Salesforce 组织安全状况的持续可见性，并及时通知可能引发风险的变更。态势监控使管理员能够主动修复问题，防止其被利用，并保持实例的安全态势。

### 操作监控和可观测性

**操作监控**指的是跟踪生产环境中应用程序和基础设施的性能、可用性和整体健康状况。这包括监控响应时间、错误率和资源利用率等指标，以检测问题并优化配置。可观测性基于操作监控，通过引入日志、跟踪和自定义遥测等额外信号，深入了解系统行为并获取更多的上下文信息。

操作监控和可观测性共同提供了保持应用程序和服务平稳运行所需的实时可见性。然而，重点是在监控当前状态，而非随时间变化的内容。虽然它们各自都是重要的学科，但操作监控和可观测性与我们所讨论的变更监控有所不同。例如，变更监控可能侧重于定制内容随时间的演变，而操作监控则可能专注于已部署的定制内容是否在其性能参数范围内正常运行，并继续满足接受标准。

变更监控的目标是通过警报和审计追踪，主动跟踪配置、数据和安全性的变动，以识别风险、问题和改进机会。相对而言，操作监控和可观测性旨在在生产环境中发生性能问题或故障时，快速应对和优化。由于我们关注的是变更监控，而非当前状态的可见性，因此本书不会涉及操作监控或可观测性实践的具体内容。然而，这些实践是互补的，属于全面监控策略的一部分。

在本节中，我们介绍了广泛的主题，从元数据和数据模式监控的必要性，到姿态监控和操作可观察性等关键方面。我们了解到，每种形式的监控在不仅保护我们的 Salesforce 组织的完整性和安全性方面扮演着至关重要的角色，同时也在提升其性能和可靠性方面具有重要作用。接下来我们将讨论如何监控我们组织的元数据变更。

# 监控元数据

在本节中，我们将深入探讨元数据监控在 Salesforce 平台中的关键作用，这是环境控制和管理的基石。元数据是定义 Salesforce 组织中每个组件的基础结构，随着组织的自定义和扩展，它不断演变。

通过提供全面的概述，说明为何应监控元数据，我们旨在强调实施健全的元数据监控策略的必要性，从而确保一个更可控、更透明、更高效的 Salesforce 环境。

## 为什么要监控元数据？

监控元数据的变更是一个至关重要的任务。当你自定义和扩展你的组织时，相关的元数据也会随之演变。这是因为 Salesforce 平台中的一切都以元数据的形式存在，所以你所做的任何更改都会导致元数据的变化。这也意味着随着自定义程度的增加，元数据会变得更加复杂。

跟踪这些元数据变更带来了以下多方面的好处：

+   **促进协作**：通过可见的元数据变更，开发人员可以避免在进行中的并行工作中覆盖已有的成果。开发人员和管理员对连接的组织中的当前状态有共同的理解，减少了不一致性。

+   **加速开发**：及早识别不一致性可以防止级联重工。如果在沙盒中新增了一个字段，但没有在生产环境中添加，及早发现这一点可以避免在不一致的元数据基础上浪费精力。

+   **支持合规性**：详细的元数据变更历史满足治理流程中对修改审计记录的要求。按需报告可以验证是否遵循了正确的协议。

如果没有全面的监控，元数据变更可能会在阴影中积累并无人检查。也许一个开发人员在沙盒中添加了一个字段，但忘记将其部署到生产环境中。管理员直接在生产环境中调整了验证规则以修复一个 bug。这些小的未被检测到的不一致性会逐渐积累成重大问题。

手动跟踪和松散的版本控制工作流有盲点。元数据更改往往会不经意间被遗漏。自动化解决方案可以通过定期记录所有连接组织的元数据状态，甚至最细粒度的组件，从而填补这些空白，但它们是有成本的。对比可以揭示精确的差异，突出显示任何环境中的每个元数据添加、删除或修改。

通过更全面的视角，架构师可以更好地了解 Salesforce 环境的形态和稳定性。开发人员可以更有信心地进行工作，确保并行操作不会被覆盖。产品和管理员从共享的真实信息源中进行协作。合规团队则拥有修改的审计追踪。

作为架构师，我们通常是所管理环境长期健康的守护者，认真跟踪元数据的变化是其中一个重要部分。幸运的是，已经有解决方案可以将强大的元数据监管无缝地融入现代开发实践中。我们将在接下来的部分中探讨这一点。

## 生产环境中的元数据监控

在生产环境中监控元数据的变化对于在环境扩展和演变过程中保持透明性和控制力至关重要。主要目标是实时了解各个团队和个人在组织中进行的自定义操作。即使这些组件是通过 CI/CD 流水线部署的，我们仍然需要确保生产环境中的元数据符合预期。通过跟踪所有元数据组件的添加、编辑、删除和部署，管理员可以实时了解新特性和配置进入组织，而无需在事后手动拼凑变更活动。

通过元数据变更可视化，管理员可以识别谁做了什么更改、何时进行的更改，以支持审计、故障排查和变更管理流程。监控元数据有助于识别后果，并追溯到引发问题的特定配置更改。它还通过提供所有自定义操作的文档支持合规性。此外，监控元数据的变化还有助于发现应该合并的不必要重复项，以及可以删除的孤立组件。总体目标是随着时间推移，通过持续的可视化管理一个良好管理、透明的组织结构，以应对日益复杂的环境。

此外，一些小规模的元数据自定义，比如报告和文档，可以安全地在生产环境中直接更改，但监控这些元数据仍然是保持对跨环境变更的可视性和控制的必要手段。即使是允许的生产变更，追踪谁在何时做了什么更改，对于审计、故障排查和治理来说都是至关重要的。

为了保持对 Salesforce 生产组织中的自定义内容的完全可见性，应监控广泛的元数据组件。从高层次来看，任何在 Salesforce 平台上构建的、用于扩展功能或根据业务需求定制系统的可配置项目都应当进行跟踪。这包括管理员可以访问的声明性工具以及工程师开发的编程组件。

具体的示例包括自定义对象、字段、页面布局、验证和工作流规则、Visualforce 页面、Lightning 组件、Apex 触发器和类、权限集、配置文件、共享规则等等。监控还应包括点击即代码的配置，如审批流程、分配规则、电子邮件模板和流程。通过 Lightning 应用构建器、体验构建器和社区构建器进行的整体应用结构的高级更改也非常重要，需要加以捕捉。全面的元数据监控不仅仅限于业务逻辑和最终用户组件，还应包括身份验证、集成和安全配置等操作设置。其目标是跟踪所有自定义定义的元数据，以便能够检测到任何变更，从而保持对生产组织发展变化的透明度。

你可以使用手动或半自动化的过程来监控生产环境中的元数据，这在典型环境中，由于生产组织数量通常较少，因此是可行的。这个过程可能涉及多个工具，你可以根据自己的具体需求将它们结合使用：

+   **监控部署**：在 **设置** 中，你可以跟踪所有的变更集和元数据 API 部署到你的组织。

+   **设置审核跟踪**：在这里，你可以看到对组织所做的所有 **设置** 更改。如果你坚持手动过程，这通常是一个很好的起点。

+   **针对元数据对象的 SOQL 查询**：有一些系统对象代表了不同类型的元数据，管理员可以通过开发者控制台使用这些对象。

+   **事件监控**：如果你拥有 Shield，事件监控模块将为你提供非常详细的日志，这些日志可以导出并在分析工具中进行分析。

如果手动监控过程看起来让人感到困难或不切实际，那么有许多供应商提供现成的解决方案，包括 Gearset、Panaya、Salto 和 Elements.cloud。

在介绍了如何监控生产中的元数据后，让我们来看一下如何在沙盒环境中监控元数据。

## 沙盒中的元数据监控

沙盒在 Salesforce 的开发和测试工作流程中发挥着关键作用。沙盒中监控的元数据取决于其预定用途。

**完全复制沙盒**包含了生产环境元数据和数据的副本。生产环境中监控的所有相同的元数据组件也应在这里进行跟踪。完全复制沙盒允许准确模拟生产环境，以进行严格的测试。只有在验证后，这里的更改才应部署到生产环境中。

**开发者和开发者专业版沙盒**仅包含少量数据的元数据。监控应重点关注诸如 Apex、Lightning 和关键配置组件等代码组件，以便在不影响生产数据的情况下进行开发。当新的功能构建完成时，生产环境与沙盒之间的元数据和行为差异会显现出来，并在发布之前需要进行对齐。

沙盒刷新和删除可能会清除环境之间的配置差异。持续的元数据监控可以在这些事件中提供连续性，保持对变化的可视性。监控的覆盖范围应与每个沙盒的角色相匹配。不过，在生产环境和沙盒中全面的可视性是无缝管理整个组织的元数据的关键。

虽然对于小型组织和部署而言，手动方法似乎足够，但随着 Salesforce 足迹的扩大，单靠临时监控和脚本很快就变得不切实际。沙盒和生产环境中元数据和配置的多样性使得手动跟踪变得繁琐。开发者浪费时间拼凑变更，而不是进行构建，而管理员则无法清晰地看到测试和发布过程。

手动监控元数据在每个步骤中都会面临限制。从多个沙盒和生产环境中收集元数据需要反复执行检索调用或下载。将这些结果整合以便跨环境进行比较涉及繁琐的解析和分析。跟踪变化的过程需要手动进行版本控制和变更管理。即便是严格的管理，也不可避免地会出现捕捉元数据快照的空白。通过 SFDX 进行源代码跟踪，其中源代码变更会被自动标记，这可以帮助完成此任务，并且是 DevOps 工具包中受欢迎的补充，但当规模扩大时，这未必足够。

构建自定义脚本和工具可以自动化部分元数据收集和比较。各种 Salesforce API 提供了访问元数据以进行检索的功能。然而，全面监控所有元数据类型涉及在 Metadata、Tooling 和 REST API 之间精心协调 API 调用。不过，某些对象和组件可能需要专门的逻辑。维护脚本还需要持续开发，尤其是在 API 发生变化时。

随着复杂性的增加，管理员或开发者的带宽迅速超负荷。学习曲线和额外的开销分散了对关键任务的关注。即使定制的解决方案成功了，它也只自动化了元数据的捕获，而不是复杂的监控和分析。边缘案例将导致元数据配置追踪的盲点。因此，依赖现有的、经过验证的第三方解决方案是一个明智的投资。

为元数据管理量身定制的工具在全面监控方面要远远优于通用工具。它们为所有 Salesforce API 中的元数据类型提供开箱即用的支持。自动化快照收集和比较能够为跨环境的变更跟踪提供支持。使用分析可以识别趋势和热点，从而指导优化。与**集成开发环境**（**IDEs**）和发布管理系统的集成，使得从开发到部署的端到端可视化成为可能。

## 关于 scratch org 的说明

**Scratch orgs（临时组织）**比沙盒更具短暂性和一次性。它们按需创建，用于开发或测试，工作完成后被删除。由于这种短暂的生命周期，在 scratch org 中进行全面的元数据监控的长期价值较小。重点应放在追踪在给定 scratch org 实例短期使用期间所做的更改，而不是通过刷新或删除来保持历史记录。轻量级的变更意识有助于协调开发团队成员之间在 scratch org 中的工作。然而，对于 scratch org 的精细监控和治理实践可能会妨碍敏捷性。虽然配置和自定义 scratch org 不应完全不受控制，但监控的目标是实际的变更可见性，而不是详尽的审计轨迹。与生产环境和沙盒环境相比，scratch org 的短暂性使得优先级更多地偏向于敏捷性而非治理。

# 监控数据行为

在 Salesforce 环境中监控数据行为不仅是最佳实践，而是保持系统健康和确保业务连续性的必要条件。因此，了解为什么这一方面需要与元数据监控一样多的关注是至关重要的。Salesforce 中的数据不仅仅是数字和文本的集合；它代表了用户和系统内过程的实时交互。通过密切监控这些数据的变化和趋势，我们可以获得宝贵的洞察力，了解操作的有效性以及潜在的风险。

本节将探讨在 Salesforce 中监控数据的重要性多方面性。我们将讨论监控数据行为的关键原因，包括以下几点：

+   防止配置漂移

+   随着用户需求的变化，保持可见性

+   识别优化机会

+   为合规性启用审计跟踪

+   预测容量需求

这些元素中的每一个在全面的环境管理中都扮演着关键角色，确保您的 Salesforce 实施保持强大、合规，并与您的业务目标保持一致。

## 为什么要监控您的数据？

紧密关注 Salesforce 数据的变化和趋势与监控元数据同样重要，这对于全面的环境管理至关重要。元数据代表了您实施的结构和组件，而数据则提供了关于用户和流程实际使用 Salesforce 的重要可见性。

监控数据和元数据一起提供了一个更完整的环境状态图景。如果仅有元数据而没有监控数据，就会存在盲点，可能导致问题逐渐在时间中浮现。

有几个关键原因说明数据变更监控应该是优先事项：

+   **捕捉配置漂移**：像 CPQ 这样的 Salesforce 配置数据需要监督。数据监控确保配置保持准确对齐。

+   **随着使用变化保持可视化**：定期的数据加载、持续的使用和变化的需求使得 Salesforce 数据持续变化。监控有助于确保随着数据的变化保持对齐。通常，数据异常揭示了应用程序中潜在的问题。

+   **识别优化机会**：使用指标揭示数据访问模式，以优化索引、存储等。监控指导战略优化，例如归档。

+   **启用审计轨迹**：变更监控提供了审计轨迹，证明符合数据治理政策和监控链的要求。

+   **预测容量需求**：历史增长趋势有助于根据数据随时间的使用方式准确预测未来的存储需求。

如果不进行监控，配置数据中的小偏差可能会随着时间的推移慢慢累积。设置可能会在不同的组织之间不同步，甚至与治理政策不合规。主动监督可以通过在配置更改时保持连续性和控制来防止这一点。

数据的体量和多样性使得手动检查随着时间推移变得不切实际。自动化的持续监控为管理员和架构师提供了对元数据和数据的完整可追溯性。如同往常一样，这可能会带来一定的成本。

然而，通过全面的可视化，能够实现早期优化、规划和问题解决，环境可以在支持日益增长的复杂性的同时，提供更成功的商业成果。监控数据与元数据一起提供了对环境状态的整体视图，这是大规模管理 Salesforce 实施的关键。

## 监控配置数据

除了标准的业务数据外，Salesforce 组织还包含需要与元数据同样重视的配置数据，以便进行环境管理。

**配置数据** 包括自定义设置、规则和记录，它们控制 Salesforce 中的行为，而不仅仅是捕捉业务事务。以下是一些示例：

+   CPQ 报价、产品、价格书和折扣计划

+   账单费用、订阅和支付方式

+   社区会员类型、管理规则和主题

+   爱因斯坦推荐设置和使用指标

这些配置数据对于环境稳定性与标准元数据同样重要。但与元数据不同，配置记录的更改不会默认记录在部署日志中或进行监控。

没有监督的情况下，配置数据可能会偏离业务规则的合规要求。可能会修改影响系统行为或合同条款的关键设置。如果不保持同步，值可能会变得不准确或过时。

因此，监控配置数据至关重要，原因如下：

+   随着配置数据的变化，保持各环境之间的一致性

+   提供对关键设置修改的透明性

+   为合规要求启用审计跟踪

+   防止不希望发生的配置漂移

+   对风险或不当调整发出警报

对配置数据变化的完全可视性使架构师能够确保稳定性和完整性。

某些类型的配置数据可能需要遵守严格的治理政策。例如，审计员可能要求审查对 CPQ 定价和折扣规则的所有更改，这些规则可能会影响收入确认。

监控配置数据满足合规需求，通过提供全面的审计跟踪。查询可以即时验证配置记录修改是否遵循了正确的协议。

没有监控的情况下，配置数据的缺失可能导致难以察觉的错误或无法控制的漂移。这些影响通常随着时间的推移缓慢出现，因为小的偏差不断累积。主动监督通过在配置数据变化时提供连续性和控制，预防了这些问题。

虽然原生的 Salesforce 工具如字段历史记录跟踪提供了有限的洞察力，但全面的监控需要专门构建的解决方案。配置数据的多样性要求自动化以高效地收集、比较和报警。

通过能够追踪配置记录和标准元数据，架构师能够更全面地了解环境的状态。监控配置数据填补了盲点，否则这些盲点可能导致关键设置逐渐失去合规性。保持配置和业务规则在整个 Salesforce 环境中的一致性是稳定性的关键。

## 监控数据异常

除了标准业务数据和配置数据外，监控不规则性和异常对于尽早发现潜在问题至关重要。异常数据行为可能意味着出现了需要干预的新问题。

以下是一些常见的数据异常，需要触发警报：

+   记录量的突然激增或骤降

+   数据分布偏斜或不可能的异常值

+   批量删除或更新记录

+   特定记录或用户的瓶颈

+   某些字段中缺失或无效的值

+   特定数据类型的处理速度慢

监控统计上不太可能的异常值有助于揭示潜在的数据错误，例如无效条目或完整性问题，防止其扩散。数据分布的不一致可能表明质量问题，需要修正。

记录数量或存储的突然下降可能表示批量删除脚本无意中删除了重要数据。事务性激增可能是集成错误的信号，导致记录重复。

在加载特定记录类型时的性能滞后可能表明数据模型存在缺陷，需要优化。更新特定记录时的瓶颈可能揭示出影响订单处理的产品目录错误。

主动监控有助于在异常行为影响流程和决策之前提前暴露。设定期望的基准值有助于检测显著的偏离。

自动标记与历史规范不符的工具，如 DynaTrace 或 Odaseva，能够快速进行分类处理，确定合适的响应措施。警报使管理员能够快速识别根本原因并解决潜在的数据问题。

数据的数量和多样性使得手动检查异常变得不切实际。自动化解决方案对于基准期望范围并可靠地检测异常值是必不可少的。

例如，监控数据异常可能会发出以下警报：

+   案件数量超过 7 天平均值的 40%

+   超过 10%的联系人记录缺少电话或电子邮件

+   每晚的批量处理时间比平时长超过 50%

通过将变更监控与自动化异常检测相结合，管理员可以在问题影响最终用户之前发现问题。难以发现的数据问题可以通过监控在导致操作中断之前被揭示出来。

在 Salesforce 中，使用标准报告进行一定程度的异常检测通常是相当容易的。事件监控也内建了一些异常检测功能。这意味着，与元数据监控相关的数据监控实施挑战，在某些情况下可能较少。

一般来说，监控生产环境和完整复制沙箱中的数据至关重要。其他环境可能不需要同样程度的审查，尽管在某些情况下，即便是在较低环境中，进行更全面的数据监控也是有意义的。

通过异常警报揭示的事件处理可能需要跨团队的协作。然而，及早识别和解决问题有助于保持数据完整性和健康。

观察异常数据行为提供了独特的可见性，这是仅通过元数据监控无法获得的。结合变更追踪，异常检测能够提供更全面的 Salesforce 环境状态视图。

## 监控数据质量

除了跟踪变更和异常情况，监控**Salesforce 数据质量**对保持环境的准确性和完整性至关重要。数据质量是一个大话题，其中很多内容与监控变更并不直接相关。因此，我们这里只讨论其中的一部分。

让数据质量问题在没有监督的情况下积累，会威胁到环境的稳定性。一些常见的数据质量维度包括：

+   **完整性**：必填字段中的缺失值

+   **有效性**：不正确的数据格式或无效的条目

+   **准确性**：不正确或过时的值

+   **一致性**：相关记录之间的矛盾

低质量数据可能导致若干积重难返的问题，包括以下几点：

+   由于无效数据导致的处理失败，可能直接影响部署

+   难以报告不完整的记录

+   由于信息不准确而做出的错误决策

+   业务用户对数据的信任下降

+   报告或查询的性能差

专门的监控确保数据质量保证是持续运营的一部分。数据问题可以在它们出现时迅速被发现并解决，而不是事后才处理。

例如，监控可以提醒如果一个对象中超过 5% 的记录缺少必要字段，如电话、地址或正确的所有者。未能满足完整性要求将触发纠正过程。

持续跟踪关键质量指标可以突出需要改进的领域。数据管理员可以自动收到通知，实施修复并优化输入工作流。

Salesforce Labs 数据质量仪表盘提供了一个免费的起点，用于监控标准和自定义对象的关键质量指标。架构师还可以根据具体需求构建适合的自定义质量仪表盘。

## 监控数据量

跟踪存储消耗、记录计数和交易量提供了对数据增长趋势的关键洞察。历史指标使得在数据扩展时能够准确预测基础设施需求和许可成本。注意到数据量激增还可以揭示潜在的处理问题，值得进一步调查。虽然简单，但监控关键的量度指标提供了重要的可见性，指导优化和规划。

Salesforce 提供了原生功能，可以查看您组织当前的存储使用情况，甚至到每个用户和每种记录类型的级别。从**设置**中，管理员可以访问存储使用报告，显示可用和已用的数据空间、按使用量排序的用户以及最大文件。点击用户可以查看他们按记录类型划分的存储数据。

存储总量是异步计算的，因此在进行大规模导入或文件上传后，使用情况可能不会立即更新。个人用户还可以在其账户信息中查看个人存储利用详情。

在本节中，我们深入探讨了关键领域，如防止配置漂移、随着用户需求的变化保持可见性、识别优化机会、为合规性启用审计追踪以及预测容量需求。这些见解不仅对确保 Salesforce 系统的运营效果至关重要，而且在将其与业务目标对齐方面也起着关键作用。现在，让我们总结一下我们所学到的内容。

# 总结

管理 Salesforce 环境（包括元数据和数据）是 Salesforce DevOps 的一个关键方面。本章强调了监控环境的重要性，不仅是为了维持稳定性和完整性，还为了理解和监督 Salesforce 组织中各个方面的变更。

我们首先讨论了监控的必要性，详细说明了如何控制变化可以防止不稳定，并探讨了自动化变更控制如何帮助维持秩序。接着，我们探讨了不同类型的监控，包括元数据监控、数据监控、姿态监控和操作监控。

我们深入讨论了元数据监控的具体内容，讲解了在生产环境和沙箱环境中监控元数据的重要性，以及可以使用的各种工具和方法。我们还提到了监控数据行为的必要性，包括配置数据、数据异常、数据质量和数据量。

本章内容强调了在 Salesforce 中的监控不仅仅是一个工具，更是确保系统稳定性、数据完整性以及遵守治理政策的必要实践。它提供了关于变更的“谁、什么、何时、何地”的详细可见性，从而实现更好的控制和问题预防。

在实际场景中，这些监控策略至关重要。它们能够防止小问题升级为严重的工作流中断，通过提供实时的变更可见性，增强协作与合规性，并为容量规划、优化及识别业务趋势提供战略决策支持。

在下一章，我们将转变方向，开始探索具体的 DevOps 工具。
