

# 敏捷、DevOps 与 Azure 概览

DevOps 是一种现代的应用程序开发和交付方法，帮助组织将高质量的软件更快速地发布到生产环境中，并减少缺陷！ 然而，采用 DevOps 方法的好处并非单独实现。 它们最好与其他概念结合使用，如敏捷规划和 云计算。

本书的大部分内容集中在 DevSecOps，但在本章中，我们将为那些不熟悉这一概念的读者介绍 DevOps。 我们将介绍 DevOps 的工作定义，并将在本书的其余部分中使用该定义。 我们将讨论 DevOps 工作流中的阶段和五个核心的 DevOps 实施实践。 我们还将解释敏捷、DevOps 和云计算之间的关系，实施 DevOps 的安全挑战，以及组织如何开始解决这些挑战。

在本章结束时，你将对以下内容有清晰的理解： 以下内容：

+   什么是 DevOps

+   DevOps 的五个核心实践 核心实践

+   DevOps 工作流中的阶段 DevOps 工作流

+   DevOps 中协作文化的重要性 在 DevOps 中的协作文化

+   需要注意的 DevOps 反模式 反模式

+   DevOps 工具链（Azure DevOps, GitHub Actions， 和 GitLab）

+   DevOps 的缘由 DevOps 的必要性

+   敏捷、DevOps 和 云计算之间的关系

这些主题将为你提供理解和 contextualize 本书其余部分讨论的必要基础知识。 现在，让我们开始吧，开启我们的旅程！

# 技术要求

要跟随本章的指引，你需要 以下内容：

+   一台具备 互联网连接的 PC

+   有效的 电子邮件地址

# 定义 DevOps——理解其概念和实践

如果你问 10 个人 DevOps 是什么，你可能会得到 10 个不同的答案，这取决于这些人的背景以及他们阅读的书籍。 因此，我们必须为本书接下来的内容建立一个工作定义，以此定义 DevOps。 微软对 DevOps 的官方定义由 Donavan Brown 于 2018 年在一个会议上提出。 你仍然可以在 YouTube 上找到该视频： [https://www.youtube.com/watch?v=cbFzojQOjyA](https://www.youtube.com/watch?v=cbFzojQOjyA)。以下是 该定义：

DevOps 是人员、过程和产品的结合，以实现持续向最终用户交付价值。

从这个定义中，我们想强调几个关键点。 首先，必须理解 DevOps 不是 *一个工具* 、一个产品，或者一个职位名称。 相反，它是一种协作式的软件开发方法。 它是一种工作/思维方式，最重要的是，它是文化的变革（稍后我们会详细讨论）。 另一个关键点是，DevOps 的主要目标是确保功能性软件能够快速且频繁地交付给最终用户。 如果实施的结果没有达到这一目标，那么它很可能就不是 DevOps，或者它并没有得到恰当的实施（我们将在本章的 *远离 DevOps 反模式* 部分详细讨论这一点）。 最后，我们想强调的是，DevOps 有三个方面。 它有一个 **人员** 方面，一个 **过程** 方面，和一个 **产品** 方面。 在接下来的部分中，我们将首先讨论过程方面，但在此之前，让我们讨论一下为什么组织正在快速转向 DevOps 方法来进行软件开发 和交付。

## DevOps 的“为什么”——创新、速度和效率

虽然我们已经 花费了 大量时间讨论 DevOps 的 过程、人员和产品方面，但同样重要的是要理解推动公司采用 DevOps 的因素，以及近年来它日益重要的原因。 DevOps 为公司提供了其他软件交付方法无法比拟的独特优势。 以下是一些与 采用 DevOps 相关的好处：

+   **加速市场推出时间**：这指的是将新产品更快推向市场的能力。 根据 Puppet 进行的研究，采纳 DevOps 文化和实践的公司在代码部署频率上比未采用的公司高出 46 倍。

+   **适应市场和竞争**：这意味着能够适应市场和竞争的变化。 例如，Etsy 是一个在线手工艺品和复古商品市场，采用 DevOps 实践，每天部署 50 次代码变更。 这使公司能够迅速测试和发布新功能，回应用户反馈，并保持领先于 竞争对手。

+   **维护系统的稳定性和可靠性**：DevOps 实践可以通过改善开发和运维团队之间的沟通与合作，帮助组织保持系统的稳定性和可靠性。 例如，Netflix 采用 DevOps 方法，确保其流媒体服务始终保持可用和响应迅速。 该公司通过自动化基础设施部署并使用“混沌猴子”工具故意在系统中引入故障，从而在问题发生之前识别并解决系统中的弱点。 这有助于防止问题的出现。

+   **提高平均恢复时间**：通过采纳 DevOps 实践，组织可以提高从事件和故障中恢复的效率。 例如，美国领先零售公司 Target 在实施 DevOps 实践后，将其 整体 **平均恢复时间（MTTR）** 缩短了 90%。 这使得公司能够将停机的影响降到最低，并保持高水平的 客户满意度。

在基础知识 得到覆盖后，接下来我们深入探讨 DevOps 中用于创建 工作流的过程。

# 理解 DevOps 过程方面

每当讨论 DevOps 时， 人们往往会把技术或工具作为焦点。 然而，如果没有明确定义的流程，采用 DevOps 所带来的任何好处或结果最多也只是有限的，甚至可能带来额外的挑战 和复杂性！

在 DevOps 方法论中，过程方面指的是创建一个高效、简化的软件开发、测试和部署工作流程。 目标是优化开发过程，确保软件能够快速且可靠地交付给最终用户，同时保持较高的质量水平。 的质量。

这涉及到敏捷开发方法学的使用，以及 **持续集成和持续交付（CI/CD）** 实践。 这些实践涉及自动化软件开发生命周期的各个方面，如代码测试、构建和部署。 通常，当一个组织采用 DevOps 方法时，必须实施五个基本实践： **敏捷规划**， **版本控制**， **持续集成** (**CI**)， **持续交付** (**CD**)，和 **持续监控** (见 *图 1**.1*)：

![图 1.1 – DevOps 的五个基本实践](img/B19710_01_1.jpg)

图 1.1 – DevOps 的五个基本实践

值得注意的是，这些并不是 DevOps 中唯一的实践，但它们被认为是至关重要的实践。 在接下来的章节中，我们将更详细地描述这五个核心实践。 更多 细节。

重要说明

对于那些希望探索 与 DevOps 相关的其他定义和模型的人，DevOps **能力模型** 由 DevOps 敏捷技能协会 **（DASA）** (**DASA**) 是一个有价值的资源。 你可以在这里找到更多相关信息： [https://www.dasa.org/products/guidance-products/team-competence-model/](https://www.dasa.org/products/guidance-products/team-competence-model/)。

## 理解 DevOps 的五个核心实践

在本节中，我们将首先从 敏捷规划开始，探讨 DevOps 的五个基本实践。 敏捷规划。

**敏捷规划** 是广泛 指用于计划和跟踪我们在 DevOps 中软件项目的技术。 它是一种项目管理方法，涉及将一个项目分解为小的、可管理的部分，并以迭代方式进行工作。 敏捷方法论于 2001 年通过《敏捷宣言》正式发布，涵盖了敏捷项目管理的主要原则。 要获取更多关于《敏捷宣言》的信息，您可以访问 以下链接 [https://agilemanifesto.org/](https://agilemanifesto.org/)。

目标是逐步和持续地交付一个可用的产品，同时获取 利益相关者的反馈。

一个简单的敏捷规划示例可以在移动应用开发中看到。 假设某公司希望开发一个可以从本地餐馆订餐的移动应用。 开发团队首先会确定应用应该具备的关键功能，例如菜单、订餐系统、支付系统和用户资料。 掌握这些需求后，他们会设计应用的架构。 接下来，团队会将这些功能分解为更小、更可管理的任务，例如设计用户界面、创建存储订单的数据库和集成支付系统。 然后，团队会根据任务所带来的业务价值和完成这些任务所需的努力程度，优先处理这些任务。 任务优先级确定后，团队会估算完成每个任务所需的时间，并制定冲刺计划。 冲刺是一个短期的、有时间限制的工作周期（通常为 1-2 周），在此期间团队会集中处理一组 任务。

在每个冲刺期间，团队会按优先级顺序处理任务，完成任务，并从利益相关者那里获得反馈。 然后，反馈将用于调整 产品和下一次冲刺的计划。 这种将任务分解、优先排序、时间估算并在反馈中迭代工作的过程是 敏捷规划的核心。

重要提示

要了解敏捷开发的指导价值观，我们建议查看以下链接中突出的敏捷开发的十二条原则： [https://www.agilealliance.org/agile101/12-principles-behind-the-agile-manifesto/](https://www.agilealliance.org/agile101/12-principles-behind-the-agile-manifesto/)。

第二个实践， **版本控制**，允许开发人员高效地管理代码更改，进行有效的协作，并跟踪对代码所做的所有更改。 *图 1**.2* 展示了版本控制在 DevOps 中如何工作的一个简单示例。 假设一组开发人员正在开发一个软件应用程序。 他们使用 一个 **版本控制系统** (**VCS**)，例如 Git，创建了一个仓库（存储代码的中央位置）。 每个开发人员可以将仓库克隆到他们的本地计算机，或者他们也可以直接在一个受控的开发环境中工作，从而避免将代码复制到本地 PC。 值得注意的是，一些公司对这种工作流程有严格的政策，不允许代码 在本地克隆。

![图 1.2 – 版本控制和分支示例](img/B19710_01_2.jpg)

图 1.2 – 版本控制和分支示例

假设开发人员 A 被分配来处理功能 A；他们在仓库中创建了一个新的分支，名为 **功能 A** 并开始对代码进行更改。 与此同时，开发人员 B 正在开发应用程序中的另一个功能。 他们创建了一个名为 **功能 B** 的新分支，并开始对代码进行更改。 两个开发人员可以独立工作，彼此的工作不会互相影响。 一旦他们完成了各自的更改，他们可以将分支合并回主分支（也叫做 **主干** 分支）中， 并提交到仓库。

如果两个开发人员所做的更改之间存在任何冲突， 版本控制系统将突出显示这些冲突，开发人员可以在合并分支之前解决它们。 版本控制系统还会记录对代码所做的所有更改，包括谁做的更改、何时做的更改以及为什么做的更改。 如果新代码出现问题，团队可以使用版本控制系统快速回滚到代码的先前版本。 这种回滚功能在引入 bug 或新更改导致 意外问题时非常有用。

第三 种实践， **持续集成** (**CI**)，指的是开发人员每次提交或修改代码时，持续验证代码质量的过程。 假设一个开发团队正在进行一个软件项目；每当开发人员完成代码更改并将其提交到共享代码库时，CI 服务器（如 Jenkins 或 Travis CI）会触发一个自动过程，构建软件、运行单元测试，并使用各种工具检查代码质量问题。 如果构建和测试都成功通过，CI 服务器将通知团队，表示这些更改已准备好进行审查和集成。 如果发现任何错误或问题，CI 服务器将提醒团队，团队可以共同解决问题，然后再将代码合并到共享代码库中。 这使得团队能够在开发早期发现并修复问题，从而减少最终产品中出现 bug 和错误的风险：

![图 1.3 – 示例 CI 流程](img/B19710_01_3.jpg)

图 1.3 – 示例 CI 流程

第四 种实践， **持续交付** (**CD**)，指的是通过自动化过程持续进行已验证软件的测试和部署。 它允许团队快速发布新特性和修复 bug，采用连续的流程进行。 CD 的目标是使开发团队能够快速且有信心地将软件更改交付到生产环境，同时保持高水平的质量 和可靠性。

假设一个开发团队正在开发一个 web 应用程序；当团队为一个新特性编写代码时，代码会被提交到版本控制系统，并通过一系列自动化测试进行测试，包括单元测试、集成测试和验收测试。 一旦代码通过所有测试，它会被自动部署到预发布环境，在那里进行额外的测试和产品负责人审核。 如果一切正常，代码将被自动部署到生产环境，并提供给 所有用户。

第五项实践 是 **持续监控** 包括收集 来自用户的反馈和实时运行应用程序的遥测数据。 目标是确保软件系统满足用户需求并为组织提供价值。 这需要持续收集软件系统的性能和行为的洞察，并利用这些信息做出基于数据的决策，从而提升整体质量和用户体验。 为了更好地理解这一实践，我们将其分解为 两个组成部分：

+   **收集用户反馈**：用户反馈是持续监控的一个重要组成部分，因为它有助于从用户的角度识别软件系统中的问题和改进的空间。 反馈可以通过各种渠道收集，例如调查、用户评论和支持票据。 通过分析这些反馈，开发团队可以识别出反映改进领域的模式和趋势，并根据这些改进对 用户体验的影响优先考虑这些改进。

+   **收集来自运行中的应用程序的遥测数据**：遥测数据是指在软件系统实时运行过程中从各种来源收集的广泛信息。 这些来源可以包括应用日志、服务器指标、网络流量、用户互动、错误报告等。 从这些数据中可以得出响应时间、错误率、服务器负载等指标，以及用户行为的洞察。 通过收集和分析遥测数据，开发团队可以全面了解软件的性能和用户互动。 这些数据对在问题升级为 关键问题之前检测异常和潜在问题至关重要。

通过结合用户反馈和遥测数据，开发团队可以全面了解软件系统的表现以及用户如何使用它。 然后，这些信息可以用来做出基于数据的决策，改进系统 并优先考虑未来的开发工作。 总体而言，持续监控的第五项实践是 DevOps 中至关重要的一部分，帮助确保软件系统满足用户需求，并为 组织提供价值。

## 理解 DevOps 工作流中的各个阶段

理解 DevOps 的五项基本实践至关重要，但组织如何将它们付诸实践呢？ DevOps 实践的实施涉及一系列阶段，这些阶段有助于软件的持续开发、测试和部署。 这些阶段可能会根据组织和开发的软件类型有所不同，但它们通常遵循如 *图 1**.4*所示的模式：

![图 1.4 – DevOps 工作流中的典型阶段](img/B19710_01_4.jpg)

图 1.4 – DevOps 工作流中的典型阶段

第一阶段是 **计划**，在此阶段，敏捷规划实践开始付诸实施。 在这个阶段，团队根据业务或客户需求计划并优先排序需要完成的任务。 这涉及到创建项目计划或路线图，进行调研以了解所需的架构变更，定义工作范围（如功能开发或修复 bug），将计划分解为更小且可分配的任务，估算每个任务所需的时间，并为需要 优先完成的任务设定优先级。

第二阶段是 **编码**，这涉及到使用 选定的编程语言、框架和工具进行实际编码和软件开发。 在这一阶段，会实施版本控制实践。 团队协作开发代码并提交更改到版本 控制系统。

第三阶段是 **构建** 和 **测试**，在这一阶段，会实施持续集成实践。 在这一阶段，代码被转换为可执行的软件并经过测试，以确保其按预期工作并满足项目要求。 结合使用自动化和手动测试来发现并解决任何错误、bug 或缺陷。

第四阶段是 **发布** 和 **部署**，在此阶段，软件被打包并发布到生产环境中。 在这一阶段，会实施持续交付实践。 这一阶段包括设置运行软件所需的基础设施并进行配置，使其能够正常工作，将软件部署到预生产环境中以进行额外的验证，并将经过验证的软件 部署到生产环境。

第五个阶段是 **操作** 和 **监控**，在这个阶段，软件会被主动监控和维护。 团队会在部署后监控任何问题或事件，检查应用程序的性能，收集并分析日志，并确保软件符合 已定义的 **服务水平协议** (**SLA**)。 在这一阶段，使用持续监控工具和实践来跟踪应用程序的性能，收集使用遥测和性能指标，并在问题影响用户之前检测潜在问题。 收集到的信息随后用于识别优化的领域或要添加的附加功能。 一种 **自愈** 方法 在这一阶段越来越受到欢迎。 这种方法涉及利用自动化来修正任何故障或错误，无需人工干预，例如终止一个有问题的应用实例并部署替代实例，或在发生意外事件时触发故障转移到备用实例。 实施这种方法显著提高了系统的可用性和可靠性，并能更快速、更高效地从故障中恢复。 故障恢复。

这些阶段形成了一个持续的循环，使团队能够持续向最终用户交付价值，同时提升软件开发流程。 请记住，速度 对成功的 DevOps 工作流至关重要！ 每个阶段都必须快速高效地执行（我们将在谈到 安全集成时重新讨论这一点）。

# 理解 DevOps 中的人文因素

单纯在持续工作流中实施 DevOps 实践不足以充分释放其潜力；还需要一个文化方面的因素。 在促进沟通、协作和开发与运维团队成员之间共享责任的文化中，实施 DevOps 方法可以取得更好的结果。 然而，对于许多组织（尤其是大型组织），这是拥抱 DevOps 时最困难的方面，因为它涉及到心态和公司文化的变化，这可能会挑战已经取得良好效果的既定政策和流程。 到目前为止。

## 协作文化的重要性

要实现 DevOps 的全部 潜力，组织必须拥抱协作文化！ 我们所说的文化是打破团队孤岛，使开发人员、运维工程师和其他利益相关者能够共同合作，达成持续向客户交付高质量软件的共同目标。 这可以通过创建跨职能团队或 垂直团队来实现。

传统上，大型组织会根据特定的技能集或职能领域，如开发、测试或运维，采用横向结构来组织团队（如 *图 1**.5*所示）。 每个团队专注于自己的专业领域，仅处理该领域内的任务。 这些团队被一个边界隔开（如 *图 1**.6 所示*），并使用不同的绩效指标来评估，这通常会导致冲突。

![图 1.5 – 软件开发中的团队边界](img/B19710_01_5.jpg)

图 1.5 – 软件开发中的团队边界

另一方面，DevOps 提倡并在围绕特定产品或服务垂直组织的团队中蓬勃发展，这也被称为跨职能团队。 这种结构将来自不同职能领域的人员聚集在一起，共同合作，目标是交付特定的产品或服务。 每个团队成员具备广泛的技能，并负责为交付该产品或服务作出贡献。 这些团队还通过一套共享的绩效指标进行评估，这鼓励团队成员利用彼此的技能和专业知识来实现共同目标。 例如，一个垂直团队可能由开发人员、测试人员和运维工程师组成，共同合作，交付特定的应用程序或服务，如下图所示：

![图 1.6 – 垂直团队边界](img/B19710_01_6.jpg)

图 1.6 – 垂直团队边界

需要特别注意的是，尽管团队的组成至关重要，但一个引导人物的存在，通常是一个仆人式领导者，同样重要。 团队需要清晰的方向和领导力，才能高效运作。 这位领导者确保团队始终与目标保持一致，促进协作，并提供解决挑战所需的支持。 应对挑战。

DevOps 还有其他文化组成部分，例如培养持续 学习和实验、责任心和问责制的文化。 然而，我们建议阅读 *《凤凰项目》* 由基恩·金（Gene Kim）所著，以便更详细地了解 这些组成部分。

## 避免 DevOps 反类型

在实施 DevOps 文化时，重要的是要意识到潜在的反模式和反类型。 这些是低效的，有时甚至适得其反的方法，可能会阻碍 DevOps 的成功实施。 的实施。

例如，在实施 DevOps 时，一位经理或高管可能会创建一个单独的 DevOps 团队，这可能进一步分割开发和运维团队（*图 1**.7*）。 这种分离只有在团队是临时性的，且有明确的任务将团队 紧密结合起来时，才有意义：

![图 1.7 – 反模式 1](img/B19710_01_7.jpg)

图 1.7 – 反模式 1

另一个常见的反类型是当开发人员或开发经理认为他们可以不依赖操作技能和活动时（*图 1**.8*）。 这种误解通常源于对云计算的错误理解，认为云计算的自助服务特性使得操作技能变得过时。 然而，这种观点极大 低估了操作技能的复杂性和重要性，导致可避免的 操作失误：

![图 1.8 – 反模式 2](img/B19710_01_8.jpg)

图 1.8 – 反模式 2

另一个反模式是组织仅仅将他们的运维团队重新命名为 DevOps 或 **站点可靠性工程** (**SRE**) 团队，而没有对他们的 流程或孤岛做出任何实际改变（参见 *图 1**.9*）。 这种方法没有理解或认识到将不同领域的人员汇聚在一起，协同工作以实现 共同目标的重要性：

![图 1.9 – 反模式 3](img/B19710_01_9.jpg)

图 1.9 – 反模式 3

SRE 是一种将软件工程的理念融入基础设施和运维问题的学科。 SRE 团队的主要目标是创建可扩展且高度可靠的软件系统。 虽然 SRE 与 DevOps 理念高度契合，但仅仅将运维团队更名为 SRE 而没有采纳其原则或实践，可以视为一种反模式。 这不仅仅是一个名称问题，而是要拥抱 DevOps 和 SRE 都提倡的 方法论、实践和文化。

重要提示

有关 DevOps 反模式的更详细分析，请参阅 Matthew Skelton 和 Manuel Pais 的著作 *《团队拓扑学》* 。

# 了解 DevOps 的产品层面——工具链

尽管 DevOps 本身不是 一个工具或产品，但它需要使用工具来有效实施其流程和实践。 可以使用开源和商业工具来支持本章前面讨论的 DevOps 工作流每个阶段所需的流程（计划、编码、构建与测试、发布与部署、以及运维 和监控）。

常用的工具 包括 **计划阶段** 常用的工具有 **Trello**、 **JIRA**、 **Notion** 和 **Asana**。根据最新的 Stack Overflow 开发者调查，专业开发者更倾向于使用 JIRA（49%），而 Trello 则主要被学习编程的人使用（43%）：

![图 1.10 – 计划阶段常用工具](img/B19710_01_10.jpg)

图 1.10 – 计划阶段常用工具

在 **代码与开发阶段** , 开发人员使用 **集成开发环境** (**IDE**)，例如 **Visual Studio Code**、 **Visual Studio**、 **IntelliJ**、 **Notepad++** 和 **Eclipse**，用于 编写代码 和 版本控制工具，例如 **Git** (自托管或云托管)， **Apache Subversion** (**SVN**)， **Perforce**和 **Mercurial**。需要注意的是 ，虽然这个列表突出显示了 一些常见工具，但它并非详尽无遗。 市场上还有无数其他工具，每个工具都有其独特的功能和能力。 根据 2022 年 Stack Overflow 开发者调查，专业开发者压倒性地偏爱 Git 作为他们的版本控制 工具（96%）和 Visual Studio Code 作为他们的 IDE（74%）：

![图 1.11 – 常见的代码和开发工具](img/B19710_01_11.jpg)

图 1.11 – 常见的代码和开发工具

重要提示

Stack Overflow 开发者调查是由 Stack Overflow 进行的一项年度调查，Stack Overflow 是一个受欢迎的在线开发者社区。 该调查旨在收集开发者社区的偏好、意见和人口统计信息。 2022 年的调查结果可以在 这里找到： [https://survey.stackoverflow.co/2022](https://survey.stackoverflow.co/2022)。

在 **构建与测试阶段**，如 **Jenkins** (一个开源自动化服务器)， **Travis CI**和 **Circle CI** 广泛用于持续集成以及构建和测试自动化。 根据 Digital.ai 的最新调查，Jenkins 被 56%的 DevOps 团队使用，显示出它在行业中的受欢迎程度。 此外，测试工具如 **Selenium**， **Junit** (一个 Java 单元测试工具)， **Nunit** (一个.NET 单元测试工具)， **PHPUnit** (一个 PHP 单元测试工具)，以及 **Jmeter** (一个性能测试负载测试工具)可以与构建自动化服务器集成，以便于测试过程。 容器构建工具如 **Docker Build** (一个从 Dockerfile 构建容器镜像的工具)， **Podman Build** (一个使用 Containerfiles 和 Dockerfiles 构建和管理容器的工具)， **Buildah** (一个开源工具，用于创建和修改容器镜像)，以及 **Kaniko** (一个为 Kubernetes 集群设计的安全容器构建工具)也可以集成进来，以简化容器 镜像构建。

![图 1.12 – 构建与测试阶段常用的工具](img/B19710_01_12.jpg)

图 1.12 – 构建与测试阶段常用的工具

在 **发布与部署阶段**，开发者使用各种工具 来自动化部署。 下表展示了一些在发布和 部署阶段使用的工具：

| **部署** |
| --- |
| **GoCD** | 一个开源的持续交付工具，自动化 部署流水线 |
| **Octopus Deploy** | 一个部署自动化和发布 管理工具 |
| **TeamCity** | 一个构建管理和持续 集成服务器 |
| **Spinnaker** | 一个开源的、多云的持续 交付平台 |
| **ArgoCD** | 一个声明式持续交付工具 用于 Kubernetes |
| **基础设施** **即代码** |
| **Terraform** | 一个开源的基础设施即代码 软件工具 |
| **Azure** **ARM 模板** | 一个部署工具，允许定义 Azure 资源的基础设施和配置 |
| **Azure** **BICEP 模板** | 一种用于部署 Azure 资源的 ARM 模板语言替代品 |
| **AWS Cloud** **Formation 模板** | 一个开源的多云持续 交付平台 |
| **容器部署** |
| **Helm charts** | Kubernetes 的包管理器，帮助管理 Kubernetes 应用 |
| **Kubernetes** **清单文件** | 一个 YAML 或 JSON 文件，定义 Kubernetes 对象的期望状态 |
| **配置** **管理工具** |
| **Ansible** | 一个开源自动化引擎，自动化软件供应、配置管理和 应用部署 |
| **Chef** | 一个配置管理工具，帮助 自动化基础设施 |
| **Puppet** | 一个开源工具，用于管理 Unix、Linux 和 Microsoft Windows 服务器的配置 |
| **PowerShell Desired State** **Configuration (DSC)** | 一个 PowerShell 扩展，支持配置 Windows 系统 |

表 1.1 – 发布和部署阶段使用的工具

在 **运营和监控阶段**，可以使用多个工具。 其中一些在 下表中突出显示：

| **OpenTelemetry** | 一个开源的可观测性框架，用于生成和收集来自应用 和基础设施的遥测数据 |
| --- | --- |
| **Jaeger** | 一个开源的分布式追踪系统，用于监控和排查 基于微服务的应用 |
| **Zipkin** | 一个开源的分布式追踪系统，用于收集、分析和可视化跨 微服务架构的请求追踪 |
| **Prometheus** | 一个开源监控系统和时间序列数据库，用于收集和查询应用程序 及基础设施的指标 |

表 1.2 – 在操作和监控阶段使用的工具

类似 **Prometheus** 的工具可以用于对应用程序代码进行仪表化，并生成诸如指标、日志和追踪等遥测数据。 Prometheus、 **Grafana**和 **ELK 堆栈** (Elasticsearch、Logstash 或 Kibana)可以用于监控应用程序和基础设施的性能 和 可用性，提供潜在问题的洞察并实现 主动修复。

协作和通信工具 如 **Slack**、 **Microsoft Teams**、 **Azure Boards**和 **Atlassian Confluence** 可用于促进 团队间的沟通 和协作，帮助简化工作流程并 提高生产力。

开发人员可以访问各种工具，涵盖每个阶段，超出了我们已提及的工具范围。 为了理解可用的丰富工具选项，我们建议参考由 **Cloud Native Computing Foundation** (**CNCF**) 提供的云原生生态图，网址为 [https://landscape.cncf.io/](https://landscape.cncf.io/)。该图（*图 1**.13*）旨在帮助人们浏览云原生领域中的各种工具、技术和平台。 该图展示了多个类别的工具，包括应用开发、持续集成和交付、自动化、 以及配置管理。

![图 1.13 – CNCF 生态图的截图](img/B19710_01_13.jpg)

图 1.13 – CNCF 生态图的截图

随着团队采纳 DevOps 实践，通常会根据偏好选择多个工具，而非考虑与组织 DevOps 战略的整体兼容性（不幸的是，许多组织并没有明确的 DevOps 战略）。 因此，碎片化的工具链可能是常见的现象，不同的团队和产品单元使用不同的工具，这些工具可能无法很好地集成或协同工作，从而阻碍了软件交付的扩展能力，并带来了治理挑战。 使用多个工具时，很难建立并强制执行与访问控制和数据隐私相关的治理和合规政策。 为了解决这些挑战，平台化工具方法可能是更受欢迎的选择。

## 平台化 DevOps 工具方法

与其为 DevOps 工作流的每个阶段使用多个不同的工具，一些组织选择了平台战略，提供一个集成平台，配备各个阶段所需的工具。 这种方法可以简化 DevOps 工具的使用场景，使得管理变得更加容易，并减少了不同工具之间手动集成的需求。

根据行业报告和调查，以下是五个最常用且评价很高的商业 DevOps 平台：

+   **GitLab**: 一体化 DevOps 平台，提供一个用于源代码管理、持续集成、测试 与部署的应用程序。

+   **Azure DevOps**: 一款微软基于云的平台，提供一整套 DevOps 服务，帮助开发者规划、开发、测试并 部署应用程序。

+   **GitHub**: 另一款微软基于云的平台，提供一整套 DevOps 服务，帮助开发者规划、开发、测试并 部署应用程序。

+   **Atlassian**: Atlassian 提供一系列 DevOps 工具，包括用于问题跟踪的 Jira、用于源代码管理的 Bitbucket 和用于持续集成 与部署的 Bamboo。

+   **Amazon Web Services (AWSs) DevOps**: AWS 提供了一整套用于 DevOps 的工具和服务，包括 AWS CodePipeline、AWS CodeCommit 和 AWS CodeDeploy。

其中两个平台是微软的 产品，将实现 DevOps 流程所需的工具汇聚在一个地方：Azure DevOps 和 GitHub。

## Azure DevOps 平台概览

**Azure DevOps** 是微软的 云平台 ，提供帮助团队实施 DevOps 流程的服务。 要使用它，我们需要创建一个 Azure DevOps 组织（*图 1**.14*）。 在该组织内，我们可以为不同的软件项目创建独立的项目，如 *图 1**.14* 所示。在每个项目中，我们可以访问用于实施 DevOps 流程的服务，并且可以组织团队来处理项目的不同部分：

![图 1.14 – Azure DevOps 组织结构](img/B19710_01_14.jpg)

图 1.14 – Azure DevOps 组织结构

Azure DevOps 平台有五个核心服务。 这些服务与开发过程中的关键实践相连接，如 计划、控制代码变更和测试。 这五项核心服务是 Azure DevOps 的核心：

+   **Azure Boards** 用于计划

+   **Azure Repos** 用于控制 代码变更

+   **Azure Pipelines** 用于持续集成 和交付

+   **Azure Artifacts** 用于 包管理

+   **Azure Test Plans** 用于探索性 测试计划

![图 1.15 – Azure DevOps 核心服务](img/B19710_01_15.jpg)

图 1.15 – Azure DevOps 核心服务

让我们简要了解这五项服务，从 Azure Boards 开始：

+   **Azure Boards**：一个帮助我们规划、跟踪和可视化工作的工具，类似于 JIRA。 它可以与 Scrum 或 Kanban 方法一起使用，并提供四种不同的模板供选择。 它还具有交互式看板和报告工具，帮助我们跟踪 我们的工作。

+   **Azure Repos**：用于管理代码变更的源代码管理服务。 它支持两种代码管理方式：Git 和 **团队基础版本控制** （**TFVC**）。 它还与 Azure DevOps 中的其他服务集成 以支持可追溯性。

+   **Azure Pipelines**：一个帮助我们自动构建、测试和部署代码的工具。 它可用于实现持续集成和持续交付的过程。 它支持多种不同类型的编程语言和平台，包括 Python、Java、PHP、Ruby、C#和 Go。 我们还可以用它将代码部署到各种目标，包括本地服务器或 云服务。

+   **Azure Artifacts**：一个帮助我们存储、管理和组织软件包的工具。 我们可以选择并控制与谁共享包。 它允许我们从上游源下载包。 它支持多种类型的包，如 NuGet、NPM、Maven、Universal、 和 Python。

+   **Azure Test Plans**：一个云托管的测试管理解决方案，我们可以用它来计划和跟踪不同类型的测试结果。 我们可以用它来规划和跟踪手动 测试、用户 验收测试、探索性测试，甚至是自动化测试。 我们可以通过任何支持的浏览器访问工具，并通过易于使用的网页门户执行手动测试。 它支持端到端的可追溯性，用于跟踪我们需求和构建的进展与质量，并为我们提供数据和报告，以改进我们的 测试过程。

关于 Azure DevOps 平台的一件好事是，我们不被强迫使用它的所有服务。 我们可以选择要用于软件项目的服务，并关闭那些我们 不需要的服务（*图 1**.16*）。

![图 1.16 – 启用/禁用 Azure DevOps 服务](img/B19710_01_16.jpg)

图 1.16 – 启用/禁用 Azure DevOps 服务

## GitHub 平台概述

GitHub 平台 提供多种产品选项，适应不同规模的团队和组织。 这些选项包括 以下内容： 

+   **GitHub Free**：这是一个免费的基础版，适合小型个人项目或开源 项目。

+   **GitHub Pro**：这是一个付费版本，具有额外功能，如高级保护功能、受保护的分支和代码所有者。 它适合需要更多 高级工具的开发人员。

+   **GitHub Team**：此版本包含 GitHub Pro 的所有功能，并具有团队管理工具。 适合需要在项目中进行协作的团队。 如果您的组织有 11 名或更少开发者，请考虑使用 GitHub Team。

+   **GitHub Enterprise**：此版本适用于需要更多高级功能（如 SAML **单点登录** (**SSO**)、数据驻留合规性和高级安全功能）的大型组织。 它适合需要遵循特定安全和监管要求的大型组织。 通常，拥有 12 名或更多开发者的组织最能从 GitHub Enterprise 中获益。 企业版还提供两种选项：企业服务器，托管在客户管理的基础设施上，以及企业云，托管在云端。

![图 1.17 – GitHub 平台产品选项](img/B19710_01_17.jpg)

图 1.17 – GitHub 平台产品选项

在本书的其余部分，我们的重点 将放在 GitHub Enterprise Cloud 产品上。 为了使用 GitHub Enterprise Cloud，我们需要创建一个 GitHub 组织（*图 1**.18*）。 组织是一个共享的 **私有** GitHub 账户，企业成员可以在多个项目中进行协作。 在组织内，我们可以创建 **仓库**，这些仓库类似于 Azure DevOps 中的项目。 为每个组织正在进行的项目创建单独的仓库是一个好主意。

![图 1.18 – GitHub 组织层级结构](img/B19710_01_18.jpg)

图 1.18 – GitHub 组织层级结构

一家公司可以拥有多个 GitHub 组织。 为了简化可见性、管理和计费，建议创建一个企业账户来管理属于贵公司的所有组织（*图 1**.19*）。 创建企业账户是可选的，但它是免费的，并且不会为 GitHub Enterprise Cloud 客户增加任何额外费用。 即使一家公司只有一个组织，创建企业账户仍然是有益的。 通过企业账户，我们可以管理并强制执行 我们公司所有组织的政策。 我们甚至可以选择希望在企业级别强制执行的政策，同时允许组织所有者在 组织级别配置其他政策。

![图 1.19 – GitHub 企业账户](img/B19710_01_19.jpg)

图 1.19 – GitHub 企业账户

GitHub Enterprise Cloud 平台提供了一系列服务，我们可以在代码到云的不同阶段使用这些服务。 这些服务包括 以下内容：

+   **Projects** 用于规划、组织、协作和跟踪软件 开发项目。

+   **Codespaces** 用于在基于云的 开发环境中编写代码。

+   **Copilot** 用于机器学习辅助的 代码编写。

+   **Repos** 用于管理私有和公共 代码库。

+   **Actions** 用于自动化构建、测试和部署 代码。

+   **Packages** 用于共享和发现可重用的 代码包。

+   **Security** 用于扫描和检测代码库中的安全问题。

下图 展示了 GitHub 服务的布局：

![图 1.20 – GitHub 服务](img/B19710_01_20.jpg)

图 1.20 – GitHub 服务

让我们简要了解一下这五项服务，从 GitHub 项目开始：

+   **GitHub 项目**：我们可以用来规划、组织和跟踪软件项目的工具。 我们可以用它分配任务、与他人协作，并添加额外信息以跟踪进度。 它还具有报告已完成和 未完成工作的能力。

+   **Codespaces**：提供一个方便的云开发环境，开发者可以在其中运行、测试、调试和推送代码，无需进行本地机器设置。 创建 Codespace 后，开发者将自动获得一个已经配置好的系统，其中包括多个语言的 SDK 和运行时，如 Python、Node、Docker、Java、Rust、Go 和 C++。 默认镜像可以根据个人或团队的需求进行完全定制，从而加快每个仓库的设置时间。

+   **GitHub Copilot**：由 OpenAI Codex 提供支持的人工智能配对编程工具，Codex 是 OpenAI 开发的机器学习模型（OpenAI 是一家知名的人工智能研究和部署公司）。 Copilot 在开发者编写代码时提供代码建议，适用于他们的 IDE。 它还可以解释自然语言注释，并将其转化为代码。 它支持多种编程语言，因为它在所有公开仓库中出现的语言上进行了训练。 Copilot 可以作为扩展插件在支持的 IDE 中使用，例如 Visual Studio Code、Visual Studio、Neovim 和 JetBrains 系列 IDE。

+   **GitHub 仓库**：一个源代码管理服务，用于管理代码的变更。 与 Azure DevOps 不同，它 *仅* 支持 Git，这是一种分布式源代码管理工具。 它还与 GitHub 中的其他服务集成 以实现可追溯性。

+   **GitHub Actions**：一个帮助我们自动构建、测试和部署代码的工具。 它可以用于实现持续集成和持续交付的过程。 它支持许多不同类型的编程语言和平台，包括 Python、Java、PHP、Ruby、C# 和 Go。 它还可以用于将代码部署到多种目标，包括本地服务器或 云服务。

+   **GitHub Packages**：一个帮助我们存储、管理和组织软件包的工具。 我们可以选择并控制希望与谁共享这些软件包。 它允许我们从上游源下载软件包。 它支持多种类型的软件包，如 NuGet、NPM、Maven、Universal、 和 Python。

+   **GitHub 高级安全**：它提供了一系列工具来保护我们仓库中的代码。 它扫描易受攻击的依赖项，并允许我们自动发起拉取请求以修复这些问题。 它还会检测新代码或修改过的代码中的安全漏洞和编码错误。 它还可以识别任何意外提交到仓库中的令牌或凭据。 我们将在本书后续章节中详细讨论这一服务。    

让我们快速了解一下 另一个 DevOps 平台：GitLab。

## GitLab 平台概述

GitLab 是一个基于 Web 的 Git 仓库管理 工具，提供端到端的 DevOps 解决方案。 与其他 DevOps 平台类似，GitLab 也拥有支持 DevOps 工作流各个阶段的核心服务。 这些服务包括 以下内容：

+   **GitLab 问题**：它是一个敏捷项目管理工具，帮助团队使用 Scrum 或 Kanban 方法规划和组织工作。 通过 GitLab 看板，团队可以轻松地跟踪进度、可视化工作，并与 团队成员协作。  

+   **GitLab 代码库**：GitLab 主要以其版本控制系统而闻名。 它为团队提供了一个集中平台，帮助他们使用 Git 存储、管理和协作开发代码库。 团队可以使用 GitLab 代码库，选择 Git 或 Mercurial，且可以轻松地从 其他代码库导入代码。

+   **GitLab CI/CD**：GitLab 的 CI/CD 工具允许团队自动化软件交付过程。 GitLab CI/CD 使团队能够以安全高效的方式在各种环境中构建、测试和部署应用程序。  

+   **GitLab 容器注册表**：GitLab 容器注册表是一个内置的容器注册表，允许团队存储、管理和部署 Docker 镜像。 团队可以使用 GitLab 容器注册表创建和管理镜像，并将其部署到 首选平台。

+   **GitLab 监控**：GitLab 监控是一个监控工具，提供应用程序和基础设施性能的实时可视化。 团队可以使用 GitLab 监控工具监控其应用程序和基础设施的健康状况，发现问题并迅速 解决问题。

GitLab 也具有高度的可配置性和可定制性。 团队可以轻松定制平台以满足他们的需求和偏好。 GitLab 支持多种集成，并拥有一个庞大的第三方扩展 和插件生态系统 ，团队可以使用这些扩展来扩展 其功能。

## Azure 服务在 DevOps 工作流中的应用

Microsoft Azure 提供了一系列广泛的工具和服务，能够很好地集成到 DevOps 工作流中。 涵盖了秘密管理、配置管理、负载测试、混沌工程和应用托管/部署的广泛工具和服务，并具备全面的监控和 可观察性功能。

![图 1.21 – Azure 云原生服务用于 DevOps](img/B19710_01_21.jpg)

图 1.21 – Azure 云原生服务用于 DevOps

*图 1**.21* 展示了可以在 DevOps 工作流的不同阶段使用的一些工具。 我们来回顾一下这些服务以及它们 如何适应：

我们有多种服务来托管 我们的应用程序：

1.  **构建阶段**:

    +   **Azure 密钥保管库**：提供安全的秘密管理，允许开发人员存储和检索敏感信息，如 API 密钥、密码 和证书。

    +   **Azure 应用配置**：此服务支持集中配置管理，提供在多个环境中存储和检索应用设置的方法。

1.  **测试阶段**:

    +   **Azure 负载测试**：通过模拟用户流量并分析系统在负载下的行为，这使得应用程序的压力测试和性能测试成为可能。

    +   **Azure 混沌工作室**：通过引入 受控 干扰和故障来测试 系统的弹性。

1.  **发布阶段**：Azure 提供了多种应用托管 和部署的计算选项：

    +   **虚拟机（VM）和虚拟机规模集**：这些提供了部署和管理虚拟机以托管应用程序的灵活性。

    +   **应用服务**：提供一个平台来托管 Web 和 API 应用程序，无需担心 基础设施管理。

    +   **函数应用**：这使得可以开发无服务器函数以按需执行代码 。

    +   **容器服务**：这支持容器化应用程序的部署，提供如 Azure 容器实例（适用于轻量级工作负载）或 Azure Kubernetes 服务（用于编排和扩展 容器化应用程序）等选项。

1.  **操作和** **监控阶段**：

    +   **Azure Monitor**：这为应用程序和基础设施提供全面的监控和诊断，允许团队深入了解系统性能 和健康状况。

    +   **应用程序洞察**：这提供了实时应用程序性能监控和日志记录，帮助开发人员快速检测和诊断 问题。

    +   **用于可观察性的托管 Grafana**：这将流行的开源可观察性平台 Grafana 与 Azure 服务集成，能够提供先进的数据可视化和分析，用于监控 和故障排除。

请记住，这里提到的示例只是其中的一部分，我们在后续过程中会遇到更多的服务。 在本书中，我们将探讨支持 DevOps 实践并增强软件开发过程的各种 Azure 服务，特别是那些与安全相关的 用例。

目前请注意，DevOps 和云计算是相辅相成的，因为两者都旨在加速软件开发和部署。 云提供了可扩展且灵活的基础设施，可以支持现代软件开发的需求，并提供增强该过程的服务，而 DevOps 则提供了一个框架，用于高效地在 云中管理和部署软件。

现在我们已经 探讨了 敏捷、DevOps 和云计算的基本概念，让我们来看看这三者是如何结合在一起，以支持现代软件 开发实践的。

# 敏捷、DevOps 和云 – 完美的三重奏

采用 DevOps 方法 并非孤立地产生效益，而是与其他概念相结合，如敏捷规划和云计算。 敏捷是一种项目管理方式，注重灵活性和对变化的响应。 云计算指的是使用基于网络的计算服务，而不是物理服务器和软件。 敏捷、DevOps 和云三者结合，可以帮助组织更高效地工作 并提高效率。

一些组织可能只使用其中一个或两个概念，但最佳的结果来自于三者的结合。 我们可以在不实践 DevOps 的情况下采用敏捷方法进行软件开发；也可以实施 DevOps 实践，但不涉及云计算，遗憾的是，许多组织在没有实施 DevOps 实践的情况下采用云计算也很常见。 对于云原生应用和新软件，三者的协同—敏捷、DevOps 和云—通常能带来最佳结果，正如下面的 图示所示：

![图 1.22 – 敏捷、DevOps 和云](img/B19710_01_22.jpg)

图 1.22 – 敏捷、DevOps 和云

我们这样说：敏捷是 *我们应该做的事情*，DevOps 是 *我们应该如何做*，云计算是 *我们应该在哪里做* 的方式。

然而， 需要 认识到，这个通用规则有例外。 将 敏捷、DevOps 和云计算结合应用于某些场景时，可能会面临不同的挑战和动态。 虽然这三者的整合对许多应用非常有益，但它并非在每个场景中都能保证成功。 正如俗话所说，**金玉其外，败絮其中**，并不是所有 DevOps 与云的结合都会带来 成功的结果。

让我们暂时结束讨论。 在接下来的章节中，我们将设置所需的云账户，以便跟随本书余下部分的动手练习。 本书的内容将涵盖这些练习。

# 动手练习 1 – 创建一个 Azure 订阅

让我们从 创建 订阅开始：

1.  打开一个网页浏览器并访问 到 [https://signup.azure.com](https://signup.azure.com)。

1.  点击 **登录**。

1.  输入你的个人资料信息，验证你的身份，并同意条款和条件。

1.  点击**下一步**并提供你的信用卡信息（注意，只有在你将订阅从免费试用切换到付费订阅时，信用卡才会被收费）。

1.  点击**注册**。

# 实践练习 2 – 创建一个 Azure DevOps 组织（与您的 Azure AD 租户相关联）

接下来，我们将创建一个新的组织：

1.  打开一个网页浏览器，访问[`portal.azure.com`](https://portal.azure.com)（Azure 门户）。

1.  在 Azure 门户中，在顶部的搜索区域，搜索并选择**Azure DevOps**。

1.  点击**我的 Azure DevOps** **组织**链接。

1.  在弹出的窗口中，配置以下内容：

    +   **名称**：输入你新建的 Azure DevOps 组织的名称。

    +   **项目位置**：选择一个靠近你的位置

接下来，我们来配置我们的新组织的账单：

1.  在 Azure DevOps 控制台中，点击左下角的**组织设置**。

1.  点击**账单**，然后点击**设置账单**。

1.  选择你的 Azure 订阅，然后点击**保存**。

# 实践练习 3 – 创建 GitHub 企业云试用账户

首先，我们来创建一个**GitHub 企业**云组织：

1.  要创建一个 GitHub 组织，请访问[`github.com/pricing`](https://github.com/pricing)，点击**开始免费试用**，然后选择**企业云**：

![﻿图 1.23 – 创建企业云组织](img/B19710_01_23.jpg)

图 1.23 – 创建企业云组织

1.  登录 GitHub 或创建一个账户。

1.  登录后，你将被引导至 **设置你的企业试用** 页面。 填写所需的详细信息并点击 **创建你的** **企业** 按钮。

干得好！ 你现在已经 完成了为接下来的实践练习所需的云账户设置。 接下来的章节将继续进行。

# 总结

本章概述了 DevOps——一种现代应用程序开发和交付方法，帮助组织更快速地将高质量软件交付到生产环境，并减少缺陷！ 我们讨论了 DevOps 的五个核心实践、DevOps 工作流中的不同阶段，以及协作文化在 DevOps 成功中的重要性。 我们还强调了需要避免的 DevOps 反模式和反例，并介绍了流行的 DevOps 平台，如 Azure DevOps、GitHub Actions 和 GitLab。 本章所获得的知识为你提供了扎实的基础知识，帮助你理解本书其余部分的讨论。

在下一章，我们将深入探讨 DevOps 的安全挑战，探索潜在的风险以及组织如何开始应对这些挑战。 敬请期待！

# 进一步阅读

要了解本章讨论的更多内容，请查看以下资源：

+   *《加速：精益软件与 DevOps 的科学：构建和扩展高性能技术组织》* 作者：Nicole Forsgren, Jez Humble, 和 Gene Kim。

+   *《凤凰计划：一本关于 IT、DevOps 以及帮助你的企业成功的小说》* 作者：Gene Kim, Kevin Behr, 和 George Spafford。
