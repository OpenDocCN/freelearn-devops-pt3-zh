- en: '12'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '12'
- en: Application Monitoring
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 应用程序监控
- en: In the previous chapters, you learned about applying DevOps principles to software
    delivery. You learned how to create a pipeline from source control all the way
    to production. You also learned how to ensure that your delivery is compliant
    and secure, without sacrificing speed or a focus on the delivery of business value.
    In this chapter, you will learn how to start transforming this pipeline into a
    DevOps loop, a continuous process of delivering new software, and then measure
    how your application performs. This is a continuous journey, as you evaluate how
    your application fares in production and learn how to proceed next.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在前几章中，你了解了如何将DevOps原则应用于软件交付。你学会了如何从源代码管理到生产环境创建一条流水线。你还学会了如何确保交付符合要求并且安全，同时不牺牲速度或对业务价值交付的关注。本章中，你将学习如何将这条流水线转变为DevOps循环——一个持续交付新软件的过程，然后衡量你的应用程序的表现。这是一个持续的过程，因为你将评估应用程序在生产中的表现，并学习如何进行下一步。
- en: To do this, this chapter starts by introducing a means for gathering application
    crashes. Almost every application will, at some point, throw an unhandled exception
    and crash. Ensuring that application crashes are gathered and reported will enable
    you to investigate the causes and address them. Then, attention will shift to
    instrumenting applications.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一目标，本章首先介绍了一种收集应用程序崩溃的方法。几乎所有应用程序都会在某个时刻抛出未处理的异常并崩溃。确保收集并报告应用程序崩溃，将帮助你调查其原因并进行修复。接下来，注意力将转向对应用程序进行仪器化。
- en: Instrumentation is the practice of gathering logs and metrics that help you
    understand how your application performs in production. You can use them to get
    alerts when things go wrong or, hopefully, before they go wrong. The chapter concludes
    by exploring several options for integrating with other tools.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 仪器化是收集日志和指标的实践，帮助你了解应用程序在生产环境中的表现。你可以利用它们在出现问题时触发警报，或者希望在问题发生之前就能发现它们。本章最后探讨了与其他工具集成的几种选项。
- en: 'The following topics are covered in this chapter:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖的主题包括：
- en: Investigating application crashes
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调查应用程序崩溃
- en: Instrumenting web applications
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仪器化Web应用程序
- en: Integrating with other tools
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与其他工具的集成
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To experiment with the techniques described in this chapter, you will need
    one or more of the following:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实验本章中描述的技术，你将需要以下工具之一或多个：
- en: An App Center account for gathering mobile application crashes
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于收集移动应用程序崩溃报告的App Center帐户
- en: A Raygun subscription for gathering desktop application crashes
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于收集桌面应用程序崩溃报告的Raygun订阅
- en: An Azure subscription for instrumenting web applications
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于仪器化Web应用程序的Azure订阅
- en: Free-trial options are available for all of these.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些工具都提供免费试用选项。
- en: Investigating application crashes
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调查应用程序崩溃
- en: No matter how well an application is engineered, at some point, it will crash
    due to an unexpected condition. To learn from these crashes and to try and prevent
    them in the future, it helps to add code to applications to gather crash reports
    and send them to a central location. Here, they can be analyzed and grouped to
    identify application improvements. How to do this differs, depending on the type
    of application.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 无论一个应用程序设计得多么完美，它最终都会因为某种意外情况而崩溃。为了从这些崩溃中吸取教训并尽量避免将来的崩溃，向应用程序添加代码以收集崩溃报告并将其发送到一个中心位置会有帮助。在那里，这些报告可以被分析和归类，以识别应用程序的改进方向。如何做到这一点取决于应用程序的类型。
- en: The following sections discuss how this process for mobile and desktop applications
    works. Regarding web applications, gathering crash reports can be done using the
    same tool as for instrumentation; we will discuss this in the *Instrumenting web
    applications* section later on.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 以下章节讨论了移动和桌面应用程序如何工作。关于Web应用程序，收集崩溃报告可以使用与仪器化相同的工具；我们将在后面的*仪器化Web应用程序*部分讨论这一点。
- en: Gathering crash reports for mobile applications
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 收集移动应用程序的崩溃报告
- en: One of the many tools available for gathering crash reports and errors from
    mobile applications is Visual Studio App Center. Besides distributing mobile applications,
    **App Center** also allows applications to submit their crashes and errors for
    analysis.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 用于收集移动应用程序崩溃报告和错误的众多工具之一是Visual Studio App Center。除了分发移动应用程序，**App Center**还允许应用程序提交其崩溃和错误以供分析。
- en: 'To get started with crash reporting using App Center, the application first
    needs to be defined. This is called an app definition and how to work with it
    was discussed in[*Chapter 6*](B18655_06.xhtml#_idTextAnchor330), *Implementing
    Continuous Deployment and Release Management*. With this app definition, an app
    secret is created, which is needed to configure an application to send out crash
    reports. Along with crash reports, it is possible to track other errors, and exceptions
    that are of interest to developers. To start sending crash reports, the following
    steps need to be performed:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用 App Center 进行崩溃报告，首先需要定义应用程序。这被称为应用程序定义，如何处理它在[*第六章*](B18655_06.xhtml#_idTextAnchor330)，*实现持续部署和发布管理*中已经讨论过。通过这个应用程序定义，会创建一个应用密钥，用于配置应用程序发送崩溃报告。除了崩溃报告，还可以跟踪开发者感兴趣的其他错误和异常。要开始发送崩溃报告，需要执行以下步骤：
- en: Install the `Microsoft.AppCenter.Crashes` NuGet package in the project.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在项目中安装 `Microsoft.AppCenter.Crashes` NuGet 包。
- en: 'Add the following code to the application initialization:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下代码添加到应用程序初始化中：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Besides crashes, it is also possible to track other errors that are of interest
    to developers. This can be done using the following code:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 除了崩溃之外，还可以跟踪开发者感兴趣的其他错误。可以使用以下代码来实现：
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'All the unhandled exceptions are automatically caught and sent back to App
    Center. Here, they become available for analysis, as shown in the following screenshot:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 所有未处理的异常都会被自动捕获并发送回 App Center。在这里，它们会变得可供分析，如下图所示：
- en: '![Figure 12.1 – An App Center diagnostics overview ](img/B18655_12_01.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.1 – App Center 诊断概览](img/B18655_12_01.jpg)'
- en: Figure 12.1 – An App Center diagnostics overview
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.1 – App Center 诊断概览
- en: 'Click on any of the reported errors or crashes to open a detailed view, as
    shown here:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 点击报告的错误或崩溃项以打开详细视图，如下所示：
- en: '![Figure 12.2 – An App Center diagnostics detailed view ](img/B18655_12_02.jpg)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.2 – App Center 诊断详细视图](img/B18655_12_02.jpg)'
- en: Figure 12.2 – An App Center diagnostics detailed view
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.2 – App Center 诊断详细视图
- en: A dashboard with the most important information is shown for each crash or error.
    This includes the number of reports and the number of affected users. Also, the
    impacted device types and operating systems are shown. At the top of the page,
    the stack traces are shown, which can be used by developers to investigate and,
    hopefully, fix the issue.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 每个崩溃或错误会显示一个包含最重要信息的仪表板。这些信息包括报告数量和受影响用户的数量，还会显示受影响的设备类型和操作系统。在页面顶部，显示堆栈跟踪，开发者可以使用这些信息来调查并希望能修复该问题。
- en: 'App Center has integration with Azure DevOps, Jira, and GitHub for bug tracking
    purposes. Refer to this link for more information: [https://docs.microsoft.com/en-us/appcenter/dashboard/bugtracker/](https://docs.microsoft.com/en-us/appcenter/dashboard/bugtracker/).'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: App Center 与 Azure DevOps、Jira 和 GitHub 集成，供 bug 跟踪使用。有关更多信息，请参考此链接：[https://docs.microsoft.com/en-us/appcenter/dashboard/bugtracker/](https://docs.microsoft.com/en-us/appcenter/dashboard/bugtracker/)。
- en: For any critical events, App Center can directly create a bug and send email
    notifications.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何关键事件，App Center 可以直接创建一个 bug 并发送电子邮件通知。
- en: That covers gathering crash reports and errors from mobile applications. The
    next section introduces the same concepts for desktop applications.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分涵盖了从移动应用程序收集崩溃报告和错误的内容。接下来的部分将介绍桌面应用程序中的相同概念。
- en: Gathering crash reports for desktop applications
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 收集桌面应用程序的崩溃报告
- en: Crash reporting is also available for desktop applications. There are, again,
    many solutions available for desktop applications and most of them work in roughly
    the same way. One of these solutions is Raygun. Raygun is a commercial offering
    available for .NET applications but works for many other languages and platforms
    as well.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面应用程序也可以进行崩溃报告。对于桌面应用程序，有许多可用的解决方案，而且大多数的工作方式大致相同。其中一个解决方案是 Raygun。Raygun 是一个商业产品，适用于
    .NET 应用程序，但也可以用于其他许多语言和平台。
- en: 'To gather crashes using Raygun, follow these three steps:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Raygun 收集崩溃的步骤如下：
- en: Sign up for a Raygun account.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注册一个 Raygun 账户。
- en: Install the `Mindscape.Raygun4Net` NuGet package on the solution.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在解决方案中安装 `Mindscape.Raygun4Net` NuGet 包。
- en: Catch unhandled exceptions and forward them to Raygun.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 捕获未处理的异常并将其转发到 Raygun。
- en: 'The following example shows you how to catch and forward unhandled exceptions
    to Raygun:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例演示了如何捕获并转发未处理的异常到 Raygun：
- en: '[PRE2]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: All the exceptions can be explored in the Raygun web interface. Here, exceptions
    are automatically grouped if stack traces are sufficiently similar. They can also
    be grouped and browsed individually, but in most cases, it makes sense to only
    focus on the larger groups of exceptions.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 所有异常都可以在Raygun的Web界面中进行探索。在这里，如果堆栈跟踪足够相似，异常会自动分组。它们也可以被分组并单独浏览，但在大多数情况下，专注于较大的异常组更有意义。
- en: 'The following screenshot shows how these groups can be browsed in Raygun:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了如何在Raygun中浏览这些组：
- en: '![Figure 12.3 – The Raygun view for desktop application exceptions  ](img/B18655_12_03.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![图12.3 – 桌面应用程序异常的Raygun视图](img/B18655_12_03.jpg)'
- en: Figure 12.3 – The Raygun view for desktop application exceptions
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.3 – 桌面应用程序异常的Raygun视图
- en: Clicking on the exception message in this interface shows the complete stack
    trace and all the shared properties of any instance of the exception that has
    occurred.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在此界面中点击异常消息将显示完整的堆栈跟踪以及任何发生的异常实例的所有共享属性。
- en: This completes our look into gathering crash reports from mobile and desktop
    applications. Doing so allows you to find and investigate issues that customers
    face in production. In the following section, instrumentation for web applications
    will be introduced to further enhance our insight into how applications behave
    in production.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这完成了我们对从移动和桌面应用程序收集崩溃报告的讨论。这样做可以让你发现并调查客户在生产环境中遇到的问题。接下来的部分将介绍Web应用程序的监控，以进一步增强我们对应用程序在生产环境中行为的洞察。
- en: Instrumenting web applications
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Web应用程序的监控
- en: Web applications differ from mobile and desktop applications in many ways, including
    the fact that large portions of the application run on a server rather than a
    client. This enables developers to collect information on how web applications
    are run more easily than other types of applications. This is known as instrumenting
    an application.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: Web应用程序与移动应用程序和桌面应用程序在许多方面不同，其中之一是大部分应用程序的运行是由服务器而非客户端执行的。这使得开发人员比其他类型的应用程序更容易收集Web应用程序的运行信息。这就是为应用程序添加监控的过程。
- en: Logs are text messages that are saved by a system to describe the execution
    path that the server follows. This helps developers go back in time and explore
    what has happened by examining the logging output. Structured logging is quickly
    becoming the standard for trace logging. **Structured logging** is a technique
    where logs are no longer only text messages. Instead, logs are parameterized text
    messages with a set of values for each parameter. This has two advantages – logs
    can be better compressed, and they can be searched more quickly.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 日志是系统保存的文本消息，用于描述服务器执行的路径。这有助于开发人员回溯并通过检查日志输出来探索发生过的事件。结构化日志正迅速成为跟踪日志的标准。**结构化日志**是一种技术，其中日志不再仅仅是文本消息，而是带有每个参数值集的参数化文本消息。这有两个优势——日志可以更好地压缩，而且可以更快速地进行搜索。
- en: '**Metrics** are values that are recorded for an application. They take the
    form of a timestamp, metric name, and value. One example is recording the percentage
    of a CPU in use every second.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '**度量指标**是为应用程序记录的值。它们通常由时间戳、指标名称和值组成。一个例子是每秒记录一次CPU使用率的百分比。'
- en: When instrumenting an application, it is easy to focus on many server-level
    types of logs and metrics. For example, many operators will, by default, start
    collecting metrics such as CPU usage, memory pressure, and I/O operations. While
    there is nothing wrong with these metrics, they are not always indicative of an
    application’s performance from a user’s point of view. Other metrics, such as
    response times or queue message processing delays, might yield better insights
    into the user experience. While there is nothing wrong with measuring system metrics
    (they are often great indicators of future issues), you should also try to gather
    user-centric metrics.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在为应用程序添加监控时，容易专注于许多服务器级别的日志和度量指标。例如，许多操作员默认会开始收集诸如CPU使用率、内存压力和I/O操作等度量指标。虽然这些度量指标本身没有问题，但它们不一定能从用户的角度反映应用程序的性能。其他度量指标，如响应时间或队列消息处理延迟，可能会更好地提供关于用户体验的见解。虽然测量系统指标没有错（它们通常是未来问题的良好指示），但你也应该尝试收集以用户为中心的度量指标。
- en: 'Azure offers the Application Insights service for instrumenting applications,
    with a focus on web applications. An Application Insights workspace can be created
    using the Azure portal, which opens up a workspace, as shown in the following
    screenshot. In Azure portal in overview section, **instrumentation key** field
    is plainly shown, it is recommended that you treat this as an application secret:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了 Application Insights 服务，用于对应用程序进行监控，重点是 Web 应用程序。可以通过 Azure 门户创建一个
    Application Insights 工作区，该工作区会打开一个工作空间，如下图所示。在 Azure 门户的概述部分，**监控密钥**字段清晰显示，建议将其视为应用程序机密：
- en: '![Figure 12.4 – Azure Application Insights Overview ](img/B18655_12_04.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.4 – Azure Application Insights 概述](img/B18655_12_04.jpg)'
- en: Figure 12.4 – Azure Application Insights Overview
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.4 – Azure Application Insights 概述
- en: The following subsections will go into detail about logging, metrics, and investigating
    individual requests.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 以下小节将详细介绍日志记录、度量和单个请求的调查。
- en: Logging
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 日志记录
- en: One of the most basic types of instrumentation is adding logging statements
    to application code. In the past, these logs were saved to the disk of the server
    that ran the application. Retrieving and investigating these logs, therefore,
    took a lot of time and effort.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 最基本的监控方式之一就是在应用程序代码中添加日志语句。过去，这些日志会保存到运行应用程序的服务器磁盘中。因此，获取和调查这些日志需要大量的时间和精力。
- en: In modern hosting environments, logs are no longer saved on the local filesystem
    but instead stored remotely. With transient infrastructure and servers added or
    removed on the fly, it is no longer possible to store logs on a server and be
    sure that they can be retrieved later. For this reason, they are transmitted over
    HTTP to specialized log stores, such as Application Insights.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在现代托管环境中，日志不再保存在本地文件系统上，而是远程存储。由于基础设施的临时性，服务器可以随时增加或移除，因此无法再将日志保存在服务器上，并确保以后可以检索到。因此，这些日志会通过
    HTTP 传输到专用的日志存储中，如 Application Insights。
- en: Emitting logs
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 生成日志
- en: 'To write log entries to a log store, such as Application Insights, from an
    ASP.NET application, two things must be done:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 要从 ASP.NET 应用程序将日志条目写入日志存储（例如 Application Insights），必须执行以下两项操作：
- en: Log entries need to be emitted from the application code, where applicable,
    using the `ILogger` interface. This interface is available from the `Microsoft.Extensions.Logging.Abstractions`
    NuGet package.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 需要在应用程序代码中使用 `ILogger` 接口生成日志条目（如适用）。该接口可以通过 `Microsoft.Extensions.Logging.Abstractions`
    NuGet 包使用。
- en: The Application Insights NuGet package (`Microsoft.ApplicationInsights.AspNetCore`)
    needs to be installed and Application Insights needs to be registered as `LoggingProvider`.
    This way, all logs sent to the preceding interface are forwarded to the Application
    Insights code. In turn, this code forwards all the logs to the Application Insights
    service.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 需要安装 Application Insights NuGet 包（`Microsoft.ApplicationInsights.AspNetCore`），并将
    Application Insights 注册为 `LoggingProvider`。这样，所有发送到前述接口的日志都会转发到 Application Insights
    代码中。反过来，这段代码会将所有日志转发到 Application Insights 服务。
- en: 'The following example code shows you how to use the `ILogger` interface from
    a class to emit a structured log entry:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例代码展示了如何使用类中的 `ILogger` 接口来生成结构化日志条目：
- en: '[PRE3]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Important Note
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: There should be no dollar sign (`$`) at the start of the log entry. There is
    no string interpolation used here, but two placeholders are inserted into the
    text message. The structured logging entry will recognize these and, when showing
    the entry, insert the provided values.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 日志条目开头不应有美元符号（`$`）。这里没有使用字符串插值，但有两个占位符被插入到文本消息中。结构化日志条目会识别这些占位符，并在显示条目时插入提供的值。
- en: With log entries emitted, a logging provider should be registered to capture
    these logs. This is done using the .NET Core built-in dependency injection.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在生成日志条目后，应注册一个日志提供程序来捕获这些日志。这个过程是通过 .NET Core 内建的依赖注入实现的。
- en: After starting the application, all log entries at the level of warning and
    higher are automatically forwarded to Application Insights. To change which entries
    are forwarded and which aren’t, filters can be configured. A link to more details
    on configuring Application Insights in detail is provided at the end of this chapter.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 启动应用程序后，所有级别为警告及以上的日志条目会自动转发到 Application Insights。要更改转发哪些条目以及哪些不转发，可以配置过滤器。本章末尾提供了有关如何详细配置
    Application Insights 的链接。
- en: Searching logs
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 搜索日志
- en: 'Within a few minutes of emitting a log entry to Application Insights, it becomes
    available on the interface for querying. To do this, open the Application Insights
    instance and navigate to **Logs** in the left-hand-side menu (**1**). This opens
    the view shown in the following screenshot:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在将日志条目发送到 Application Insights 后的几分钟内，它将出现在界面上供查询。为此，请打开 Application Insights
    实例，并在左侧菜单中导航至 **日志** (**1**)。这将打开如下所示的视图：
- en: '![Figure 12.5 – The Application Insights Logs view ](img/B18655_12_05.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.5 – Application Insights 日志视图](img/B18655_12_05.jpg)'
- en: Figure 12.5 – The Application Insights Logs view
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.5 – Application Insights 日志视图
- en: Here, it is possible to write queries (**2**) that search the recorded logs
    in **Kusto Query Language** (**KQL**). Application Insights is optimized for handling
    large amounts of data and most queries return results within a second or less,
    even when searching millions of log entries.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，可以编写查询 (**2**) 来搜索以 **Kusto 查询语言** (**KQL**) 记录的日志。Application Insights
    被优化用于处理大量数据，大多数查询能在一秒钟或更短时间内返回结果，即使是在搜索数百万条日志条目时。
- en: Alerting on logs
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 针对日志设置警报
- en: Gathering and searching logs is useful when troubleshooting specific situations
    or bugs in response to a user complaint. However, there are situations where it
    is better to be notified automatically when a certain condition arises. This is
    called alerting.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 收集和搜索日志在排查特定情况或响应用户投诉时非常有用。然而，在某些情况下，当某个条件出现时，自动通知比手动搜索更为有效。这就是警报的作用。
- en: Within Azure, it is possible to create alert rules that notify developers whenever
    a certain condition is met. Alerting functionality is provided by the Azure Monitor
    offering that is integrated with many Azure services, including Application Insights.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 中，可以创建警报规则，当满足某个条件时通知开发人员。警报功能由 Azure Monitor 提供，并与许多 Azure 服务（包括 Application
    Insights）集成。
- en: 'To create a new alert rule, follow these steps:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个新的警报规则，请按照以下步骤操作：
- en: Navigate to Azure Monitor using the portal.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用门户导航到 Azure Monitor。
- en: 'Now, choose **Alerts**. This opens the view shown in the following screenshot:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，选择 **警报**。这将打开如下所示的视图：
- en: '![Figure 12.6 – The Azure Monitor Alerts view ](img/B18655_12_06.jpg)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.6 – Azure Monitor 警报视图](img/B18655_12_06.jpg)'
- en: Figure 12.6 – The Azure Monitor Alerts view
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.6 – Azure Monitor 警报视图
- en: 'If there are any alerts that need attention, they are shown here:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有需要注意的警报，它们将在此处显示：
- en: '![Figure 12.7 – The Azure Monitor alert creation view ](img/B18655_12_07.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.7 – Azure Monitor 警报创建视图](img/B18655_12_07.jpg)'
- en: Figure 12.7 – The Azure Monitor alert creation view
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.7 – Azure Monitor 警报创建视图
- en: 'Use the **Create** button at the top-left-hand side of the screen to add new
    alert rules. Doing so opens another view, as shown in the preceding screenshot.
    Here, the alerting conditions can be configured:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 使用屏幕左上角的 **创建** 按钮来添加新的警报规则。这样会打开另一个视图，如前面的截图所示。在这里，可以配置警报条件：
- en: '![Figure 12.8 – The Azure Monitor alerts Review + create view ](img/B18655_12_08.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.8 – Azure Monitor 警报审查 + 创建视图](img/B18655_12_08.jpg)'
- en: Figure 12.8 – The Azure Monitor alerts Review + create view
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.8 – Azure Monitor 警报审查 + 创建视图
- en: In the preceding screenshot, the view that opens to configure alerts – **Scope**
    – is shown. Here, it is necessary to make resource selections to create an alert.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中，打开用于配置警报的视图——**范围**——如图所示。在这里，需要选择资源以创建警报。
- en: This (**1**) is the resource that is the subject of the alert. This can be any
    type of resource, and in this instance, the alert will be on an Application Insights
    workspace.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这里的 (**1**) 是警报的资源主题。这可以是任何类型的资源，在这个实例中，警报将针对一个 Application Insights 工作区。
- en: 'These (`404` code result:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这些 (`404` 代码结果：
- en: '[PRE4]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '`400` code result.'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`400` 代码结果。'
- en: '**The interval to evaluate the alert condition over** (**2c**): When specifying
    a query that matches a specific number, this determines the interval in which
    this amount must be met.'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**评估警报条件的时间间隔** (**2c**)：当指定一个匹配特定数字的查询时，这将决定必须满足该数量的时间间隔。'
- en: '**How often to evaluate the alert condition** (**2d**): Evaluating an alert
    condition too frequently can result in too many alerts opening and closing in
    a fast series. Evaluating an alert condition too infrequently can result in alerts
    coming in too late. Experimentation will help you understand how to configure
    this.'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**评估警报条件的频率** (**2d**)：过于频繁地评估警报条件可能会导致警报频繁开闭，产生快速的警报序列。过于不频繁地评估警报条件可能会导致警报反应过迟。实验将帮助你了解如何配置这个参数。'
- en: This is the action to execute when the alert condition is met. Since there might
    be a lot of alerts that have to invoke the same group of actions, actions can
    be grouped, and these action groups can be referenced here. Some examples of actions
    are calling a Webhook or sending an SMS message or email.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是在满足警报条件时执行的操作。由于可能有许多警报必须调用相同的动作组，因此可以将操作分组，并在此处引用这些操作组。一些操作的示例包括调用Webhook或发送短信或电子邮件。
- en: The alert configuration is completed by putting in a name and description (**3**).
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 警报配置通过输入名称和描述（**3**）来完成。
- en: Finally, the alert can be saved.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，警报可以保存。
- en: After the alert is reviewed and created as per the preceding screenshot, activation
    is done automatically, and within a few minutes, the alert is ready to inspect
    application logs and signal whenever the alert condition is met.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在按前面的截图回顾并创建警报后，激活会自动完成，几分钟内，警报就可以开始检查应用程序日志并在满足警报条件时发出信号。
- en: Logging is a great method of gaining deep knowledge about what happened with
    a request and how an error came to be. Another technique for learning more about
    an application’s behavior is by using metrics.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 日志记录是深入了解请求发生了什么以及错误如何发生的绝佳方法。另一种了解应用程序行为的技术是使用度量。
- en: Metrics
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 度量
- en: 'Besides logs, an application can also emit one or more metrics. A metric is
    a series of values over time that describes one or more aspects of a system. Some
    examples of metrics are as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 除了日志外，应用程序还可以发出一个或多个度量。度量是随时间变化的一系列值，描述系统的一个或多个方面。以下是一些度量的示例：
- en: The number of users currently logged in
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前登录的用户数量
- en: The number of products viewed by users
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户查看的产品数量
- en: The number of database transactions
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库事务的数量
- en: Gathering metrics such as these can provide insight into how a system is used
    and how it currently operates. Metrics are often used for creating dashboards
    and alerts.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 收集此类度量可以提供有关系统使用情况和当前操作方式的洞察。度量通常用于创建仪表板和警报。
- en: Emitting metrics
  id: totrans-109
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 发出度量
- en: To start working with metrics, they first have to be emitted by an application
    and stored in a centralized location. Besides logging, Application Insights can
    be used for metrics as well.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用度量，首先必须由应用程序发出度量并将其存储在集中位置。除了日志记录外，还可以使用Application Insights进行度量。
- en: 'To use Application Insights for metrics, the following steps need to be taken:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Application Insights进行度量时，需要采取以下步骤：
- en: Metrics need to be emitted from the application code where applicable, using
    the `TelemetryClient` class. This interface is available from the `Microsoft.Extensions.Logging.Abstractions`
    NuGet package.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 度量需要在应用程序代码中发出，使用`TelemetryClient`类。在`Microsoft.Extensions.Logging.Abstractions`
    NuGet包中可以找到此接口。
- en: Install the `Microsoft.ApplicationInsights.AspNetCore` Application Insights
    NuGet package.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装`Microsoft.ApplicationInsights.AspNetCore`应用程序Insights NuGet包。
- en: 'Register `TelemetryClient` with the `Dependency` container. Do this by using
    the extension method on the container builder, as shown in the following code
    snippet:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`Dependency`容器注册`TelemetryClient`。通过在容器构建器上使用扩展方法来完成此操作，如下代码片段所示：
- en: '[PRE5]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Once this is done, the application is ready to start emitting metrics. This
    is done using the `TelemetryClient` class:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成此操作后，应用程序即可开始发出度量。这是通过使用`TelemetryClient`类来完成的：
- en: '[PRE6]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Emitting a metric involves two steps. First, a reference to the metric is retrieved
    using the `GetMetric()` method. Next, a value is submitted using the `TrackValue`
    method. Submitted values should be doubles or allow an implicit conversion to
    a double.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 发出度量涉及两个步骤。首先，使用`GetMetric()`方法检索度量的引用。接下来，使用`TrackValue`方法提交一个值。提交的值应该是双精度浮点数或允许隐式转换为双精度浮点数的类型。
- en: Once the metrics are emitted, they can be used to create graphs and metrics.
    However, before moving on to these topics, first, another type of metric needs
    to be discussed – namely, Azure platform metrics.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦度量被发出，它们可以用于创建图表和度量。然而，在继续这些话题之前，首先需要讨论另一种类型的度量——即Azure平台度量。
- en: 'Besides the metrics that an application emits, there are also numerous metrics
    that can be recorded from the Azure platform that the system is running on. Some
    examples are as follows:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 除了应用程序发出的度量外，还有许多可以从系统运行所在的Azure平台记录的度量。以下是一些示例：
- en: The percentage of CPU used
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CPU使用百分比
- en: The number of messages on a service bus
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务总线上的消息数量
- en: The number of database transactions per second
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每秒数据库事务数量
- en: The amount of free disk space
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用的磁盘空间量
- en: These metrics are often closely related to how an application performs and may
    even be leading indicators. For example, when the amount of free disk space reaches
    0, most web servers stop working.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 这些指标通常与应用程序的性能密切相关，甚至可能是领先指标。例如，当可用磁盘空间达到 0 时，大多数 Web 服务器会停止工作。
- en: In Azure, each service emits a series of metrics by default. These are called
    platform metrics. Which metrics are emitted differs from service to service and
    cannot be influenced by the user. These metrics are also automatically gathered
    by Azure Monitor, and they can be used in the same ways for graphing and alerting
    as they are emitted by an application.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 中，每个服务默认会发出一系列指标，这些被称为平台指标。发出哪些指标因服务而异，且无法由用户影响。这些指标也会自动被 Azure Monitor
    收集，并可以像应用程序发出的指标一样用于绘图和告警。
- en: Platform metrics are integrated, cost-free, and for the majority of resources
    metrics are retained for 93 days.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 平台指标是集成的、免费的，并且大多数资源的指标会保留 93 天。
- en: Graphing metrics
  id: totrans-128
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 绘制指标图
- en: 'All metrics that are gathered, either in Application Insights or in Azure Monitor,
    can be used to build graphs and dashboards that visualize the metric. Graphs can
    be created using the **Metrics** tab that is available on every Azure resource.
    Graphs can also be created using the Azure Monitor. This way, graphs for multiple
    resources can be combined on a single canvas. To do this, do the following:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 所有收集到的指标，无论是在 Application Insights 还是 Azure Monitor 中，都可以用来构建图表和仪表板以可视化指标。可以使用每个
    Azure 资源上都可以访问的**指标**选项卡来创建图表。也可以使用 Azure Monitor 来创建图表，这样就可以将多个资源的图表合并到一个画布中。操作步骤如下：
- en: Open Azure Monitor, which is available from the menu on the left.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Azure Monitor，它可以从左侧菜单中访问。
- en: 'Navigate to the **Metrics** menu. This opens the view shown in the following
    screenshot:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**指标**菜单。这将打开如下所示的视图：
- en: '![Figure 12.9 – Azure Monitor – Metrics ](img/B18655_12_09.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.9 – Azure Monitor – 指标](img/B18655_12_09.jpg)'
- en: Figure 12.9 – Azure Monitor – Metrics
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.9 – Azure Monitor – 指标
- en: 'Once the canvas opens, one or more graphs can be added to it. A graph is built
    using the graph builder at the top. Four selections have to be made here:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开画布后，可以向其中添加一个或多个图表。图表是使用顶部的图表构建器构建的。在这里必须做出四个选择：
- en: The resource that a graph needs to be drawn for.
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要为其绘制图表的资源。
- en: '`TelemetryClient`.'
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`TelemetryClient`。'
- en: '`GetMetric()` method from the previous section.'
  id: totrans-137
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自上一节的`GetMetric()`方法。
- en: '**The mathematical operation to combine multiple measurements into a single
    point on the graph**: This can be the minimum, maximum, average, sum, or count.'
  id: totrans-138
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**将多个测量值合并为图表中的一个点的数学操作**：可以选择最小值、最大值、平均值、总和或计数。'
- en: To add multiple graph lines to the same graph, choose **Add Metric** at the
    top. Repeat the preceding four selections to configure the new graph.
  id: totrans-139
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要在同一个图表中添加多条指标线，请选择顶部的**添加指标**。重复前面的四个选择来配置新图表。
- en: To make this graph part of a dashboard for easy reuse, click the **Pin to dashboard**
    button at the top.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 若要将此图表作为仪表板的一部分以便于重复使用，请点击顶部的**固定到仪表板**按钮。
- en: 'Dashboards can then be accessed directly using the menu on the right:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后可以通过右侧菜单直接访问仪表板：
- en: '![Figure 12.10 – The App Service Http400 metrics graph ](img/B18655_12_10.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.10 – App Service Http400 指标图](img/B18655_12_10.jpg)'
- en: Figure 12.10 – The App Service Http400 metrics graph
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.10 – App Service Http400 指标图
- en: Having a graph of a metric, or even multiple graphs in a dashboard, is great
    for investigating issues. However, no one likes to continuously watch dashboards
    to see how things are going. For that reason, it is also possible to configure
    alerts on metrics.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有某个指标的图表，或者在仪表板中拥有多个图表，对于调查问题非常有帮助。然而，没人喜欢一直盯着仪表板看事态进展。因此，也可以配置指标告警。
- en: Alerting on metrics
  id: totrans-145
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 告警指标
- en: Just as with log entries, it is possible to be alerted by Azure Monitor when
    a metric goes above or below a certain threshold. Log entries that require a follow-up
    could be related to only a single user or customer that is having trouble. Metrics,
    on the other hand, are useful for detecting situations where all users are impacted
    by an issue, or situations where an infrastructure no longer works or will stop
    working soon.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 就像日志条目一样，当某个指标超过或低于某个阈值时，可以通过 Azure Monitor 设置告警。需要后续跟进的日志条目可能仅与遇到问题的某个用户或客户相关。而指标则有助于检测所有用户都受某个问题影响的情况，或检测基础设施停止工作或即将停止工作的情况。
- en: Creating alerts for metrics works in a way that is very similar to creating
    alerts from logs. To create a new alert rule, navigate to Azure Monitor using
    the portal and then choose **Alerts**.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 对指标创建警报的工作方式与从日志创建警报非常相似。要创建新的警报规则，请使用门户导航到 Azure Monitor，然后选择**警报**。
- en: Investigating requests
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调查请求
- en: When using Application Insights for logging and metrics, there are many more
    built-in capabilities of Application Insights that you can use. One of these capabilities
    is the possibility to execute search queries against all types of data collected
    by Application Insights from one view, called **Search**.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用应用洞察进行日志记录和度量时，您可以使用应用洞察的许多内置功能。其中一项功能是从一个称为**搜索**的视图执行针对应用洞察收集的所有类型数据的搜索查询。
- en: 'Here, it is possible to search all the information collected by Application
    Insights, including the following:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在此处，可以搜索应用洞察收集的所有信息，包括以下内容：
- en: Logs emitted by the application code, which includes NuGet packages and the
    .NET Framework.
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用程序代码发出的日志，其中包括 NuGet 包和 .NET Framework。
- en: '**All dependency calls**: These are calls to databases and other systems that
    are automatically detected by Application Insights. Application Insights records
    the target system and duration.'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**所有依赖调用**：这些是对数据库和其他系统的调用，由应用洞察自动检测到。应用洞察记录目标系统和持续时间。'
- en: '**All exceptions**: All exceptions that occur in an application are recorded
    by Application Insights, even if properly handled by the application code.'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**所有异常**：应用程序中发生的所有异常都会被应用洞察记录，即使应用程序代码已正确处理。'
- en: '**Requests**: Every user request that comes in over HTTP is logged. Important
    properties, such as the URL, duration, and HTTP verb, are also included.'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**请求**：所有通过 HTTP 进入的用户请求都会被记录。还包括重要属性，如 URL、持续时间和 HTTP 动词。'
- en: 'To search for a specific transaction using the search view, open the correct
    Application Insights instance within the Azure portal and navigate to the **Transaction
    search** menu (**1**) to get the view shown in the following screenshot:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用搜索视图搜索特定事务，请在 Azure 门户中打开正确的应用洞察实例，然后导航到**事务搜索**菜单（**1**），以获取以下截图显示的视图：
- en: '![Figure 12.11 – Application Insights – Transaction search ](img/B18655_12_11.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.11 – 应用洞察 – 事务搜索 ](img/B18655_12_11.jpg)'
- en: Figure 12.11 – Application Insights – Transaction search
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.11 – 应用洞察 – 事务搜索
- en: 'In the **Transaction search** view, several search parameters can be configured
    (**2**):'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在**事务搜索**视图中，可以配置几个搜索参数（**2**）：
- en: '**An interval to search within**: This defaults to the last 24 hours.'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**要搜索的时间间隔**：默认为最近 24 小时。'
- en: '**The types of events to search in**: These can be requests, log entries, page
    views, exceptions, dependency calls, and so on.'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**要搜索的事件类型**：可以是请求、日志条目、页面查看、异常、依赖调用等。'
- en: Any text to search for.
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任何要搜索的文本。
- en: Within seconds, all matching results are shown in a bar chart. Each bar stands
    for a time period and shows how many matches there are within that time frame.
    Below this chart, all the individual matches are shown. These are a mix of all
    of the types of events available.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 几秒钟内，条形图显示所有匹配的结果。每个条形代表一个时间段，并显示在该时间段内有多少匹配项。在此图表下方显示所有单个匹配项。这些是所有可用事件类型的混合。
- en: Clicking on any of the results opens a new view that shows the selected record
    in relation to all the other types, grouped per request. This allows you to quickly
    navigate to all the logs, dependency calls, and exceptions that are gathered by
    Application Insights during the execution of a single user request. The results
    can be displayed as a list and as a timeline.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 点击任何结果会打开一个新视图，显示选定的记录与所有其他类型的请求分组相关联的情况。这使您可以快速导航到应用洞察在单个用户请求执行期间收集的所有日志、依赖调用和异常。结果可以显示为列表和时间轴。
- en: 'This allows you to see very quickly what the server was doing when performing
    the user request:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 这使您能够快速查看服务器在执行用户请求时的操作：
- en: '![Figure 12.12 – Application Insights – End-to-end transaction details ](img/B18655_12_12.jpg)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.12 – 应用洞察 – 端到端交易详细信息 ](img/B18655_12_12.jpg)'
- en: Figure 12.12 – Application Insights – End-to-end transaction details
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.12 – 应用洞察 – 端到端交易详细信息
- en: With all of these means to investigate applications and be notified regarding
    events, it is important to decide which alerts to create and which not to, not
    only in order to create a healthy working environment but also to balance monitoring
    with new work. This is the topic of the next section.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有这些用于调查应用程序并接收事件通知的手段下，决定创建哪些告警、哪些不创建是非常重要的，这不仅是为了创建一个健康的工作环境，也是为了平衡监控与新工作的关系。这是下一节的主题。
- en: Optimizing alerting
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 优化告警
- en: Once teams start instrumenting their applications and adding alerts to metrics
    that they find important, it will not be long before the first alerts start coming
    in. At this point, it is important to not only respond to the alerts but also
    to investigate them and then close them. Alerts should also be evaluated and viewed
    as an opportunity for learning.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦团队开始为应用程序添加指标并设置告警，首批告警就很快会出现。在这一点上，重要的不是仅仅响应告警，还要调查它们并关闭它们。告警还应当被评估，并视为学习的机会。
- en: Optimizing alerts
  id: totrans-170
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 优化告警
- en: 'An important thing to do after creating a series of alerts is to re-evaluate
    them on a regular basis. Two things that might come out of an evaluation such
    as this are as follows:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一系列告警后，重要的是定期重新评估它们。通过这种评估，可能得出的两点结论如下：
- en: '**Changes in the alerting threshold**: Evaluating alerts regularly involves
    taking a look at the metric over time and seeing where the alerting threshold
    is at now. This might lead to the conclusion that the threshold is too low or
    too high.'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**告警阈值变化**：定期评估告警涉及查看一段时间内的指标，并观察当前告警阈值的情况。这可能导致得出结论，阈值设得太低或太高。'
- en: '**Removing duplicates**: Looking at alerts that have been raised over the month(s),
    it is very likely you’ll identify one or more groups of alerts that are always
    raised at the same time. For example, a set of alerts set on a specific web server
    can be so related that they are always raised at the same time. A common example
    is CPU usage and the average response time for an HTTP request; these two often
    rise at the same time. If this is the case, it is worth considering either removing
    one of them or downgrading one of them to be a warning only. Duplicate alerts
    increase the number of items that need an immediate reaction, leading to increased
    pressure on a team without a clear benefit.'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**消除重复项**：查看一个月（或几个月）内触发的告警，很可能你会发现一个或多个告警组总是同时触发。例如，针对特定Web服务器设置的一组告警，可能是如此相关，以至于它们总是同时触发。一个常见的例子是CPU使用率和HTTP请求的平均响应时间，这两个通常会同时上升。如果是这种情况，值得考虑删除其中一个告警，或者将其中一个降级为仅警告。重复的告警增加了需要立即响应的项目数量，导致团队在没有明确好处的情况下承受更大的压力。'
- en: Constantly optimizing the set of alerts not only helps to reduce waste but also
    prevents so-called alert fatigue.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 不断优化告警集不仅有助于减少浪费，还能防止所谓的告警疲劳。
- en: Alert fatigue
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 告警疲劳
- en: If alert rules are not constantly reviewed and updated, they could negatively
    influence a team, especially when alert rules trigger too easily or too frequently,
    as people will no longer respond to them properly. If there are too many alerts,
    it will wear people out and they will become numb to the effect of an alert. It
    does not even matter whether they are false alerts or real alerts; just the number
    of alerts can be enough to get people into a state where they do not care anymore.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 如果告警规则不不断地审查和更新，它们可能会对团队产生负面影响，尤其是当告警规则触发过于容易或过于频繁时，人们将不再正确响应它们。如果告警过多，团队成员会感到疲劳，对告警的反应变得麻木。无论这些告警是虚假告警还是实际告警，单纯的告警数量足以让人们进入一种不再关心的状态。
- en: If a situation such as this is observed within a team, it is time to drastically
    change the way alerts are generated and responded to. If this does not happen,
    team members might fall ill or leave a company altogether.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在团队中观察到这种情况，便是时候彻底改变告警的生成和响应方式了。如果不这样做，团队成员可能会生病或完全离开公司。
- en: One of the ways to prevent this situation is by implementing a healthy on-call
    schedule.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 防止这种情况发生的一种方式是实施健康的值班安排。
- en: Which metrics to capture
  id: totrans-179
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 捕获哪些指标
- en: 'One question that comes up frequently when talking about metrics is what metrics
    to emit and monitor. There are many possible metrics and even more opinions on
    this subject. As a good starting point, the following metrics are often gathered
    for web applications:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在讨论指标时，常常会有一个问题：应该发送和监控哪些指标？有许多可能的指标，关于这个问题也有更多的看法。作为一个良好的起点，以下是通常会为 Web 应用程序收集的一些指标：
- en: '**Requests per minute, transactions per minute, or something similar**: This
    is a metric that is intended to capture the current load or throughput on a web
    application.'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每分钟请求数、每分钟事务数或类似的指标**：这是一个旨在捕获 Web 应用程序当前负载或吞吐量的指标。'
- en: '**The average response time**: This metric captures the response time for all
    requests within a time window.'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平均响应时间**：这个指标捕获时间窗口内所有请求的响应时间。'
- en: '`400` and upward are often taken.'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`400` 及以上的状态码通常会被记录。'
- en: 'When these three metrics are captured and graphed together in a single graph,
    it provides the very first step in understanding an application’s behavior. Let’s
    explore a few examples:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 当这三个指标被捕获并一起绘制成一个图表时，它提供了理解应用程序行为的第一步。让我们探索几个例子：
- en: When the average response time goes up but the throughput (requests per minute)
    stays the same, this might be an indication that the infrastructure that hosts
    the application is having issues.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当平均响应时间上升，但吞吐量（每分钟请求数）保持不变时，这可能表明托管应用程序的基础设施出现了问题。
- en: When both the throughput and the average response times go up, this might be
    an indication that traffic is increasing and that the current infrastructure is
    not capable of sustaining that throughput at the same response times.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当吞吐量和平均响应时间同时上升时，这可能表明流量增加，当前的基础设施无法在相同的响应时间下承受如此高的吞吐量。
- en: When the error rate goes up but the other metrics stay the same, this might
    be an indication that a deployment has gone wrong or that a specific code path
    is starting to generate (more) errors.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当错误率上升，而其他指标保持不变时，这可能表明部署出现了问题，或者某个特定的代码路径开始产生（更多）错误。
- en: Of course, these are just examples, and there are many more possible scenarios.
    Other metrics can help to rule out a specific scenario or try to avoid them. For
    example, also starting to monitor the database load as a percentage can help detect
    a specific instance of all three scenarios. If the database load gets close to
    100%, it might be time to scale the database up to a higher performance tier to
    help to sustain the higher throughput at the same response times as before.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这些仅仅是例子，还有许多可能的场景。其他指标可以帮助排除某些特定场景或避免它们。例如，开始监控数据库负载百分比也可以帮助检测这三种场景的具体实例。如果数据库负载接近
    100%，可能是时候将数据库升级到更高性能的层级，以便在相同响应时间下支持更高的吞吐量。
- en: To conclude this section, there is one final recommendation – when starting
    with monitoring, there is often a tendency to focus on the systems that host the
    application. As an alternative, also consider monitoring metrics that have a direct
    business impact or metrics that are an indication of user satisfaction in terms
    of the usability of an application. This comes much closer to measuring business
    value than when only you watch systems.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 总结这一部分时，有一个最终的建议——在开始监控时，通常有一种倾向是专注于托管应用程序的系统。作为替代方案，也可以考虑监控那些对业务有直接影响的指标，或者反映用户满意度的指标，这些指标与应用程序的可用性相关。与仅仅监控系统相比，这种方法更接近于衡量业务价值。
- en: 'Some examples of this are as follows:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些例子：
- en: In an online shop, the number of books sold per minute can be a very valuable
    business metric. Just imagine the impact it can have on a business if this metric
    is available in near real time using Azure Monitor and custom metrics from the
    application code.
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在一个在线商店中，每分钟销售的书籍数量可以是一个非常有价值的业务指标。试想一下，如果通过 Azure Monitor 和应用程序代码中的自定义指标，能够几乎实时地获取该指标，这对业务的影响将有多大。
- en: For an online reading platform, the number of virtual page turns can be a valuable
    metric that signals whether users are happily working with the service. As soon
    as this number sees a sharp drop or rapidly increases, this might be an indication
    that something is going wrong.
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于一个在线阅读平台，虚拟翻页次数可以是一个有价值的指标，能够反映用户是否愉快地使用该服务。一旦该数字出现急剧下降或快速增长，可能表明出现了问题。
- en: To find out which metrics make sense in a given scenario, it might help to talk
    to business or subject matter experts.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 要找出在特定场景下哪些指标是有意义的，可能需要与业务或领域专家进行交流。
- en: Having an on-call schedule
  id: totrans-194
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 制定待命排班表
- en: Once alerts are configured and start to be raised, it does not make sense to
    configure them to not trigger before 8 AM and after 5 PM. In other words, it is
    necessary to make sure that alerts of a certain severity are followed up even
    outside of business hours.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦配置了警报并开始触发，就没有必要设置警报在早上 8 点之前或下午 5 点之后不触发。换句话说，必须确保一定严重程度的警报即使在非工作时间也能得到跟进。
- en: In many companies where having alerts is new, there is some form of implicit
    expectation that some people will be available outside of office hours (alongside
    their regular duties) to handle these alerts. Sometimes, when an alert is raised
    only once or twice a year, and there are no agreements about response times, this
    might not even be a problem at all.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多引入警报的新公司中，存在一种隐性预期，即某些人在正常工作时间以外（除了完成常规工作任务）需要处理这些警报。有时，如果警报每年只触发一次或两次，而且没有关于响应时间的协议，这可能根本不会成为问题。
- en: However, in many organizations – especially over time – there is an expectation
    that these alerts are responded to within a certain period of time. Besides that,
    the number of alerts may increase as systems become larger and more complex, or
    the number of systems grows.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在许多组织中——尤其是随着时间的推移——存在一种期望，即这些警报需要在一定时间内得到响应。此外，随着系统规模的扩大和复杂性增加，或者系统数量的增加，警报的数量也可能会增加。
- en: The way to cope with this is by creating an on-call schedule and formal agreements
    on what is expected of engineers and how the organization will reward them for
    their efforts. This allows the organization to set clear expectations and allows
    engineers to manage their free time based on these agreements. Having enough system
    downtime helps the engineers relax between periods of higher stress. This allows
    them to stay alert when they are on call, ready to react when this is expected
    of them.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 应对这一问题的方式是制定待命排班表，并与工程师达成正式协议，明确他们的期望以及组织如何奖励他们的努力。这使得组织能够设定清晰的期望，并且工程师可以根据这些协议来管理自己的空闲时间。足够的系统停机时间可以帮助工程师在高压期之间放松，从而确保他们在待命时保持警觉，随时准备响应。
- en: 'There is much material available on what constitutes a healthy on-call schedule
    and what doesn’t, and the keyword here is *healthy*. Some general pointers are
    as follows:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多资料讨论什么构成健康的待命排班表，什么不构成，而这里的关键词是*健康*。一些常见的建议如下：
- en: Those who are on call during non-business hours should not be on call during
    business hours as well.
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在非工作时间待命的人员不应在工作时间也待命。
- en: Provide engineers who are on call with reasonable compensation for being close
    to a phone, not under the influence, and so on. What is reasonable differs from
    situation to situation, but the more demanding being on call is, the higher the
    compensation should be.
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为待命的工程师提供合理的补偿，以奖励他们保持电话畅通、不受干扰等。什么是合理的补偿因情况而异，但待命的要求越高，补偿就应该越高。
- en: Provide the proper tools for being on call. For example, when a response time
    of 30 minutes or less is expected, provide those on call with a backpack with
    a laptop, phone, and means to connect to the internet.
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为待命人员提供合适的工具。例如，当期望响应时间为 30 分钟或更短时，为待命人员提供一个背包，里面装有笔记本电脑、电话和上网工具。
- en: Ensure that every employee is not on call at least 75% of the time.
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保每个员工在至少 75% 的时间内不需要待命。
- en: Allow employees to take time off in lieu so that they can be late for work if
    they had to respond to an alert overnight.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许员工在换休时休假，这样如果他们需要在晚上响应警报，第二天上班时可以迟到。
- en: After every disturbance of the normal operation of a system, whether this is
    during business hours or after, a live site incident review can be performed to
    learn what happened and how to reduce the chance of it happening again.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 每次系统正常运行被打断后，无论是在工作时间还是工作时间外，都可以进行现场事故审查，了解发生了什么，并探讨如何降低再次发生的可能性。
- en: Live site reviews
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 现场审查
- en: 'After an alert is triggered and the team has responded and remediated the situation,
    it is time to evaluate what happened. This is called a live site incident review.
    Here, the whole team gathers to address the following:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 当警报触发后，团队响应并解决问题后，便是评估发生了什么的时候。这就是现场事故审查。在此，整个团队会聚集在一起，讨论以下内容：
- en: What happened – to start, a timeline should be constructed from the time the
    incident was discovered to the point that normal operations were restored. Next,
    the timeline is expanded with the events that led to the situation that triggered
    the incident.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发生了什么——首先，应该从事件被发现的时间开始，构建一个时间线，直到正常操作恢复为止。接下来，时间线会扩展，加入导致触发事件的相关事件。
- en: Next, the series of events is evaluated to learn what worked well in the response.
    If one member of the team used a new tool to quickly diagnose a problem, this
    can benefit other members of the team as well.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 接下来，将评估一系列事件，以了解响应中哪些方面做得很好。如果团队成员之一使用了新工具快速诊断了问题，这可以让团队的其他成员也受益。
- en: Only then is it time to look at the possible points of improvement and translate
    these points into high-priority work for the team. Possible fail-safes are identified
    and scheduled for implementation or new alerts are identified that send an alert
    before a similar problem occurs again.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只有在此之后，才是审视可能改进的点，并将这些点转化为团队的高优先级任务的时候。可能的故障保护被识别并安排实施，或是识别出新的警报，这些警报会在类似问题再次发生之前发送预警。
- en: The alert or group of alerts that triggered the initial response is evaluated
    to determine whether they are adequate or possibly contain duplicates.
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 触发初步响应的警报或警报组会被评估，以确定它们是否足够充分或可能包含重复的警报。
- en: The best time for a live site incident review is as soon after the incident
    itself as possible. In practice, this means giving everyone enough time to rest
    and recuperate and plan a meeting for the next business day.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 最适合进行现场事件回顾的时机是事件发生后尽可能快的时间。实际上，这意味着给每个人足够的时间休息和恢复，并计划在下一个工作日召开会议。
- en: This completes our overview of Application Insights and the Azure Monitor capabilities
    for instrumenting web applications. The following section describes several approaches
    for integrating Application Insights and Azure Monitor with other tools.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 这完成了我们对**Application Insights**和Azure Monitor在仪表化Web应用程序方面的概述。接下来的部分描述了几种将Application
    Insights和Azure Monitor与其他工具集成的方法。
- en: Integrating with other tools
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 与其他工具的集成
- en: Azure Monitor and Application Insights are excellent tools for gathering application
    logs and metrics, as well as storing them and making them searchable. However,
    there could be reasons why development teams or businesses prefer to work with
    other tools to visualize application performance or respond to alerts. One important
    driver for integration is often the primary tool used by a person or team. If
    a team operates mainly in ServiceNow or Grafana, it is often useful to integrate
    these with Azure Monitor instead of forcing these teams to work with multiple
    tools.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Monitor和Application Insights是收集应用日志和指标的出色工具，同时也能存储它们并使其可搜索。然而，开发团队或企业可能有理由更倾向于使用其他工具来可视化应用性能或响应警报。集成的一个重要驱动因素通常是某个人或团队主要使用的工具。如果一个团队主要在ServiceNow或Grafana中工作，通常将这些工具与Azure
    Monitor集成，而不是强迫这些团队使用多个工具，是一种更有用的做法。
- en: Many possible integrations exist; some examples are detailed in the following
    subsections.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 存在许多可能的集成，以下子部分详细介绍了一些例子。
- en: IT service management applications
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IT服务管理应用程序
- en: Action groups were introduced in the previous section where we looked at instrumenting
    web applications. Action groups are groups of actions to be performed in response
    to an alert.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一部分中，我们讨论了如何对Web应用程序进行仪表化时引入了操作组。操作组是执行响应警报时需要进行的一组操作。
- en: Next to the rich built-in capabilities, it is also possible to automatically
    raise an alert in an existing **IT Service Management** (**ITSM**) solution. If
    there is already an ITSM solution in place within a company, it makes sense not
    to create a separate alerting channel using Azure Monitor. Instead, using an ITSM
    connector from Azure Monitor allows you to manage all the company-wide alerts
    from one solution.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 除了丰富的内置功能外，还可以在现有的**IT服务管理**（**ITSM**）解决方案中自动生成警报。如果公司内已有ITSM解决方案，那么使用Azure
    Monitor时不需要创建独立的警报渠道。相反，使用Azure Monitor的ITSM连接器可以让你通过一个解决方案来管理全公司范围的所有警报。
- en: Currently, there are integrations available with ServiceNow, Provance, System
    Center Service Manager, and more. These connections are created through the ITSM
    connector.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，已有与ServiceNow、Provance、System Center Service Manager等工具的集成。这些连接是通过ITSM连接器创建的。
- en: Azure Boards
  id: totrans-221
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Azure Boards
- en: In many development teams, Azure DevOps is the tool that developers spend most
    of their time with. This is also where they perform their backlog management using
    Azure Boards.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多开发团队中，Azure DevOps是开发人员花费大部分时间使用的工具。它也是他们通过Azure Boards进行待办事项管理的地方。
- en: Meanwhile, operators (and hopefully, developers, too) perform investigative
    work in Application Insights to determine the cause of user errors and to drill
    down into the reasons for failure. This investigative work could result in new
    work that needs to be backlogged in Azure DevOps.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 与此同时，运维人员（希望开发人员也能参与）在Application Insights中进行调查工作，以确定用户错误的原因并深入分析故障原因。这项调查工作可能会产生新的任务，需要在Azure
    DevOps中加入待办事项。
- en: 'To facilitate this, integration between Application Insights and Azure DevOps
    can be configured from Application Insights by taking the following steps:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 为了便于操作，可以通过以下步骤在Application Insights中配置与Azure DevOps的集成：
- en: 'Navigate to the **Work Items** option on the left-hand side menu (**1**). This
    opens the view shown on the left in the following screenshot. Here, a connection
    to Azure Boards can be configured:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧菜单中导航到**工作项**选项（**1**）。这将打开以下截图中显示的视图。在这里，可以配置与Azure Boards的连接：
- en: '![Figure 12.13 – Application Insights – Work Item integration ](img/B18655_12_13.jpg)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.13 – Application Insights – 工作项集成](img/B18655_12_13.jpg)'
- en: Figure 12.13 – Application Insights – Work Item integration
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.13 – Application Insights – 工作项集成
- en: 'To configure the connection, the following details need to be filled out:'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要配置连接，需要填写以下详细信息：
- en: Enter the Azure DevOps link. Here, the name of the organization needs to be
    appended.
  id: totrans-229
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输入Azure DevOps链接。在此，需附加组织的名称。
- en: Select the Azure DevOps project to use. This can be selected from the dropdown.
  id: totrans-230
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择要使用的Azure DevOps项目。可以从下拉菜单中选择。
- en: Select a product area where new items will be created. By default, this is the
    same as the name of the project, unless you change it.
  id: totrans-231
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择一个将创建新项的产品区域。默认情况下，这与项目名称相同，除非你更改它。
- en: Provide the name of a user as the default owner of new work items.
  id: totrans-232
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供用户名称作为新工作项的默认所有者。
- en: After configuring this connection, a new **+ Create work item** button is visible
    on the relevant pages in Application Insights. This button allows you to create
    a bug with all the relevant information directly on the backlog.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 配置此连接后，在Application Insights的相关页面上将显示一个新的**+ 创建工作项**按钮。此按钮允许你在待办事项中直接创建一个包含所有相关信息的缺陷。
- en: Grafana
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Grafana
- en: Azure Monitor allows you to build simple, easy-to-use dashboards. The advantage
    of using Azure Monitor dashboards is that they integrate perfectly with all the
    other Azure practices, such as **Role-Based Access Control** (**RBAC**) and Azure
    Resource Manager templates.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Monitor允许你构建简单、易于使用的仪表板。使用Azure Monitor仪表板的优势在于它们与所有其他Azure实践（如**基于角色的访问控制**（**RBAC**）和Azure资源管理器模板）完美集成。
- en: However, teams may have already adopted other tools for visualization, such
    as Grafana. Grafana is a well-known platform that works well with operational
    dashboards. Grafana can be configured to connect using Azure Monitor and can query
    metrics for graphing. Grafana also has alerting capabilities.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，团队可能已经采用了其他可视化工具，如Grafana。Grafana是一个著名的平台，适用于操作仪表板。Grafana可以配置为使用Azure Monitor连接，并查询指标以进行图表绘制。Grafana还具备告警功能。
- en: 'To connect Grafana to Azure Monitor, the following steps need to be taken:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 要将Grafana连接到Azure Monitor，需要执行以下步骤：
- en: Create a new app registration in the Azure Active Directory account that is
    used by your Azure subscription. Take note of the **Tenant ID**, **Client ID**,
    **Subscription ID**, and **Client Secret** properties of this app registration.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的Azure订阅所使用的Azure Active Directory帐户中创建一个新的应用程序注册。记下此应用程序注册的**租户ID**、**客户端ID**、**订阅ID**和**客户端机密**属性。
- en: Create a new RBAC role assignment for the app registration, with at least the
    **Reader** permissions set on the resources to monitor.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为应用程序注册创建一个新的RBAC角色分配，并至少在要监视的资源上设置**Reader**权限。
- en: Configure a new data source in Grafana of the **Azure Monitor** type. Insert
    the properties collected in *step 1* for authenticating to Azure.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Grafana中配置一个新的**Azure Monitor**类型的数据源。插入在*步骤1*中收集的用于Azure身份验证的属性。
- en: Add a new graph to the dashboard, selecting **Azure Monitor** as a data source.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向仪表板添加一个新图表，选择**Azure Monitor**作为数据源。
- en: By taking the preceding steps, a Grafana-to-Azure Monitor connection can be
    set up within a matter of minutes.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行前面的步骤，可以在几分钟内设置Grafana与Azure Monitor的连接。
- en: Summary
  id: totrans-243
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, you learned how to start completing the DevOps loop. You also
    learned how to work with crash reports and gather them from all types of applications,
    as well as how to instrument web applications. You now know how to use Application
    Insights to centralize logs and metrics and to get insight into requests and dependency
    calls. You also learned how you can integrate Azure Monitor with other tools to
    further streamline your development processes.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您学习了如何开始完成 DevOps 循环。您还学会了如何处理崩溃报告，并从各种类型的应用程序中收集这些报告，以及如何为 Web 应用程序添加监控。您现在知道如何使用
    Application Insights 集中日志和度量，并获取请求和依赖调用的洞察。您还学会了如何将 Azure Monitor 与其他工具集成，以进一步简化开发流程。
- en: With this knowledge, you can now start learning about how your applications
    operate in production. By doing so, you can not only deliver your software faster
    but also learn from its usage and start improving from there.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 有了这些知识，您现在可以开始了解您的应用程序在生产环境中的运行情况。通过这样做，您不仅能更快地交付软件，还能从其使用情况中学习并开始改进。
- en: In the next chapter, you will learn about gathering user feedback to complement
    what you have learned from your system logs and metrics. You will also learn how
    to measure end user satisfaction with your application and new features.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，您将学习如何收集用户反馈，以补充您从系统日志和度量中学到的内容。您还将学习如何衡量最终用户对您的应用程序和新功能的满意度。
- en: Questions
  id: totrans-247
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'As we conclude, here is a list of questions for you to test your knowledge
    regarding this chapter’s material. You will find the answers in the *Assessments*
    section of the *Appendix*:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们总结时，这里有一份问题清单，供您测试自己对本章内容的理解。您可以在*附录*的*评估*部分找到答案：
- en: It is possible to capture custom metrics from the Azure platform offerings using
    Application Insights – true or false?
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是否可以使用 Application Insights 从 Azure 平台服务中捕获自定义度量？——对还是错？
- en: How long are platform metrics retained for in Azure Monitor?
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure Monitor 中，平台度量的保留时间是多少？
- en: It is possible to capture custom metrics from your own application code using
    Application Insights – true or false?
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是否可以使用 Application Insights 从您自己的应用程序代码中捕获自定义度量？——对还是错？
- en: What do you call a situation where engineers start ignoring alerts as they are
    worn down by too many of them?
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当工程师因为收到过多警报而开始忽视这些警报时，这种情况被称为什么？
- en: It is possible to call a Webhook when an alert fires in Azure – true or false?
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure 中，当警报触发时，是否可以调用 Webhook？——对还是错？
- en: Further reading
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: More information about the App Center SDK can be found at [https://docs.microsoft.com/en-us/appcenter/sdk/](https://docs.microsoft.com/en-us/appcenter/sdk/).
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于 App Center SDK 的更多信息可以在[https://docs.microsoft.com/en-us/appcenter/sdk/](https://docs.microsoft.com/en-us/appcenter/sdk/)找到。
- en: 'Azure Monitor-supported metrics by resource type: [https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/metrics-supported](https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/metrics-supported).'
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Monitor 按资源类型支持的度量：[https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/metrics-supported](https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/metrics-supported)。
- en: More information on Raygun can be found at [https://raygun.com](https://raygun.com).
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于 Raygun 的更多信息可以在[https://raygun.com](https://raygun.com)找到。
- en: More detailed information on configuring Application Insights is available at
    [https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview](https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview).
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 Application Insights 的更详细信息可以在[https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview](https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview)找到。
- en: The KQL reference page can be found at [https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference](https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference).
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: KQL 参考页面可以在[https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference](https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference)找到。
